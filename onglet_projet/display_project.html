<!-- Description: Page d'affichage des projets -->
<div style="display: flex; justify-content: space-between; margin: 10px;">
    <button type="button" class="box-clicable" id="createProject"
        style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
        <!-- icone plus -->
        <img src="https://img.icons8.com/ios/50/000000/plus-math.png"
            style="width: 20px; height: 20px; margin-right: 5px;" alt="">
        Nouveau Projet
    </button>

    <div style="display: flex; justify-content: flex-end; margin: 10px;">
        <!-- Bouton afficher tous les projets -->
        <button type="button" class="box-clicable" id="allProjects"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone liste -->
            <img src="https://img.icons8.com/ios/50/000000/list.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Tous les Projets
        </button>

        <!-- Bouton Mes projets -->
        <button type="button" class="box-clicable" id="myProjects"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone profil -->
            <img src="https://img.icons8.com/ios/50/000000/user.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Mes projets
        </button>

        <!-- Bouton Archives -->
        <button type="button" class="box-clicable" id="archives_projects"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone archive -->
            <img src="https://img.icons8.com/ios/50/000000/archive-folder.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Archives
        </button>
    </div>
</div>


<!-- Barre  de recherche -->
<div class="container">
    <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Rechercher un projet" aria-label="Rechercher un projet"
            aria-describedby="button-addon2" id="search_projects">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" id="button-addon2">
                <!-- icone loupe (couleur grise) -->
                <img src="https://img.icons8.com/ios/50/000000/search--v1.png" style="width: 20px; height: 20px;"
                    alt="">
                Rechercher</button>
        </div>
    </div>
</div>


<body>
    <!--#region Formulaire de création de projet -->
    <br style="color: #000; font-size: 20px; font-weight: bold; text-align: center;" />
    <div class="container" id="new_project_form" style="display: none;" class="main-group-scroll">
        <form id="projectForm" class="container" style="border-radius: 15px; background-color: white;">
            <div class="row">
                <div class="col-md-12">
                    <p>Remplissez les champs suivants:</p>
                    <hr class="gray-border">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="projectTitle">Titre du projet: <span style="color: red;">*</span></label>
                    <input type="text" id="projectTitle" name="projectTitle" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="projectType">Type de projet: <span style="color: red;">*</span></label>
                    <input type="text" id="projectType" name="projectType" class="form-control" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="projectDate">Date de début prévisionnelle: <span style="color: red;">*</span></label>
                    <input type="date" id="projectDate" name="projectDate" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="projectEndDate2">Date de fin prévisionnelle: <span style="color: red;">*</span></label>
                    <input type="date" id="projectEndDate2" name="projectEndDate2" class="form-control" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="projectLocation">Pays de réalisation du projet: <span
                            style="color: red;">*</span></label>
                    <input type="text" id="projectLocation" name="projectLocation" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="pademResponsible">Responsable Padem:</label>
                    <input type="text" id="pademResponsible" name="pademResponsible" class="form-control">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="pademResponsibleEmail">Email du responsable Padem:</label>
                    <input type="email" id="pademResponsibleEmail" name="pademResponsibleEmail" class="form-control">
                </div>
                <div class="col-md-6">
                    <label for="projectReferent">Référent du projet: <span style="color: red;">*</span></label>
                    <input type="text" id="projectReferent" name="projectReferent" class="form-control" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="projectReferentEmail">Email du référent du projet: <span
                            style="color: red;">*</span></label>
                    <input type="email" id="projectReferentEmail" name="projectReferentEmail" class="form-control"
                        required>
                </div>
                <div class="col-md-6">
                    <label for="projectDescription">Description du projet: <span style="color: red;">*</span></label>
                    <textarea id="projectDescription" name="projectDescription" rows="4" cols="50"
                        class="form-control"></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12" id="add_trames">
                    <!-- Saisir les noms des documents models que vous comptez joindre ci-dessous à ce projet: -->
                    <label for="projectDocuments">Saisir le nom de la trame à joindre au projet: <span
                            style="color: red;">*</span></label>
                    <textarea type="text" id="projectDocuments" name="projectDocuments" class="form-control" rows="4"
                        required></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <hr class="gray-border">
                </div>
            </div>
            <!--
            <div class="row">
                <div class="col-md-6">
                    <label for="projectCover">Ajoutez une image de couverture pour le projet:</label>
                    <input type="file" id="projectCover" name="projectCover" accept="image/*" class="form-control-file">
                </div>
            </div>-->
            <div class="row">
                <div class="col-md-12">
                    <div class="action-buttons" style="display: flex; justify-content: flex-end;">
                        <button type="button" onclick="cancelProject()" class="btn btn-secondary"
                            style="width: fit-content;">
                            Annuler
                            <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="cancel"
                                style="width: 35px; height: 35px;">
                        </button>
                        <button type="button" onclick="saveFormData()" class="btn btn-primary"
                            style="color: white; width: fit-content;">
                            Enregistrer
                            <img src="https://lab.padem.org/wp-content/uploads/save_black.png" alt="save"
                                style="width: 35px; height: 35px;">
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!--#endregion -->

    <div id="all_projects_details_container" style="display: block;">
        <!--#region Tableau des projets -->
        <div id="all_projects_table" class="main-group-scroll">
            <table>
                <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                    <tr>
                        <th scope="col" id="project_tite">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="country_name">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="association_name">Association <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="theme_name">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="status_name">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                style="width: 15px; height: 15px;" alt=""></th>
                    </tr>
                </thead>
                <tbody id="display_projects">
                </tbody>
            </table>
        </div>
        <!--#endregion -->

        <!--#region Afficher les détails du projet sélectionné -->
        <div class="container" id="project_details" style="display: none;" class="main-group-scroll">
            
        </div>
        <!--#endregion -->
    </div>

    <!-- Mes projets -->
    <div class="container" id="my_projects_table" style="display: none;" class="main-group-scroll">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="my_project_tite">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="my_country_name">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="my_association_name">Association <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="my_theme_name">Thématique <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="my_status_name">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="display_my_projects">
            </tbody>
        </table>
    </div>
    <!--#endregion -->

    <!-- Archives -->
    <div class="container" id="archives_projects_table" style="display: none;" class="main-group-scroll">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="archives_project_tite">Titre <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="archives_country_name">Pays <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="archives_association_name">Association <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="archives_theme_name">Thématique <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="archives_status_name">Statut <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="display_archives_projects">
            </tbody>
        </table>
    </div>
    <!--#endregion -->

    <script>
        //#region Initialisation des variables
        var projects = [];
        var users = [];
        var projectManagers = [];
        var projectMembers = [];

        // Récupérer les données de l'utilisateur connecté
        var userEmail = current_user_data.email;
        var userRole = current_user_data.roles;
        var userId = current_user_data.ID;

        // Variables des filtres
        var status_list = ['En cours', 'En attente', 'Terminé'];
        var country_list = [];
        var association_list = [];
        var theme_list = [];

        //#region Model de projet
        var project_model = {
            id: 0,
            project_id: 0,
            project_title: "",
            project_type: "",
            start_date: "",
            end_date: "",
            updated_date: "",
            project_location: "",
            project_status: "",
            padem_responsible: "",
            padem_responsible_email: "",
            project_referent: "",
            project_referent_email: "",
            project_description: JSON.stringify(""),
            background_image_link: "",
            folders: "",
        };
        //#endregion

        //#endregion

        // Chargement de la page
        document.addEventListener('DOMContentLoaded', function (e) {
            e.preventDefault();

            // Afficher le tableau des projets
            document.getElementById('all_projects_table').style.display = 'block';
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';

            document.getElementById('allProjects').style.color = '#29A6A7';

            //#region Vérifier si l'utilisateur connecté est un administrateur, un membre privilégié ou un abonné(subscriber)
            if (userRole.includes('administrator')) {
                // Afficher le bouton Créer un Projet
                document.getElementById('createProject').style.display = 'block';
                // Afficher le bouton Mes projets
                document.getElementById('myProjects').style.display = 'block';
                // Afficher le bouton Archives
                document.getElementById('archives_projects').style.display = 'block';
            }
            else if (userRole.includes('um_member')) {
                // Afficher le bouton Créer un Projet
                document.getElementById('createProject').style.display = 'none';
                // Afficher le bouton Mes projets
                document.getElementById('myProjects').style.display = 'block';
                // Afficher le bouton Archives
                document.getElementById('archives_projects').style.display = 'block';
            }
            else if (userRole.includes('subscriber')) {
                // Afficher le bouton Créer un Projet
                document.getElementById('createProject').style.display = 'none';
                // Afficher le bouton Mes projets
                document.getElementById('myProjects').style.display = 'block';
                document.getElementById('myProjects').disabled = true;
                // Afficher le bouton Archives
                document.getElementById('archives_projects').style.display = 'block';
                document.getElementById('archives_projects').disabled = true;
            }
            //#endregion

            // Récupération des utilisateurs
            getUsers();
            // Récupération des projets
            getProjects();
        });

        //#region écouteur d'événement pour les filtres
        document.getElementById('project_tite').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher un menu déroulant pour les filtres

        });

        document.getElementById('country_name').addEventListener('click', function (e) {
            e.preventDefault();


        });

        document.getElementById('association_name').addEventListener('click', function (e) {
            e.preventDefault();
            projects.sort((a, b) => a.association.localeCompare(b.association));
            displayProjects(projects);
        });

        document.getElementById('theme_name').addEventListener('click', function (e) {
            e.preventDefault();
            projects.sort((a, b) => a.theme.localeCompare(b.theme));
            displayProjects(projects);
        });

        document.getElementById('status_name').addEventListener('click', function (e) {
            e.preventDefault();
            projects.sort((a, b) => a.status.localeCompare(b.status));
            displayProjects(projects);
        });
        //#endregion

        //#region ajouter écouteur d'événement pour le bouton Tous les Projets
        document.getElementById('allProjects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = '#29A6A7';
            document.getElementById('allProjects').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.border = 'gray';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = 'gray';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = 'gray';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher le tableau des projets
            document.getElementById('all_projects_details_container').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';
        });
        //#endregion

        //#region ajouter écouteur d'événement pour le bouton Créer un Projet
        document.getElementById('createProject').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = 'gray';
            document.getElementById('allProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer, et la couleur du texte
            document.getElementById('createProject').style.border = '#29A6A7';
            document.getElementById('createProject').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = 'gray';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = 'gray';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher le formulaire de création de projet
            document.getElementById('new_project_form').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('all_projects_details_container').style.display = 'none';
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Mes projets
        document.getElementById('myProjects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = 'gray';
            document.getElementById('allProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = '#29A6A7';
            document.getElementById('myProjects').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.border = 'gray';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = 'gray';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher les projets de l'utilisateur connecté
            document.getElementById('my_projects_table').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('all_projects_details_container').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';
        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Archives
        document.getElementById('archives_projects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = 'gray';
            document.getElementById('allProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = '#29A6A7';
            document.getElementById('archives_projects').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.border = 'gray';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = 'gray';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            // Afficher les archives des projets
            document.getElementById('archives_projects_table').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('all_projects_details_container').style.display = 'none';
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';
        });
        //#endregion


        //#region Récupération des utilisateurs
        function getUsers() {
            fetch('https://api.ynov.jcatania.io/user')
                .then(response => response.json())
                .then(data => {
                    users = data;
                    projectManagers = users.filter(user => user.roles.includes('project_manager'));
                    projectMembers = users.filter(user => user.roles.includes('project_member'));
                    displayProjectManagers(projectManagers);
                    displayProjectMembers(projectMembers);
                })
                .catch(error => console.error('Erreur récupération des utilisateurs:', error));
        }
        //#endregion

        //#region Récupération des projets
        function getProjects() {
            // Afficher l'animation de chargement
            document.getElementById('loading').style.display = 'block';
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    projects = data;
                    displayProjects(projects);
                    // Masquer l'animation de chargement
                    document.getElementById('loading').style.display = 'none';
                })
                .catch(error => { 
                    console.error('Erreur récupération des projets:', error)
                    // Masquer l'animation de chargement
                    document.getElementById('loading').style.display = 'none';
                });
        }
        //#endregion

        //#region Affichage des projets (Chaque projet est une ligne du tableau avec des bordures et des angles arrondis)
        function displayProjects(projects) {
            var displayProjects = document.getElementById('display_projects');
            displayProjects.innerHTML = '';
            projects.forEach(project => {
                let tr = document.createElement('tr');
                let td = document.createElement('td');
                tr.className = 'card';
                tr.style.border = '1px solid lightgray';
                tr.style.borderRadius = '25px';
                tr.style.backgroundColor = 'white';
                tr.style.margin = '5px';
                tr.style.padding = '5px';
                tr.style.height = '50px';
                tr.style.cursor = 'pointer';
                tr.style.display = 'flex';
                tr.style.justifyContent = 'space-between';
                tr.id = project.project_id;
                tr.addEventListener('click', function () { // Afficher les détails du projet
                    document.getElementById('all_projects_table').style.display = 'none';
                    document.getElementById('project_details').style.display = 'block';
                    displayProject(project.project_id);
                });
                tr.innerHTML = `
                    <td class="card-body" style="color: #29A6A7; margin-left: 5px;">${project.project_title}</td>
                    <td class="card-body">${project.project_location}</td>
                    <td class="card-body">${project.association}</td>
                    <td class="card-body">${project.project_type}</td>
                    <td class="card-body" style="background-color: ${project.project_status === 'En cours' ? 'lightgreen' : project.project_status === 'Terminé' ? 'lightcoral' : 'lightgray'}; border-radius: 10px; margin: 5px; padding: 5px; width: fit-content;">
                        <p style="color: ${project.project_status === 'En cours' ? 'green' : project.project_status === 'Terminé' ? 'red' : 'gray'};">${project.project_status}</p>
                `;
                displayProjects.appendChild(tr);
            });
        }
        //#endregion

        // Barre de recherche

        // Mes projets
        function getUserProjects() {
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    projects = data;
                    displayMyProjects();
                })
                .catch(error => console.error('Erreur récupération des projets:', error));
        }
        function displayMyProjects() {
            let myProjects = projects.filter(project => project.manager === userId || project.members.includes(userId));
            displayProjects(myProjects);
        }

        //#region Archives
        function displayArchivesProjects() {
            let archivesProjects = projects.filter(project => project.status === 'Archivé');
            displayProjects(archivesProjects);
        }
        //#endregion

        //#region Get months' names
        function getMonthName(month) {
            let monthName = '';
            switch (month) {
                case 0:
                    monthName = 'Janvier';
                    break;
                case 1:
                    monthName = 'Février';
                    break;
                case 2:
                    monthName = 'Mars';
                    break;
                case 3:
                    monthName = 'Avril';
                    break;
                case 4:
                    monthName = 'Mai';
                    break;
                case 5:
                    monthName = 'Juin';
                    break;
                case 6:
                    monthName = 'Juillet';
                    break;
                case 7:
                    monthName = 'Août';
                    break;
                case 8:
                    monthName = 'Septembre';
                    break;
                case 9:
                    monthName = 'Octobre';
                    break;
                case 10:
                    monthName = 'Novembre';
                    break;
                case 11:
                    monthName = 'Décembre';
                    break;
                default:
                    monthName = 'Non renseigné';
                    break;
            }
            return monthName;
        }
        //#endregion

        //#region Get days' names
        function getDayName(day) {
            let dayName = '';
            switch (day) {
                case 0:
                    dayName = 'Dimanche';
                    break;
                case 1:
                    dayName = 'Lundi';
                    break;
                case 2:
                    dayName = 'Mardi';
                    break;
                case 3:
                    dayName = 'Mercredi';
                    break;
                case 4:
                    dayName = 'Jeudi';
                    break;
                case 5:
                    dayName = 'Vendredi';
                    break;
                case 6:
                    dayName = 'Samedi';
                    break;
                default:
                    dayName = 'Non renseigné';
                    break;
            }
            return dayName;
        }
        //#endregion

        //#region Fonction pour ajouter un projet
        function newProject() {
            var projectTitle = document.getElementById('projectTitle').value;
            var projectType = document.getElementById('projectType').value;
            var projectDate = document.getElementById('projectDate').value;
            var projectEndDate2 = document.getElementById('projectEndDate2').value;
            var projectLocation = document.getElementById('projectLocation').value;
            var pademResponsible = document.getElementById('pademResponsible').value;
            var pademResponsibleEmail = document.getElementById('pademResponsibleEmail').value;
            var projectReferent = document.getElementById('projectReferent').value;
            var projectReferentEmail = document.getElementById('projectReferentEmail').value;
            var projectDescription = document.getElementById('projectDescription').value;
            var projectDocuments = document.getElementById('projectDocuments').value;

            var project = {
                project_title: projectTitle,
                project_type: projectType,
                start_date: projectDate,
                end_date: projectEndDate2,
                updated_date: new Date(),
                project_location: projectLocation,
                project_status: 'En attente',
                padem_responsible: pademResponsible,
                padem_responsible_email: pademResponsibleEmail,
                project_referent: projectReferent,
                project_referent_email: projectReferentEmail,
                project_description: projectDescription,
                background_image_link: '',
                folders: projectDocuments,
            };

            fetch('https://lab.padem.org/wp-json/mo/v1/addProject', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(project),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    getProjects();
                    document.getElementById('new_project_form').style.display = 'none';
                    document.getElementById('all_projects_details_container').style.display = 'block';
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
        //#endregion

        //#region Liste des fonctions pour les actions sur les projets
        // Fonction pour ajouter une association à un projet
        function addAssociationToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var associations = project.association;
            var association = prompt('Saisir le nom de l\'association à ajouter au projet:');
            if (association !== null) {
                associations.push(association);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, association: associations }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }
        // Fonction pour ajouter un membre à un projet
        function addMemberToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var members = project.members;
            var member = prompt('Saisir le nom du membre à ajouter au projet:');
            if (member !== null) {
                members.push(member);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, members: members }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }
        // Fonction pour ajouter un document à un projet
        function addDocumentToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var documents = project.documents;
            var document = prompt('Saisir le nom du document à ajouter au projet:');
            if (document !== null) {
                documents.push(document);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, documents: documents }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }
        // Fonction pour ajouter un rapport à un projet
        function addReportToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var reports = project.reports;
            var report = prompt('Saisir le nom du rapport à ajouter au projet:');
            if (report !== null) {
                reports.push(report);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, reports: reports }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }
        // Fonction pour éditer un projet
        function editProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var projectTitle = prompt('Saisir le nouveau titre du projet:', project.project_title);
            var projectType = prompt('Saisir le nouveau type du projet:', project.project_type);
            var projectDate = prompt('Saisir la nouvelle date de début du projet:', project.start_date);
            var projectEndDate2 = prompt('Saisir la nouvelle date de fin du projet:', project.end_date);
            var projectLocation = prompt('Saisir la nouvelle localisation du projet:', project.project_location);
            var pademResponsible = prompt('Saisir le nouveau responsable du projet:', project.padem_responsible);
            var pademResponsibleEmail = prompt('Saisir le nouvel email du responsable du projet:', project.padem_responsible_email);
            var projectReferent = prompt('Saisir le nouveau référent du projet:', project.project_referent);
            var projectReferentEmail = prompt('Saisir le nouvel email du référent du projet:', project.project_referent_email);
            var projectDescription = prompt('Saisir la nouvelle description du projet:', project.project_description);
            var projectDocuments = prompt('Saisir les nouveaux documents du projet:', project.folders);

            var updatedProject = {
                project_title: projectTitle,
                project_type: projectType,
                start_date: projectDate,
                end_date: projectEndDate2,
                updated_date: new Date(),
                project_location: projectLocation,
                project_status: project.project_status,
                padem_responsible: pademResponsible,
                padem_responsible_email: pademResponsibleEmail,
                project_referent: projectReferent,
                project_referent_email: projectReferentEmail,
                project_description: projectDescription,
                background_image_link: project.background_image_link,
                folders: projectDocuments,
            };

            fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ project_id: projectId, project: updatedProject }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    getProjects();
                    document.getElementById('all_projects_table').style.display = 'block';
                    document.getElementById('project_details').style.display = 'none';
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
        // Fonction pour archiver un projet
        function archiveProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);

            //#region Mettre à jour le projet
            fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    project_id: projectId,
                    project_title: project.project_title,
                    project_type: project.project_type,
                    start_date: project.start_date,
                    end_date: project.end_date,
                    is_archive: true, // Archiver le projet
                    updated_date: new Date(),
                    project_location: project.project_location,
                    project_status: 'Archivé',
                    padem_responsible: project.padem_responsible,
                    padem_responsible_email: project.padem_responsible_email,
                    project_referent: project.project_referent,
                    project_referent_email: project.project_referent_email,
                    project_description: project.project_description,
                    background_image_link: project.background_image_link,
                    users: project.users,
                    reports: project.reports,
                    folders: project.folders,
                    divers: project.divers,
                }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);

                    //#region Supprimer le projet de la liste des projets
                    fetch('https://lab.padem.org/wp-json/mo/v1/removeProjectData', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ column_param1: project.id }),
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Success:', data);
                            getProjects();
                            document.getElementById('all_projects_table').style.display = 'block';
                            document.getElementById('project_details').style.display = 'none';
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                    //#endregion
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            //#endregion

            //#region Envoyer un email à l'ensemble des membres du projet pour les informer de l'archivage du projet
            var projectMembers = project.users;
            var subject = 'Padem Lab Notifications: ' + 'Archivage du projet ' + project.project_title;
            var message = 'Bonjour, \n\nLe projet ' + project.project_title + ' a été archivé. \n\nCordialement, \n\nL\'équipe PADEM';
            
            // Envoyer un email à chaque membre du projet
            project.users.forEach(user => {
                var userEmail = users.find(u => u.ID === user).user_email;
                
                sendMailNotification(userEmail, subject, message);
            });
        }
        //#endregion
        //#endregion

        //#region Afficher le projet correspondant à l'ID
        function displayProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var displayProject = document.getElementById('project_details');
            // Vider le contenu
            displayProject.innerHTML = '';

            //#region Formater les dates
            var formated_updated_date = new Date(project.updated_date).toLocaleDateString('fr-FR'); // Formater la date
            var formated_start_date = new Date(project.start_date).toLocaleDateString('fr-FR');
            var formated_end_date = new Date(project.end_date).toLocaleDateString('fr-FR');

            var _updated_date = formated_updated_date.split('/'); // Récupérer la date
            var _start_date = formated_start_date.split('/');
            var _end_date = formated_end_date.split('/');

            var month_updated_date = getMonthName(parseInt(_updated_date[1])); // Récupérer le mois
            var month_start_date = getMonthName(parseInt(_start_date[1]));
            var month_end_date = getMonthName(parseInt(_end_date[1]));

            var day_updated_date = getDayName(new Date(project.updated_date).getDay()); // Récupérer le jour de la semaine
            var day_start_date = getDayName(new Date(project.start_date).getDay());
            var day_end_date = getDayName(new Date(project.end_date).getDay());

            var final_updated_date = day_updated_date + ' ' + _updated_date[0] + ' ' + month_updated_date + ' ' + _updated_date[2]; // Date finale
            var final_start_date = day_start_date + ' ' + _start_date[0] + ' ' + month_start_date + ' ' + _start_date[2];
            var final_end_date = day_end_date + ' ' + _end_date[0] + ' ' + month_end_date + ' ' + _end_date[2];
            //#endregion

            //#region Progression du projet (En cours, En attente, Terminé)
            var today = new Date();
            var start_date = new Date(project.start_date);
            var end_date = new Date(project.end_date);
            var progression = '';
            if (today < start_date) {
                progression = 'En attente';
            }
            else if (today >= start_date && today <= end_date) {
                progression = 'En cours';
            }
            else {
                progression = 'Terminé';
            }
            //#endregion

            displayProject.innerHTML = `
                <!-- Afficher le projet -->
                <div class="card-body" style="display: flex; justify-content: space-between; margin: 5px; padding: 5px; width: 100%; height: fit-content; border-radius: 25px; background-color: transparent;">
                    <!-- Boutons d'actions -->
                    <button type="button" id="add_association_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone groupe --> <img src="https://img.icons8.com/?size=100&id=23266&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <button type="button" id="add_member_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone personne --> <img src="https://img.icons8.com/?size=100&id=3&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <button type="button" id="add_document_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone ajouter document --> <img src="https://img.icons8.com/?size=100&id=57052&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <button type="button" id="add_report_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone soumettre rapport --> <img src="https://img.icons8.com/?size=100&id=5271&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <!-- Boutons d'édition -->
                    <button type="button" id="editProject" style="background-color: white; border-radius: 25px;"> <!-- icone crayon --> <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <button type="button" id="archiveProject" onclick="archiveProject(${project.project_id})" style="background-color: white; border-radius: 25px;"> <!-- icone archive --> <img src="https://img.icons8.com/?size=100&id=12634&format=png&color=FA5252" style="width: 20px; height: 20px;" alt=""></button>
                </div>
                <article class="card" style="margin: 5px; padding: 5px; border-radius: 25px;">
                    <!-- Informations du projet -->
                    <div style="display: flex; justify-content: space-between; margin: 5px; padding: 5px;">
                        <h4 style="color: #29A6A7; margin-top: 5px;">${project.project_title ? project.project_title : '---'}</h4>
                        <button type="button" id="back_To_All_Projects" style="background-color: #29A6A7; border-radius: 50px; width: fit-content; color: white; font-size: 12px;" title="Retour"> <!-- icone retour --> <img src="https://img.icons8.com/?size=100&id=3483&format=png&color=FFFFFF" style="width: 20px; height: 20px;" alt=""> Retour</button>
                    </div>
                    <div style="display: none;">
                        <div style="display: flex; justify-content: flex-start; margin-bottom: -5px;">
                            <button type="button" id="hide_show_details" style="width: fit-content; color: lightgray; font-size: 12px;" title=""> <img src="https://img.icons8.com/?size=100&id=986&format=png&color=9F9F9F" id="hide_show_details_icon_"
                                style="width: 20px; height: 20px;" alt="details">Masquer les détails du projet</button>
                        </div>
                        <hr style="border: 1px solid lightgray;">
                    </div>
                    <div style="display: block; margin: 5px; padding: 5px; border-radius: 25px; border: 1px solid lightgray;">
                        <!-- Détails du projet -->
                        <div id="project_details_container_">
                            <div style="border-radius: 25px; background-color: white; display: flex; justify-content: space-between;" id="project_details_container">
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Bailleur de fonds --> <img src="https://img.icons8.com/?size=100&id=Iv2ecGx6KYqh&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Bailleur: </p>
                                        <p style="color: black; margin-left: 5px;">${project.funder ? project.funder : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Groupe --> <img src="https://img.icons8.com/?size=100&id=779&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Association: </p>
                                        <p style="color: black; margin-left: 5px;">${project.association ? project.association : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Thématique --> <img src="https://img.icons8.com/?size=100&id=22798&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Thématique: </p>
                                        <p style="color: black; margin-left: 5px;">${project.project_type ? project.project_type : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone pays --> <img src="https://img.icons8.com/?size=100&id=17548&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Pays: </p>
                                        <p style="color: black; margin-left: 5px;">${project.project_location ? project.project_location : '---'}</p>
                                    </div>
                                </div>
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Responsable --> <img src="https://img.icons8.com/?size=100&id=21996&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Référent: </p>
                                        <p style="color: black; margin-left: 5px;">${project.project_referent ? project.project_referent : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de début --> <img src="https://img.icons8.com/?size=100&id=1072&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de début: </p>
                                        <p style="color: black; margin-left: 5px;">${final_start_date ? final_start_date : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de fin --> <img src="https://img.icons8.com/?size=100&id=1070&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de fin: </p>
                                        <p style="color: black; margin-left: 5px;">${final_end_date ? final_end_date : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- progress bar --> <img src="https://img.icons8.com/?size=100&id=39273&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Progression: </p>
                                        <p style="color: ${progression === 'En cours' ? 'green' : progression === 'Terminé' ? 'red' : 'gray'}; width: fit-content; margin-left: 5px;">${progression}</p>
                                    </div>
                                </div>
                                <!-- Bouton pour modifier les détails du projet -->
                                <button type="button" id="update_all_project_details" style="width: fit-content; margin-bottom: 150px;" title="Modifier les détails du projet"> <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=9F9F9F" id="update_all_project_details_icon"
                                    style="width: 55px; height: 30px;" alt="Modifier les détails du projet"></button>
                            </div>
                            <!-- Description du projet -->
                            <div id="project_description_container_main" style="display: block;">
                                <div style="display: flex; justify-content: flex-start; margin-bottom: -3px;">
                                    <button type="button" id="_project_description_" style="width: fit-content; color: gray; font-size: 12px;" title="">Voir la description du projet....</button>
                                </div>
                                <div id="project_description_container_" style="display: none;">
                                    <div style="display: column; justify-content: flex-start; margin: 5px; padding: 5px;">
                                        <p style="color: black; margin-left: 5px;">${project.project_description ? project.project_description : 'Aucune description disponible pour ce projet.'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Formulaire pour modifier les détails du projet -->
                        <div id="update_all_project_details_container_" style="display: none;">
                            <div style="display: flex; justify-content: space-between; margin: 5px; padding: 5px;">
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Bailleur de fonds --> <img src="https://img.icons8.com/?size=100&id=Iv2ecGx6KYqh&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Bailleur: </p>
                                        <input type="text" id="update_funder" value="${project.funder ? project.funder : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Groupe --> <img src="https://img.icons8.com/?size=100&id=779&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Association: </p>
                                        <input type="text" id="update_association" value="${project.association ? project.association : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Thématique --> <img src="https://img.icons8.com/?size=100&id=22798&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Thématique: </p>
                                        <input type="text" id="update_project_type" value="${project.project_type ? project.project_type : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone pays --> <img src="https://img.icons8.com/?size=100&id=17548&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Pays: </p>
                                        <input type="text" id="update_project_location" value="${project.project_location ? project.project_location : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                </div>
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Responsable --> <img src="https://img.icons8.com/?size=100&id=21996&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Référent: </p>
                                        <input type="text" id="update_project_referent" value="${project.project_referent ? project.project_referent : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de début --> <img src="https://img.icons8.com/?size=100&id=1072&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de début: </p>
                                        <input type="date" id="update_start_date" value="${project.start_date ? project.start_date : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de fin --> <img src="https://img.icons8.com/?size=100&id=1070&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de fin: </p>
                                        <input type="date" id="update_end_date" value="${project.end_date ? project.end_date : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Responsable --> <img src="https://img.icons8.com/?size=100&id=77&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Description: </p>
                                        <textarea id="update_project_description" style="color: gray; margin-left: 5px; width: fit-content; border: 1px solid lightgray; border-radius: 15px;" row="5">${project.project_description ? project.project_description : '---'}</textarea>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: flex-end; margin: 5px; padding: 5px;">
                                <button type="button" id="update_all_project_details_button" style="width: fit-content; background-color: #29A6A7; border-radius: 25px; color: white; font-size: 12px;" title="valider"> <!-- icone valider --> <img src="https://img.icons8.com/?size=100&id=11658&format=png&color=FFFFFF" style="width: 20px; height: 20px;" alt=""> Valider</button>
                                <div style="margin: 5px;"></div>
                                <button type="button" id="cancel_update_all_project_details" style="width: fit-content; background-color: red; border-radius: 25px; color: white; font-size: 12px;" title="annuler"> <!-- icone annuler --> <img src="https://img.icons8.com/?size=100&id=3062&format=png&color=FFFFFF" style="width: 20px; height: 20px;" alt=""> Annuler</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body" style="margin: 5px; padding: 5px; min-height: 300px; width: 100%;"">
                        <!-- Menu initial -->
                        <div id="first_menu_${project.project_id}" style="display: block;">
                            <div style="margin: 5px; display: flex; justify-content: space-between;">
                                <button type="button" id="_reports_requests_${project.project_id}" style="background-color: white; color: gray; border-radius: 15px; font-size: 13px;" class="box-clicable"> <!-- icone rapport --> <img src="https://img.icons8.com/?size=100&id=123478&format=png&color=9F9F9F" 
                                    style="width: 20px; height: 20px;" alt=""> Demandes de rapports</button>
                                <div style="margin: 5px; display: flex; justify-content: flex-end;">
                                    <button id="_project_reports_${project.project_id}" style="width: fit-content; color: gray; background-color: #E7E7E7; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/ios/50/9F9F9F/report-card.png"
                                            style="width: 15px; height: 15px;" alt=""> Rapports</button>
                                    <button id="_project_documents_${project.project_id}" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/ios/50/9F9F9F/document.png"
                                            style="width: 15px; height: 15px;" alt=""> Documents</button>
                                    <button id="_project_associations_${project.project_id}" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/?size=100&id=779&format=png&color=9F9F9F"
                                            style="width: 15px; height: 15px;" alt=""> Associations</button>                             
                                    <button id="_project_members_${project.project_id}" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/?size=100&id=21997&format=png&color=9F9F9F"
                                            style="width: 15px; height: 15px;" alt=""> Membres</button>
                                </div>
                            </div>
                            <!-- Ligne de séparation -->
                            <hr style="border: 1px solid lightgray;">
                            <div>
                                <div class="container" id="reportsRequests_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_tite_${project.project_id}_reports_requests">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="country_name_${project.project_id}_reports_requests">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="association_name_${project.project_id}_reports_requests">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}_reports_requests">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}_reports_requests">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_reports_requests_${project.project_id}" class="main-group
                                            -scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="container" id="projectReports_${project.project_id}" style="display: block;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_tite_${project.project_id}">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="country_name_${project.project_id}">Auteur <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="association_name_${project.project_id}">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}">Type de rapport <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_reports_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="container" id="projectAssociations_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_name_${project.project_id}">Nom <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="country_name_${project.project_id}">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="association_name_${project.project_id}">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_associations_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="container" id="projectMembers_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_tite_${project.project_id}_members">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="country_name_${project.project_id}_members">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="association_name_${project.project_id}_members">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}_members">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}_members">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_members_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="container" id="projectDocuments_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="doc_title_${project.project_id}">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="doc_name">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="doc_association_name">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="doc_theme_name">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="doc_status_name">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_documents_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Ajouter une association existante au projet -->
                        <div id="_menu_add_association_${project.project_id}" style="display: none;">
                            <form id="add_association_to_project_form_${project.project_id}" class="form-group">
                                <div class="form-group">
                                    <label for="association_${project.project_id}">Association</label>
                                    <select class="form-control" id="association_${project.project_id}" name="association">
                                        <option value="">Sélectionner une association</option>

                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Ajouter</button>
                            </form>
                        </div>

                        <!-- Ajouter un membre au projet -->
                        <div id="_menu_add_member_${project.project_id}" style="display: none;">
                            <form id="add_member_to_project_form_${project.project_id}" class="form-group">
                                <div class="form-group">
                                    <label for="member_${project.project_id}">Membre</label>
                                    <select class="form-control" id="member" name="member_${project.project_id}">
                                        <option value="">Sélectionner un membre</option>

                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Ajouter</button>
                            </form>
                        </div>  

                        <!-- Ajouter un document au projet (Formulaire & upload) -->
                        <div id="_menu_add_document_${project.project_id}" style="display: none;">
                            <form id="add_document_to_project_form_${project.project_id}" class="form-group">
                                <div class="form-group">
                                    <label for="document_title_${project.project_id}">Titre</label>
                                    <input type="text" class="form-control" id="document_title_${project.project_id}" name="document_title">
                                </div>
                                <div class="form-group">
                                    <label for="document_file_${project.project_id}">Fichier</label>
                                    <input type="file" class="form-control" id="document_file_${project.project_id}" name="document_file">
                                    <small id="fileHelp" class="form-text text-muted">Veuillez sélectionner un fichier PDF.</small>
                                </div>
                                <button type="submit" class="btn btn-primary">Ajouter</button>
                            </form>
                        </div>

                        <!-- Ajouter un nouveau rapport au projet -->
                        <div id="_menu_add_report_${project.project_id}" style="display: none;">
                            <form id="add_report_to_project_form_${project.project_id}" class="form-group">
                                <div class="form-group">
                                    <label for="report_title_${project.project_id}">Titre</label>
                                    <input type="text" class="form-control" id="report_title_${project.project_id}" name="report_title">
                                </div>
                                <!-- type de rapport -->
                                <div class="form-group">
                                    <label for="report_type_${project.project_id}">Type</label>
                                    <select class="form-control" id="report_type_${project.project_id}" name="report_type">
                                        <option value="">Sélectionner un type de rapport</option>
                                        <option value="Rapport d'activité">Rapport d'activité</option>
                                        <option value="Rapport financier">Rapport financier</option>
                                        <option value="Rapport de mission">Rapport de mission</option>
                                        <option value="Rapport de suivi">Rapport de suivi</option>
                                    </select>
                                </div>
                                <!-- Date du rapport -->
                                <div class="form-group">
                                    <label for="report_date_${project.project_id}">Date</label>
                                    <input type="date" class="form-control" id="report_date_${project.project_id}" name="report_date">
                                </div>
                                <div class="form-group">
                                    <label for="report_description">Description</label>
                                    <textarea class="form-control" id="report_description" name="report_description" rows="8"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="report_file_${project.project_id}">Fichier</label>
                                    <input type="file" class="form-control" id="report_file_${project.project_id}" name="report_file">
                                    <small id="fileHelp_${project.project_id}" class="form-text text-muted">Veuillez sélectionner un fichier PDF.</small>
                                </div>
                                <button type="submit" class="btn btn-primary">Ajouter</button>
                            </form>
                        </div>
                    </div>
                </article>
            `;

            //#region Ajouter écouteur d'événement pour le bouton "Modifier les détails du projet"
            document.getElementById('update_all_project_details').addEventListener('click', function () {
                document.getElementById('update_all_project_details_container_').style.display = 'block';
                document.getElementById('project_details_container_').style.display = 'none';
            });

            //#region Ajouter écouteur d'événement pour le bouton "Valider"
            document.getElementById('update_all_project_details_button').addEventListener('click', function () {
                var funder = document.getElementById('update_funder').value;
                var association = document.getElementById('update_association').value;
                var project_type = document.getElementById('update_project_type').value;
                var project_location = document.getElementById('update_project_location').value;
                var project_referent = document.getElementById('update_project_referent').value;
                var start_date = document.getElementById('update_start_date').value;
                var end_date = document.getElementById('update_end_date').value;
                var project_description = document.getElementById('update_project_description').value;

                // Vérifier si les champs sont vides
                if (funder === '' || association === '' || project_type === '' || project_location === '' || project_referent === '' || start_date === '' || end_date === '' || project_description === '') {
                    alert('Veuillez completer tous les champs.');
                }
                else {
                    // Mettre à jour les détails du projet
                    var project = {
                        project_id: project_id,
                        funder: funder,
                        association: association,
                        project_type: project_type,
                        project_location: project_location,
                        project_referent: project_referent,
                        start_date: start_date,
                        end_date: end_date,
                        project_description: project_description
                    };
                    updateProjectDetails(project);
                }
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton "Annuler"
            document.getElementById('cancel_update_all_project_details').addEventListener('click', function () {
                document.getElementById('update_all_project_details_container_').style.display = 'none';
                document.getElementById('project_details_container_').style.display = 'block';
            });
            //#endregion
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton "Masquer la description du projet"
            document.getElementById('_project_description_').addEventListener('click', function () {
                var project_description_container = document.getElementById('project_description_container_');
                if (project_description_container.style.display === 'block') {
                    project_description_container.style.animation = 'hide 1s';
                    project_description_container.style.display = 'none';
                    document.getElementById('_project_description_').innerHTML = 'Voir la description du projet....';
                }
                else {
                    project_description_container.style.animation = 'show 1s';
                    project_description_container.style.display = 'block';
                    document.getElementById('_project_description_').innerHTML = 'Masquer la description du projet';
                }
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton "Masquer les détails du projet"
            document.getElementById('hide_show_details').addEventListener('click', function () {
                var project_details_container = document.getElementById('project_details_container_');
                if (project_details_container.style.display === 'block') {
                    project_details_container.style.animation = 'hide 1s';
                    project_details_container.style.display = 'none';
                    document.getElementById('hide_show_details').innerHTML = 'Afficher les détails du projet';
                    document.getElementById('hide_show_details_icon_').src = 'https://img.icons8.com/?size=100&id=121539&format=png&color=9F9F9F';
                }
                else {
                    project_details_container.style.animation = 'show 1s';
                    project_details_container.style.display = 'block';
                    document.getElementById('hide_show_details').innerHTML = 'Masquer les détails du projet';
                    document.getElementById('hide_show_details_icon_').src = 'https://img.icons8.com/?size=100&id=986&format=png&color=9F9F9F';
                }
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton Retour aux projets
            document.getElementById('back_To_All_Projects').addEventListener('click', function (e) {
                e.preventDefault();
                
                // Masquer tout les autres éléments
                document.getElementById('project_details').style.display = 'none';
                // Afficher le tableau des projets
                document.getElementById('all_projects_table').style.display = 'block';
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton "Retour aux projets"
            document.getElementById('back_To_Projects').addEventListener('click', function (e) {
                e.preventDefault();
                backToProjects();
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons (Rapports, Documents, Associations, Membres, Demandes de rapports)
            document.getElementById(`_reports_requests_${project.project_id}`).addEventListener('click', function () {
                // Afficher les demandes de rapports & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'block';
                document.getElementById('projectReports_' + project.project_id).style.display = 'none';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = '#E7E7E7';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = 'white';
            });
            document.getElementById(`_project_reports_${project.project_id}`).addEventListener('click', function () {
                // Afficher les rapports du projet & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'none';
                document.getElementById('projectReports_' + project.project_id).style.display = 'block';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = '#E7E7E7';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = 'white';
            });
            document.getElementById(`_project_documents_${project.project_id}`).addEventListener('click', function () {
                // Afficher les documents du projet & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'none';
                document.getElementById('projectReports_' + project.project_id).style.display = 'none';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'block';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = '#E7E7E7';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = 'white';
            });
            document.getElementById(`_project_associations_${project.project_id}`).addEventListener('click', function () {
                // Afficher les associations du projet & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'none';
                document.getElementById('projectReports_' + project.project_id).style.display = 'none';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'block';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = '#E7E7E7';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = 'white';
            });
            document.getElementById(`_project_members_${project.project_id}`).addEventListener('click', function () {
                // Afficher les membres du projet & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'none';
                document.getElementById('projectReports_' + project.project_id).style.display = 'none';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'block';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = '#E7E7E7';
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons (entré/sortie de la souris) pour afficher le nom du bouton
            document.getElementById('add_association_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_association_to_project').innerHTML = 'Ajouter une Association';
                document.getElementById('add_association_to_project').style.color = 'white';
                document.getElementById('add_association_to_project').style.fontSize = '12px';
                document.getElementById('add_association_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_association_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_association_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=23266&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_association_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('add_member_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_member_to_project').innerHTML = 'Ajouter un Membre';
                document.getElementById('add_member_to_project').style.color = 'white';
                document.getElementById('add_member_to_project').style.fontSize = '12px';
                document.getElementById('add_member_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_member_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_member_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=3&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_member_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('add_document_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_document_to_project').innerHTML = 'Ajouter un Document';
                document.getElementById('add_document_to_project').style.color = 'white';
                document.getElementById('add_document_to_project').style.fontSize = '12px';
                document.getElementById('add_document_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_document_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_document_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=57052&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_document_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('add_report_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_report_to_project').innerHTML = 'Ajouter un Rapport';
                document.getElementById('add_report_to_project').style.color = 'white';
                document.getElementById('add_report_to_project').style.fontSize = '12px';
                document.getElementById('add_report_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_report_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_report_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=5271&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_report_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('editProject').addEventListener('mouseover', function () {
                document.getElementById('editProject').innerHTML = 'Modifier le Projet';
                document.getElementById('editProject').style.color = 'white';
                document.getElementById('editProject').style.fontSize = '12px';
                document.getElementById('editProject').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('editProject').addEventListener('mouseout', function () {
                document.getElementById('editProject').innerHTML = '<img src="https://img.icons8.com/?size=100&id=6697&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('editProject').style.backgroundColor = 'white';
            });

            document.getElementById('archiveProject').addEventListener('mouseover', function () {
                document.getElementById('archiveProject').innerHTML = 'Archiver le Projet';
                document.getElementById('archiveProject').style.color = 'white';
                document.getElementById('archiveProject').style.fontSize = '12px';
                document.getElementById('archiveProject').style.backgroundColor = 'red';
            });
            document.getElementById('archiveProject').addEventListener('mouseout', function () {
                document.getElementById('archiveProject').innerHTML = '<img src="https://img.icons8.com/?size=100&id=12634&format=png&color=FA5252" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('archiveProject').style.backgroundColor = 'white';
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements "click" pour les boutons (Ajouter une association, un membre, un document, un rapport, éditer, archiver)
            document.getElementById('add_association_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('add_association_to_project').style.backgroundColor = '#29A6A7';
                document.getElementById('add_association_to_project').style.color = 'white';
                document.getElementById('add_association_to_project').innerHTML = 'Annuler';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_member_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_report_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                }
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('add_member_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('add_member_to_project').style.backgroundColor = '#29A6A7';
                document.getElementById('add_member_to_project').style.color = 'white';
                document.getElementById('add_member_to_project').innerHTML = 'Annuler';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_association_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                }
                else if(document.getElementById('_menu_add_association_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_report_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                } 
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('add_document_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('add_document_to_project').style.backgroundColor = '#29A6A7';
                document.getElementById('add_document_to_project').style.color = 'white';
                document.getElementById('add_document_to_project').innerHTML = 'Annuler';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_member_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_association_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                } 
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('add_report_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('add_report_to_project').style.backgroundColor = '#29A6A7';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_member_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_report_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('editProject').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('editProject').style.backgroundColor = '#29A6A7';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_member_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_report_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('archiveProject').addEventListener('click', function (e) {
                e.preventDefault();

                // Afficher une boîte de dialogue Swall pour confirmer l'archivage du projet (ou non)
                Swal.fire({
                    title: 'Êtes-vous sûr de vouloir archiver ce projet ?',
                    text: "Vous ne pourrez pas revenir en arrière !",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#29A6A7',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Oui, archiver !',
                    cancelButtonText: 'Annuler'
                }).then((result) => {
                    if (result.isConfirmed) {
                        archiveProject(project.project_id);
                        window.location.href = 'https://lab.padem.org/projets/';
                    }
                });
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons (Ajouter une association, un membre, un document, un rapport)
            document.getElementById(`add_association_to_project_form_${project.project_id}`).addEventListener('submit', function (e) {
                e.preventDefault();
                addAssociationToProject(project.project_id);
            });
            document.getElementById(`add_member_to_project_form_${project.project_id}`).addEventListener('submit', function (e) {
                e.preventDefault();
                addMemberToProject(project.project_id);
            });
            document.getElementById(`add_document_to_project_form_${project.project_id}`).addEventListener('submit', function (e) {
                e.preventDefault();
                addDocumentToProject(project.project_id);
            });
            document.getElementById(`add_report_to_project_form_${project.project_id}`).addEventListener('submit', function (e) {
                e.preventDefault();
                addReportToProject(project.project_id);
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons
            document.getElementById('add_association_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                addAssociationToProject(project.project_id);
            });
            document.getElementById('add_member_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                addMemberToProject(project.project_id);
            });
            document.getElementById('add_document_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                addDocumentToProject(project.project_id);
            });
            document.getElementById('add_report_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                addReportToProject(project.project_id);
            });
            document.getElementById('editProject').addEventListener('click', function (e) {
                e.preventDefault();
                editProject(project.project_id);
            });
            document.getElementById('archiveProject').addEventListener('click', function (e) {
                e.preventDefault();
                archiveProject(project.project_id);
            });
            //#endregion

            //#region Afficher les documents du projet
            let projectDocuments = document.getElementById('projectDocuments');
            projectDocuments.innerHTML = '';
            fetch(`https://lab.padem.org/wp-json/mo/v1/getProjectDocuments`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(document => {
                        if (document.project_id === projectId) {
                            let li_document = document.createElement('li');
                            li_document.style.border = '1px solid lightgray';
                            li_document.style.borderRadius = '25px';
                            li_document.style.margin = '5px';
                            li_document.style.padding = '5px';
                            li_document.className = 'box-clicable';
                            li_document.id = document.document_id;
                            li_document.addEventListener('click', function () {
                                displayDocument(document.document_id);
                            });
                            projectDocuments.appendChild(li_document);
                            li_document.innerHTML = `
                                <p>${document.document_title}</p>
                                <p>${document.document_date}</p>
                                <p>${document.document_type}</p>
                                <p>${document.document_status}</p>
                            `;
                        }
                    });
                })
                .catch(error => console.error('Erreur récupération des documents:', error));
            //#endregion

            //#region Afficher les membres du projet
            let projectMembers = document.getElementById('projectMembers');
            projectMembers.innerHTML = '';
            project.members.forEach(member => {
                let p = document.createElement('p');
                p.innerHTML = member;
                projectMembers.appendChild(p);
            });
            //#endregion

            //#region Afficher les associations du projet
            let projectAssociations = document.getElementById('display_project_associations' + project.project_id);
            projectAssociations.innerHTML = '';
            project.associations.forEach(association => {
                let p = document.createElement('p');
                p.innerHTML = association;
                projectAssociations.appendChild(p);
            });
            //#endregion

            //#region Afficher les rapports du projet
            let projectReports = document.getElementById('display_project_reports_' + project.project_id);
            projectReports.innerHTML = '';
            fetch(`https://lab.padem.org/wp-json/mo/v1/getProjectReports`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(report => {
                        if (report.project_id === projectId) {
                            let li_report = document.createElement('li');
                            li_report.style.border = '1px solid lightgray';
                            li_report.style.borderRadius = '25px';
                            li_report.style.margin = '5px';
                            li_report.style.padding = '5px';
                            li_report.className = 'box-clicable';
                            li_report.id = report.report_id;
                            li_report.addEventListener('click', function () {
                                displayReport(report.report_id);
                            });
                            projectReports.appendChild(li_report);
                            li_report.innerHTML = `
                                <p>${report.report_title}</p>
                                <p>${report.report_date}</p>
                                <p>${report.report_type}</p>
                                <p>${report.report_status}</p>
                            `;
                        }
                    });
                })
                .catch(error => console.error('Erreur récupération des rapports:', error));
            //#endregion
        }
        //#endregion

        //#region Afficher le rapport correspondant à l'ID
        function displayReport(reportId) {
            let report = reports.find(report => report.report_id === reportId);
            let displayReport = document.getElementById('all_projects_table');
            displayReport.innerHTML = '';
            displayReport.innerHTML = `
                <article class="report">
                    <div style="display: flex; justify-content: space-between;">
                        <button type="button" class="btn btn-primary" id="backToProjects" onclick="getProjects()">Tous les Projets</button>
                        <div style="display: flex; justify-content: flex-end;">
                            <button type="button" class="btn btn-primary" id="previousReport" onclick="displayReport(${report.report_id - 1})"> <img src="https://img.icons8.com/ios/50/000000/previous.png" style="width: 20px; height: 20px;" alt=""> Précédent</button>
                            <button type="button" class="btn btn-primary" id="nextReport" onclick="displayReport(${report.report_id + 1})"> <img src="https://img.icons8.com/ios/50/000000/next.png" style="width: 20px; height: 20px;" alt=""> Suivant</button>
                        </div>
                    </div>
                    <br>
                    
                    <h1>${report.report_title}</h1>
                    <p>${report.report_date}</p>
                    <p>${report.report_type}</p>
                    <p>${report.report_status}</p>
                    <p>${report.report_description}</p>
                    <p>${report.report_referent}</p>
                    <p>${report.report_referent_email}</p>
                    <p>${report.report_manager}</p>
                    <p>${report.report_manager_email}</p>
                    <p>${report.report_project}</p>
                    <p>${report.report_association}</p>
                    <p>${report.report_location}</p>
                    <p>${report.report_status}</p>
                    <p>${report.report_type}</p>
                    <p>${report.report_start_date}</p>
                    <p>${report.report_end_date}</p>
                    <p>${report.report_updated_date}</p>

                    <!-- Afficher la liste des documents du rapport -->
                    <ul id="reportDocuments_${reportId}" style="display: block;">
                    </ul>

                    <!-- Ajouter les autres informations du rapport -->
                    <button type="button" class="btn btn-primary" id="add_document_to_report" onclick="addDocumentToReport(${report.report_id})">Ajouter un Document</button>

                    <!-- Ajouter les actions possibles sur le rapport (membres privilégiés et administrateurs) -->
                    <button type="button" class="btn btn-primary" id="add_assocition_to_report" onclick="addAssociationToReport(${report.report_id})">Ajouter une Association</button>
                    <button type="button" class="btn btn-primary" id="add_member_to_report" onclick="addMemberToReport(${report.report_id})">Ajouter un Membre</button>
                    <button type="button" class="btn btn-primary" id="editReport" onclick="editReport(${report.report_id})">Modifier</button>
                    <button type="button" class="btn btn-danger" id="archiveReport" onclick="archiveReport(${report.report_id})">Archiver</button>
                </article>
            `;

            //#region Ajouter des écouteurs d'événements pour les boutons
            document.getElementById('add_document_to_report').addEventListener('click', function (e) {
                e.preventDefault();
                addDocumentToReport(report.report_id);
            });
            document.getElementById('add_assocition_to_report').addEventListener('click', function (e) {
                e.preventDefault();
                addAssociationToReport(report.report_id);
            });
            document.getElementById('add_member_to_report').addEventListener('click', function (e) {
                e.preventDefault();
                addMemberToReport(report.report_id);
            });
            document.getElementById('editReport').addEventListener('click', function (e) {
                e.preventDefault();
                editReport(report.report_id);
            });
            document.getElementById('archiveReport').addEventListener('click', function (e) {
                e.preventDefault();
                archiveReport(report.report_id);
            });
            //#endregion

            //#region Afficher les documents du rapport
            let reportDocuments = document.getElementById(`reportDocuments_${reportId}`);
            reportDocuments.innerHTML = '';
            fetch(`https://lab.padem.org/wp-json/mo/v1/getReportDocuments`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(document => {
                        if (document.report_id === reportId) {
                            let li_document = document.createElement('li');
                            li_document.style.border = '1px solid lightgray';
                            li_document.style.borderRadius = '25px';
                            li_document.style.margin = '5px';
                            li_document.style.padding = '5px';
                            li_document.className = 'box-clicable';
                            li_document.id = document.document_id;
                            li_document.addEventListener('click', function () {
                                displayDocument(document.document_id);
                            });
                            reportDocuments.appendChild(li_document);
                            li_document.innerHTML = `
                                <p>${document.document_title}</p>
                                <p>${document.document_date}</p>
                                <p>${document.document_type}</p>
                                
                                <button type="button" class="btn btn-primary" id="downloadDocument" onclick="downloadDocument(${document.document_id})"> <img src="https://img.icons8.com/ios/50/000000/download.png" style="width: 20px; height: 20px;" alt=""> Télécharger</button>
                                <button type="button" class="btn btn-primary" id="editDocument" onclick="editDocument(${document.document_id})">Modifier</button>
                                <button type="button" class="btn btn-danger" id="deleteDocument" onclick="deleteDocument(${document.document_id})">Supprimer</button>
                            `;

                            //#region Ajouter des écouteurs d'événements pour les boutons
                            document.getElementById('downloadDocument').addEventListener('click', function (e) {
                                e.preventDefault();
                                downloadDocument(document.document_id);
                            });
                            document.getElementById('editDocument').addEventListener('click', function (e) {
                                e.preventDefault();
                                editDocument(document.document_id);
                            });
                            document.getElementById('deleteDocument').addEventListener('click', function (e) {
                                e.preventDefault();
                                deleteDocument(document.document_id);
                            });
                            //#endregion
                        }
                    });
                })
                .catch(error => console.error('Erreur récupération des documents:', error));
            //#endregion
        }
        //#endregion

        //#region Fonction pour envoyer des mails de notification via le serveur SMTP de Padem
        function sendMailNotification(member, subject, message) {
            const nodemailer = require('nodemailer');

            // Créer un transporteur SMTP réutilisable à l'aide de l'objet transporteur par défaut
            let transporter = nodemailer.createTransport({
                host: 'ssl0.ovh.net',
                port: 465,
                secure: true,
                auth: {
                    user: 'nathan.imogo@padem.org',
                    pass: 'NathIm82!',
                },
                tls: {
                    rejectUnauthorized: false
                },
            });

            // Options de l'e-mail
            let mailOptions = {
                from: '<nathan.imogo@padem.org>',
                to: member,
                subject: subject,
                text: message,
            };

            // Envoyer l'e-mail
            transporter.sendMail(mailOptions, (error, info) => {
                if (error) {
                    console.log('Erreur envoi de l\'e-mail:', error);
                } else {
                    console.log('E-mail envoyé:', info.response);
                }
            });
        }
        //#endregion

        //#region Fonction envoyer des notifications de diverses actions (ajout, modification, suppression, archivage)
        function sendNotification(action, member, project, report, document) {
            let subject = '';
            let message = '';

            switch (action) {
                case 'add':
                    subject = 'Ajout d\'un élément';
                    message = `Bonjour, un élément a été ajouté au projet ${project}.\n\nCordialement,`;
                    break;
                case 'edit':
                    subject = 'Modification d\'un élément';
                    message = `Bonjour, un élément a été modifié dans le projet ${project}.\n\nCordialement,`;
                    break;
                case 'delete':
                    subject = 'Suppression d\'un élément';
                    message = `Bonjour, un élément a été supprimé du projet ${project}.\n\nCordialement,`;
                    break;
                case 'archive':
                    subject = 'Archivage d\'un élément';
                    message = `Bonjour, un élément a été archivé dans le projet ${project}.\n\nCordialement,`;
                    break;
                default:
                    break;
            }

            sendMailNotification(member, subject, message);
        }
        //#endregion
    </script>
</body>