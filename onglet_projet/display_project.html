<!-- Description: Page d'affichage des projets -->
<div style="display: flex; justify-content: space-between; margin: 10px;">
    <button type="button" class="box-clicable" id="createProject"
        style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
        <!-- icone plus -->
        <img src="https://img.icons8.com/ios/50/9F9F9F/plus-math.png"
            style="width: 20px; height: 20px; margin-right: 5px;" alt="">
        Nouveau Projet
    </button>

    <div style="display: flex; justify-content: flex-end; margin: 10px;">
        <!-- Bouton afficher tous les projets -->
        <button type="button" class="box-clicable" id="allProjects"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone liste -->
            <img src="https://img.icons8.com/ios/50/9F9F9F/list.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Tous les Projets
        </button>

        <!-- Bouton Mes projets -->
        <button type="button" class="box-clicable" id="myProjects"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone profil -->
            <img src="https://img.icons8.com/ios/50/9F9F9F/user.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Mes projets
        </button>

        <!-- Bouton Archives -->
        <button type="button" class="box-clicable" id="archives_projects"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone archive -->
            <img src="https://img.icons8.com/ios/50/9F9F9F/archive-folder.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Archives
        </button>
    </div>
</div>


<!--#region Onglet Rapports -->
<!-- Description: Page d'affichage des rapports -->
 <div style="display: flex; justify-content: space-between; margin: 10px;">
    <button type="button" class="box-clicable" id="create_Report"
        style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
        <!-- icone plus -->
        <img src="https://img.icons8.com/ios/50/9F9F9F/plus-math.png"
            style="width: 20px; height: 20px; margin-right: 5px;" alt="">
        Nouveau Rapport
    </button>

    <div style="display: flex; justify-content: flex-end; margin: 10px;">
        <!-- Bouton afficher tous les rapports -->
        <button type="button" class="box-clicable" id="all_Reports"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone liste -->
            <img src="https://img.icons8.com/ios/50/9F9F9F/list.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Tous les Rapports
        </button>

        <!-- Bouton Mes rapports -->
        <button type="button" class="box-clicable" id="my_Reports"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone profil -->
            <img src="https://img.icons8.com/ios/50/9F9F9F/user.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Mes rapports
        </button>

        <!-- Bouton Archives -->
        <button type="button" class="box-clicable" id="archives_Reports"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding:5px;">
            <!-- icone archive -->
            <img src="https://img.icons8.com/ios/50/9F9F9F/archive-folder.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Archives</button>
    </div>
</div>

<body>
    <!--#region Nouveau Rapport -->
    <div class="card" id="new_report_form" style="display: none;">
        <form id="reportForm" class="card-body" style="border-radius: 15px; background-color: white;">
            <div class="row">
                <div class="col-md-12">
                    <p>Remplissez les champs suivants:</p>
                    <hr class="gray-border">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="onglet_reportTitle">Titre du rapport: <span style="color: red;">*</span></label>
                    <input type="text" id="onglet_reportTitle" name="onglet_reportTitle" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="onglet_reportType">Type de rapport: <span style="color: red;">*</span></label>
                    <input type="text" id="onglet_reportType" name="onglet_reportType" class="form-control" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="onglet_reportDate">Date de début prévisionnelle: <span style="color: red;">*</span></label>
                    <input type="date" id="onglet_reportDate" name="onglet_reportDate" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="onglet_reportEndDate">Date de fin prévisionnelle: <span style="color: red;">*</span></label>
                    <input type="date" id="onglet_reportEndDate" name="onglet_reportEndDate" class="form-control" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="onglet_reportLocation">Pays de réalisation du rapport: <span style="color: red;">*</span></label>
                    <input type="text" id="onglet_reportLocation" name="onglet_reportLocation" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="onglet_reportReferent">Référent du rapport: <span style="color: red;">*</span></label>
                    <input type="text" id="onglet_reportReferent" name="onglet_reportReferent" class="form-control" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="onglet_reportReferentEmail">Email du référent du rapport: <span style="color: red;">*</span></label>
                    <input type="email" id="onglet_reportReferentEmail" name="onglet_reportReferentEmail" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="onglet_reportDescription">Description du rapport: <span style="color: red;">*</span></label>
                    <textarea id="onglet_reportDescription" name="onglet_reportDescription" rows="4" cols="50" class="form-control"
                        required></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12" id="add_trames">
                    <!-- Saisir les noms des documents models que vous comptez joindre ci-dessous à ce rapport: -->
                    <label for="onglet_reportDocuments">Saisir le nom de la trame à joindre au rapport: <span
                            style="color: red;">*</span></label>
                    <textarea type="text" id="onglet_reportDocuments" name="onglet_reportDocuments" class="form-control" rows="4"
                        required></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <hr class="gray-border">
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="action-buttons" style="display: flex; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary"
                            style="width: fit-content;">
                            Annuler
                            <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="cancel"
                                style="width: 35px; height: 35px;">
                        </button>
                        <button type="button" class="btn btn-primary"
                            style="color: white; width: fit-content;">
                            Enregistrer
                            <img src="https://lab.padem.org/wp-content/uploads/save_black.png" alt="save"
                                style="width: 35px; height: 35px;">
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!--#endregion -->
    <!--#region Tout les rapports -->
    <div class="container" id="all_reports_table" style="display: block;">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="onglet_report_tite">Titre <img src="https://img.icons8.com/ios/50/9F9F9F/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="onglet_report_country_name">Projet <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_report_association_name">Auteur <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_report_theme_name">Type de rapport <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_report_status_name">Statut <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                </tr>
            </thead>
            <tbody id="onglet_display_reports" class="main-group-scroll" style="height: 500px;">
            </tbody>
        </table>
    </div>
    <!--#endregion -->
    <!--#region Mes rapports -->
    <div class="container" id="onglet_my_reports_table" style="display: none;">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="onglet_my_report_tite">Titre <img src="https://img.icons8.com/ios/50/9F9F9F/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="onglet_my_report_country_name">Projet <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_my_report_association_name">Auteur <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_my_report_theme_name">Type de rapport <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_my_report_status_name">Statut <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="onglet_display_my_reports" class="main-group-scroll" style="height: 500px;">
            </tbody>
        </table>
    </div>
    <!--#endregion -->
    <!--#region Archives -->
    <div class="container" id="onglet_archives_reports_table" style="display: none;">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="onglet_archives_report_tite">Titre <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_archives_report_country_name">Projet <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_archives_report_association_name">Auteur <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_archives_report_theme_name">Type de rapport <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_archives_report_status_name">Statut <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="onglet_display_archives_reports" class="main-group-scroll" style="height: 500px;">
            </tbody>
        </table>
    </div>
    <!--#endregion -->

    <script>

        // Chargement de la page
        document.addEventListener('DOMContentLoaded', function (e) {
            e.preventDefault();

            // Afficher le tableau des rapports
            document.getElementById('all_reports_table').style.display = 'block';
            // Masquer le formulaire de création de rapport
            document.getElementById('new_report_form').style.display = 'none';
            // Masquer le tableau de mes rapports
            document.getElementById('onglet_my_reports_table').style.display = 'none';
            // Masquer le tableau des archives
            document.getElementById('onglet_archives_reports_table').style.display = 'none';

            document.getElementById('all_Reports').style.color = '#29A6A7';
        });

        //#region Afficher le formulaire de création de rapport
        document.getElementById('create_Report').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le formulaire de création de rapport
            document.getElementById('new_report_form').style.display = 'block';
            // Masquer le tableau des rapports
            document.getElementById('all_reports_table').style.display = 'none';
            // Masquer le tableau de mes rapports
            document.getElementById('onglet_my_reports_table').style.display = 'none';
            // Masquer le tableau des archives
            document.getElementById('onglet_archives_reports_table').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('create_Report').style.color = '#29A6A7';
            document.getElementById('all_Reports').style.color = 'gray';
            document.getElementById('my_Reports').style.color = 'gray';
            document.getElementById('archives_Reports').style.color = 'gray';
        });
        //#endregion

        //#region Afficher tous les rapports
        document.getElementById('all_Reports').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le tableau des rapports
            document.getElementById('all_reports_table').style.display = 'block';
            // Masquer le formulaire de création de rapport
            document.getElementById('new_report_form').style.display = 'none';
            // Masquer le tableau de mes rapports
            document.getElementById('onglet_my_reports_table').style.display = 'none';
            // Masquer le tableau des archives
            document.getElementById('onglet_archives_reports_table').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('create_Report').style.color = 'gray';
            document.getElementById('all_Reports').style.color = '#29A6A7';
            document.getElementById('my_Reports').style.color = 'gray';
            document.getElementById('archives_Reports').style.color = 'gray';
        });
        //#endregion

        //#region Afficher mes rapports
        document.getElementById('my_Reports').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le tableau de mes rapports
            document.getElementById('onglet_my_reports_table').style.display = 'block';
            // Masquer le formulaire de création de rapport
            document.getElementById('new_report_form').style.display = 'none';
            // Masquer le tableau des rapports
            document.getElementById('all_reports_table').style.display = 'none';
            // Masquer le tableau des archives
            document.getElementById('onglet_archives_reports_table').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('create_Report').style.color = 'gray';
            document.getElementById('all_Reports').style.color = 'gray';
            document.getElementById('my_Reports').style.color = '#29A6A7';
            document.getElementById('archives_Reports').style.color = 'gray';
        });
        //#endregion

        //#region Afficher les archives
        document.getElementById('archives_Reports').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le tableau des archives
            document.getElementById('onglet_archives_reports_table').style.display = 'block';
            // Masquer le formulaire de création de rapport
            document.getElementById('new_report_form').style.display = 'none';
            // Masquer le tableau des rapports
            document.getElementById('all_reports_table').style.display = 'none';
            // Masquer le tableau de mes rapports
            document.getElementById('onglet_my_reports_table').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('create_Report').style.color = 'gray';
            document.getElementById('all_Reports').style.color = 'gray';
            document.getElementById('my_Reports').style.color = 'gray';
            document.getElementById('archives_Reports').style.color = '#29A6A7';
        });
        //#endregion
    </script>
</body>
<!--#endregion -->


<!--#region Onglet Demandes de rapports -->
<!-- Description: Page d'affichage des demandes de rapports -->
<div style="display: flex; justify-content: space-between; margin: 10px;">
    <button type="button" class="box-clicable" id="onglet_report_requests_create_Report_Request"
        style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
        <!-- icone plus -->
        <img src="https://img.icons8.com/ios/50/9F9F9F/plus-math.png"
            style="width: 20px; height: 20px; margin-right: 5px;" alt="">
        Nouvelle Demande
    </button>

    <div style="display: flex; justify-content: flex-end; margin: 10px;">
        <!-- Bouton afficher toutes les demandes -->
        <button type="button" class="box-clicable" id="onglet_report_requests_all_Requests"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone liste -->
            <img src="https://img.icons8.com/ios/50/9F9F9F/list.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Toutes les Demandes
        </button>

        <!-- Bouton Mes demandes -->
        <button type="button" class="box-clicable" id="onglet_report_requests_my_Requests"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <!-- icone profil -->
            <img src="https://img.icons8.com/ios/50/9F9F9F/user.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Mes demandes
        </button>

        <!-- Bouton Archives -->
        <button type="button" class="box-clicable" id="onglet_report_requests_archives_Requests"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding:5px;">
            <!-- icone archive -->
            <img src="https://img.icons8.com/ios/50/9F9F9F/archive-folder.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Archives</button>
    </div>
</div>

<body>
    <!--#region Nouvelle Demande -->
    <div class="container" id="new_request_form" style="display: none;">
        <form id="onglet_ReportRequest_request_Form" class="card" style="border-radius: 15px; background-color: white; margin: 5px; padding: 5px;" method="post" enctype="multipart/form-data">
            <div class="row">
            </div>
            <div class="card-body" style="border-radius: 15px; padding: 10px; margin: 10px;">
                <div class="row">
                    <div class="col-md-6">
                        <label for="onglet_ReportRequest_project" style="color: gray;"> <img src="https://img.icons8.com/?size=100&id=h88n73Ss5iTI&format=png&color=9F9F9F"
                                style="width: 20px; height: 20px; margin-right: 5px;" alt=""> Sélectionner le Projet correspondant: <span style="color: red;">*</span></label>
                        <select id="onglet_ReportRequest_project" name="onglet_ReportRequest_project" class="form-control" style="border-radius: 20px;" required>
                            <option value="">Sélectionner le Projet</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="onglet_ReportRequest_requestType" style="color: gray;"> <img src="https://img.icons8.com/?size=100&id=364&format=png&color=9F9F9F"
                                style="width: 20px; height: 20px; margin-right: 5px;" alt=""> Type de rapport attendu: <span style="color: red;">*</span></label>
                        <input type="text" id="onglet_ReportRequest_requestType" name="onglet_ReportRequest_requestType" class="form-control" style="border-radius: 20px;" required>
                    </div>
                </div>
                <div style="margin: 5px; padding: 5px;"></div>
                <div class="row">
                    <div class="col-md-12">
                        <label for="onglet_required_submit_date" style="color: gray;"> <img src="https://img.icons8.com/?size=100&id=1074&format=png&color=9F9F9F"
                                style="width: 20px; height: 20px; margin-right: 5px;" alt=""> Date attendue de soumission du rapport: <span style="color: red;">*</span></label>
                        <input type="date" id="onglet_required_submit_date" name="onglet_required_submit_date" class="form-control" style="border-radius: 20px;" required>
                    </div>
                </div>
                <div style="margin: 5px; padding: 5px;"></div>
                <div class="row">
                    <div class="col-md-12">
                        <label for="onglet_ReportRequest_requestDescription" style="color: gray;"> <img src="https://img.icons8.com/?size=100&id=77&format=png&color=9F9F9F"
                                style="width: 20px; height: 20px; margin-right: 5px;" alt=""> Description de la demande: </label>
                        <textarea id="onglet_ReportRequest_requestDescription" name="onglet_ReportRequest_requestDescription" rows="6" cols="50" class="form-control" style="border-radius: 20px;"></textarea>
                    </div>
                </div>
                <div style="margin: 5px; padding: 5px;"></div>
                <div class="row">
                    <div class="col-md-12">
                        <label for="onglet_ReportRequest_requestDocuments" style="color: gray;"> <img src="https://img.icons8.com/?size=100&id=4716&format=png&color=9F9F9F"
                                style="width: 20px; height: 20px; margin-right: 5px;" alt="">Sélectionner une ou plusieurs trames(documents models) à joindre à la demande: </label>
                        <input type="file" id="onglet_ReportRequest_requestDocuments" name="file" class="form-control" style="border-radius: 20px;" multiple>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="action-buttons" style="display: flex; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary"
                        style="width: fit-content;" id="onglet_ReportRequest_cancel">
                        Annuler
                        <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="Annuler"
                            style="width: 25px; height: 25px;">
                    </button>
                    <button type="button" class="btn btn-primary"
                        style="color: white; width: fit-content;" id="onglet_ReportRequest_send">
                        Envoyer
                        <img src="https://img.icons8.com/?size=100&id=12628&format=png&color=FFFFFF" alt="Envoyer"
                            style="width: 25px; height: 25px;">
                    </button>
                </div>
            </div>
        </form>
    </div>
    <!--#endregion -->

    <!--#region Toutes les demandes -->
    <div class="container" id="all_requests_table_and_details" style="display: block;">
        <!--#region Toutes les demandes -->
        <div class="container" id="all_requests_table" style="display: block;">
            <table id="onglet_display_requests">
                <thead style="font-size: 12px; font-weight: lighter; color: gray;" class="thead-light">
                    <tr>
                        <th scope="col" id="onglet_request_title" style="margin: 2px;">Titre <img src="https://img.icons8.com/ios/50/9F9F9F/sort.png"
                                style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="onglet_request_country_name">
                            Projet <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="onglet_request_association_name">
                            Auteur <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="onglet_request_date"> Date limite de soumission <img src="https://img.icons8.com/ios/50/9F9F9F/sort.png"
                                style="width: 15px; height: 15px;" alt="">
                        </th>
                        <th scope="col" id="onglet_request_status">
                            Status <img src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt="">
                        </th>
                    </tr>
                </thead>
                <tbody class="main-group-scroll" style="height: 500px;">
                </tbody>
            </table>
        </div>
        <!--#endregion -->

        <!--#region Afficher les détails avec le formulaire de demande de rapport correspondant -->
        <div class="card" id="onglet_request_details" style="display: none;">
            <div class="card-header" style="border-radius: 25px; background-color: white; margin: 5px; padding: 5px; border: 1px solid lightgray;">
                <h5 style="color: gray;">Détails de la demande</h5>
            </div>
            <form id="onglet_request_details_form" class="card-body" style="border-radius: 25px; background-color: white; margin: 5px; padding: 5px; border: 1px solid lightgray;">
                <div class="row">
                    <div class="col-md-6">
                        <label for="onglet_request_details_title">Titre de la demande: </label>
                        <input type="text" id="onglet_request_details_title" name="onglet_request_details_title" class="form-control" readonly>
                    </div>
                    <div class="col-md-6">
                        <label for="onglet_request_details_project">Projet correspondant: </label>
                        <input type="text" id="onglet_request_details_project" name="onglet_request_details_project" class="form-control" readonly>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="onglet_request_details_association">Auteur de la demande: </label>
                        <input type="text" id="onglet_request_details_association" name="onglet_request_details_association" class="form-control" readonly>
                    </div>
                    <div class="col-md-6">
                        <label for="onglet_request_details_date">Date limite de soumission: </label>
                        <input type="text" id="onglet_request_details_date" name="onglet_request_details_date" class="form-control" readonly>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <label for="onglet_request_details_description">Description de la demande: </label>
                        <textarea id="onglet_request_details_description" name="onglet_request_details_description" rows="6" cols="50" class="form-control" readonly></textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <label for="onglet_request_details_documents">Trames(documents models) à joindre à la demande: </label>
                        <textarea id="onglet_request_details_documents" name="onglet_request_details_documents" rows="6" cols="50" class="form-control" readonly></textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <label for="onglet_request_details_status">Status de la demande: </label>
                        <input type="text" id="onglet_request_details_status" name="onglet_request_details_status" class="form-control" readonly>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="action-buttons" style="display: flex; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary"
                                style="color: white; width: fit-content; border-radius: 20px;" id="onglet_request_cancel">
                                Annuler
                                <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="Annuler"
                                    style="width: 25px; height: 25px;">
                            </button>
                            <button type="button" class="btn btn-primary"
                                style="width: fit-content; border-radius: 20px;" id="onglet_request_send">
                                Envoyer le rapport
                                <img src="https://img.icons8.com/ios/50/FFFFFF/send-file.png" alt="Envoyer le rapport"
                                    style="width: 25px; height: 25px;">
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <!--#endregion -->
    </div>
    <!--#endregion -->

    <!--#region Mes demandes -->
    <div class="container" id="onglet_my_requests_table" style="display: none;">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="onglet_my_request_tite">Titre <img src="https://img.icons8.com/ios/50/9F9F9F/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="onglet_my_request_country_name">Projet <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_my_request_association_name">Auteur <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_my_request_theme_name">Type de demande <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_my_request_status_name">Status <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="onglet_display_my_requests" class="main-group-scroll" style="height: 500px;">
            </tbody>
        </table>
    </div> 
    <!--#endregion -->

    <!--#region Archives -->
    <div class="container" id="onglet_archives_requests_table" style="display: none;">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="onglet_archives_request_tite">Titre <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_archives_request_country_name">Projet <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_archives_request_association_name">Auteur <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_archives_request_theme_name">Type de demande <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="onglet_archives_request_status_name">Status <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="onglet_display_archives_requests" class="main-group-scroll" style="height: 500px;">
            </tbody>
        </table>
    </div>
    <!--#endregion -->

    <script>
        //initialisation des variables
        var projects_list = [];
        var users_list = [];

        // Chargement de la page
        document.addEventListener('DOMContentLoaded', function (e) {
            e.preventDefault();

            // Afficher le tableau des demandes
            document.getElementById('all_requests_table').style.display = 'block';
            // Masquer le formulaire de création de demande
            document.getElementById('new_request_form').style.display = 'none';
            // Masquer le tableau de mes demandes
            document.getElementById('onglet_my_requests_table').style.display = 'none';
            // Masquer le tableau des archives
            document.getElementById('onglet_archives_requests_table').style.display = 'none';

            document.getElementById('onglet_report_requests_all_Requests').style.color = '#29A6A7';

            // Récupérer la liste des noms des projets
            getProjectsNames();

            // Afficher les demandes
            displayRequests();
        });

        //#region Récupérer la liste des noms des projets
        function getProjectsNames() {
            // Récupérer la liste des noms des projets
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    // console.log(data);
                    let projects = data;
                    projects_list = data; // Enregistrer la liste des projets
                    let select = document.getElementById('onglet_ReportRequest_project');
                    for (let i = 0; i < projects.length; i++) {
                        let option = document.createElement('option');
                        option.value = projects[i].project_id;
                        option.text = projects[i].project_title;
                        select.appendChild(option);
                    }
                })
                .catch(error => console.error(error));
        }
        //#endregion

        //#region Récupérer le nom d'un utilisateur grace à son adresse email
        function getUserNameByEmail(email) {
            // Récupérer le nom de l'utilisateur
            fetch('https://lab.padem.org/wp-json/mo/v1/getAllMembers')
                .then(response => response.json())
                .then(data => {
                    users_list = data;
                    let user_name = users_list.find(user => user.user_email == email);
                    return user_name.display_name;
                })
                .catch(error => console.error(error));
        }
        //#endregion

        //#region Récupérer le nom d'un projet grace à son id
        function getProjectNameById(project_id) {
            // Récupérer le nom du projet
            console.log('projects_list: ', projects_list);
            let project_ = projects_list.find(project => project.project_id == project_id);
            console.log('project_name: ', project_);
            console.log('project_.project_title: ', project_.project_title);
            return project_.project_title;
        }
        //#endregion

        //#region Afficher les demandes
        function displayRequests() {
            var project_name = '';
            var user_name = '';
            var all_users_names = [];
            var all_projects_names = [];

            //#region Récupérer les utilisateurs
            fetch('https://lab.padem.org/wp-json/mo/v1/getAllMembers')
                .then(response => response.json())
                .then(data => {
                    data.forEach(user => {
                        all_users_names.push({
                            user_email: user.user_email,
                            user_name: user.display_name
                        });
                    });
                })
                .catch(error => console.error(error));
            //#endregion

            //#region Récupérer les projets
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    data.forEach(project => {
                        all_projects_names.push({
                            project_id: project.project_id,
                            project_name: project.project_title
                        });
                    });
                })
                .catch(error => console.error(error));
            //#endregion

            //#region Fonctions pour récupérer le jour de la semaine et le mois
            function getDayOfWeek(date) {
                var dayOfWeek = new Date(date).getDay();
                return isNaN(dayOfWeek) ? null : ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'][dayOfWeek];
            }
            function getMonthName(date) {
                var month = new Date(date).getMonth();
                return isNaN(month) ? null : ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'][month];
            }
            //#endregion

            // Récupérer les demandes
            fetch('https://lab.padem.org/wp-json/mo/v1/getReportRequest')
                .then(response => response.json())
                .then(data => {
                    // console.log(data);
                    var requests = data;
                    const tbody = document.querySelector('#onglet_display_requests tbody');
                    tbody.innerHTML = '';
                    if (requests.length > 0) {
                        requests.forEach(request => {
                            var tr = document.createElement('tr');
                            tr.style.border = '1px solid lightgray';
                            tr.style.borderRadius = '25px';
                            tr.style.backgroundColor = 'white';
                            tr.style.display = 'flex';
                            tr.style.justifyContent = 'flex-start';
                            tr.style.margin = '6px';
                            tr.style.padding = '15px';
                            tr.style.cursor = 'pointer';
                            tr.style.paddingRight = '35px';
                            tr.id = request.Project_Report_Request_id;
                            tr.addEventListener('click', function (e) {
                                e.preventDefault();
                                // Afficher les détails de la demande
                                document.getElementById('onglet_request_details').style.display = 'block';
                                // Masquer le tableau des demandes
                                document.getElementById('all_requests_table').style.display = 'none';
                                displayRequestDetails(request.Project_Report_Request_id);
                            });
                            // Changement de couleur de la ligne au survol
                            tr.addEventListener('mouseover', function (e) {
                                tr.style.border = '1px solid #6CE8E8';
                            });
                            tr.addEventListener('mouseout', function (e) {
                                tr.style.border = '1px solid lightgray';
                            });
                            // Récupérer le nom de l'utilisateur
                            const user_email = request.author_email;
                            const user = all_users_names.find(user => user.user_email === user_email);
                            user_name = user.user_name ? user.user_name : '---';
                            // Récupérer le nom du projet
                            const projectId = request.project_id;
                            const project = all_projects_names.find(project => {    
                                parseInt(project.project_id) === parseInt(projectId);
                            });
                            project_name = project.project_name ? project.project_name : '---';
                            //#region Formatage de la date
                            let date = new Date(request.request_submit_date);
                            let day = date.getDate();
                            let month = date.getMonth() + 1;
                            let year = date.getFullYear();
                            let submit_date = `${getDayOfWeek(date)}, ${day} ${getMonthName(date)} ${year}`;
                            //#endregion
                            tr.innerHTML = `
                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${request.request_type}</th>
                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${project_name ? project_name : '---'}</th>
                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${user_name ? user_name : '---'}</th>
                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${submit_date}</th>
                                <th style="color: ${request.report_request_state == 'En attente' ? 'orange' : request.report_request_state == 'Validée' ? 'green' : 'red'}; width: fit-content; border-radius: 10px; margin: 3px; padding: 3px; background-color: ${request.report_request_state == 'En attente' ? 'rgba(255, 165, 0, 0.1)' : request.report_request_state == 'Validée' ? 'rgba(0, 128, 0, 0.1)' : 'rgba(255, 0, 0, 0.1)'};">${request.report_request_state}</th>
                            `;
                            tbody.appendChild(tr);
                        });
                    } else {
                        let tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td colspan="6" style="text-align: center; color: gray;"> <img src="https://img.icons8.com/?size=100&id=3574&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">
                                Aucune demande de rapport pour le moment.</td>
                        `;
                        tbody.appendChild(tr);
                    }
                })
                .catch(error => console.error(error));
        }
        //#endregion

        //#region Afficher les détails d'une demande
        function displayRequestDetails(request_id){
            
        }

        //#region Afficher le formulaire de création de demande
        document.getElementById('onglet_report_requests_create_Report_Request').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le formulaire de création de demande
            document.getElementById('new_request_form').style.display = 'block';
            // Masquer le tableau des demandes
            document.getElementById('all_requests_table_and_details').style.display = 'none';
            // Masquer le tableau de mes demandes
            document.getElementById('onglet_my_requests_table').style.display = 'none';
            // Masquer le tableau des archives
            document.getElementById('onglet_archives_requests_table').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('onglet_report_requests_create_Report_Request').style.color = '#29A6A7';
            document.getElementById('onglet_report_requests_all_Requests').style.color = 'gray';
            document.getElementById('onglet_report_requests_my_Requests').style.color = 'gray';
            document.getElementById('onglet_report_requests_archives_Requests').style.color = 'gray';
        });
        //#endregion

        //#region Afficher toutes les demandes
        document.getElementById('onglet_report_requests_all_Requests').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le tableau des demandes
            document.getElementById('all_requests_table_and_details').style.display = 'block';
            // Masquer le formulaire de création de demande
            document.getElementById('new_request_form').style.display = 'none';
            // Masquer le tableau de mes demandes
            document.getElementById('onglet_my_requests_table').style.display = 'none';
            // Masquer le tableau des archives
            document.getElementById('onglet_archives_requests_table').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('onglet_report_requests_create_Report_Request').style.color = 'gray';
            document.getElementById('onglet_report_requests_all_Requests').style.color = '#29A6A7';
            document.getElementById('onglet_report_requests_my_Requests').style.color = 'gray';
            document.getElementById('onglet_report_requests_archives_Requests').style.color = 'gray';
        });
        //#endregion

        //#region Afficher mes demandes
        document.getElementById('onglet_report_requests_my_Requests').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le tableau de mes demandes
            document.getElementById('onglet_my_requests_table').style.display = 'block';
            // Masquer le formulaire de création de demande
            document.getElementById('new_request_form').style.display = 'none';
            // Masquer le tableau des demandes
            document.getElementById('all_requests_table_and_details').style.display = 'none';
            // Masquer le tableau des archives
            document.getElementById('onglet_archives_requests_table').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('onglet_report_requests_create_Report_Request').style.color = 'gray';
            document.getElementById('onglet_report_requests_all_Requests').style.color = 'gray';
            document.getElementById('onglet_report_requests_my_Requests').style.color = '#29A6A7';
            document.getElementById('onglet_report_requests_archives_Requests').style.color = 'gray';
        });
        //#endregion

        //#region Afficher les archives
        document.getElementById('onglet_report_requests_archives_Requests').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le tableau des archives
            document.getElementById('onglet_archives_requests_table').style.display = 'block';
            // Masquer le formulaire de création de demande
            document.getElementById('new_request_form').style.display = 'none';
            // Masquer le tableau des demandes
            document.getElementById('all_requests_table_and_details').style.display = 'none';
            // Masquer le tableau de mes demandes
            document.getElementById('onglet_my_requests_table').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('onglet_report_requests_create_Report_Request').style.color = 'gray';
            document.getElementById('onglet_report_requests_all_Requests').style.color = 'gray';
            document.getElementById('onglet_report_requests_my_Requests').style.color = 'gray';
            document.getElementById('onglet_report_requests_archives_Requests').style.color = '#29A6A7';
        });
        //#endregion

        //#region Annuler la création de demande
        document.getElementById('onglet_ReportRequest_cancel').addEventListener('click', function (e) {
            e.preventDefault();

            // Masquer le formulaire de création de demande
            document.getElementById('new_request_form').style.display = 'none';
            // Afficher le tableau des demandes
            document.getElementById('all_requests_table_and_details').style.display = 'block';
            // Masquer le tableau de mes demandes
            document.getElementById('onglet_my_requests_table').style.display = 'none';
            // Masquer le tableau des archives
            document.getElementById('onglet_archives_requests_table').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('create_Report_Request').style.color = 'gray';
            document.getElementById('all_Requests').style.color = '#29A6A7';
            document.getElementById('my_Requests').style.color = 'gray';
            document.getElementById('archives_Requests').style.color = 'gray';

            // Vider les champs du formulaire
            document.getElementById('onglet_ReportRequest_project').value = '';
            document.getElementById('onglet_ReportRequest_requestType').value = '';
            document.getElementById('onglet_required_submit_date').value = '';
            document.getElementById('onglet_ReportRequest_requestDescription').value = '';
            document.getElementById('onglet_ReportRequest_requestDocuments').value = '';
        });
        //#endregion

        //#region Envoyer la demande
        document.getElementById('onglet_ReportRequest_send').addEventListener('click', function (e) {
            e.preventDefault();

            // Récupérer les valeurs des champs
            let requestProject = document.getElementById('onglet_ReportRequest_project').value;
            let requestType = document.getElementById('onglet_ReportRequest_requestType').value;
            let required_submit_date = document.getElementById('onglet_required_submit_date').value;
            let requestDescription = document.getElementById('onglet_ReportRequest_requestDescription').value;

            //#region Récupérer les fichiers
            let requestDocuments = document.getElementById('onglet_ReportRequest_requestDocuments');
            let form_data = new FormData();
            let documents_links = [] || ''; // Enregistrer les liens des fichiers

            if(requestDocuments.files.length > 0) {
                // Afficher l'avancement du chargement
                document.getElementById('loading').style.display = 'block';
                if (requestDocuments.files.length > 1) { // Si plusieurs fichiers
                    for (let i = 0; i < requestDocuments.files.length; i++) {
                        form_data.append('file_' + i, requestDocuments.files[i]);
                        form_data.append('action', 'handle_file_upload');
                    }
                } else { // Si un seul fichier
                    form_data.append('file', requestDocuments.files[0]);
                    form_data.append('action', 'handle_file_upload');
                }

                // Envoi des fichiers
                fetch(ajaxurl, {
                    method: 'POST',
                    body: form_data,
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Enregistrer les liens des fichiers
                        if (requestDocuments.files.length === 1) {
                            documents_links.push(data.data.url);
                            console.log('Data:', data.data);
                            console.log('Url:', data.data.url);
                            console.log('Documents:', documents_links);
                        } else {
                            for (let i = 0; i < data.data.length; i++) {
                                documents_links.push(data.data[i].url);
                                console.log('Data:', data.data[i]);
                                console.log('Url:', data.data[i].url);
                                console.log('Documents:', documents_links);
                            }
                        }
                    } else {
                        console.log('Error:', data.data);
                        // Masquer l'avancement du chargement
                        document.getElementById('loading').style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Masquer l'avancement du chargement
                    document.getElementById('loading').style.display = 'none';
                });
            }
            //#endregion

            // Récupérer l'adresse email de l'utilisateur connecté
            let userEmail = current_user_data.email;

            // Vérifier si les champs sont vides
            if (requestProject === '' || requestType === '' || required_submit_date === '') {
                alert('Veuillez remplir tous les champs obligatoires');
            }

            fetch('https://lab.padem.org/wp-json/mo/v1/createReportRequest', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    project_id: requestProject,
                    request_type: requestType,
                    request_submit_date: required_submit_date,
                    request_description: requestDescription,
                    model_files: JSON.stringify(documents_links),
                    author_email: userEmail,
                    report_request_state: 'En attente',
                }),
            })
                .then((response) => response.json())
                .then((data) => {
                    console.log('Success:', data);
                    //#region Vider les champs du formulaire
                    document.getElementById('onglet_ReportRequest_project').value = '';
                    document.getElementById('onglet_ReportRequest_requestType').value = '';
                    document.getElementById('onglet_required_submit_date').value = '';
                    document.getElementById('onglet_ReportRequest_requestDescription').value = '';
                    document.getElementById('onglet_ReportRequest_requestDocuments').value = '';

                    // Masquer le formulaire de création de demande
                    document.getElementById('new_request_form').style.display = 'none';
                    // Afficher le tableau des demandes
                    document.getElementById('all_requests_table_and_details').style.display = 'block';
                    // Masquer le tableau de mes demandes
                    document.getElementById('onglet_my_requests_table').style.display = 'none';
                    // Masquer le tableau des archives
                    document.getElementById('onglet_archives_requests_table').style.display = 'none';

                    // Changer la couleur du bouton
                    document.getElementById('onglet_report_requests_create_Report_Request').style.color = 'gray';
                    document.getElementById('onglet_report_requests_all_Requests').style.color = '#29A6A7';
                    document.getElementById('onglet_report_requests_my_Requests').style.color = 'gray';
                    document.getElementById('onglet_report_requests_archives_Requests').style.color = 'gray';
                    //#endregion

                    // Recharger les demandes
                    displayRequests();

                    // Masquer l'avancement du chargement
                    document.getElementById('loading').style.display = 'none';

                    // Afficher un message de succès
                    alert('Demande envoyée avec succès !');
                })
                .catch((error) => {
                    console.error('Error:', error);
                    // Masquer l'avancement du chargement
                    document.getElementById('loading').style.display = 'none';
                });
        });
        //#endregion
    </script>
</body>
<!--#endregion -->

<!--#region Onglet Trames (Documents models) -->
    <!--#region Entête de l'onglet -->
    <!-- Boutons de navigation -->
    <div class="container" style="display: flex; justify-content: space-between; margin: 5px;">
        <!-- Barre  de recherche -->
        <div style="display: flex; justify-content: flex-start; margin: 5px; width: fit-content;" id="search_trames_div_files">
            <input type="text" class="form-control" placeholder="Rechercher..." aria-label="Rechercher..."
                aria-describedby="button-addon2" id="search_trames_" style="border-radius: 35px; width: 300px;">
            <div style="width: 2px;"></div>
            <div class="input-group-append" style="display: flex; justify-content: center;">
                <button class="btn btn-outline-secondary box-clicable" type="button" id="trame_search_button" style="border-radius: 50px; background-color: transparent; color: gray; width: 50px; border: none; padding: 5px;" title="Rechercher">
                    <!-- icone loupe (couleur grise) -->
                    <img src="https://img.icons8.com/ios/50/9F9F9F/search--v1.png" style="width: 25px; height: 20px;" alt="">
            </div>
        </div>
        <div class="container" style="display: flex; justify-content: flex-end;">
            <button type="button" class="btn btn-light box-clicable" id="onglet_files_create_trame" style="width: fit-content; border-radius: 50%; color: gray; background-color: white; align-self: center; border: 1px solid lightgray; margin: 5px; padding: 5px;" title="Nouveau document">
                <div style="width: 10px;"></div>
                <img src="https://img.icons8.com/ios/50/9F9F9F/add-file.png" style="width: 30px; height: 30px; margin: 5px;" alt="Nouveau document" id="onglet_files_create_trame_img">
                <div style="width: 10px;"></div>
            </button>
            <button type="button" class="btn btn-light box-clicable" id="onglet_files_create_folder_1" style="width: fit-content; border-radius: 50%; color: gray; background-color: white; align-self: center; border: 1px solid lightgray; margin: 5px; padding: 5px;" title="Nouveau dossier">
                <div style="width: 10px;"></div>
                <img src="https://img.icons8.com/?size=100&id=16745&format=png&color=9F9F9F" style="width: 30px; height: 30px; margin: 5px;" alt="Nouveau dossier" id="onglet_files_create_folder_img">
                <div style="width: 10px;"></div>
            </button>
            <button type="button" class="btn btn-light box-clicable" id="onglet_files_trames" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
                <div style="width: 10px;"></div>
                <img src="https://img.icons8.com/?size=100&id=42415&format=png&color=9F9F9F" style="width: 30px; height: 30px; margin: 2px;" alt="" id="onglet_files_trames_img">
                Trames </button>
            <button type="button" class="btn btn-light box-clicable" id="onglet_files_all_files" style="width: fit-content; color: #29A6A7; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
                <div style="width: 10px;"></div>
                <img src="https://img.icons8.com/?size=100&id=20440&format=png&color=9F9F9F" style="width: 25px; height: 25px; margin: 5px;" alt="" id="onglet_files_all_files_img">
                Tous les fichiers
            </button>
        </div>
    </div>
    <!--#endregion -->

    <body>
        <!--#region Formulaire de création de trame -->
        <div class="container" id="_new_trame_form_" style="display: none;">
            <form id="_trame_Form" class="card" style="border-radius: 25px; background-color: white; padding: 20px;" method="post" enctype="multipart/form-data">
                <!--#region Upload de fichiers un ou plusieurs fichiers (pdf, word, excel, powerpoint) un à la fois avec un bouton d'ajout et un bouton de suppression -->
                <div style="display: column; justify-content: space-between; padding: 10px;" id="trame_files_container" class="card-body">
                    <div style="height: 10px;"></div>
                    <div id="trame_files_list">
                        <div class="col-md-12" id="trame_file_1_">
                            <label for="trame_file_1" style="color: gray; display: none;">Document 1</label>
                            <input type="file" id="trame_file_1" name="trame_file_1" class="form-control" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                            <div style="height: 10px;"></div>
                        </div>
                    </div>
                    <div style="height: 10px;"></div>
                    <!-- Choisir un dossier de destination -->
                    <div class="col-md-12" id="trame_folder_dastination_">
                        <select class="form-control" id="tame_folder_1" name="trame_folder_1" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px; font-size: 14px; color: gray;">
                            <option value="0">Choisir un dossier de destination</option>
                        </select>
                        <div style="height: 10px;"></div>
                    </div>
                </div>
                <!--#endregion Upload de fichiers -->
                <div class="action-buttons col-md-12" style="display: flex; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" style="color: white; width: fit-content; border-radius: 20px;" id="onglet_trame_cancel">
                        Annuler <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="Annuler" style="width: 25px; height: 25px;">
                    </button>
                    <button type="button" class="btn btn-primary" style="width: fit-content; border-radius: 20px; color: white;" id="onglet_trame_send">
                        Enregistrer <img src="https://img.icons8.com/ios/50/FFFFFF/save.png" alt="Enregistrer" style="width: 25px; height: 25px;">
                    </button>
                </div>
            </form>
        </div>
        <!--#endregion -->
        <!-- Formulaire de création de dossier -->
        <div class="container" id="container_onglet_trame_create_folder" style="display: none; margin-bottom: 10px;">
            <form id="new_trame_folder_Form" class="card" style="border-radius: 25px; background-color: white; padding: 20px;" method="post" enctype="multipart/form-data">    
                <div style="display: column; justify-content: space-between; padding: 10px;" id="onglet_trame_folder_container" class="card-body">
                    <div style="height: 10px;"></div>
                    <!-- Saisir le nom du dossier -->
                    <div class="col-md-12">
                        <label for="trame_new_folder" style="font-size: 14px; font-weight: lighter; color: gray;">
                            <img src="https://img.icons8.com/ios/50/9F9F9F/folder-invoices.png" style="width: 20px; height: 20px;" alt="">
                            Nom du nouveau dossier <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="trame_new_folder_name" name="trame_new_folder_name" class="form-control" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px;" required>
                        <div style="height: 10px;"></div>
                    </div>
                    <div style="height: 10px;"></div>
                </div>
                <div class="action-buttons col-md-12" style="display: flex; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" style="color: white; width: fit-content; border-radius: 20px;" id="onglet_trame_folder_cancel">
                        Annuler <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="Annuler" style="width: 25px; height: 25px;">
                    </button>
                    <button type="button" class="btn btn-primary" style="width: fit-content; border-radius: 20px; color: white;" id="onglet_trame_folder_send">
                        Enregistrer <img src="https://img.icons8.com/ios/50/FFFFFF/save.png" alt="Enregistrer" style="width: 25px; height: 25px;">
                    </button>
                </div>
            </form>
        </div>
        <!--#region Tableau des trames -->
        <div class="container" id="onglet_trames_table" style="display: none;">
            <table>
                <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                    <tr>
                        <th scope="col" id="onglet_trame_name">Nom <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="onglet_trame_author">Auteur <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="onglet_trame_date">Date de création <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="onglet_trame_type">Type <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="onglet_trame_size">Taille <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th> <!-- pdf, word, excel, powerpoint -->
                        <th scope="col">Actions</th> <!-- Voire, Modifier, Supprimer -->
                    </tr>
                </thead>
                <tbody id="onglet_display_trames" class="main-group-scroll" style="height: 500px;">
                </tbody>
            </table>
        </div>
        <!--#endregion -->

        <!--#region Tableau de toutes les trames et dossiers -->
        <div class="container" id="onglet_files_all_files_table" style="display: block;">
            <table>
                <thead  id="onglet_files_display_all_files" style="font-size: 12px; font-weight: lighter; color: gray;">
                    <tr>
                        <th scope="col" id="onglet_all_files_name">Nom <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="onglet_all_files_author">Auteur <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="onglet_all_files_date">Date de création <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="onglet_all_files_type">Type <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="onglet_all_files_size">Taille <img
                                src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th> <!-- pdf, word, excel, powerpoint -->
                        <th scope="col">Actions</th> <!-- Voire, Modifier, Supprimer -->
                    </tr>
                </thead>
                <tbody class="main-group-scroll" style="height: 500px;">
                </tbody>
            </table>
        </div>
        <!--#endregion -->

        <script>
            // Initialisation des variables
            var all_trames = [];
            
            // Chargement initial da la page
            document.addEventListener('DOMContentLoaded', function (e) {
                e.preventDefault();
                var userEmail = current_user_data.email;
                // Récupérer les trames
                try {
                    console.log('Chargement des trames...');
                    displayTrames();
                } catch (error) {
                    console.error('Erreur lors du chargement des trames:', error);
                    sendMailNotification(userEmail, 'Erreur lors du chargement des trames', 'Une erreur est survenue lors du chargement des trames. Veuillez réessayer plus tard. Contenu de l\'erreur: ' + error);
                }
            });

            // Récupérer et afficher toutes les trames
            function displayTrames() {

                // Récupérer les utilisateurs
                fetch('https://lab.padem.org/wp-json/mo/v1/getAllMembers')
                    .then(response => response.json())
                    .then(data => {
                        var all_users_names = [];
                        if (data.length > 0) {
                            data.forEach(user => {
                                all_users_names.push({
                                    user_email: user.user_email,
                                    user_name: user.display_name
                                });
                            });
                        } else {
                            all_users_names = [];
                        }

                        //#region Récupérer les trames
                        fetch('https://lab.padem.org/wp-json/mo/v1/getProjectFile',
                            {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                            })
                            .then(response => response.json())
                            .then(data => {
                                // console.log(data);
                                let trames = data;
                                all_trames = data; // Enregistrer la liste des trames
                                const tbody = document.getElementById('onglet_files_display_all_files');
                                tbody.innerHTML = '';
                                var is_image = new Array(trames.length).fill(false); // Tableau pour vérifier si le fichier est une image
                                var file_type = new Array(trames.length).fill(''); // Tableau pour enregistrer le type de fichier
                                var is_folder = new Array(trames.length).fill(false); // Tableau pour vérifier si le fichier est un dossier

                                if (trames.length > 0) { // Si des trames existent
                                    // Afficher les trames
                                    trames.forEach((trame, index) => {

                                        if (trame.is_trame) { // Vériier si c'est une trame

                                        console.log('Trame:', trame);

                                            //#region Formater la taille du fichier
                                            var fileSize = '';
                                            if (trame.file_size) { // Si la taille du fichier est définie

                                                var unformattedFileSize = parseInt(trame.file_size); // Convertir la taille en entier

                                                if (unformattedFileSize < 1024) {
                                                    fileSize = unformattedFileSize + ' octets';
                                                } 
                                                else if (unformattedFileSize < 1048576) {
                                                    fileSize = (unformattedFileSize / 1024).toFixed(2) + ' Ko';
                                                } 
                                                else if (unformattedFileSize < 1073741824) {
                                                    fileSize = (unformattedFileSize / 1048576).toFixed(2) + ' Mo';
                                                } 
                                                else {
                                                    fileSize = (unformattedFileSize / 1073741824).toFixed(2) + ' Go';
                                                }
                                            } else {
                                                fileSize = '---';
                                            }
                                            //#endregion

                                            //#region Afficher une icone à côté du nom du fichier selon son type
                                            var fileIcon = '';
                                            if (trame.file_type) {
                                                if ((trame.file_type).includes('pdf')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FF0000/pdf.png';
                                                } else if ((trame.file_type).includes('word')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/2E86C1/ms-word.png';
                                                } else if ((trame.file_type).includes('excel')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/1ABC9C/ms-excel.png';
                                                } else if ((trame.file_type).includes('powerpoint')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/ms-powerpoint.png';
                                                } else if ((trame.file_type).includes('image')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/image.png';
                                                    is_image[index] = true;
                                                } else if((trame.file_type).includes('audio')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/audio.png';
                                                } else if((trame.file_type).includes('video')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/video.png';
                                                } else if((trame.file_type).includes('folder')) {
                                                    fileIcon = 'https://img.icons8.com/?size=100&id=EoxnfFDqfEyw&format=png&color=29A6A7';
                                                    is_folder[index] = true;
                                                } else {
                                                    fileIcon = 'https://img.icons8.com/ios/50/9F9F9F/file.png';
                                                }
                                            } else {
                                                fileIcon = 'https://img.icons8.com/ios/50/9F9F9F/file.png';
                                            }
                                            //#endregion
                        
                                            //#region formatage de la date
                                            let date = new Date(trame.created_at);
                                            let day = date.getDate();
                                            let month = date.getMonth() + 1;
                                            let year = date.getFullYear();
                                            let created_at = `${day} ${getMonthName(month)} ${year}`;
                                            //#endregion

                                            //#region Récupérer le nom de l'auteur
                                            var author_email = trame.author_email;
                                            var author = all_users_names.find(user => user.user_email === author_email) || '';
                                            var author_name = author.user_name || '---';
                                            //#endregion

                                            //#region Créer une ligne pour chaque trame
                                            var tr = document.createElement('tr');
                                            tr.style.border = '1px solid lightgray';
                                            tr.style.borderRadius = '25px';
                                            tr.style.backgroundColor = 'white';
                                            tr.title = trame.file_name ? trame.file_name : '---';
                                            tr.style.margin = '5px';
                                            tr.style.padding = '8px';
                                            tr.style.paddingRight = '10px';
                                            tr.style.marginBottom = '0px';
                                            tr.id = parseInt(trame.id);
                                            // Changement de couleur de la ligne au survol
                                            tr.addEventListener('mouseover', function (e) {
                                                tr.style.border = '1px solid #6CE8E8';
                                                document.getElementById('move_file_icon_' + trame.id).style.display = 'flex'; // Afficher l'icone de déplacement de fichier
                                            });
                                            tr.addEventListener('mouseout', function (e) {
                                                tr.style.border = '1px solid lightgray';
                                                document.getElementById('move_file_icon_' + trame.id).style.display = 'none';
                                            });
                                            tr.innerHTML = `
                                                <th style="font-weight: lighter; color: black; display: ${(is_folder[index] && !is_image[index]) ? 'flex' : 'none'}; justify-content: flex-start;">
                                                    <div style="width: 100%; height: 50px; border-radius: 50%; background-color: white; display: flex; justify-content: flex-start; cursor: pointer;" id="trame_folder_${trame.id}">
                                                        <img src="${fileIcon}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">
                                                        <div style="width: 6px;"></div>
                                                        <p class="long-file-name" style="color: #29A6A7; margin-top: 15px; width: 150px;">${trame.folder_name ? trame.folder_name : '---'}</p>
                                                    </div>
                                                </th>
                                                <!-- Afficher un aperçu de l'image -->
                                                <th style="font-weight: lighter; color: black; display: ${(is_image[index] && !is_folder[index]) ? 'flex' : 'none'}; justify-content: flex-start;">
                                                    <div style="width: 100%; height: 50px; border-radius: 50%; background-color: white; display: flex; justify-content: flex-start; cursor: pointer;" id="trame_preview_image_${trame.id}">
                                                        ${trame.file_link ? `<img src="${trame.file_link}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">` : `<img src="https://img.icons8.com/ios/50/FFA500/image.png" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">`}
                                                        <div style="width: 6px;"></div>
                                                        <p class="long-file-name" style="color: black; margin-top: 15px; width: 150px;">${trame.file_name ? trame.file_name : '---'}</p>
                                                    </div>
                                                </th>
                                                <th style="font-weight: lighter; color: black; display: ${(is_image[index] && !is_folder[index]) ? 'none' : 'flex'}; justify-content: flex-start;"> 
                                                    <div id="trame_name_displayed_${trame.id}" style="display: flex; justify-content: space-between;"> 
                                                        ${trame.file_link ? `<iframe src="${trame.file_link}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" title="file"></iframe>` : `<img src="${fileIcon}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">`}
                                                        <div style="width: 6px;"></div>
                                                        <p class="long-file-name" style="color: black; margin-top: 15px;">${trame.file_name ? trame.file_name : '---'}</p>
                                                    </div>
                                                    <!-- Menu de l'action à effectuer sur le document (Renommer) -->
                                                    <div class="dropdown-menu" id="trame_menu_${trame.id}" style="display: none ; position: absolute; background-color: white; border-radius: 20px; padding: 5px; margin-top: 10px; margin-right: 10px; width: fit-content; align-self: center;">
                                                        <input type="text" id="trame_name_input_${trame.id}" style="display: none; width: 100px; border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                                        <img src="https://img.icons8.com/?size=100&id=11658&format=png&color=29A6A7" style="width: 30px; height: 30px; align-self: center; margin: 5px; padding: 5px;" id="save_trame_edit_${trame.id}" alt="">
                                                        <img src="https://img.icons8.com/?size=100&id=3062&format=png&color=9F9F9F" style="width: 30px; height: 30px; align-self: center; margin: 5px; padding: 5px;" id="cancel_edit_trame_${trame.id}" alt="">
                                                    </div>
                                                </th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: space-between; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${author_name}</th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: space-between; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${created_at}</th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: space-between; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${trame.file_type ? `<img src="${fileIcon}" style="width: 20px; height: 20px;" alt="">` : '---'}</th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: space-between; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${fileSize}</th>
                                                <!-- Bouton pour télécharger le document et bouton pour supprimer le document -->
                                                <th style="color: #29A6A7; width: 100%; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 3px;">
                                                    <!-- Afficher l'animation de chargement -->
                                                    <div id="loading_delete_${trame.id}" style="display: none; background: none;">
                                                        <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Suppression...">
                                                    </div>
                                                    <div style="display: none; justify-content: space-between; width: 50px; height: 50px; border-radius: 50%; background-color: #D6D6D641; align-self: center;" id="move_file_icon_${trame.id}" title="Déplacer">
                                                        <img src="https://img.icons8.com/?size=100&id=38978&format=png&color=9F9F9F" style="margin-left: 15px; width: 20px; height: 20px; cursor: pointer; align-self: center;" alt="Move">
                                                    </div>
                                                    <div style="width: 10px;"></div>
                                                    <a href="${trame.file_link}" id="download_trame_${trame.id}" download="${trame.file_name}" style="display: flex; justify-content: space-between; text-decoration: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; background-color: #D6D6D641; align-self: center;" title="Télécharger">
                                                        <img src="https://img.icons8.com/ios/50/29A6A7/download.png" style="margin-left: 15px; width: 20px; height: 20px; cursor: pointer; align-self: center;" alt="Télécharger">
                                                    </a>
                                                    <div style="width: 10px;"></div>
                                                    <div style="display: flex; justify-content: space-between; width: 50px; height: 50px; border-radius: 50%; background-color: #D6D6D641; align-self: center;" id="this_file_menu_icon_${trame.id}" title="Détails">
                                                        <img src="https://img.icons8.com/ios/50/9F9F9F/menu.png" style="margin-left: 15px; width: 20px; height: 20px; cursor: pointer; align-self: center;" alt="Détails" id="display_menu_${trame.id}">
                                                    </div>
                                                    <!-- Menu de l'action à effectuer sur le document -->
                                                    <div  class="dropdown-menu" id="file_menu_${trame.id}" style="display: none ; position: absolute; background-color: white; border-radius: 20px; padding: 5px; margin-top: 10px; margin-right: 10px; width: fit-content; align-self: center;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="display_file_${trame.id}" title="Afficher">
                                                            <img src="https://img.icons8.com/ios/50/9F9F9F/visible.png" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Afficher dans un nouvel onglet">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;">Afficher</p>
                                                        </div>
                                                        <hr style="border: 1px solid lightgray; width: 100%; margin: 5px;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="edit_file_${trame.id}" title="Editer">
                                                            <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=9F9F9F" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Editer">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;">Renommer</p>
                                                        </div>
                                                        <hr style="border: 1px solid lightgray; width: 100%; margin: 5px;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="move_element_${trame.id}" title="Editer">
                                                            <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=9F9F9F" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Editer">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;">Déplacer</p>
                                                        </div>
                                                        <hr style="border: 1px solid lightgray; width: 100%; margin: 5px;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="delete_trame_${trame.id}" title="Supprimer">
                                                            <img src="https://img.icons8.com/ios/50/9F9F9F/trash.png" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Supprimer" id="delete_trame_icon_${trame.id}">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;" id="delete_trame_text_${trame.id}">Supprimer</p>
                                                        </div>
                                                    </div>
                                                    <!-- Menu de l'action à effectuer sur le document ou le dossier (Déplacer dans un dossier) -->
                                                    <div class="dropdown-menu" id="move_menu_${trame.id}" style="display: none ; position: absolute; background-color: white; border-radius: 20px; padding: 5px; margin-top: 10px; margin-right: 10px; width: fit-content; align-self: center;">
                                                        <select class="form-control" id="move_trame_folder_${trame.id}" name="move_trame_folder_${trame.id}" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px; font-size: 14px; color: gray;">
                                                            <option value="0">Choisir un dossier de destination</option>
                                                        </select>
                                                        <div style="height: 10px;"></div>
                                                        <img src="https://img.icons8.com/?size=100&id=11658&format=png&color=29A6A7" style="width: 30px; height: 30px; align-self: center; margin: 5px; padding: 5px;" id="save_move_trame_${trame.id}" alt="">
                                                        <img src="https://img.icons8.com/?size=100&id=3062&format=png&color=9F9F9F" style="width: 30px; height: 30px; align-self: center; margin: 5px; padding: 5px;" id="cancel_move_trame_${trame.id}" alt="">
                                                    </div>
                                                </th>
                                            `;
                                            tbody.appendChild(tr);
                                            //#endregion

                                            // Déplacer le document ou le dossier en maintenant le clic du bouton gauche de la souris (move_file_icon_)
                                            document.getElementById('move_file_icon_' + trame.id).addEventListener('mousedown', function (e) {
                                                e.preventDefault();
                                                // Effectuer le déaplacement de ligne en maintenant le clic
                                                //moveTrame(trame.id, trame.folder_name);
                                            });

                                            // Fonction pour déplacer le document ou le dossier
                                            function moveTrame(trame_id, folder_name) {
                                                // Récupérer la ligne du document ou du dossier
                                                var trame = document.getElementById(trame_id);
                                                // Récupérer la position de la souris
                                                var x = e.clientX;
                                                var y = e.clientY;
                                                // Récupérer la position de la ligne
                                                var trame_x = trame.getBoundingClientRect().left;
                                                var trame_y = trame.getBoundingClientRect().top;
                                                // Déplacer la ligne
                                                trame.style.position = 'absolute';
                                                trame.style.left = x - trame_x + 'px';
                                                trame.style.top = y - trame_y + 'px';
                                                trame.style.zIndex = '1000';
                                                // Récupérer les dossiers
                                                fetch('https://lab.padem.org/wp-json/mo/v1/getProjectFile',
                                                    {
                                                        method: 'GET',
                                                        headers: {
                                                            'Content-Type': 'application/json',
                                                        },
                                                    })
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        var folders = data;
                                                        // Afficher les dossiers
                                                        var move_trame_folder = document.getElementById(`move_trame_folder_${trame_id}`);
                                                        move_trame_folder.innerHTML = '';
                                                        var option = document.createElement('option');
                                                        option.value = 0;
                                                        option.innerHTML = 'Choisir un dossier de destination';
                                                        move_trame_folder.appendChild(option);
                                                        folders.forEach(folder => {
                                                            if (folder.is_folder) {
                                                                var option = document.createElement('option');
                                                                option.value = folder.id;
                                                                option.innerHTML = folder.folder_name;
                                                                move_trame_folder.appendChild(option);
                                                            }
                                                        });
                                                    })
                                                    .catch(error => {
                                                        console.error('Erreur lors de la récupération des dossiers.', error);
                                                    });
                                            }
                                            try {
                                                // Ajouter un évènement pour le bouton déplacer (Déplacer le document ou le dossier dans un autre dossier)
                                                document.getElementById(`move_element_${trame.id}`).addEventListener('click', function (e) {
                                                    e.preventDefault();
                                                    // Afficher le menu de déplacement
                                                    document.getElementById(`move_menu_${trame.id}`).style.display = 'block';
                                                    document.getElementById(trame.id).style.border = '1px solid #6CE8E8'; // Changer la couleur de la ligne
                                                });

                                                // Masquer le menu de déplacement quand la souris quitte le bouton
                                                document.getElementById(`move_element_${trame.id}`).addEventListener('mouseout', function (e) {
                                                    document.getElementById(`move_menu_${trame.id}`).style.display = 'none';
                                                    document.getElementById(trame.id).style.border = '1px solid lightgray'; // Changer la couleur de la ligne
                                                });

                                                // Ajouter un évènement pour le bouton Annuler (Annuler le déplacement du document ou du dossier)
                                                document.getElementById(`cancel_move_trame_${trame.id}`).addEventListener('click', function (e) {
                                                    e.preventDefault();
                                                    // Masquer le menu de déplacement
                                                    document.getElementById(`move_menu_${trame.id}`).style.display = 'none';
                                                    document.getElementById(trame.id).style.border = '1px solid lightgray'; // Changer la couleur de la ligne
                                                });

                                                // Ajouter un évènement pour le bouton Enregistrer (Enregistrer le déplacement du document ou du dossier)
                                                document.getElementById(`save_move_trame_${trame.id}`).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                // Récupérer le dossier de destination
                                                var move_trame_folder = document.getElementById(`move_trame_folder_${trame.id}`).value;
                                                // Vérifier si le dossier de destination est sélectionné
                                                if (move_trame_folder == 0) {
                                                    alert('Veuillez choisir un dossier de destination.');
                                                } else {
                                                    // Afficher l'animation de chargement
                                                    document.getElementById(`loading_delete_${trame.id}`).style.display = 'block';
                                                    // Déplacer le document ou le dossier
                                                    moveTrame(trame.id, move_trame_folder);
                                                }
                                            });
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout des évènements pour le déplacement des documents ou des dossiers.', error);
                                            }

                                            try {
                                                // Ajouter un évènement pour le bouton Afficher (Afficher le document dans un nouvel onglet)
                                                document.getElementById(`display_file_${trame.id}`).addEventListener('click', function (e) {
                                                    e.preventDefault();
                                                    // Ouvrir le document dans un nouvel onglet
                                                    window.open(trame.file_link, '_blank');
                                                });

                                                // Changer la couleur de fond du bouton Afficher au survol 
                                                document.getElementById(`display_file_${trame.id}`).addEventListener('mouseover', function (e) {
                                                    document.getElementById(`display_file_${trame.id}`).style.backgroundColor = '#D6D6D641';
                                                });

                                                // Changer la couleur de fond du bouton Afficher au survol (quand la souris quitte le bouton)
                                                document.getElementById(`display_file_${trame.id}`).addEventListener('mouseout', function (e) {
                                                    document.getElementById(`display_file_${trame.id}`).style.backgroundColor = 'white';
                                                });

                                                // Changer la couleur de fond du bouton Editer au survol
                                                document.getElementById(`edit_file_${trame.id}`).addEventListener('mouseover', function (e) {
                                                    document.getElementById(`edit_file_${trame.id}`).style.backgroundColor = '#D6D6D641';
                                                });

                                                // Changer la couleur de fond du bouton Editer au survol (quand la souris quitte le bouton)
                                                document.getElementById(`edit_file_${trame.id}`).addEventListener('mouseout', function (e) {
                                                    document.getElementById(`edit_file_${trame.id}`).style.backgroundColor = 'white';
                                                });

                                                // Ajouter un évènement pour le bouton Editer (Editer le nom de la trame)
                                                document.getElementById(`edit_file_${trame.id}`).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                // Afficher le champ de saisie du nom de la trame
                                                document.getElementById(`trame_name_displayed_${trame.id}`).style.display = 'none';
                                                document.getElementById(`trame_name_input_${trame.id}`).style.display = 'block';
                                                document.getElementById(`save_trame_edit_${trame.id}`).style.display = 'block';
                                                document.getElementById(`cancel_edit_trame_${trame.id}`).style.display = 'block';
                                                document.getElementById(`edit_trame_${trame.id}`).style.display = 'none';
                                            });
                                            
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout des évènements pour afficher le menu de la trame.', error);
                                            }

                                            try {
                                                // Ajouter un évènement pour le bouton Annuler (Annuler l'édition du nom de la trame)
                                                document.getElementById(`cancel_edit_trame_${trame.id}`).addEventListener('click', function (e) {
                                                    e.preventDefault();
                                                    // Masquer le champ de saisie du nom de la trame
                                                    document.getElementById(`trame_name_displayed_${trame.id}`).style.display = 'flex';
                                                    document.getElementById(`trame_name_input_${trame.id}`).style.display = 'none';
                                                    document.getElementById(`save_trame_edit_${trame.id}`).style.display = 'none';
                                                    document.getElementById(`cancel_edit_trame_${trame.id}`).style.display = 'none';
                                                });

                                                // Ajouter un évènement pour afficher le menu de la trame (Afficher, Modifier, Supprimer)
                                                document.getElementById(`display_menu_${trame.id}`).addEventListener('click', function (e) {
                                                    e.preventDefault();
                                                    // Afficher le menu de la trame
                                                    document.getElementById(`file_menu_${trame.id}`).style.display = 'block';
                                                    document.getElementById(trame.id).style.border = '1px solid #6CE8E8'; // Changer la couleur de la ligne
                                                });

                                                // Ajouter un évènement pour prévisualiser une image
                                                document.getElementById(`trame_preview_image_${trame.id}`).addEventListener('click', function (e) {
                                                    e.preventDefault();
                                                    // Ouvrir un apperçu du document en overlay
                                                    var overlay = document.getElementById('overlay');
                                                    var previewFrame = document.getElementById('previewFrame');
                                                    // Définir l'URL du document dans l'iframe
                                                    previewFrame.src = trame.file_link;
                                                    // Afficher l'overlay
                                                    overlay.style.display = 'flex';
                                                });

                                                // Fonction pour afficher un apperçu du document en cliquant sur une la miniature de l'image
                                                document.getElementById(`trame_name_displayed_${trame.id}`).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                // Ouvrir un apperçu du document en overlay
                                                var overlay = document.getElementById('overlay');
                                                var previewFrame = document.getElementById('previewFrame');
                                                // Définir l'URL du document dans l'iframe
                                                previewFrame.src = trame.file_link;
                                                // Afficher l'overlay
                                                overlay.style.display = 'flex';
                                            });
                                            
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout des évènements pour afficher le menu de la trame.', error);
                                            }
                                            // Fonction pour télécharger un fichier à partir de son lien (URL)
                                            function downloadFile(url) {
                                                var a = document.createElement('a');
                                                a.href = url;
                                                a.download = url.split('/').pop();
                                                document.body.appendChild(a);
                                                a.click();
                                                document.body.removeChild(a);
                                            }
                        
                                            try {
                                                // Ajouter un évènement pour sauvegarder le nom de la trame
                                                document.getElementById(`save_trame_edit_${trame.id}`).addEventListener('click', function (e) {
                                                    e.preventDefault();

                                                    // Afficher l'animation de chargement
                                                    document.getElementById(`loading_delete_${trame.id}`).style.display = 'block';

                                                    // Récupérer la trame actuelle
                                                    var this_trame = trame;
                                                    // Récupérer le nouveau nom de la trame
                                                    let new_trame_name = document.getElementById(`trame_name_input_${trame.id}`).value;

                                                    // Mettre à jour le nom de la trame sur le serveur
                                                    fetch(ajaxurl, {
                                                        method: 'POST',
                                                        headers: {
                                                            'Content-Type': 'application/x-www-form-urlencoded',
                                                        },
                                                        body: new URLSearchParams({
                                                            action: 'rename_file_callback',
                                                            current_filename: trame.file_name,
                                                            new_filename: new_trame_name,
                                                        }),
                                                    })
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        if (data.success) {
                                                            console.log('Success:', data);
                                                            //#region Mettre à jour le nom de la trame dans la base de données
                                                            fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFile', {
                                                                method: 'POST',
                                                                headers: {
                                                                    'Content-Type': 'application/json',
                                                                },
                                                                body: JSON.stringify({
                                                                    file_name: new_trame_name,
                                                                    file_link: this_trame.file_link,
                                                                    file_type: this_trame.file_type,
                                                                    author_email: this_trame.author_email,
                                                                    is_trame: this_trame.is_trame,
                                                                    project_id: this_trame.project_id,
                                                                    report_id: this_trame.report_id,
                                                                    created_at: this_trame.created_at,
                                                                }),
                                                            })
                                                                .then((response) => response.json())
                                                                .then((data) => {
                                                                    console.log('Success:', data);
                                                                    //#region Supprimer l'ancienne trame
                                                                    fetch('https://lab.padem.org/wp-json/mo/v1/deleteProjectFiles', {
                                                                        method: 'DELETE',
                                                                        headers: {
                                                                            'Content-Type': 'application/json',
                                                                        },
                                                                        body: JSON.stringify({
                                                                            column_param1: this_trame.id,
                                                                        }),
                                                                    })
                                                                        .then((response) => response.json())
                                                                        .then((data) => {
                                                                            console.log('Success:', data);
                                                                            // Masquer l'animation de chargement
                                                                            document.getElementById(`loading_delete_${trame.id}`).style.display = 'none';
                                                                            // Recharger les trames
                                                                            displayTrames();
                                                                        })
                                                                        .catch((error) => {
                                                                            console.error('Error:', error);
                                                                            // Masquer l'animation de chargement
                                                                            document.getElementById(`loading_delete_${trame.id}`).style.display = 'none';
                                                                        });
                                                                    //#endregion
                                                                })
                                                                .catch((error) => {
                                                                    console.error('Error:', error);
                                                                    // Masquer l'animation de chargement
                                                                    document.getElementById(`loading_delete_${trame.id}`).style.display = 'none';
                                                                });
                                                            //#endregion
                                                        } else {
                                                            console.log('Error:', data.data);
                                                            // Masquer l'animation de chargement
                                                            document.getElementById(`loading_delete_${trame.id}`).style.display = 'none';
                                                        }
                                                    })
                                                    .catch(error => {
                                                        console.error('Erreur lors de la requête AJAX:', error);
                                                        // Masquer l'animation de chargement
                                                        document.getElementById(`loading_delete_${trame.id}`).style.display = 'none';
                                                    });
                                                });
                            
                                                // Ajouter un évènement pour changer la couleur de fond de l'icone de suppression au survol
                                                document.getElementById(`delete_trame_${trame.id}`).addEventListener('mouseover', function (e) {
                                                    document.getElementById(`delete_trame_${trame.id}`).style.backgroundColor = '#FC2A2A';
                                                    document.getElementById(`delete_trame_text_${trame.id}`).style.color = 'white';
                                                    document.getElementById(`delete_trame_icon_${trame.id}`).src = 'https://img.icons8.com/ios/50/FFFFFF/trash.png';
                                                });

                                                // Ajouter un évènement pour changer la couleur de fond de l'icone de suppression à la sortie du survol
                                                document.getElementById(`delete_trame_${trame.id}`).addEventListener('mouseout', function (e) {
                                                    document.getElementById(`delete_trame_${trame.id}`).style.backgroundColor = 'white';
                                                    document.getElementById(`delete_trame_text_${trame.id}`).style.color = 'gray';
                                                    document.getElementById(`delete_trame_icon_${trame.id}`).src = 'https://img.icons8.com/ios/50/9F9F9F/trash.png';
                                                });

                                                // Ajouter un évènement pour télécharger le document
                                                document.getElementById(`download_trame_${trame.id}`).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                // Télécharger directement le document sans ouvrir de nouvelle fenêtre
                                                downloadFile(trame.file_link);
                                            });
                                            
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout de l\'évènement pour télécharger le document:', error);
                                            }
                                            try {
                                                // Évènement pour changer la couleur de fond de l'icone de téléchargement au survol
                                                document.getElementById(`download_trame_${trame.id}`).addEventListener('mouseover', function (e) {
                                                document.getElementById(`download_trame_${trame.id}`).style.backgroundColor = '#29A7A749';
                                            });
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout de l\'évènement pour changer la couleur de fond de l\'icone de téléchargement au survol:', error);
                                            }
                                            try {
                                                // Évènement pour changer la couleur de fond de l'icone de téléchargement à la sortie du survol
                                                document.getElementById(`download_trame_${trame.id}`).addEventListener('mouseout', function (e) {
                                                document.getElementById(`download_trame_${trame.id}`).style.backgroundColor = '#D6D6D641';
                                            });
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout de l\'évènement pour changer la couleur de fond de l\'icone de téléchargement à la sortie du survol:', error);
                                            }
                                            try {
                                                // Évènement pour changer la couleur de fond de l'icone de Menu au survol
                                                document.getElementById(`display_menu_${trame.id}`).addEventListener('mouseover', function (e) {
                                                document.getElementById(`this_file_menu_icon_${trame.id}`).style.backgroundColor = '#29A7A749';
                                            });
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout de l\'évènement pour changer la couleur de fond de l\'icone de Menu au survol:', error);
                                            }
                                            try {
                                                // Évènement pour changer la couleur de fond de l'icone de Menu à la sortie du survol
                                                document.getElementById(`display_menu_${trame.id}`).addEventListener('mouseout', function (e) {
                                                document.getElementById(`this_file_menu_icon_${trame.id}`).style.backgroundColor = '#D6D6D641';
                                            });
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout de l\'évènement pour changer la couleur de fond de l\'icone de Menu à la sortie du survol:', error);
                                            }
                                            try {
                                                // Ajouter un évènement pour masquer le menu de la trame au clic en dehors du menu
                                                document.addEventListener('click', function (e) {
                                                if (e.target.id !== `display_menu_${trame.id}`) {
                                                    document.getElementById(`file_menu_${trame.id}`).style.display = 'none';
                                                    document.getElementById(trame.id).style.border = '1px solid lightgray'; // Réinitialiser la couleur de la ligne
                                                }
                                            });
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout de l\'évènement pour masquer le menu de la trame au clic en dehors du menu:', error);
                                            }
                                            try {
                                                // Ajouter un évènement pour supprimer le document
                                                document.getElementById(`delete_trame_${trame.id}`).addEventListener('click', function (e) {
                                                e.preventDefault();

                                                // Afficher l'animation de chargement
                                                document.getElementById(`loading_delete_${trame.id}`).style.display = 'block';

                                                // Supprimer le document du serveur
                                                fetch(ajaxurl, {
                                                    method: 'POST',
                                                    body: new URLSearchParams({
                                                        action: 'delete_file_callback', 
                                                        file_url: trame.file_link, // Lien du fichier à supprimer
                                                    }),
                                                })
                                                .then(response => response.json())
                                                .then(data => {
                                                    if (data.success) {
                                                        console.log('Success:', data);
                                                    } else {
                                                        console.log('Error:', data.data);
                                                    }
                                                })
                                                .catch(error => console.error('Error:', error));

                                                // Supprimer le document de la base de données
                                                fetch('https://lab.padem.org/wp-json/mo/v1/deleteProjectFiles', {
                                                    method: 'DELETE',
                                                    headers: {
                                                        'Content-Type': 'application/json',
                                                    },
                                                    body: JSON.stringify({
                                                        column_param1: trame.id,
                                                    }),
                                                })
                                                    .then((response) => response.json())
                                                    .then((data) => {
                                                        console.log('Success:', data);
                                                        // Masquer l'animation de chargement
                                                        document.getElementById(`loading_delete_${trame.id}`).style.display = 'none';
                                                        // Recharger les trames
                                                        displayTrames();
                                                    })
                                                    .catch((error) => {
                                                        console.error('Error:', error);
                                                        // Masquer l'animation de chargement
                                                        document.getElementById(`loading_delete_${trame.id}`).style.display = 'none';
                                                    });
                                            });
                                            } catch (error) {
                                                console.error('Erreur lors de l\'ajout de l\'évènement pour supprimer le document:', error);
                                            }
                                        }    
                                    });
                                } else {
                                    let tr = document.createElement('tr');
                                    tr.innerHTML = `
                                        <td colspan="6" style="text-align: center; color: gray;"> <img src="https://img.icons8.com/?size=100&id=3574&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">
                                            Aucun document trouvé.</td>
                                    `;
                                    tbody.appendChild(tr);
                                }
                            })
                            .catch(error => console.error(error));
                        //#endregion
                        //#endregion
                    })
                    .catch(error => console.error(error));

                
            }

            console.log('Fin de l\'affichage des trames.');

            try {
                // Ajouter un évènement pour afficher tout les fichiers et dossiers
            } catch (error) {
                console.error('Erreur lors de l\'ajout de l\'évènement pour afficher tout les fichiers et dossiers:', error);
            }
            
            try {
                // Ajouter un évènement pour afficher les trames
                
            } catch (error) {
                console.error('Erreur lors de l\'ajout de l\'évènement pour afficher les trames:', error);
            }
            
            try {
                // Afficher le formulaire de création de dossier
            } catch (error) {
                console.error('Erreur lors de l\'ajout de l\'évènement pour afficher le formulaire de création de dossier:', error);
            }

            
            try {
            // Annuler la création de dossier
            } catch (error) {
                console.error('Erreur lors de l\'ajout de l\'évènement pour annuler la création de dossier:', error);
            }
            
            

            try {
            // Afficher le formulaire de création de trame
            } catch (error) {
                console.error('Erreur lors de l\'ajout de l\'évènement pour afficher le formulaire de création de trame:', error);
            }
            /*
            try {
            // Annuler la création de trame
            document.getElementById('onglet_trame_cancel').addEventListener('click', function (e) {
                e.preventDefault();

                // Masquer le formulaire de création de trame
                document.getElementById('_new_trame_form_').style.display = 'none';

                document.getElementById('onglet_files_create_trame').innerHTML = ' <img src="https://img.icons8.com/?size=100&id=16745&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">';

                // Vider les champs du formulaire
                document.getElementById('trame_file_1').value = '';
            });
            } catch (error) {
                console.error('Erreur lors de l\'ajout de l\'évènement pour annuler la création de trame:', error);
            }
            try {
            // Envoyer la trame
            document.getElementById('onglet_trame_send').addEventListener('click', function (e) {
                e.preventDefault();

                // Récupérer le premier fichier
                let trame_file = document.getElementById('trame_file_1').files[0];
                let trame_file_name = trame_file.name;
                let trame_file_type = trame_file.type;
                let trame_file_size = trame_file.size;

                // Récupérer l'adresse email de l'utilisateur connecté
                let userEmail = current_user_data.email;

                // Vérifier si les champs sont vides
                if (trame_file.length === 0) {
                    alert('Veuillez ajouter un fichier.');
                    return;
                }

                // Afficher l'avancement du chargement
                document.getElementById('loading').style.display = 'block';

                // Créer un objet FormData
                let formData = new FormData();
                formData.append('file', trame_file);
                formData.append('action', 'handle_file_upload');

                // Envoyer le fichier
                fetch(ajaxurl, {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            //#region Envoi des données de la trame
                            fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFile', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    file_name: ((data.data.url).split('/')).pop(), // Nom du fichier
                                    file_type: trame_file_type, 
                                    file_link: data.data.url, // Lien du fichier
                                    file_size: trame_file_size,
                                    author_email: userEmail,
                                    is_trame: true,
                                    created_at: new Date(Date.now()) // Date de création
                                }),
                            })
                                .then((response) => response.json())
                                .then((data) => {
                                    // Masquer l'avancement du chargement
                                    document.getElementById('loading').style.display = 'none';
                                    // Recharger les trames
                                    displayTrames();
                                    
                                    // Vider les champs du formulaire
                                    document.getElementById('trame_file_1').value = '';
                                })
                                .catch((error) => {
                                    console.error('Error:', error);
                                    // Masquer l'avancement du chargement
                                    document.getElementById('loading').style.display = 'none';
                                });
                            //#endregion
                        } else {
                            console.log('Error:', data.data);
                            // Masquer l'avancement du chargement
                            document.getElementById('loading').style.display = 'none';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // Masquer l'avancement du chargement
                        document.getElementById('loading').style.display = 'none';
                    });
            });
            } catch (error) {
                console.error('Erreur lors de l\'ajout de l\'évènement pour envoyer la trame:', error);
            }*/
        </script>
    </body>
<!--#endregion -->

<!--#region Onglet Fichiers -->
<div class="container" style="display: flex; justify-content: space-between; margin: 5px;">
    <!-- Barre  de recherche -->
    <div style="display: flex; justify-content: flex-start; margin: 5px; width: fit-content;" id="search_trames_div">
        <input type="text" class="form-control" placeholder="Rechercher..." aria-label="Rechercher..."
            aria-describedby="button-addon2" id="search_files" style="border-radius: 35px; width: 300px;">
        <div style="width: 2px;"></div>
        <div class="input-group-append" style="display: flex; justify-content: center;">
            <button class="btn btn-outline-secondary" type="button" id="file_search_button" style="border-radius: 50px; background-color: transparent; color: gray; width: 50px; border: none; padding: 5px;" title="Rechercher">
                <!-- icone loupe (couleur grise) -->
                <img src="https://img.icons8.com/ios/50/9F9F9F/search--v1.png" style="width: 20px; height: 20px;" alt="">
        </div>
    </div>
    <div class="container" style="display: flex; justify-content: flex-end;">
        <!-- Bouton pour créer un nouveau fichier -->
        <button type="button" class="btn btn-light" id="onglet_files_create_file" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <img src="https://img.icons8.com/ios/50/9F9F9F/add-file.png" style="width: 20px; height: 20px;" alt=""> Nouveau fichier</button>
        <!-- Bouton pour créer un nouveau dossier -->
        <button type="button" class="btn btn-light" id="onglet_files_create_folder" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: 1px solid lightgray; margin: 5px; padding: 5px;">
            <img src="https://img.icons8.com/?size=100&id=16745&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Nouveau dossier</button>
    </div>
</div>

<body>
    <!-- Formulaire de création de document -->
    <div class="container" id="container_onglet_files_create_file" style="display: none; margin-bottom: 10px;">
        <form id="files_Form" class="card" style="border-radius: 25px; background-color: white; padding: 20px;" method="post" enctype="multipart/form-data">
            <!--#region Upload de fichiers un ou plusieurs fichiers (pdf, word, excel, powerpoint) un à la fois avec un bouton d'ajout et un bouton de suppression -->
            <div style="display: column; justify-content: space-between; padding: 10px;" id="onglet_files_container" class="card-body">
                <div style="height: 10px;"></div>
                <div class="col-md-12" id="files_file_1_">
                    <input type="file" id="files_file_1" name="files_file_1" class="form-control" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                    <div style="height: 10px;"></div>
                </div>
                <div style="height: 10px;"></div>
                <!-- Choisir un dossier de destination -->
                <div class="col-md-12" id="files_folder_1_">
                    <select class="form-control" id="files_folder_1" name="files_folder_1" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px; font-size: 14px; color: gray;">
                        <option value="0">Choisir un dossier de destination</option>
                    </select>
                    <div style="height: 10px;"></div>
                </div>
            </div>
            <!--#endregion Upload de fichiers -->
            <div class="action-buttons col-md-12" style="display: flex; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" style="color: white; width: fit-content; border-radius: 20px;" id="onglet_files_cancel">
                    Annuler <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="Annuler" style="width: 25px; height: 25px;">
                </button>
                <button type="button" class="btn btn-primary" style="width: fit-content; border-radius: 20px; color: white;" id="onglet_files_send">
                    Enregistrer <img src="https://img.icons8.com/ios/50/FFFFFF/save.png" alt="Enregistrer" style="width: 25px; height: 25px;">
                </button>
            </div>
        </form>
    </div>
    <!-- Formulaire de création de dossier de fichiers avec un bouton d'ajout et un bouton de suppression et la possibilité de sélectionner plusieurs fichiers à la fois -->
    <div class="container" id="container_onglet_files_create_folder" style="display: none; margin-bottom: 10px;">
        <form id="new_folder_Form" class="card" style="border-radius: 25px; background-color: white; padding: 20px;" method="post" enctype="multipart/form-data">    
            <div style="display: column; justify-content: space-between; padding: 10px;" id="onglet_files_folder_container" class="card-body">
                <div style="height: 10px;"></div>
                <!-- Saisir le nom du dossier -->
                <div class="col-md-12">
                    <label for="files_new_folder" style="font-size: 14px; font-weight: lighter; color: gray;">
                        <img src="https://img.icons8.com/ios/50/9F9F9F/folder-invoices.png" style="width: 20px; height: 20px;" alt="">
                        Nom du nouveau dossier <span style="color: red;">*</span>
                    </label>
                    <input type="text" id="files_new_folder" name="files_new_folder" class="form-control" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px;" required>
                    <div style="height: 10px;"></div>
                </div>
                <div style="height: 10px;"></div>
            </div>
            <div class="action-buttons col-md-12" style="display: flex; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" style="color: white; width: fit-content; border-radius: 20px;" id="onglet_files_folder_cancel">
                    Annuler <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="Annuler" style="width: 25px; height: 25px;">
                </button>
                <button type="button" class="btn btn-primary" style="width: fit-content; border-radius: 20px; color: white;" id="onglet_files_folder_send">
                    Enregistrer <img src="https://img.icons8.com/ios/50/FFFFFF/save.png" alt="Enregistrer" style="width: 25px; height: 25px;">
                </button>
            </div>
        </form>
    </div>
    <!-- Tableau des Fichiers et des dossiers -->
    <div class="container" id="onglet_files_table" style="display: block;">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="onglet_files_name">Nom <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="onglet_files_author">Auteur <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="onglet_files_date">Date de création <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="onglet_files_type">Type <img 
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="onglet_files_size">Taille <img
                            src="https://img.icons8.com/ios/50/9F9F9F/sort.png" style="width: 15px; height: 15px;" alt=""></th> <!-- pdf, word, excel, powerpoint -->
                    <th scope="col" id="onglet_files_action">Action</th>
                </tr>
            </thead>
            <tbody id="onglet_display_all_files" style="height: 500px;" class="main-group-scroll">
            </tbody>
        </table>
    </div>

    <script>

        // Chargement de la page
        document.addEventListener('DOMContentLoaded', function () {
            // Afficher les fichiers
            displayFiles();
        });

        // Fonction pour afficher les fichiers
        function displayFiles() {

        }

        // Ajouter un évènement pour afficher le formulaire de création de dossier
        document.getElementById('onglet_files_create_folder').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le formulaire de création de dossier
            if (document.getElementById('container_onglet_files_create_folder').style.display === 'block') {
                document.getElementById('container_onglet_files_create_folder').style.display = 'none';
                document.getElementById('onglet_files_create_folder').innerHTML = '<img src="https://img.icons8.com/?size=100&id=16745&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Nouveau dossier';
                document.getElementById('onglet_files_create_folder').style.color = 'gray';

                // Vider les champs du formulaire
                document.getElementById('files_new_folder').value = '';
            } else {
                document.getElementById('container_onglet_files_create_folder').style.display = 'block';
                document.getElementById('onglet_files_create_folder').innerHTML = '<img src="https://img.icons8.com/?size=100&id=6483&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""> Terminer';
                document.getElementById('onglet_files_create_folder').style.color = '#29A6A7';

                document.getElementById('onglet_files_create_file').style.color = 'gray';
                document.getElementById('onglet_files_create_file').innerHTML = ' <img src="https://img.icons8.com/ios/50/9F9F9F/add-file.png" style="width: 20px; height: 20px;" alt=""> Nouveau fichier';
                document.getElementById('container_onglet_files_create_file').style.display = 'none';
            }
        });

        // Annuler la création de dossier
        document.getElementById('onglet_files_folder_cancel').addEventListener('click', function (e) {
            e.preventDefault();

            // Masquer le formulaire de création de dossier
            document.getElementById('container_onglet_files_create_folder').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('onglet_files_create_folder').style.color = 'gray';
            document.getElementById('onglet_files_create_folder').innerHTML = '<img src="https://img.icons8.com/ios/50/9F9F9F/folder-invoices.png" style="width: 20px; height: 20px;" alt=""> Nouveau dossier';

            // Vider les champs du formulaire
            document.getElementById('files_new_folder').value = '';
        });

        // Envoyer le dossier
        document.getElementById('onglet_files_folder_send').addEventListener('click', function (e) {
            e.preventDefault();

            // Récupérer le nom du dossier
            let files_new_folder = document.getElementById('files_new_folder').value;

            // Vérifier si les champs sont vides
            if (files_new_folder.length === 0) {
                alert('Veuillez ajouter un nom de dossier.');
                return;
            }

            // Afficher l'avancement du chargement
            document.getElementById('loading').style.display = 'block';

            // Envoyer le dossier
            fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFolder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    folder_name: files_new_folder,
                    author_email: current_user_data.email,
                    created_at: new Date(Date.now())
                }),
            })
                .then((response) => response.json())
                .then((data) => {
                    console.log('Success:', data);
                    // Masquer l'avancement du chargement
                    document.getElementById('loading').style.display = 'none';
                    // Recharger les fichiers
                    displayFiles();

                    // Vider les champs du formulaire
                    document.getElementById('files_new_folder').value = '';
                })
                .catch((error) => {
                    console.error('Error:', error);
                    // Masquer l'avancement du chargement
                    document.getElementById('loading').style.display = 'none';
                });
        });

        // Ajouter un évènement pour afficher le formulaire de création de fichier
        document.getElementById('onglet_files_create_file').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher le formulaire de création de fichier
            if (document.getElementById('container_onglet_files_create_file').style.display === 'block') {
                document.getElementById('container_onglet_files_create_file').style.display = 'none';
                document.getElementById('onglet_files_create_file').innerHTML = ' <img src="https://img.icons8.com/ios/50/9F9F9F/add-file.png" style="width: 20px; height: 20px;" alt=""> Nouveau fichier';
                document.getElementById('onglet_files_create_file').style.color = 'gray';

                // Vider les champs du formulaire
                document.getElementById('files_file_1').value = '';
            } else {
                document.getElementById('container_onglet_files_create_file').style.display = 'block';
                document.getElementById('onglet_files_create_file').innerHTML = ' <img src="https://img.icons8.com/?size=100&id=6483&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""> Terminer';
                document.getElementById('onglet_files_create_file').style.color = '#29A6A7';

                document.getElementById('onglet_files_create_folder').style.color = 'gray';
                document.getElementById('onglet_files_create_folder').innerHTML = '<img src="https://img.icons8.com/?size=100&id=16745&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Nouveau dossier';
                document.getElementById('container_onglet_files_create_folder').style.display = 'none';
            }
        });

        // Annuler la création de fichier
        document.getElementById('onglet_files_cancel').addEventListener('click', function (e) {
            e.preventDefault();

            // Masquer le formulaire de création de fichier
            document.getElementById('container_onglet_files_create_file').style.display = 'none';

            // Changer la couleur du bouton
            document.getElementById('onglet_files_create_file').style.color = 'gray';
            document.getElementById('onglet_files_create_file').innerHTML = ' <img src="https://img.icons8.com/ios/50/9F9F9F/add-file.png" style="width: 20px; height: 20px;" alt=""> Nouveau fichier';

            // Vider les champs du formulaire
            document.getElementById('files_file_1').value = '';
        });

        // Envoyer le fichier
        document.getElementById('onglet_files_send').addEventListener('click', function (e) {
            e.preventDefault();

            // Récupérer le premier fichier
            let fichier_file = document.getElementById('files_file_1').files[0];
            let fichier_file_name = fichier_file.name;
            let fichier_file_type = fichier_file.type;
            let fichier_file_size = fichier_file.size;

            // Récupérer l'adresse email de l'utilisateur connecté
            let userEmail = current_user_data.email;

            // Vérifier si les champs sont vides
            if (fichier_file.length === 0) {
                alert('Veuillez ajouter un fichier.');
                return;
            }

            // Afficher l'avancement du chargement
            document.getElementById('loading').style.display = 'block';

            // Créer un objet FormData
            let formData = new FormData();
            formData.append('file', fichier_file);
            formData.append('action', 'handle_file_upload');

            // Envoyer le fichier au serveur
            fetch(ajaxurl, {
                method: 'POST',
                body: formData,
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Success:', data.data);
                        //#region Envoi des données du fichier à la base de données
                        fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFile', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                file_name: ((data.data.url).split('/')).pop(), // Nom du fichier
                                file_type: fichier_file_type,
                                file_link: data.data.url, // Lien du fichier
                                file_size: fichier_file_size,
                                author_email: userEmail,
                                is_trame: false,
                                created_at: new Date(Date.now()) // Date de création
                            }),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                // Masquer l'avancement du chargement
                                document.getElementById('loading').style.display = 'none';
                                // Recharger les fichiers
                                displayFiles();

                                // Vider les champs du formulaire
                                document.getElementById('files_file_1').value = '';
                            })
                            .catch((error) => {
                                console.error('Error:', error);
                                // Masquer l'avancement du chargement
                                document.getElementById('loading').style.display = 'none';
                            });
                        //#endregion
                    } else {
                        console.log('Error:', data.data);
                        // Masquer l'avancement du chargement
                        document.getElementById('loading').style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Masquer l'avancement du chargement
                    document.getElementById('loading').style.display = 'none';
                });
        });

    </script>
</body>
<!--#endregion -->

<!--#region Onglet Projet -->
<!-- Barre  de recherche -->
<div class="container">
    <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Rechercher un projet" aria-label="Rechercher un projet"
            aria-describedby="button-addon2" id="search_projects">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" id="button-addon2">
                <!-- icone loupe (couleur grise) -->
                <img src="https://img.icons8.com/ios/50/000000/search--v1.png" style="width: 20px; height: 20px;"
                    alt="">
                Rechercher</button>
        </div>
    </div>
</div>

<body>

    <!--#region Onglet Projet -->
        <!--#region Formulaire de création de projet -->
        <br style="color: #000; font-size: 20px; font-weight: bold; text-align: center;" />
        <div class="container" id="new_project_form" style="display: none;" class="main-group-scroll">
            <form id="projectForm" class="container" style="border-radius: 15px; background-color: white;">
                <div class="row">
                    <div class="col-md-12">
                        <p>Remplissez les champs suivants:</p>
                        <hr class="gray-border">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectTitle">Titre du projet: <span style="color: red;">*</span></label>
                        <input type="text" id="projectTitle" name="projectTitle" class="form-control" required>
                    </div>
                    <div class="col-md-6">
                        <label for="projectType">Type de projet: <span style="color: red;">*</span></label>
                        <input type="text" id="projectType" name="projectType" class="form-control" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectDate">Date de début prévisionnelle: <span style="color: red;">*</span></label>
                        <input type="date" id="projectDate" name="projectDate" class="form-control" required>
                    </div>
                    <div class="col-md-6">
                        <label for="projectEndDate2">Date de fin prévisionnelle: <span style="color: red;">*</span></label>
                        <input type="date" id="projectEndDate2" name="projectEndDate2" class="form-control" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectLocation">Pays de réalisation du projet: <span
                                style="color: red;">*</span></label>
                        <input type="text" id="projectLocation" name="projectLocation" class="form-control" required>
                    </div>
                    <div class="col-md-6">
                        <label for="pademResponsible">Responsable Padem:</label>
                        <input type="text" id="pademResponsible" name="pademResponsible" class="form-control">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="pademResponsibleEmail">Email du responsable Padem:</label>
                        <input type="email" id="pademResponsibleEmail" name="pademResponsibleEmail" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label for="projectReferent">Référent du projet: <span style="color: red;">*</span></label>
                        <input type="text" id="projectReferent" name="projectReferent" class="form-control" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectReferentEmail">Email du référent du projet: <span
                                style="color: red;">*</span></label>
                        <input type="email" id="projectReferentEmail" name="projectReferentEmail" class="form-control"
                            required>
                    </div>
                    <div class="col-md-6">
                        <label for="projectDescription">Description du projet: <span style="color: red;">*</span></label>
                        <textarea id="projectDescription" name="projectDescription" rows="4" cols="50"
                            class="form-control"></textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12" id="add_trames">
                        <!-- Saisir les noms des documents models que vous comptez joindre ci-dessous à ce projet: -->
                        <label for="projectDocuments">Saisir le nom de la trame à joindre au projet: <span
                                style="color: red;">*</span></label>
                        <textarea type="text" id="projectDocuments" name="projectDocuments" class="form-control" rows="4"
                            required></textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <hr class="gray-border">
                    </div>
                </div>
                <!--
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectCover">Ajoutez une image de couverture pour le projet:</label>
                        <input type="file" id="projectCover" name="projectCover" accept="image/*" class="form-control-file">
                    </div>
                </div>-->
                <div class="row">
                    <div class="col-md-12">
                        <div class="action-buttons" style="display: flex; justify-content: flex-end;">
                            <button type="button" onclick="cancelProject()" class="btn btn-secondary"
                                style="width: fit-content;">
                                Annuler
                                <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="cancel"
                                    style="width: 35px; height: 35px;">
                            </button>
                            <button type="button" onclick="saveFormData()" class="btn btn-primary"
                                style="color: white; width: fit-content;">
                                Enregistrer
                                <img src="https://lab.padem.org/wp-content/uploads/save_black.png" alt="save"
                                    style="width: 35px; height: 35px;">
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <!--#endregion -->

        <div id="all_projects_details_container" style="display: block;">
            <!--#region Tableau des projets -->
            <div id="all_projects_table" class="main-group-scroll">
                <table>
                    <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                        <tr>
                            <th scope="col" id="project_tite">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                    style="width: 15px; height: 15px;" alt=""></th>
                            <th scope="col" id="country_name">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                    style="width: 15px; height: 15px;" alt=""></th>
                            <th scope="col" id="association_name">Association <img
                                    src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                    alt=""></th>
                            <th scope="col" id="theme_name">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                    style="width: 15px; height: 15px;" alt=""></th>
                            <th scope="col" id="status_name">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                    style="width: 15px; height: 15px;" alt=""></th>
                        </tr>
                    </thead>
                    <tbody id="display_projects" class="main-group-scroll" style="height: 500px;">
                    </tbody>
                </table>
            </div>
            <!--#endregion -->

            <!--#region Afficher les détails du projet sélectionné -->
            <div class="container" id="project_details" style="display: none;" class="main-group-scroll">
            </div>
            <!--#endregion -->
        </div>

        <!--#region Mes projets -->
        <div class="container" id="my_projects_table" style="display: none;" class="main-group-scroll">
            <table>
                <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                    <tr>
                        <th scope="col" id="my_project_tite">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="my_country_name">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col" id="my_association_name">Association <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="my_theme_name">Thématique <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="my_status_name">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                style="width: 15px; height: 15px;" alt=""></th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody id="display_my_projects">
                </tbody>
            </table>
        </div>
        <!--#endregion -->

        <!--#region Archives -->
        <div class="container" id="archives_projects_table" style="display: none;" class="main-group-scroll">
            <table>
                <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                    <tr>
                        <th scope="col" id="archives_project_tite">Titre <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="archives_country_name">Pays <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="archives_association_name">Association <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="archives_theme_name">Thématique <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="archives_status_name">Statut <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody id="display_archives_projects">
                </tbody>
            </table>
        </div>
        <!--#endregion -->
    <!--#endregion -->

    <script>
        //#region Initialisation des variables
        var projects = [];
        var users = [];
        var projectManagers = [];
        var projectMembers = [];

        // Récupérer les données de l'utilisateur connecté
        var userEmail = current_user_data.email;
        var userRole = current_user_data.roles;
        var userId = current_user_data.ID;

        // Variables des filtres
        var status_list = ['En cours', 'En attente', 'Terminé'];
        var country_list = [];
        var association_list = [];
        var theme_list = [];

        //#region Model de projet
        var project_model = {
            id: 0,
            project_id: 0,
            project_title: "",
            project_type: "",
            start_date: "",
            end_date: "",
            updated_date: "",
            project_location: "",
            project_status: "",
            padem_responsible: "",
            padem_responsible_email: "",
            project_referent: "",
            project_referent_email: "",
            project_description: JSON.stringify(""),
            background_image_link: "",
            folders: "",
        };
        //#endregion

        //#endregion

        // Chargement de la page
        document.addEventListener('DOMContentLoaded', function (e) {
            e.preventDefault();

            // Afficher le tableau des projets
            document.getElementById('all_projects_table').style.display = 'block';
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';

            document.getElementById('allProjects').style.color = '#29A6A7';

            //#region Vérifier si l'utilisateur connecté est un administrateur, un membre privilégié ou un abonné(subscriber)
            if (userRole.includes('administrator')) {
                // Afficher le bouton Créer un Projet
                document.getElementById('createProject').style.display = 'block';
                // Afficher le bouton Mes projets
                document.getElementById('myProjects').style.display = 'block';
                // Afficher le bouton Archives
                document.getElementById('archives_projects').style.display = 'block';
            }
            else if (userRole.includes('um_member')) {
                // Afficher le bouton Créer un Projet
                document.getElementById('createProject').style.display = 'none';
                // Afficher le bouton Mes projets
                document.getElementById('myProjects').style.display = 'block';
                // Afficher le bouton Archives
                document.getElementById('archives_projects').style.display = 'block';
            }
            else if (userRole.includes('subscriber')) {
                // Afficher le bouton Créer un Projet
                document.getElementById('createProject').style.display = 'none';
                // Afficher le bouton Mes projets
                document.getElementById('myProjects').style.display = 'block';
                document.getElementById('myProjects').disabled = true;
                // Afficher le bouton Archives
                document.getElementById('archives_projects').style.display = 'block';
                document.getElementById('archives_projects').disabled = true;
            }
            //#endregion

            // Récupération des utilisateurs
            getUsers();
            // Récupération des projets
            getProjects();
        });

        //#region écouteur d'événement pour les filtres
        document.getElementById('project_tite').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher un menu déroulant pour les filtres

        });

        document.getElementById('country_name').addEventListener('click', function (e) {
            e.preventDefault();


        });

        document.getElementById('association_name').addEventListener('click', function (e) {
            e.preventDefault();
            projects.sort((a, b) => a.association.localeCompare(b.association));
            displayProjects(projects);
        });

        document.getElementById('theme_name').addEventListener('click', function (e) {
            e.preventDefault();
            projects.sort((a, b) => a.theme.localeCompare(b.theme));
            displayProjects(projects);
        });

        document.getElementById('status_name').addEventListener('click', function (e) {
            e.preventDefault();
            projects.sort((a, b) => a.status.localeCompare(b.status));
            displayProjects(projects);
        });
        //#endregion

        //#region ajouter écouteur d'événement pour le bouton Tous les Projets
        document.getElementById('allProjects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = '#29A6A7';
            document.getElementById('allProjects').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.border = 'gray';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = 'gray';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = 'gray';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher le tableau des projets
            document.getElementById('all_projects_details_container').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';
        });
        //#endregion

        //#region ajouter écouteur d'événement pour le bouton Créer un Projet
        document.getElementById('createProject').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = 'gray';
            document.getElementById('allProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer, et la couleur du texte
            document.getElementById('createProject').style.border = '#29A6A7';
            document.getElementById('createProject').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = 'gray';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = 'gray';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher le formulaire de création de projet
            document.getElementById('new_project_form').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('all_projects_details_container').style.display = 'none';
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Mes projets
        document.getElementById('myProjects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = 'gray';
            document.getElementById('allProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = '#29A6A7';
            document.getElementById('myProjects').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.border = 'gray';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = 'gray';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher les projets de l'utilisateur connecté
            document.getElementById('my_projects_table').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('all_projects_details_container').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';
        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Archives
        document.getElementById('archives_projects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = 'gray';
            document.getElementById('allProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = '#29A6A7';
            document.getElementById('archives_projects').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.border = 'gray';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = 'gray';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            // Afficher les archives des projets
            document.getElementById('archives_projects_table').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('all_projects_details_container').style.display = 'none';
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';
        });
        //#endregion


        //#region Récupération des utilisateurs
        function getUsers() {
            fetch('https://api.ynov.jcatania.io/user')
                .then(response => response.json())
                .then(data => {
                    users = data;
                    projectManagers = users.filter(user => user.roles.includes('project_manager'));
                    projectMembers = users.filter(user => user.roles.includes('project_member'));
                })
                .catch(error => console.error('Erreur récupération des utilisateurs:', error));
        }
        //#endregion

        //#region Récupération des projets
        function getProjects() {
            // Afficher l'animation de chargement
            document.getElementById('loading').style.display = 'block';
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    projects = data;
                    displayProjects(projects);
                    // Masquer l'animation de chargement
                    document.getElementById('loading').style.display = 'none';
                })
                .catch(error => { 
                    console.error('Erreur récupération des projets:', error)
                    // Masquer l'animation de chargement
                    document.getElementById('loading').style.display = 'none';
                });
        }
        //#endregion

        //#region Affichage des projets (Chaque projet est une ligne du tableau avec des bordures et des angles arrondis)
        function displayProjects(projects) {
            var displayProjects = document.getElementById('display_projects');
            displayProjects.innerHTML = '';
            projects.forEach(project => {
                let tr = document.createElement('tr');
                tr.style.border = '1px solid lightgray';
                tr.style.borderRadius = '25px';
                tr.style.backgroundColor = 'white';
                tr.style.margin = '6px';
                tr.style.padding = '15px';
                tr.style.cursor = 'pointer';
                tr.id = project.project_id;
                tr.addEventListener('click', function () { // Afficher les détails du projet
                    document.getElementById('all_projects_table').style.display = 'none';
                    document.getElementById('project_details').style.display = 'block';
                    displayProject(project.project_id);
                });
                tr.addEventListener('mouseover', function () {
                    tr.style.border = '1px solid #6CE8E8';
                });
                tr.addEventListener('mouseout', function () {
                    tr.style.border = '1px solid lightgray';
                });
                tr.innerHTML = `
                    <th style="color: #29A6A7; margin-left: 5px;">${project.project_title}</th>
                    <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${project.project_location}</th>
                    <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${project.association}</th>
                    <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${project.project_type}</th>
                    <th style="background-color: ${project.project_status === 'En cours' ? 'lightgreen' : project.project_status === 'Terminé' ? 'lightcoral' : 'lightgray'}; border-radius: 10px; margin: 5px; padding: 5px; width: fit-content;">
                        <p style="color: ${project.project_status === 'En cours' ? 'green' : project.project_status === 'Terminé' ? 'red' : 'gray'};">${project.project_status ? project.project_status : '---'}</p>
                    </th>
                `;
                displayProjects.appendChild(tr);
            });
        }
        //#endregion

        // Barre de recherche

        // Mes projets
        function getUserProjects() {
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    projects = data;
                    displayMyProjects();
                })
                .catch(error => console.error('Erreur récupération des projets:', error));
        }
        function displayMyProjects() {
            let myProjects = projects.filter(project => project.manager === userId || project.members.includes(userId));
            displayProjects(myProjects);
        }

        //#region Archives
        function displayArchivesProjects() {
            let archivesProjects = projects.filter(project => project.status === 'Archivé');
            displayProjects(archivesProjects);
        }
        //#endregion

        //#region Get months' names
        function getMonthName(month) {
            let monthName = '';
            switch (month) {
                case 0:
                    monthName = 'Janvier';
                    break;
                case 1:
                    monthName = 'Février';
                    break;
                case 2:
                    monthName = 'Mars';
                    break;
                case 3:
                    monthName = 'Avril';
                    break;
                case 4:
                    monthName = 'Mai';
                    break;
                case 5:
                    monthName = 'Juin';
                    break;
                case 6:
                    monthName = 'Juillet';
                    break;
                case 7:
                    monthName = 'Août';
                    break;
                case 8:
                    monthName = 'Septembre';
                    break;
                case 9:
                    monthName = 'Octobre';
                    break;
                case 10:
                    monthName = 'Novembre';
                    break;
                case 11:
                    monthName = 'Décembre';
                    break;
                default:
                    monthName = 'Non renseigné';
                    break;
            }
            return monthName;
        }
        //#endregion

        //#region Get days' names
        function getDayName(day) {
            let dayName = '';
            switch (day) {
                case 0:
                    dayName = 'Dimanche';
                    break;
                case 1:
                    dayName = 'Lundi';
                    break;
                case 2:
                    dayName = 'Mardi';
                    break;
                case 3:
                    dayName = 'Mercredi';
                    break;
                case 4:
                    dayName = 'Jeudi';
                    break;
                case 5:
                    dayName = 'Vendredi';
                    break;
                case 6:
                    dayName = 'Samedi';
                    break;
                default:
                    dayName = 'Non renseigné';
                    break;
            }
            return dayName;
        }
        //#endregion

        //#region Fonction pour ajouter un projet
        function newProject() {
            var projectTitle = document.getElementById('projectTitle').value;
            var projectType = document.getElementById('projectType').value;
            var projectDate = document.getElementById('projectDate').value;
            var projectEndDate2 = document.getElementById('projectEndDate2').value;
            var projectLocation = document.getElementById('projectLocation').value;
            var pademResponsible = document.getElementById('pademResponsible').value;
            var pademResponsibleEmail = document.getElementById('pademResponsibleEmail').value;
            var projectReferent = document.getElementById('projectReferent').value;
            var projectReferentEmail = document.getElementById('projectReferentEmail').value;
            var projectDescription = document.getElementById('projectDescription').value;
            var projectDocuments = document.getElementById('projectDocuments').value;

            var project = {
                project_title: projectTitle,
                project_type: projectType,
                start_date: projectDate,
                end_date: projectEndDate2,
                updated_date: new Date(),
                project_location: projectLocation,
                project_status: 'En attente',
                padem_responsible: pademResponsible,
                padem_responsible_email: pademResponsibleEmail,
                project_referent: projectReferent,
                project_referent_email: projectReferentEmail,
                project_description: projectDescription,
                background_image_link: '',
                folders: projectDocuments,
            };

            fetch('https://lab.padem.org/wp-json/mo/v1/addProject', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(project),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    getProjects();
                    document.getElementById('new_project_form').style.display = 'none';
                    document.getElementById('all_projects_details_container').style.display = 'block';
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
        //#endregion

        //#region Liste des fonctions pour les actions sur les projets
        // Fonction pour ajouter une association à un projet
        function addAssociationToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var associations = project.association;
            var association = prompt('Saisir le nom de l\'association à ajouter au projet:');
            if (association !== null) {
                associations.push(association);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, association: associations }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }
        // Fonction pour ajouter un membre à un projet
        function addMemberToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var members = project.members;
            var member = prompt('Saisir le nom du membre à ajouter au projet:');
            if (member !== null) {
                members.push(member);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, members: members }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }
        // Fonction pour ajouter un document à un projet
        function addDocumentToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var documents = project.documents;
            var document = prompt('Saisir le nom du document à ajouter au projet:');
            if (document !== null) {
                documents.push(document);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, documents: documents }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }
        // Fonction pour ajouter un rapport à un projet
        function addReportToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var reports = project.reports;
            var report = prompt('Saisir le nom du rapport à ajouter au projet:');
            if (report !== null) {
                reports.push(report);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, reports: reports }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }
        // Fonction pour éditer un projet
        function editProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var projectTitle = prompt('Saisir le nouveau titre du projet:', project.project_title);
            var projectType = prompt('Saisir le nouveau type du projet:', project.project_type);
            var projectDate = prompt('Saisir la nouvelle date de début du projet:', project.start_date);
            var projectEndDate2 = prompt('Saisir la nouvelle date de fin du projet:', project.end_date);
            var projectLocation = prompt('Saisir la nouvelle localisation du projet:', project.project_location);
            var pademResponsible = prompt('Saisir le nouveau responsable du projet:', project.padem_responsible);
            var pademResponsibleEmail = prompt('Saisir le nouvel email du responsable du projet:', project.padem_responsible_email);
            var projectReferent = prompt('Saisir le nouveau référent du projet:', project.project_referent);
            var projectReferentEmail = prompt('Saisir le nouvel email du référent du projet:', project.project_referent_email);
            var projectDescription = prompt('Saisir la nouvelle description du projet:', project.project_description);
            var projectDocuments = prompt('Saisir les nouveaux documents du projet:', project.folders);

            var updatedProject = {
                project_title: projectTitle,
                project_type: projectType,
                start_date: projectDate,
                end_date: projectEndDate2,
                updated_date: new Date(),
                project_location: projectLocation,
                project_status: project.project_status,
                padem_responsible: pademResponsible,
                padem_responsible_email: pademResponsibleEmail,
                project_referent: projectReferent,
                project_referent_email: projectReferentEmail,
                project_description: projectDescription,
                background_image_link: project.background_image_link,
                folders: projectDocuments,
            };

            fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ project_id: projectId, project: updatedProject }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    getProjects();
                    document.getElementById('all_projects_table').style.display = 'block';
                    document.getElementById('project_details').style.display = 'none';
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
        // Fonction pour archiver un projet
        function archiveProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);

            //#region Mettre à jour le projet
            fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    project_id: projectId,
                    project_title: project.project_title,
                    project_type: project.project_type,
                    start_date: project.start_date,
                    end_date: project.end_date,
                    is_archive: true, // Archiver le projet
                    updated_date: new Date(),
                    project_location: project.project_location,
                    project_status: 'Archivé',
                    padem_responsible: project.padem_responsible,
                    padem_responsible_email: project.padem_responsible_email,
                    project_referent: project.project_referent,
                    project_referent_email: project.project_referent_email,
                    project_description: project.project_description,
                    background_image_link: project.background_image_link,
                    users: project.users,
                    reports: project.reports,
                    folders: project.folders,
                    divers: project.divers,
                }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);

                    //#region Supprimer le projet de la liste des projets
                    fetch('https://lab.padem.org/wp-json/mo/v1/removeProjectData', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ column_param1: project.id }),
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Success:', data);
                            getProjects();
                            document.getElementById('all_projects_table').style.display = 'block';
                            document.getElementById('project_details').style.display = 'none';
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                    //#endregion
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            //#endregion

            //#region Envoyer un email à l'ensemble des membres du projet pour les informer de l'archivage du projet
            var projectMembers = project.users;
            var subject = 'Padem Lab Notifications: ' + 'Archivage du projet ' + project.project_title;
            var message = 'Bonjour, \n\nLe projet ' + project.project_title + ' a été archivé. \n\nCordialement, \n\nL\'équipe PADEM';
            
            // Envoyer un email à chaque membre du projet
            project.users.forEach(user => {
                var userEmail = users.find(u => u.ID === user).user_email;
                
                sendMailNotification(userEmail, subject, message);
            });
        }
        //#endregion
        //#endregion

        //#region Afficher le projet correspondant à l'ID
        function displayProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var displayProject = document.getElementById('project_details');
            // Vider le contenu
            displayProject.innerHTML = '';

            //#region Formater les dates
            var formated_updated_date = new Date(project.updated_date).toLocaleDateString('fr-FR'); // Formater la date
            var formated_start_date = new Date(project.start_date).toLocaleDateString('fr-FR');
            var formated_end_date = new Date(project.end_date).toLocaleDateString('fr-FR');

            var _updated_date = formated_updated_date.split('/'); // Récupérer la date
            var _start_date = formated_start_date.split('/');
            var _end_date = formated_end_date.split('/');

            var month_updated_date = getMonthName(parseInt(_updated_date[1])); // Récupérer le mois
            var month_start_date = getMonthName(parseInt(_start_date[1]));
            var month_end_date = getMonthName(parseInt(_end_date[1]));

            var day_updated_date = getDayName(new Date(project.updated_date).getDay()); // Récupérer le jour de la semaine
            var day_start_date = getDayName(new Date(project.start_date).getDay());
            var day_end_date = getDayName(new Date(project.end_date).getDay());

            var final_updated_date = day_updated_date + ' ' + _updated_date[0] + ' ' + month_updated_date + ' ' + _updated_date[2]; // Date finale
            var final_start_date = day_start_date + ' ' + _start_date[0] + ' ' + month_start_date + ' ' + _start_date[2];
            var final_end_date = day_end_date + ' ' + _end_date[0] + ' ' + month_end_date + ' ' + _end_date[2];
            //#endregion

            //#region Progression du projet (En cours, En attente, Terminé)
            var today = new Date();
            var start_date = new Date(project.start_date);
            var end_date = new Date(project.end_date);
            var progression = '';
            if (today < start_date) {
                progression = 'En attente';
            }
            else if (today >= start_date && today <= end_date) {
                progression = 'En cours';
            }
            else {
                progression = 'Terminé';
            }
            //#endregion

            displayProject.innerHTML = `
                <!-- Afficher le projet -->
                <div class="card-body" style="display: flex; justify-content: space-between; margin: 5px; padding: 5px; width: 100%; height: fit-content; border-radius: 25px; background-color: transparent;">
                    <!-- Boutons d'actions -->
                    <button type="button" id="add_association_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone groupe --> <img src="https://img.icons8.com/?size=100&id=23266&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <button type="button" id="add_member_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone personne --> <img src="https://img.icons8.com/?size=100&id=3&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <button type="button" id="add_document_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone ajouter document --> <img src="https://img.icons8.com/?size=100&id=57052&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <button type="button" id="add_report_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone soumettre rapport --> <img src="https://img.icons8.com/?size=100&id=5271&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <!-- Boutons d'édition -->
                    <button type="button" id="editProject" style="background-color: white; border-radius: 25px;"> <!-- icone crayon --> <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    <button type="button" id="archiveProject" onclick="archiveProject(${project.project_id})" style="background-color: white; border-radius: 25px;"> <!-- icone archive --> <img src="https://img.icons8.com/?size=100&id=12634&format=png&color=FA5252" style="width: 20px; height: 20px;" alt=""></button>
                </div>
                <article class="card" style="margin: 5px; padding: 5px; border-radius: 25px;">
                    <!-- Informations du projet -->
                    <div style="display: flex; justify-content: space-between; margin: 5px; padding: 5px;">
                        <h4 style="color: #29A6A7; margin-top: 5px;">${project.project_title ? project.project_title : '---'}</h4>
                        <button type="button" id="back_To_All_Projects" style="background-color: #29A6A7; border-radius: 50px; width: fit-content; color: white; font-size: 12px;" title="Retour"> <!-- icone retour --> <img src="https://img.icons8.com/?size=100&id=3483&format=png&color=FFFFFF" style="width: 20px; height: 20px;" alt=""> Retour</button>
                    </div>
                    <div style="display: none;">
                        <div style="display: flex; justify-content: flex-start; margin-bottom: -5px;">
                            <button type="button" id="hide_show_details" style="width: fit-content; color: lightgray; font-size: 12px;" title=""> <img src="https://img.icons8.com/?size=100&id=986&format=png&color=9F9F9F" id="hide_show_details_icon_"
                                style="width: 20px; height: 20px;" alt="details">Masquer les détails du projet</button>
                        </div>
                        <hr style="border: 1px solid lightgray;">
                    </div>
                    <div style="display: block; margin: 5px; padding: 5px; border-radius: 25px; border: 1px solid lightgray;">
                        <!-- Détails du projet -->
                        <div id="project_details_container_">
                            <div style="border-radius: 25px; background-color: white; display: flex; justify-content: space-between;" id="project_details_container">
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Bailleur de fonds --> <img src="https://img.icons8.com/?size=100&id=Iv2ecGx6KYqh&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Bailleur: </p>
                                        <p style="color: black; margin-left: 5px;">${project.funder ? project.funder : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Groupe --> <img src="https://img.icons8.com/?size=100&id=779&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Association: </p>
                                        <p style="color: black; margin-left: 5px;">${project.association ? project.association : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Thématique --> <img src="https://img.icons8.com/?size=100&id=22798&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Thématique: </p>
                                        <p style="color: black; margin-left: 5px;">${project.project_type ? project.project_type : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone pays --> <img src="https://img.icons8.com/?size=100&id=17548&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Pays: </p>
                                        <p style="color: black; margin-left: 5px;">${project.project_location ? project.project_location : '---'}</p>
                                    </div>
                                </div>
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Responsable --> <img src="https://img.icons8.com/?size=100&id=21996&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Référent: </p>
                                        <p style="color: black; margin-left: 5px;">${project.project_referent ? project.project_referent : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de début --> <img src="https://img.icons8.com/?size=100&id=1072&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de début: </p>
                                        <p style="color: black; margin-left: 5px;">${final_start_date ? final_start_date : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de fin --> <img src="https://img.icons8.com/?size=100&id=1070&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de fin: </p>
                                        <p style="color: black; margin-left: 5px;">${final_end_date ? final_end_date : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- progress bar --> <img src="https://img.icons8.com/?size=100&id=39273&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Progression: </p>
                                        <p style="color: ${progression === 'En cours' ? 'green' : progression === 'Terminé' ? 'red' : 'gray'}; width: fit-content; margin-left: 5px;">${progression}</p>
                                    </div>
                                </div>
                                <!-- Bouton pour modifier les détails du projet -->
                                <button type="button" id="update_all_project_details" style="width: fit-content; margin-bottom: 150px;" title="Modifier les détails du projet"> <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=9F9F9F" id="update_all_project_details_icon"
                                    style="width: 55px; height: 30px;" alt="Modifier les détails du projet"></button>
                            </div>
                            <!-- Description du projet -->
                            <div id="project_description_container_main" style="display: block;">
                                <div style="display: flex; justify-content: flex-start; margin-bottom: -3px;">
                                    <button type="button" id="_project_description_" style="width: fit-content; color: gray; font-size: 12px;" title="">Voir la description du projet....</button>
                                </div>
                                <div id="project_description_container_" style="display: none;">
                                    <div style="display: column; justify-content: flex-start; margin: 5px; padding: 5px;">
                                        <p style="color: black; margin-left: 5px;">${project.project_description ? project.project_description : 'Aucune description disponible pour ce projet.'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Formulaire pour modifier les détails du projet -->
                        <div id="update_all_project_details_container_" style="display: none;">
                            <div style="display: flex; justify-content: space-between; margin: 5px; padding: 5px;">
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Bailleur de fonds --> <img src="https://img.icons8.com/?size=100&id=Iv2ecGx6KYqh&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Bailleur: </p>
                                        <input type="text" id="update_funder" value="${project.funder ? project.funder : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Groupe --> <img src="https://img.icons8.com/?size=100&id=779&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Association: </p>
                                        <input type="text" id="update_association" value="${project.association ? project.association : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Thématique --> <img src="https://img.icons8.com/?size=100&id=22798&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Thématique: </p>
                                        <input type="text" id="update_project_type" value="${project.project_type ? project.project_type : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone pays --> <img src="https://img.icons8.com/?size=100&id=17548&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Pays: </p>
                                        <input type="text" id="update_project_location" value="${project.project_location ? project.project_location : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                </div>
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Responsable --> <img src="https://img.icons8.com/?size=100&id=21996&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Référent: </p>
                                        <input type="text" id="update_project_referent" value="${project.project_referent ? project.project_referent : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de début --> <img src="https://img.icons8.com/?size=100&id=1072&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de début: </p>
                                        <input type="date" id="update_start_date" value="${project.start_date ? project.start_date : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de fin --> <img src="https://img.icons8.com/?size=100&id=1070&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de fin: </p>
                                        <input type="date" id="update_end_date" value="${project.end_date ? project.end_date : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Responsable --> <img src="https://img.icons8.com/?size=100&id=77&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Description: </p>
                                        <textarea id="update_project_description" style="color: gray; margin-left: 5px; width: fit-content; border: 1px solid lightgray; border-radius: 15px;" row="5">${project.project_description ? project.project_description : '---'}</textarea>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: flex-end; margin: 5px; padding: 5px;">
                                <button type="button" id="update_all_project_details_button" style="width: fit-content; background-color: #29A6A7; border-radius: 25px; color: white; font-size: 12px;" title="valider"> <!-- icone valider --> <img src="https://img.icons8.com/?size=100&id=11658&format=png&color=FFFFFF" style="width: 20px; height: 20px;" alt=""> Valider</button>
                                <div style="margin: 5px;"></div>
                                <button type="button" id="cancel_update_all_project_details" style="width: fit-content; background-color: red; border-radius: 25px; color: white; font-size: 12px;" title="annuler"> <!-- icone annuler --> <img src="https://img.icons8.com/?size=100&id=3062&format=png&color=FFFFFF" style="width: 20px; height: 20px;" alt=""> Annuler</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body" style="margin: 5px; padding: 5px; min-height: 300px; width: 100%;"">
                        <!-- Menu initial -->
                        <div id="first_menu_${project.project_id}" style="display: block;">
                            <div style="margin: 5px; display: flex; justify-content: space-between;">
                                <button type="button" id="_reports_requests_${project.project_id}" style="background-color: white; color: gray; border-radius: 15px; font-size: 13px;" class="box-clicable"> <!-- icone rapport --> <img src="https://img.icons8.com/?size=100&id=123478&format=png&color=9F9F9F" 
                                    style="width: 20px; height: 20px;" alt=""> Demandes de rapports</button>
                                <div style="margin: 5px; display: flex; justify-content: flex-end;">
                                    <button id="_project_reports_${project.project_id}" style="width: fit-content; color: gray; background-color: #E7E7E7; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/ios/50/9F9F9F/report-card.png"
                                            style="width: 15px; height: 15px;" alt=""> Rapports</button>
                                    <button id="_project_documents_${project.project_id}" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/ios/50/9F9F9F/document.png"
                                            style="width: 15px; height: 15px;" alt=""> Documents</button>
                                    <button id="_project_associations_${project.project_id}" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/?size=100&id=779&format=png&color=9F9F9F"
                                            style="width: 15px; height: 15px;" alt=""> Associations</button>                             
                                    <button id="_project_members_${project.project_id}" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/?size=100&id=21997&format=png&color=9F9F9F"
                                            style="width: 15px; height: 15px;" alt=""> Membres</button>
                                </div>
                            </div>
                            <!-- Ligne de séparation -->
                            <hr style="border: 1px solid lightgray;">
                            <div>
                                <div class="container" id="reportsRequests_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_tite_${project.project_id}_reports_requests">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="country_name_${project.project_id}_reports_requests">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="association_name_${project.project_id}_reports_requests">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}_reports_requests">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}_reports_requests">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_reports_requests_${project.project_id}" class="main-group
                                            -scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="container" id="projectReports_${project.project_id}" style="display: block;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_tite_${project.project_id}">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="country_name_${project.project_id}">Auteur <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="association_name_${project.project_id}">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}">Type de rapport <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_reports_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="container" id="projectAssociations_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_name_${project.project_id}">Nom <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="country_name_${project.project_id}">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="association_name_${project.project_id}">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_associations_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="container" id="projectMembers_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_tite_${project.project_id}_members">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="country_name_${project.project_id}_members">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="association_name_${project.project_id}_members">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}_members">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}_members">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_members_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="container" id="projectDocuments_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 300px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="doc_title_${project.project_id}">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="doc_name">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="doc_association_name">Association <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="doc_theme_name">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="doc_status_name">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_documents_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Ajouter une association existante au projet -->
                        <div id="_menu_add_association_${project.project_id}" style="display: none;">
                            <form id="add_association_to_project_form_${project.project_id}" class="form-group">
                                <div class="form-group">
                                    <label for="association_${project.project_id}">Association</label>
                                    <select class="form-control" id="association_${project.project_id}" name="association">
                                        <option value="">Sélectionner une association</option>

                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Ajouter</button>
                            </form>
                        </div>

                        <!-- Ajouter un membre au projet -->
                        <div id="_menu_add_member_${project.project_id}" style="display: none;">
                            <form id="add_member_to_project_form_${project.project_id}" class="form-group">
                                <div class="form-group">
                                    <label for="member_${project.project_id}">Membre</label>
                                    <select class="form-control" id="member" name="member_${project.project_id}">
                                        <option value="">Sélectionner un membre</option>

                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Ajouter</button>
                            </form>
                        </div>  

                        <!-- Ajouter un document au projet (Formulaire & upload) -->
                        <div id="_menu_add_document_${project.project_id}" style="display: none;">
                            <form id="add_document_to_project_form_${project.project_id}" class="form-group">
                                <div class="form-group">
                                    <label for="document_title_${project.project_id}">Titre</label>
                                    <input type="text" class="form-control" id="document_title_${project.project_id}" name="document_title">
                                </div>
                                <div class="form-group">
                                    <label for="document_file_${project.project_id}">Fichier</label>
                                    <input type="file" class="form-control" id="document_file_${project.project_id}" name="document_file">
                                    <small id="fileHelp" class="form-text text-muted">Veuillez sélectionner un fichier PDF.</small>
                                </div>
                                <button type="submit" class="btn btn-primary">Ajouter</button>
                            </form>
                        </div>

                        <!-- Ajouter un nouveau rapport au projet -->
                        <div id="_menu_add_report_${project.project_id}" style="display: none;">
                            <form id="add_report_to_project_form_${project.project_id}" class="form-group">
                                <div class="form-group">
                                    <label for="report_title_${project.project_id}">Titre</label>
                                    <input type="text" class="form-control" id="report_title_${project.project_id}" name="report_title">
                                </div>
                                <!-- type de rapport -->
                                <div class="form-group">
                                    <label for="report_type_${project.project_id}">Type</label>
                                    <select class="form-control" id="report_type_${project.project_id}" name="report_type">
                                        <option value="">Sélectionner un type de rapport</option>
                                        <option value="Rapport d'activité">Rapport d'activité</option>
                                        <option value="Rapport financier">Rapport financier</option>
                                        <option value="Rapport de mission">Rapport de mission</option>
                                        <option value="Rapport de suivi">Rapport de suivi</option>
                                    </select>
                                </div>
                                <!-- Date du rapport -->
                                <div class="form-group">
                                    <label for="report_date_${project.project_id}">Date</label>
                                    <input type="date" class="form-control" id="report_date_${project.project_id}" name="report_date">
                                </div>
                                <div class="form-group">
                                    <label for="report_description">Description</label>
                                    <textarea class="form-control" id="report_description" name="report_description" rows="8"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="report_file_${project.project_id}">Fichier</label>
                                    <input type="file" class="form-control" id="report_file_${project.project_id}" name="report_file">
                                    <small id="fileHelp_${project.project_id}" class="form-text text-muted">Veuillez sélectionner un fichier PDF.</small>
                                </div>
                                <button type="submit" class="btn btn-primary">Ajouter</button>
                            </form>
                        </div>
                    </div>
                </article>
            `;

            //#region Ajouter écouteur d'événement pour le bouton "Modifier les détails du projet"
            document.getElementById('update_all_project_details').addEventListener('click', function () {
                document.getElementById('update_all_project_details_container_').style.display = 'block';
                document.getElementById('project_details_container_').style.display = 'none';
            });

            //#region Ajouter écouteur d'événement pour le bouton "Valider"
            document.getElementById('update_all_project_details_button').addEventListener('click', function () {
                var funder = document.getElementById('update_funder').value;
                var association = document.getElementById('update_association').value;
                var project_type = document.getElementById('update_project_type').value;
                var project_location = document.getElementById('update_project_location').value;
                var project_referent = document.getElementById('update_project_referent').value;
                var start_date = document.getElementById('update_start_date').value;
                var end_date = document.getElementById('update_end_date').value;
                var project_description = document.getElementById('update_project_description').value;

                // Vérifier si les champs sont vides
                if (funder === '' || association === '' || project_type === '' || project_location === '' || project_referent === '' || start_date === '' || end_date === '' || project_description === '') {
                    alert('Veuillez completer tous les champs.');
                }
                else {
                    // Mettre à jour les détails du projet
                    var project = {
                        project_id: project_id,
                        funder: funder,
                        association: association,
                        project_type: project_type,
                        project_location: project_location,
                        project_referent: project_referent,
                        start_date: start_date,
                        end_date: end_date,
                        project_description: project_description
                    };
                    updateProjectDetails(project);
                }
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton "Annuler"
            document.getElementById('cancel_update_all_project_details').addEventListener('click', function () {
                document.getElementById('update_all_project_details_container_').style.display = 'none';
                document.getElementById('project_details_container_').style.display = 'block';
            });
            //#endregion
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton "Masquer la description du projet"
            document.getElementById('_project_description_').addEventListener('click', function () {
                var project_description_container = document.getElementById('project_description_container_');
                if (project_description_container.style.display === 'block') {
                    project_description_container.style.animation = 'hide 1s';
                    project_description_container.style.display = 'none';
                    document.getElementById('_project_description_').innerHTML = 'Voir la description du projet....';
                }
                else {
                    project_description_container.style.animation = 'show 1s';
                    project_description_container.style.display = 'block';
                    document.getElementById('_project_description_').innerHTML = 'Masquer la description du projet';
                }
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton "Masquer les détails du projet"
            document.getElementById('hide_show_details').addEventListener('click', function () {
                var project_details_container = document.getElementById('project_details_container_');
                if (project_details_container.style.display === 'block') {
                    project_details_container.style.animation = 'hide 1s';
                    project_details_container.style.display = 'none';
                    document.getElementById('hide_show_details').innerHTML = 'Afficher les détails du projet';
                    document.getElementById('hide_show_details_icon_').src = 'https://img.icons8.com/?size=100&id=121539&format=png&color=9F9F9F';
                }
                else {
                    project_details_container.style.animation = 'show 1s';
                    project_details_container.style.display = 'block';
                    document.getElementById('hide_show_details').innerHTML = 'Masquer les détails du projet';
                    document.getElementById('hide_show_details_icon_').src = 'https://img.icons8.com/?size=100&id=986&format=png&color=9F9F9F';
                }
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton Retour aux projets
            document.getElementById('back_To_All_Projects').addEventListener('click', function (e) {
                e.preventDefault();
                
                // Masquer tout les autres éléments
                document.getElementById('project_details').style.display = 'none';
                // Afficher le tableau des projets
                document.getElementById('all_projects_table').style.display = 'block';
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton "Retour aux projets"
            document.getElementById('back_To_Projects').addEventListener('click', function (e) {
                e.preventDefault();
                backToProjects();
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons (Rapports, Documents, Associations, Membres, Demandes de rapports)
            document.getElementById(`_reports_requests_${project.project_id}`).addEventListener('click', function () {
                // Afficher les demandes de rapports & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'block';
                document.getElementById('projectReports_' + project.project_id).style.display = 'none';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = '#E7E7E7';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = 'white';
            });
            document.getElementById(`_project_reports_${project.project_id}`).addEventListener('click', function () {
                // Afficher les rapports du projet & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'none';
                document.getElementById('projectReports_' + project.project_id).style.display = 'block';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = '#E7E7E7';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = 'white';
            });
            document.getElementById(`_project_documents_${project.project_id}`).addEventListener('click', function () {
                // Afficher les documents du projet & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'none';
                document.getElementById('projectReports_' + project.project_id).style.display = 'none';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'block';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = '#E7E7E7';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = 'white';
            });
            document.getElementById(`_project_associations_${project.project_id}`).addEventListener('click', function () {
                // Afficher les associations du projet & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'none';
                document.getElementById('projectReports_' + project.project_id).style.display = 'none';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'block';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = '#E7E7E7';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = 'white';
            });
            document.getElementById(`_project_members_${project.project_id}`).addEventListener('click', function () {
                // Afficher les membres du projet & masquer les autres éléments
                document.getElementById('reportsRequests_' + project.project_id).style.display = 'none';
                document.getElementById('projectReports_' + project.project_id).style.display = 'none';
                document.getElementById('projectAssociations_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'block';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_reports_requests_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_reports_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_documents_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_associations_${project.project_id}`).style.backgroundColor = 'white';
                document.getElementById(`_project_members_${project.project_id}`).style.backgroundColor = '#E7E7E7';
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons (entré/sortie de la souris) pour afficher le nom du bouton
            document.getElementById('add_association_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_association_to_project').innerHTML = 'Ajouter une Association';
                document.getElementById('add_association_to_project').style.color = 'white';
                document.getElementById('add_association_to_project').style.fontSize = '12px';
                document.getElementById('add_association_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_association_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_association_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=23266&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_association_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('add_member_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_member_to_project').innerHTML = 'Ajouter un Membre';
                document.getElementById('add_member_to_project').style.color = 'white';
                document.getElementById('add_member_to_project').style.fontSize = '12px';
                document.getElementById('add_member_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_member_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_member_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=3&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_member_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('add_document_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_document_to_project').innerHTML = 'Ajouter un Document';
                document.getElementById('add_document_to_project').style.color = 'white';
                document.getElementById('add_document_to_project').style.fontSize = '12px';
                document.getElementById('add_document_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_document_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_document_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=57052&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_document_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('add_report_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_report_to_project').innerHTML = 'Ajouter un Rapport';
                document.getElementById('add_report_to_project').style.color = 'white';
                document.getElementById('add_report_to_project').style.fontSize = '12px';
                document.getElementById('add_report_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_report_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_report_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=5271&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_report_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('editProject').addEventListener('mouseover', function () {
                document.getElementById('editProject').innerHTML = 'Modifier le Projet';
                document.getElementById('editProject').style.color = 'white';
                document.getElementById('editProject').style.fontSize = '12px';
                document.getElementById('editProject').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('editProject').addEventListener('mouseout', function () {
                document.getElementById('editProject').innerHTML = '<img src="https://img.icons8.com/?size=100&id=6697&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('editProject').style.backgroundColor = 'white';
            });

            document.getElementById('archiveProject').addEventListener('mouseover', function () {
                document.getElementById('archiveProject').innerHTML = 'Archiver le Projet';
                document.getElementById('archiveProject').style.color = 'white';
                document.getElementById('archiveProject').style.fontSize = '12px';
                document.getElementById('archiveProject').style.backgroundColor = 'red';
            });
            document.getElementById('archiveProject').addEventListener('mouseout', function () {
                document.getElementById('archiveProject').innerHTML = '<img src="https://img.icons8.com/?size=100&id=12634&format=png&color=FA5252" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('archiveProject').style.backgroundColor = 'white';
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements "click" pour les boutons (Ajouter une association, un membre, un document, un rapport, éditer, archiver)
            document.getElementById('add_association_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('add_association_to_project').style.backgroundColor = '#29A6A7';
                document.getElementById('add_association_to_project').style.color = 'white';
                document.getElementById('add_association_to_project').innerHTML = 'Annuler';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_member_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_report_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                }
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('add_member_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('add_member_to_project').style.backgroundColor = '#29A6A7';
                document.getElementById('add_member_to_project').style.color = 'white';
                document.getElementById('add_member_to_project').innerHTML = 'Annuler';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_association_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                }
                else if(document.getElementById('_menu_add_association_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_report_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'block';
                } 
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('add_document_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('add_document_to_project').style.backgroundColor = '#29A6A7';
                document.getElementById('add_document_to_project').style.color = 'white';
                document.getElementById('add_document_to_project').innerHTML = 'Annuler';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_member_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_association_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                } 
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('add_report_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('add_report_to_project').style.backgroundColor = '#29A6A7';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_member_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_report_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('editProject').addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('editProject').style.backgroundColor = '#29A6A7';

                if (document.getElementById('first_menu_' + project.project_id).style.display === 'block') {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_member_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_member_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_document_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else if (document.getElementById('_menu_add_report_' + project.project_id).style.display === 'block') {
                    document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'block';
                } 
                else {
                    document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                    document.getElementById('_menu_add_association_' + project.project_id).style.display = 'none';
                }
            });
            document.getElementById('archiveProject').addEventListener('click', function (e) {
                e.preventDefault();

                // Afficher une boîte de dialogue Swall pour confirmer l'archivage du projet (ou non)
                Swal.fire({
                    title: 'Êtes-vous sûr de vouloir archiver ce projet ?',
                    text: "Vous ne pourrez pas revenir en arrière !",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#29A6A7',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Oui, archiver !',
                    cancelButtonText: 'Annuler'
                }).then((result) => {
                    if (result.isConfirmed) {
                        archiveProject(project.project_id);
                        window.location.href = 'https://lab.padem.org/projets/';
                    }
                });
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons (Ajouter une association, un membre, un document, un rapport)
            document.getElementById(`add_association_to_project_form_${project.project_id}`).addEventListener('submit', function (e) {
                e.preventDefault();
                addAssociationToProject(project.project_id);
            });
            document.getElementById(`add_member_to_project_form_${project.project_id}`).addEventListener('submit', function (e) {
                e.preventDefault();
                addMemberToProject(project.project_id);
            });
            document.getElementById(`add_document_to_project_form_${project.project_id}`).addEventListener('submit', function (e) {
                e.preventDefault();
                addDocumentToProject(project.project_id);
            });
            document.getElementById(`add_report_to_project_form_${project.project_id}`).addEventListener('submit', function (e) {
                e.preventDefault();
                addReportToProject(project.project_id);
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons
            document.getElementById('add_association_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                addAssociationToProject(project.project_id);
            });
            document.getElementById('add_member_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                addMemberToProject(project.project_id);
            });
            document.getElementById('add_document_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                addDocumentToProject(project.project_id);
            });
            document.getElementById('add_report_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                addReportToProject(project.project_id);
            });
            document.getElementById('editProject').addEventListener('click', function (e) {
                e.preventDefault();
                editProject(project.project_id);
            });
            document.getElementById('archiveProject').addEventListener('click', function (e) {
                e.preventDefault();
                archiveProject(project.project_id);
            });
            //#endregion

            //#region Afficher les documents du projet
            let projectDocuments = document.getElementById('projectDocuments');
            projectDocuments.innerHTML = '';
            fetch(`https://lab.padem.org/wp-json/mo/v1/getProjectDocuments`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(document => {
                        if (document.project_id === projectId) {
                            let li_document = document.createElement('li');
                            li_document.style.border = '1px solid lightgray';
                            li_document.style.borderRadius = '25px';
                            li_document.style.margin = '5px';
                            li_document.style.padding = '5px';
                            li_document.className = 'box-clicable';
                            li_document.id = document.document_id;
                            li_document.addEventListener('click', function () {
                                displayDocument(document.document_id);
                            });
                            projectDocuments.appendChild(li_document);
                            li_document.innerHTML = `
                                <p>${document.document_title}</p>
                                <p>${document.document_date}</p>
                                <p>${document.document_type}</p>
                                <p>${document.document_status}</p>
                            `;
                        }
                    });
                })
                .catch(error => console.error('Erreur récupération des documents:', error));
            //#endregion

            //#region Afficher les membres du projet
            let projectMembers = document.getElementById('projectMembers');
            projectMembers.innerHTML = '';
            project.members.forEach(member => {
                let p = document.createElement('p');
                p.innerHTML = member;
                projectMembers.appendChild(p);
            });
            //#endregion

            //#region Afficher les associations du projet
            let projectAssociations = document.getElementById('display_project_associations' + project.project_id);
            projectAssociations.innerHTML = '';
            project.associations.forEach(association => {
                let p = document.createElement('p');
                p.innerHTML = association;
                projectAssociations.appendChild(p);
            });
            //#endregion

            //#region Afficher les rapports du projet
            let projectReports = document.getElementById('display_project_reports_' + project.project_id);
            projectReports.innerHTML = '';
            fetch(`https://lab.padem.org/wp-json/mo/v1/getProjectReports`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(report => {
                        if (report.project_id === projectId) {
                            let li_report = document.createElement('li');
                            li_report.style.border = '1px solid lightgray';
                            li_report.style.borderRadius = '25px';
                            li_report.style.margin = '5px';
                            li_report.style.padding = '5px';
                            li_report.className = 'box-clicable';
                            li_report.id = report.report_id;
                            li_report.addEventListener('click', function () {
                                displayReport(report.report_id);
                            });
                            projectReports.appendChild(li_report);
                            li_report.innerHTML = `
                                <p>${report.report_title}</p>
                                <p>${report.report_date}</p>
                                <p>${report.report_type}</p>
                                <p>${report.report_status}</p>
                            `;
                        }
                    });
                })
                .catch(error => console.error('Erreur récupération des rapports:', error));
            //#endregion
        }
        //#endregion

        //#region Afficher le rapport correspondant à l'ID
        function displayReport(reportId) {
            let report = reports.find(report => report.report_id === reportId);
            let displayReport = document.getElementById('all_projects_table');
            displayReport.innerHTML = '';
            displayReport.innerHTML = `
                <article class="report">
                    <div style="display: flex; justify-content: space-between;">
                        <button type="button" class="btn btn-primary" id="backToProjects" onclick="getProjects()">Tous les Projets</button>
                        <div style="display: flex; justify-content: flex-end;">
                            <button type="button" class="btn btn-primary" id="previousReport" onclick="displayReport(${report.report_id - 1})"> <img src="https://img.icons8.com/ios/50/000000/previous.png" style="width: 20px; height: 20px;" alt=""> Précédent</button>
                            <button type="button" class="btn btn-primary" id="nextReport" onclick="displayReport(${report.report_id + 1})"> <img src="https://img.icons8.com/ios/50/000000/next.png" style="width: 20px; height: 20px;" alt=""> Suivant</button>
                        </div>
                    </div>
                    <br>
                    
                    <h1>${report.report_title}</h1>
                    <p>${report.report_date}</p>
                    <p>${report.report_type}</p>
                    <p>${report.report_status}</p>
                    <p>${report.report_description}</p>
                    <p>${report.report_referent}</p>
                    <p>${report.report_referent_email}</p>
                    <p>${report.report_manager}</p>
                    <p>${report.report_manager_email}</p>
                    <p>${report.report_project}</p>
                    <p>${report.report_association}</p>
                    <p>${report.report_location}</p>
                    <p>${report.report_status}</p>
                    <p>${report.report_type}</p>
                    <p>${report.report_start_date}</p>
                    <p>${report.report_end_date}</p>
                    <p>${report.report_updated_date}</p>

                    <!-- Afficher la liste des documents du rapport -->
                    <ul id="reportDocuments_${reportId}" style="display: block;">
                    </ul>

                    <!-- Ajouter les autres informations du rapport -->
                    <button type="button" class="btn btn-primary" id="add_document_to_report" onclick="addDocumentToReport(${report.report_id})">Ajouter un Document</button>

                    <!-- Ajouter les actions possibles sur le rapport (membres privilégiés et administrateurs) -->
                    <button type="button" class="btn btn-primary" id="add_assocition_to_report" onclick="addAssociationToReport(${report.report_id})">Ajouter une Association</button>
                    <button type="button" class="btn btn-primary" id="add_member_to_report" onclick="addMemberToReport(${report.report_id})">Ajouter un Membre</button>
                    <button type="button" class="btn btn-primary" id="editReport" onclick="editReport(${report.report_id})">Modifier</button>
                    <button type="button" class="btn btn-danger" id="archiveReport" onclick="archiveReport(${report.report_id})">Archiver</button>
                </article>
            `;

            //#region Ajouter des écouteurs d'événements pour les boutons
            document.getElementById('add_document_to_report').addEventListener('click', function (e) {
                e.preventDefault();
                addDocumentToReport(report.report_id);
            });
            document.getElementById('add_assocition_to_report').addEventListener('click', function (e) {
                e.preventDefault();
                addAssociationToReport(report.report_id);
            });
            document.getElementById('add_member_to_report').addEventListener('click', function (e) {
                e.preventDefault();
                addMemberToReport(report.report_id);
            });
            document.getElementById('editReport').addEventListener('click', function (e) {
                e.preventDefault();
                editReport(report.report_id);
            });
            document.getElementById('archiveReport').addEventListener('click', function (e) {
                e.preventDefault();
                archiveReport(report.report_id);
            });
            //#endregion

            //#region Afficher les documents du rapport
            let reportDocuments = document.getElementById(`reportDocuments_${reportId}`);
            reportDocuments.innerHTML = '';
            fetch(`https://lab.padem.org/wp-json/mo/v1/getReportDocuments`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(document => {
                        if (document.report_id === reportId) {
                            let li_document = document.createElement('li');
                            li_document.style.border = '1px solid lightgray';
                            li_document.style.borderRadius = '25px';
                            li_document.style.margin = '5px';
                            li_document.style.padding = '5px';
                            li_document.className = 'box-clicable';
                            li_document.id = document.document_id;
                            li_document.addEventListener('click', function () {
                                displayDocument(document.document_id);
                            });
                            reportDocuments.appendChild(li_document);
                            li_document.innerHTML = `
                                <p>${document.document_title}</p>
                                <p>${document.document_date}</p>
                                <p>${document.document_type}</p>
                                
                                <button type="button" class="btn btn-primary" id="downloadDocument" onclick="downloadDocument(${document.document_id})"> <img src="https://img.icons8.com/ios/50/000000/download.png" style="width: 20px; height: 20px;" alt=""> Télécharger</button>
                                <button type="button" class="btn btn-primary" id="editDocument" onclick="editDocument(${document.document_id})">Modifier</button>
                                <button type="button" class="btn btn-danger" id="deleteDocument" onclick="deleteDocument(${document.document_id})">Supprimer</button>
                            `;

                            //#region Ajouter des écouteurs d'événements pour les boutons
                            document.getElementById('downloadDocument').addEventListener('click', function (e) {
                                e.preventDefault();
                                downloadDocument(document.document_id);
                            });
                            document.getElementById('editDocument').addEventListener('click', function (e) {
                                e.preventDefault();
                                editDocument(document.document_id);
                            });
                            document.getElementById('deleteDocument').addEventListener('click', function (e) {
                                e.preventDefault();
                                deleteDocument(document.document_id);
                            });
                            //#endregion
                        }
                    });
                })
                .catch(error => console.error('Erreur récupération des documents:', error));
            //#endregion
        }
        //#endregion

        //#region Fonction pour envoyer des mails de notification via le serveur SMTP de Padem
        function sendMailNotification(member, subject, message) {
            const nodemailer = require('nodemailer');

            // Créer un transporteur SMTP réutilisable à l'aide de l'objet transporteur par défaut
            let transporter = nodemailer.createTransport({
                host: 'ssl0.ovh.net',
                port: 465,
                secure: true,
                auth: {
                    user: 'nathan.imogo@padem.org',
                    pass: 'NathIm82!',
                },
                tls: {
                    rejectUnauthorized: false
                },
            });

            // Options de l'e-mail
            let mailOptions = {
                from: '<nathan.imogo@padem.org>',
                to: member,
                subject: subject,
                text: message,
            };

            // Envoyer l'e-mail
            transporter.sendMail(mailOptions, (error, info) => {
                if (error) {
                    console.log('Erreur envoi de l\'e-mail:', error);
                } else {
                    console.log('E-mail envoyé:', info.response);
                }
            });
        }
        //#endregion

        //#region Fonction envoyer des notifications de diverses actions (ajout, modification, suppression, archivage)
        function sendNotification(action, member, project, report, document) {
            let subject = '';
            let message = '';

            switch (action) {
                case 'add':
                    subject = 'Ajout d\'un élément';
                    message = `Bonjour, un élément a été ajouté au projet ${project}.\n\nCordialement,`;
                    break;
                case 'edit':
                    subject = 'Modification d\'un élément';
                    message = `Bonjour, un élément a été modifié dans le projet ${project}.\n\nCordialement,`;
                    break;
                case 'delete':
                    subject = 'Suppression d\'un élément';
                    message = `Bonjour, un élément a été supprimé du projet ${project}.\n\nCordialement,`;
                    break;
                case 'archive':
                    subject = 'Archivage d\'un élément';
                    message = `Bonjour, un élément a été archivé dans le projet ${project}.\n\nCordialement,`;
                    break;
                default:
                    break;
            }

            sendMailNotification(member, subject, message);
        }
        //#endregion
    </script>
</body>
<!--#endregion-->

