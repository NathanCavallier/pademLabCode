<!-- Description: Page d'affichage des projets -->
<div style="display: flex; justify-content: space-between; margin: 10px;">
    <button type="button" class="box-clicable" id="createProject"
        style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px;">
        <!-- icone plus -->
        <img src="https://img.icons8.com/ios/50/000000/plus-math.png"
            style="width: 20px; height: 20px; margin-right: 5px;" alt="">
        Nouveau Projet
    </button>

    <div style="display: flex; justify-content: flex-end; margin: 10px;">
        <!-- Bouton afficher tous les projets -->
        <button type="button" class="box-clicable" id="allProjects"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px;">
            <!-- icone plus -->
            <img src="https://img.icons8.com/ios/50/000000/plus-math.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Tous les Projets
        </button>

        <!-- Bouton Mes projets -->
        <button type="button" class="box-clicable" id="myProjects"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px;">
            <!-- icone profil -->
            <img src="https://img.icons8.com/ios/50/000000/user.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Mes projets
        </button>

        <!-- Bouton Archives -->
        <button type="button" class="box-clicable" id="archives_projects"
            style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px;">
            <!-- icone archive -->
            <img src="https://img.icons8.com/ios/50/000000/archive-folder.png"
                style="width: 20px; height: 20px; margin-right: 5px;" alt="">
            Archives
        </button>
    </div>
</div>


<!-- Barre  de recherche -->
<div class="container">
    <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Rechercher un projet" aria-label="Rechercher un projet"
            aria-describedby="button-addon2" id="search_projects">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" id="button-addon2">Rechercher</button>
        </div>
    </div>
</div>


<body>
    
    <!--#region Formulaire de création de projet -->
    <div class="container" id="new_project_form">
        <form id="formProject">
            <div class="form-group">
                <label for="projectName">Nom du Projet</label>
                <input type="text" class="form-control" id="projectName" name="projectName" required>
            </div>
            <div class="form-group">
                <label for="projectDescription">Description du Projet</label>
                <textarea class="form-control" id="projectDescription" name="projectDescription" rows="3"
                    required></textarea>
            </div>
            <div class="form-group">
                <label for="projectDeadline">Date de fin du Projet</label>
                <input type="date" class="form-control" id="projectDeadline" name="projectDeadline" required>
            </div>
            <div class="form-group">
                <label for="projectStatus">Statut du Projet</label>
                <select class="form-control" id="projectStatus" name="projectStatus" required>
                    <option value="En cours">En cours</option>
                    <option value="En attente">En attente</option>
                    <option value="Terminé">Terminé</option>
                </select>
            </div>
            <div class="form-group">
                <label for="projectManager">Chef de Projet</label>
                <select class="form-control" id="projectManager" name="projectManager" required>
                    <option value="0">Sélectionner un Chef de Projet</option>
                </select>
            </div>
            <div class="form-group">
                <label for="projectMembers">Membres du Projet</label>
                <select class="form-control" id="projectMembers" name="projectMembers" multiple required>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Créer</button>
        </form>
    </div>
    <!--#endregion -->


    <!--#region Tableau des projets -->
    <div class="container" id="all_projects_table">
        <table class="table table-striped">
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="project_tite">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="country_name">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="association_name">Association <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="theme_name">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="status_name">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="display_projects">
            </tbody>
        </table>
    </div>
    <!--#endregion -->

    <!-- Mes projets -->
    <div class="container" id="my_projects_table">
        <table class="table table-striped">
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="project_tite">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="country_name">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="association_name">Association <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="theme_name">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="status_name">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="display_my_projects">
            </tbody>
        </table>
    </div>
    <!--#endregion -->

    <!-- Archives -->
    <div class="container" id="archives_projects_table">
        <table class="table table-striped">
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="project_tite">Titre <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="country_name">Pays <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="association_name">Association <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="theme_name">Thématique <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col" id="status_name">Statut <img src="https://img.icons8.com/ios/50/000000/sort.png"
                            style="width: 15px; height: 15px;" alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="display_archives_projects">
            </tbody>
        </table>
    </div>
    <!--#endregion -->


    <script>
        //#region Initialisation des variables
        let projects = [];
        let users = [];
        let projectManagers = [];
        let projectMembers = [];

        // Récupérer les données de l'utilisateur connecté
        var userEmail = current_user_data.email;
        var userRole = current_user_data.roles;
        var userId = current_user_data.ID;

        // Variables des filtres
        let status_list = ['En cours', 'En attente', 'Terminé'];
        let country_list = [];
        let association_list = [];
        let theme_list = [];

        // Model de projet
        var project_model = {
            id: 0,
            project_id: 0,
            project_title: "",
            project_type: "",
            start_date: "",
            end_date: "",
            updated_date: "",
            project_location: "",
            project_status: "",
            padem_responsible: "",
            padem_responsible_email: "",
            project_referent: "",
            project_referent_email: "",
            project_description: JSON.stringify(""),
            background_image_link: "",
            folders: "",
        };
        //#endregion

        // Chargement de la page
        document.addEventListener('DOMContentLoaded', function (e) {
            e.preventDefault();

            // Afficher le tableau des projets
            document.getElementById('all_projects_table').style.display = 'block';
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';

            //#region Vérifier si l'utilisateur connecté est un administrateur, un membre privilégié ou un abonné(subscriber)
            if (userRole.includes('administrator')) {
                // Afficher le bouton Créer un Projet
                document.getElementById('createProject').style.display = 'block';
                // Afficher le bouton Mes projets
                document.getElementById('myProjects').style.display = 'block';
                // Afficher le bouton Archives
                document.getElementById('archives_projects').style.display = 'block';
            }
            else if (userRole.includes('um_member')) {
                // Afficher le bouton Créer un Projet
                document.getElementById('createProject').style.display = 'none';
                // Afficher le bouton Mes projets
                document.getElementById('myProjects').style.display = 'block';
                // Afficher le bouton Archives
                document.getElementById('archives_projects').style.display = 'block';
            }
            else if (userRole.includes('subscriber')) {
                // Afficher le bouton Créer un Projet
                document.getElementById('createProject').style.display = 'none';
                // Afficher le bouton Mes projets
                document.getElementById('myProjects').style.display = 'block';
                document.getElementById('myProjects').disabled = true;
                // Afficher le bouton Archives
                document.getElementById('archives_projects').style.display = 'block';
                document.getElementById('archives_projects').disabled = true;
            }
            //#endregion

            // Récupération des utilisateurs
            getUsers();
            // Récupération des projets
            getProjects();
        });

        //#region ajouter écouteur d'événement pour le bouton Créer un Projet
        document.getElementById('createProject').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Créer, et la couleur du texte
            document.getElementById('createProject').style.backgroundColor = '#29A6A7';
            document.getElementById('createProject').style.color = 'white';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.backgroundColor = 'white';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.backgroundColor = 'white';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion


            // Afficher le formulaire de création de projet
            document.getElementById('display_projects').style.display = 'none';
            document.getElementById('formProject').style.display = 'block';

        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Mes projets
        document.getElementById('myProjects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.backgroundColor = '#29A6A7';
            document.getElementById('myProjects').style.color = 'white';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.backgroundColor = 'white';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.backgroundColor = 'white';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher les projets de l'utilisateur connecté
            displayMyProjects();
        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Archives
        document.getElementById('archives_projects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.backgroundColor = '#29A6A7';
            document.getElementById('archives_projects').style.color = 'white';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.backgroundColor = 'white';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.backgroundColor = 'white';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            // Afficher les archives des projets
            displayArchivesProjects();
        });
        //#endregion

        //#region Récupération des utilisateurs
        function getUsers() {
            fetch('https://api.ynov.jcatania.io/user')
                .then(response => response.json())
                .then(data => {
                    users = data;
                    projectManagers = users.filter(user => user.roles.includes('project_manager'));
                    projectMembers = users.filter(user => user.roles.includes('project_member'));
                    displayProjectManagers(projectManagers);
                    displayProjectMembers(projectMembers);
                })
                .catch(error => console.error('Erreur récupération des utilisateurs:', error));
        }
        //#endregion

        //#region Récupération des projets
        function getProjects() {
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    projects = data;
                    displayProjects(projects);
                })
                .catch(error => console.error('Erreur récupération des projets:', error));
        }
        //#endregion



        //#region Affichage des projets (Chaque projet est une ligne du tableau avec des bordures et des angles arrondis)
        function displayProjects(projects) {
            let displayProjects = document.getElementById('display_projects');
            displayProjects.innerHTML = '';
            projects.forEach(project => {
                let tr = document.createElement('tr');
                tr.style.border = '1px solid lightgray';
                tr.style.borderRadius = '15px';
                tr.style.margin = '5px';
                tr.innerHTML = `
                    <td style="color: blue;">${project.name}</td>
                    <td>${project.country}</td>
                    <td>${project.association}</td>
                    <td>${project.theme}</td>
                    <td style="color: ${project.status === 'En cours' ? 'green' : project.status === 'Terminé' ? 'red' : 'gray'};">${project.status}</td>
                    <td>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalProject" id="editProject" onclick="editProject(${project.id})">Modifier</button>
                        <button type="button" class="btn btn-danger" id="deleteProject" onclick="deleteProject(${project.id})">Supprimer</button>
                    </td>
                `;
                displayProjects.appendChild(tr);
            });
        }

        // Barre de recherche

        // Création d'un projet

        // Mes projets
        function displayMyProjects(projects) {
            let myProjects = projects.filter(project => project.manager === userId || project.members.includes(userId));
            displayProjects(myProjects);
        }

        // Archives


    </script>
</body>