<body>
    <!--#region Formulaire de création de projet -->
    <div class="container" id="new_project_form" style="display: none;" class="main-group-scroll">
        <form id="projectForm" class="card"
            style="border-radius: 15px; background-color: white; margin: 5px; padding: 5px;" method="post"
            enctype="multipart/form-data">
            <div class="card-body" style="border-radius: 15px; padding: 10px; background: none; margin: 10px;">
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectTitle" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=h88n73Ss5iTI&format=png&color=9F9F9F"
                                alt="Projet" style="width: 20px; height: 20px;">
                            Titre du projet: <span style="color: red;">*</span></label>
                        <input type="text" id="projectTitle" name="projectTitle" class="form-control"
                            style="border-radius: 20px;" required>
                    </div>
                    <div class="col-md-6">
                        <label for="projectType" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=364&format=png&color=9F9F9F"
                                alt="Type de projet" style="width: 20px; height: 20px;">
                            Type de projet: <span style="color: red;">*</span></label>
                        <input type="text" id="projectType" name="projectType" class="form-control"
                            style="border-radius: 20px;" required>
                    </div>
                </div>
                <div style="height: 10px;"></div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectDate" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=1072&format=png&color=9F9F9F"
                                alt="Date de début" style="width: 20px; height: 20px;">
                            Date de début prévisionnelle: <span style="color: red;">*</span></label>
                        <input type="date" id="projectDate" name="projectDate" class="form-control"
                            style="border-radius: 20px;" required>
                    </div>
                    <div class="col-md-6">
                        <label for="projectEndDate2" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=1070&format=png&color=9F9F9F"
                                alt="Date de fin" style="width: 20px; height: 20px;">
                            Date de fin prévisionnelle: <span style="color: red;">*</span></label>
                        <input type="date" id="projectEndDate2" name="projectEndDate2" class="form-control"
                            style="border-radius: 20px;" required>
                    </div>
                </div>
                <div style="height: 10px;"></div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectReferent" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=11164&format=png&color=9F9F9F" alt="Référent"
                                style="width: 20px; height: 20px;">
                            Référent du projet: <span style="color: red;">*</span></label>
                        <input type="text" id="projectReferent" name="projectReferent" class="form-control"
                            style="border-radius: 20px;" required>
                    </div>
                    <div class="col-md-6">
                        <label for="projectReferentEmail" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=77&format=png&color=9F9F9F" alt="Email"
                                style="width: 20px; height: 20px;">
                            Email du référent du projet: <span style="color: red;">*</span></label>
                        <input type="email" id="projectReferentEmail" name="projectReferentEmail" class="form-control"
                            style="border-radius: 20px;" required>
                    </div>
                </div>
                <div style="height: 10px;"></div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectLocation" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=60425&format=png&color=9F9F9F" alt="Pays"
                                style="width: 20px; height: 20px;">
                            Pays de réalisation du projet: <span style="color: red;">*</span></label>
                        <input type="text" id="projectLocation" name="projectLocation" class="form-control"
                            style="border-radius: 20px;" required>
                    </div>
                    <div class="col-md-6">
                        <label for="projectDescription" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=77&format=png&color=9F9F9F" alt="Description"
                                style="width: 20px; height: 20px;">
                            Description du projet: <span style="color: red;">*</span></label>
                        <textarea id="projectDescription" name="projectDescription" rows="4" cols="50"
                            class="form-control" style="border-radius: 20px;"></textarea>
                    </div>
                </div>
                <div style="height: 10px;"></div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="projectStatus" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=59145&format=png&color=9F9F9F" alt="Statut"
                                style="width: 20px; height: 20px;">
                            Statut du projet: <span style="color: red;">*</span></label>
                        <select id="projectStatus" name="projectStatus" class="form-control"
                            style="border-radius: 20px;" required>
                            <option value="En cours">En cours</option>
                            <option value="Terminé">Terminé</option>
                            <option value="En attente">En attente</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="projectAssociation" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=779&format=png&color=9F9F9F" alt="Association"
                                style="width: 20px; height: 20px;">
                            Association partenaire: <span style="color: red;">*</span></label>
                        <input type="text" id="projectAssociation" name="projectAssociation" class="form-control"
                            style="border-radius: 20px;" required>
                    </div>
                </div>
                <div style="height: 10px;"></div>
                <div class="col-md-12" id="add_trames_to_this_project">
                    <div class="row">
                        <label for="upload_trames_1" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=iBeRV9QTCIH8&format=png&color=9F9F9F"
                                alt="Trames" style="width: 20px; height: 20px;">
                            Ajouter des trames à ce projet (1): </label>
                        <input type="file" id="upload_trames_1" name="upload_trames_1" class="form-control-file"
                            style="border-radius: 20px;">
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="row">
                        <label for="upload_trames_2" style="color: gray;">
                            <img src="https://img.icons8.com/?size=100&id=iBeRV9QTCIH8&format=png&color=9F9F9F"
                                alt="Trames" style="width: 20px; height: 20px;">
                            Ajouter des trames à ce projet (2): </label>
                        <input type="file" id="upload_trames_2" name="upload_trames_2" class="form-control-file"
                            style="border-radius: 20px;">
                    </div>
                </div>
            </div>
            <div style="height: 10px;"></div>
            <div class="col-md-12">
                <div class="action-buttons" style="display: flex; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" style="width: fit-content;"
                        id="cancel_project_form">
                        Annuler
                        <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="cancel"
                            style="width: 35px; height: 35px;">
                    </button>
                    <button type="button" onclick="saveFormData()" class="btn btn-primary"
                        style="color: white; width: fit-content;" id="save_project_form">
                        Enregistrer
                        <img src="https://lab.padem.org/wp-content/uploads/save_black.png" alt="save"
                            style="width: 35px; height: 35px;">
                    </button>
                </div>
            </div>
        </form>
    </div>
    <!--#endregion -->

    <div id="all_projects_details_container" style="display: block;">
        <!--#region Tableau des projets -->
        <div id="all_projects_table" class="main-group-scroll">
            <table>
                <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                    <tr>
                        <th scope="col" id="project_tite" style="cursor: pointer;">Titre <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="country_name" style="cursor: pointer;">Pays <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="association_name" style="cursor: pointer;">Association <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="theme_name" style="cursor: pointer;">Thématique <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                        <th scope="col" id="status_name" style="cursor: pointer;">Statut <img
                                src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                alt=""></th>
                    </tr>
                </thead>
                <tbody id="display_projects" class="main-group-scroll" style="height: 500px;">
                </tbody>
            </table>
        </div>
        <!--#endregion -->

        <!--#region Afficher les détails du projet sélectionné -->
        <div class="container" id="project_details" style="display: none;" class="main-group-scroll">
        </div>
        <!--#endregion -->
    </div>

    <!--#region Mes projets -->
    <div class="container" id="my_projects_table" style="display: none;" class="main-group-scroll">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="my_project_tite" style="cursor: pointer;">Titre <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="my_country_name" style="cursor: pointer;">Pays <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="my_association_name" style="cursor: pointer;">Association <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="my_theme_name" style="cursor: pointer;">Thématique <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="my_status_name" style="cursor: pointer;">Statut <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="display_my_projects">
            </tbody>
        </table>
    </div>
    <!--#endregion -->

    <!--#region Archives -->
    <div class="container" id="archives_projects_table" style="display: none;" class="main-group-scroll">
        <table>
            <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                <tr>
                    <th scope="col" id="archives_project_tite" style="cursor: pointer;">Titre <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="archives_country_name" style="cursor: pointer;">Pays <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="archives_association_name" style="cursor: pointer;">Association <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="archives_theme_name" style="cursor: pointer;">Thématique <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col" id="archives_status_name" style="cursor: pointer;">Statut <img
                            src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                            alt=""></th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="display_archives_projects">
            </tbody>
        </table>
    </div>
    <!--#endregion -->

    <script>
        //#region Initialisation des variables
        var projects = [];
        var users = [];
        var projectManagers = [];
        var projectMembers = [];

        // Récupérer les données de l'utilisateur connecté
        var userEmail = current_user_data.email;
        var userRole = current_user_data.roles;
        var userId = current_user_data.ID;

        // Variables des filtres
        var status_list = ['En cours', 'En attente', 'Terminé'];
        var country_list = [];
        var association_list = [];
        var theme_list = [];

        //#region Model de projet
        var project_model = {
            id: 0,
            project_id: 0,
            project_title: "",
            project_type: "",
            start_date: "",
            end_date: "",
            updated_date: "",
            project_location: "",
            project_status: "",
            padem_responsible: "",
            padem_responsible_email: "",
            project_referent: "",
            project_referent_email: "",
            project_description: JSON.stringify(""),
            background_image_link: "",
            folders: "",
        };
        //#endregion

        //#endregion

        // Chargement de la page
        document.addEventListener('DOMContentLoaded', function (e) {
            e.preventDefault();

            // Récupérer l'adresse mail de l'utilisateur connecté
            let userMail = current_user_data.email;
            let userRole = current_user_data.roles;

            if (userRole.includes('administrator') || userRole.includes('partenaire')) { // Vérifier si l'utilisateur connecté est un administrateur ou un partenaire
                // Afficher le tableau des projets
                document.getElementById('all_projects_table').style.display = 'block';
                document.getElementById('my_projects_table').style.display = 'none';
                document.getElementById('archives_projects_table').style.display = 'none';
                document.getElementById('new_project_form').style.display = 'none';
                document.getElementById('allProjects').style.color = '#29A6A7';
                document.getElementById('onglet_projects_buttons').style.display = 'flex'; // Afficher les boutons

                //#region Vérifier si l'utilisateur connecté est un administrateur, un membre privilégié ou un abonné(subscriber)
                if (userRole.includes('administrator')) {
                    // Afficher tout les boutons
                    document.getElementById('onglet_projects_buttons').style.justifyContent = 'space-between';
                    // Afficher le bouton Créer un Projet
                    document.getElementById('createProject').style.display = 'block';
                    // Afficher le bouton Mes projets
                    document.getElementById('myProjects').style.display = 'block';
                    // Afficher le bouton Archives
                    document.getElementById('archives_projects').style.display = 'block';
                }
                else {
                    // Afficher tout les boutons autorisés à droite
                    document.getElementById('onglet_projects_buttons').style.justifyContent = 'flex-end';
                    // Afficher le bouton Créer un Projet
                    document.getElementById('createProject').style.display = 'none';
                    // Afficher le bouton Mes projets
                    document.getElementById('myProjects').style.display = 'block';
                    // Afficher le bouton Archives
                    document.getElementById('archives_projects').style.display = 'block';
                }
                //#endregion
                // Récupérer les projets
                getProjects('title');

            } else {
                // Afficher le tableau des projets
                document.getElementById('all_projects_table').style.display = 'block';
                document.getElementById('my_projects_table').style.display = 'none';
                document.getElementById('archives_projects_table').style.display = 'none';
                document.getElementById('new_project_form').style.display = 'none';

                // Masquer les boutons
                document.getElementById('createProject').style.display = 'none';
                document.getElementById('myProjects').style.display = 'none';
                document.getElementById('archives_projects').style.display = 'none';
                document.getElementById('allProjects').style.display = 'none';

                // Afficher un message d'erreur
                document.getElementById('all_projects_table').innerHTML = '<p style="color: gray; text-align: center;">Vous n\'avez pas les droits nécessaires pour accéder à cette page.</p>';
            }
        });

        //#region écouteur d'événement pour les filtres
        document.getElementById('project_tite').addEventListener('click', function (e) {
            e.preventDefault();

            // Afficher un menu déroulant pour les filtres

        });

        document.getElementById('country_name').addEventListener('click', function (e) {
            e.preventDefault();


        });

        document.getElementById('association_name').addEventListener('click', function (e) {
            e.preventDefault();
            projects.sort((a, b) => a.association.localeCompare(b.association));
            displayProjects(projects);
        });

        document.getElementById('theme_name').addEventListener('click', function (e) {
            e.preventDefault();
            projects.sort((a, b) => a.theme.localeCompare(b.theme));
            displayProjects(projects);
        });

        document.getElementById('status_name').addEventListener('click', function (e) {
            e.preventDefault();
            projects.sort((a, b) => a.status.localeCompare(b.status));
            displayProjects(projects);
        });
        //#endregion

        //#region ajouter écouteur d'événement pour le bouton Tous les Projets
        document.getElementById('allProjects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = '#29A6A7';
            document.getElementById('allProjects').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.border = 'gray';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = 'gray';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = 'gray';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher le tableau des projets
            document.getElementById('all_projects_details_container').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';
        });
        //#endregion

        //#region ajouter écouteur d'événement pour le bouton Créer un Projet
        document.getElementById('createProject').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = 'gray';
            document.getElementById('allProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer, et la couleur du texte
            document.getElementById('createProject').style.border = '#29A6A7';
            document.getElementById('createProject').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = 'gray';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = 'gray';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher le formulaire de création de projet
            document.getElementById('new_project_form').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('all_projects_details_container').style.display = 'none';
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Mes projets
        document.getElementById('myProjects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = 'gray';
            document.getElementById('allProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = '#29A6A7';
            document.getElementById('myProjects').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.border = 'gray';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = 'gray';
            document.getElementById('archives_projects').style.color = 'gray';
            //#endregion

            // Afficher les projets de l'utilisateur connecté
            document.getElementById('my_projects_table').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('all_projects_details_container').style.display = 'none';
            document.getElementById('archives_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';
        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Archives
        document.getElementById('archives_projects').addEventListener('click', function (e) {
            e.preventDefault();

            //#region changer ma couleur de fond du bouton Tous les Projets, et la couleur du texte
            document.getElementById('allProjects').style.border = 'gray';
            document.getElementById('allProjects').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Archives, et la couleur du texte
            document.getElementById('archives_projects').style.border = '#29A6A7';
            document.getElementById('archives_projects').style.color = '#29A6A7';
            //#endregion

            //#region changer ma couleur de fond du bouton Créer un Projet, et la couleur du texte
            document.getElementById('createProject').style.border = 'gray';
            document.getElementById('createProject').style.color = 'gray';
            //#endregion

            //#region changer ma couleur de fond du bouton Mes projets, et la couleur du texte
            document.getElementById('myProjects').style.border = 'gray';
            document.getElementById('myProjects').style.color = 'gray';
            //#endregion

            // Afficher les archives des projets
            document.getElementById('archives_projects_table').style.display = 'block';
            // Masquer tout les autres éléments
            document.getElementById('all_projects_details_container').style.display = 'none';
            document.getElementById('my_projects_table').style.display = 'none';
            document.getElementById('new_project_form').style.display = 'none';
        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Annuler
        document.getElementById('cancel_project_form').addEventListener('click', function (e) {
            e.preventDefault();

            // Vider les champs du formulaire
            document.getElementById('projectTitle').value = '';
            document.getElementById('projectType').value = '';
            document.getElementById('projectDate').value = '';
            document.getElementById('projectEndDate2').value = '';
            document.getElementById('projectReferent').value = '';
            document.getElementById('projectReferentEmail').value = '';
            document.getElementById('projectLocation').value = '';
            document.getElementById('projectDescription').value = '';
            document.getElementById('projectStatus').value = '';
            document.getElementById('projectAssociation').value = '';
            document.getElementById('upload_trames_1').value = '';
            document.getElementById('upload_trames_2').value = '';
        });
        //#endregion

        //#region Ajouter écouteur d'événement pour le bouton Enregistrer (créer un projet)
        document.getElementById('save_project_form').addEventListener('click', function (e) {
            e.preventDefault();

            // Récupérer les données du formulaire
            var projectTitle = document.getElementById('projectTitle').value;
            var projectType = document.getElementById('projectType').value;
            var projectDate = document.getElementById('projectDate').value;
            var projectEndDate2 = document.getElementById('projectEndDate2').value;
            var projectReferent = document.getElementById('projectReferent').value;
            var projectReferentEmail = document.getElementById('projectReferentEmail').value;
            var projectLocation = document.getElementById('projectLocation').value;
            var projectDescription = document.getElementById('projectDescription').value;
            var projectStatus = document.getElementById('projectStatus').value;
            var projectAssociation = document.getElementById('projectAssociation').value;
            var upload_trames_1 = document.getElementById('upload_trames_1').files[0];
            var upload_trames_2 = document.getElementById('upload_trames_2').files[0];

            // Vérifier si les champs obligatoires sont remplis
            if (projectTitle === '' || projectType === '' || projectDate === '' || projectEndDate2 === '' || projectReferent === '' || projectReferentEmail === '' || projectLocation === '' || projectDescription === '' || projectStatus === '' || projectAssociation === '') {
                alert('Veuillez remplir tous les champs obligatoires.');
                return;
            }

            // Afficher l'animation de chargement
            document.getElementById('loading').style.display = 'block';

            // Récupérer les projets
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    // Récupérer l'id du projet ayant la plus grande valeur
                    var project_id = data.length > 0 ? projects[projects.length - 1].id + 1 : 1;

                    // Créer un objet FormData
                    if (upload_trames_1) {
                        var formData = new FormData();
                        formData.append('upload_trames_1', upload_trames_1);
                        formData.append('action', 'handle_file_upload');

                        // Envoyer le fichier au serveur
                        fetch(ajaxurl, {
                            method: 'POST',
                            body: formData
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success:', data);
                                // Récupérer le lien du fichier
                                //#region Envoi des données du fichier à la base de données
                                fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFile', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        project_id: project_id,
                                        file_name: ((data.data.url).split('/')).pop(), // Nom du fichier
                                        file_type: upload_trames_1.type, // Type du fichier
                                        file_link: data.data.url, // Lien du fichier
                                        file_size: upload_trames_1.size, // Taille du fichier
                                        author_email: userEmail,
                                        folder_name: '', // Dossier de destination
                                        is_folder: false,
                                        is_in_folder: false,
                                        folder_link: '',
                                        is_trame: true,
                                        created_at: new Date(Date.now()) // Date de création
                                    }),
                                })
                                    .then((response) => response.json())
                                    .then((data) => {
                                        // Recharger les fichiers
                                        displayFiles();
                                        displayProjectDocuments();
                                    })
                                    .catch((error) => {
                                        console.error('Error:', error);
                                        // Masquer l'avancement du chargement
                                        document.getElementById('loading').style.display = 'none';
                                    });
                                //#endregion
                            })
                            .catch((error) => {
                                console.error('Error:', error);
                            });
                    }
                    if (upload_trames_2) {
                        var formData = new FormData();
                        formData.append('upload_trames_2', upload_trames_2);
                        formData.append('action', 'handle_file_upload');

                        // Envoyer le fichier au serveur
                        fetch(ajaxurl, {
                            method: 'POST',
                            body: formData
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success:', data);
                                // Récupérer le lien du fichier
                                var fileLink = data.data.url;
                                //#region Envoi des données du fichier à la base de données
                                fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFile', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        project_id: project_id,
                                        file_name: ((data.data.url).split('/')).pop(), // Nom du fichier
                                        file_type: upload_trames_2.type, // Type du fichier
                                        file_link: data.data.url, // Lien du fichier
                                        file_size: upload_trames_2.size, // Taille du fichier
                                        author_email: userEmail,
                                        folder_name: '', // Dossier de destination
                                        is_folder: false,
                                        is_in_folder: false,
                                        folder_link: '',
                                        is_trame: true,
                                        created_at: new Date(Date.now()) // Date de création
                                    }),
                                })
                                    .then((response) => response.json())
                                    .then((data) => {
                                        // Recharger les fichiers
                                        displayFiles();
                                        displayProjectDocuments();
                                    })
                                    .catch((error) => {
                                        console.error('Error:', error);
                                        // Masquer l'avancement du chargement
                                        document.getElementById('loading').style.display = 'none';
                                    });
                                //#endregion
                            })
                            .catch((error) => {
                                console.error('Error:', error);
                            });
                    }

                    // Envoyer les données du formulaire à la base de données
                    fetch('https://lab.padem.org/wp-json/mo/v1/createProjectData', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            project_id: project_id,
                            project_title: projectTitle,
                            project_type: projectType,
                            start_date: projectDate,
                            end_date: projectEndDate2,
                            project_referent: projectReferent,
                            project_referent_email: projectReferentEmail,
                            project_location: projectLocation,
                            project_description: projectDescription,
                            project_status: projectStatus,
                            association: projectAssociation,
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            // Masquer l'animation de chargement
                            document.getElementById('loading').style.display = 'none';
                            // Masquer le formulaire
                            document.getElementById('new_project_form').style.display = 'none';
                            // Afficher le tableau des projets
                            document.getElementById('all_projects_details_container').style.display = 'block';

                            //#region Vider les champs du formulaire
                            document.getElementById('projectTitle').value = '';
                            document.getElementById('projectType').value = '';
                            document.getElementById('projectDate').value = '';
                            document.getElementById('projectEndDate2').value = '';
                            document.getElementById('projectReferent').value = '';
                            document.getElementById('projectReferentEmail').value = '';
                            document.getElementById('projectLocation').value = '';
                            document.getElementById('projectDescription').value = '';
                            document.getElementById('projectStatus').value = '';
                            document.getElementById('projectAssociation').value = '';
                            document.getElementById('upload_trames_1').value = '';
                            document.getElementById('upload_trames_2').value = '';
                            //#endregion

                            // Afficher un message de succès
                            alert('Projet créé avec succès.');
                            // Récupérer les projets
                            getProjects('title');
                        })
                        .catch(error => {
                            console.error('Erreur création du projet:', error);
                            // Masquer l'animation de chargement
                            document.getElementById('loading').style.display = 'none';
                            // Afficher un message d'erreur
                        });
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Masquer l'avancement du chargement
                    document.getElementById('loading').style.display = 'none';
                });
        });
        //#region Récupération des utilisateurs
        function getUsers() {
            fetch('https://api.ynov.jcatania.io/user')
                .then(response => response.json())
                .then(data => {
                    users = data;
                    projectManagers = users.filter(user => user.roles.includes('project_manager'));
                    projectMembers = users.filter(user => user.roles.includes('project_member'));
                })
                .catch(error => console.error('Erreur récupération des utilisateurs:', error));
        }
        //#endregion

        //#region Récupération des projets
        function getProjects(filter) {
            // Afficher l'animation de chargement
            document.getElementById('loading').style.display = 'block';
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    projects = data;
                    displayProjects(projects, filter);
                    // Masquer l'animation de chargement
                    document.getElementById('loading').style.display = 'none';
                })
                .catch(error => {
                    console.error('Erreur récupération des projets:', error)
                    // Masquer l'animation de chargement
                    document.getElementById('loading').style.display = 'none';
                });
        }
        //#endregion

        //#region Affichage des projets (Chaque projet est une ligne du tableau avec des bordures et des angles arrondis)
        function displayProjects(projects, sortBy) {
            // Appliquer le tri en fonction de l'argument 'sortBy'
            if (sortBy === 'title') {
                projects = sortByTitle(projects);
            } else if (sortBy === 'country') {
                projects = sortByCountry(projects);
            } else if (sortBy === 'association') {
                projects = sortByAssociation(projects);
            } else if (sortBy === 'thematic') {
                projects = sortByThematic(projects);
            } else if (sortBy === 'status') {
                projects = sortByStatus(projects);
            }

            var displayProjects = document.getElementById('display_projects');
            var displayArchivesProjects = document.getElementById('display_archives_projects');
            displayArchivesProjects.innerHTML = '';
            displayProjects.innerHTML = '';

            // Tableau des status du projet
            var status_list = {
                'En cours': 'lightgreen',
                'Terminé': 'lightcoral',
                'En attente': 'lightgray',
                'Archivé': 'lightgray'
            }

            // Get Working Table
            fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then((response) => response.json())
                .then((data) => {
                    let workingTable = data;
                    let project_list = [];

                    projects.forEach(project => {
                        if (project.project_status !== 'Archivé' || project.is_archive !== '1') {
                            let tr = document.createElement('tr');
                            tr.style.border = '1px solid lightgray';
                            tr.style.borderRadius = '25px';
                            tr.style.backgroundColor = 'white';
                            tr.style.cursor = 'pointer';
                            tr.style.margin = '5px';
                            tr.style.padding = '8px';
                            tr.style.paddingRight = '10px';
                            tr.style.marginBottom = '0px';
                            tr.id = project.project_id;
                            tr.addEventListener('click', function () { // Afficher les détails du projet
                                document.getElementById('all_projects_table').style.display = 'none';
                                document.getElementById('project_details').style.display = 'block';
                                displayProject(project.project_id);
                            });
                            tr.addEventListener('mouseover', function () {
                                tr.style.border = '1px solid #6CE8E8';
                            });
                            tr.addEventListener('mouseout', function () {
                                tr.style.border = '1px solid lightgray';
                            });
                            tr.innerHTML = `
                            <th style="color: #29A6A7; margin-left: 5px; margin-top: 15px;">${project.project_title ? project.project_title : '---'}</th>
                            <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start; margin-top: 10px;">${project.project_location ? project.project_location : '---'}</th>
                            <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start; margin-top: 10px;">${project.association ? project.association : '---'}</th>
                            <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start; margin-top: 10px;">${project.project_type ? project.project_type : '---'}</th>
                            <th style="background-color: ${project.project_state === 'En cours' ? 'lightgreen' : project.project_state === 'Terminé' ? 'lightcoral' : 'lightgray'}; border-radius: 10px; margin: 5px; padding: 5px; width: fit-content; margin-top: 15px;">
                                <p style="color: ${project.project_state === 'En cours' ? 'green' : project.project_state === 'Terminé' ? 'red' : 'gray'}; margin-bottom: -2px;">${project.project_state ? project.project_state : '---'}</p>
                            </th>
                        `;
                            displayProjects.appendChild(tr);
                        } else {
                            let tr = document.createElement('tr');
                            tr.style.border = '1px solid lightgray';
                            tr.style.borderRadius = '25px';
                            tr.style.backgroundColor = 'white';
                            tr.style.margin = '6px';
                            tr.style.padding = '15px';
                            tr.style.cursor = 'pointer';
                            tr.id = project.project_id;
                            tr.addEventListener('click', function () { // Afficher les détails du projet
                                document.getElementById('all_projects_table').style.display = 'none';
                                document.getElementById('project_details').style.display = 'block';
                                displayProject(project.project_id);
                            });
                            tr.addEventListener('mouseover', function () {
                                tr.style.border = '1px solid #6CE8E8';
                            });
                            tr.addEventListener('mouseout', function () {
                                tr.style.border = '1px solid lightgray';
                            });
                            tr.innerHTML = `
                            <th style="color: #29A6A7; margin-left: 5px; margin-top: 15px;">${project.project_title ? project.project_title : '---'}</th>
                            <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start; margin-top: 10px;">${project.project_location ? project.project_location : '---'}</th>
                            <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start; margin-top: 10px;">${project.association ? project.association : '---'}</th>
                            <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start; margin-top: 10px;">${project.project_type ? project.project_type : '---'}</th>
                            <th style="background-color: ${project.project_status === 'En cours' ? 'lightgreen' : project.project_status === 'Terminé' ? 'lightcoral' : 'lightgray'}; border-radius: 10px; margin: 5px; padding: 5px; width: fit-content; margin-top: 15px;">
                                <p style="color: ${project.project_status === 'En cours' ? 'green' : project.project_status === 'Terminé' ? 'red' : 'gray'}; margin-bottom: -2px;">${project.project_status ? project.project_status : '---'}</p>
                            </th>
                        `;
                            displayArchivesProjects.appendChild(tr);
                        }
                    });
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
        //#endregion

        // Mes projets
        function getUserProjects() {
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData')
                .then(response => response.json())
                .then(data => {
                    projects = data;
                    displayMyProjects();
                })
                .catch(error => console.error('Erreur récupération des projets:', error));
        }
        function displayMyProjects() {
            let myProjects = projects.filter(project => project.manager === userId || project.members.includes(userId));
            displayProjects(myProjects);
        }

        //#region Archives
        function displayArchivesProjects() {
            var displayProjects = document.getElementById('archives_projects_table');
            displayProjects.innerHTML = '';
            projects.forEach(project => {
                if (project.project_status === 'Archivé') {
                    let tr = document.createElement('tr');
                    tr.style.border = '1px solid lightgray';
                    tr.style.borderRadius = '25px';
                    tr.style.backgroundColor = 'white';
                    tr.style.margin = '6px';
                    tr.style.padding = '15px';
                    tr.style.cursor = 'pointer';
                    tr.id = project.project_id;
                    tr.addEventListener('click', function () { // Afficher les détails du projet
                        document.getElementById('all_projects_table').style.display = 'none';
                        document.getElementById('project_details').style.display = 'block';
                        displayProject(project.project_id);
                    });
                    tr.addEventListener('mouseover', function () {
                        tr.style.border = '1px solid #6CE8E8';
                    });
                    tr.addEventListener('mouseout', function () {
                        tr.style.border = '1px solid lightgray';
                    });
                    tr.innerHTML = `
                        <th style="color: #29A6A7; margin-left: 5px;">${project.project_title}</th>
                        <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${project.project_location}</th>
                        <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${project.association}</th>
                        <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-start;">${project.project_type}</th>
                        <th style="background-color: ${project.project_status === 'En cours' ? 'lightgreen' : project.project_status === 'Terminé' ? 'lightcoral' : 'lightgray'}; border-radius: 10px; margin: 5px; padding: 5px; width: fit-content;">
                            <p style="color: ${project.project_status === 'En cours' ? 'green' : project.project_status === 'Terminé' ? 'red' : 'gray'};">${project.project_status ? project.project_status : '---'}</p>
                        </th>
                    `;
                    displayProjects.appendChild(tr);
                }
            });
        }
        //#endregion

        //#region Get months' names
        function getMonthName(month) {
            let monthName = '';
            switch (month) {
                case 0:
                    monthName = 'Janvier';
                    break;
                case 1:
                    monthName = 'Février';
                    break;
                case 2:
                    monthName = 'Mars';
                    break;
                case 3:
                    monthName = 'Avril';
                    break;
                case 4:
                    monthName = 'Mai';
                    break;
                case 5:
                    monthName = 'Juin';
                    break;
                case 6:
                    monthName = 'Juillet';
                    break;
                case 7:
                    monthName = 'Août';
                    break;
                case 8:
                    monthName = 'Septembre';
                    break;
                case 9:
                    monthName = 'Octobre';
                    break;
                case 10:
                    monthName = 'Novembre';
                    break;
                case 11:
                    monthName = 'Décembre';
                    break;
                default:
                    monthName = 'Non renseigné';
                    break;
            }
            return monthName;
        }
        //#endregion

        //#region Get days' names
        function getDayName(day) {
            let dayName = '';
            switch (day) {
                case 0:
                    dayName = 'Dimanche';
                    break;
                case 1:
                    dayName = 'Lundi';
                    break;
                case 2:
                    dayName = 'Mardi';
                    break;
                case 3:
                    dayName = 'Mercredi';
                    break;
                case 4:
                    dayName = 'Jeudi';
                    break;
                case 5:
                    dayName = 'Vendredi';
                    break;
                case 6:
                    dayName = 'Samedi';
                    break;
                default:
                    dayName = 'Non renseigné';
                    break;
            }
            return dayName;
        }
        //#endregion

        //#region Fonction pour ajouter un projet
        function newProject() {
            var projectTitle = document.getElementById('projectTitle').value;
            var projectType = document.getElementById('projectType').value;
            var projectDate = document.getElementById('projectDate').value;
            var projectEndDate2 = document.getElementById('projectEndDate2').value;
            var projectLocation = document.getElementById('projectLocation').value;
            var pademResponsible = document.getElementById('pademResponsible').value;
            var pademResponsibleEmail = document.getElementById('pademResponsibleEmail').value;
            var projectReferent = document.getElementById('projectReferent').value;
            var projectReferentEmail = document.getElementById('projectReferentEmail').value;
            var projectDescription = document.getElementById('projectDescription').value;
            var projectDocuments = document.getElementById('projectDocuments').value;

            var project = {
                project_title: projectTitle,
                project_type: projectType,
                start_date: projectDate,
                end_date: projectEndDate2,
                updated_date: new Date(),
                project_location: projectLocation,
                project_status: 'En attente',
                padem_responsible: pademResponsible,
                padem_responsible_email: pademResponsibleEmail,
                project_referent: projectReferent,
                project_referent_email: projectReferentEmail,
                project_description: projectDescription,
                background_image_link: '',
                folders: projectDocuments,
            };

            fetch('https://lab.padem.org/wp-json/mo/v1/createProjectData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(project),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    getProjects();
                    document.getElementById('new_project_form').style.display = 'none';
                    document.getElementById('all_projects_details_container').style.display = 'block';
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
        //#endregion

        //#region Liste des fonctions pour les actions sur les projets
        // Fonction pour ajouter une association à un projet
        // Fonction pour ajouter un membre à un projet
        function addMemberToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var members = project.members;
            var member = prompt('Saisir le nom du membre à ajouter au projet:');
            if (member !== null) {
                members.push(member);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, members: members }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }

        // Fonction pour ajouter un rapport à un projet
        function addReportToProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var reports = project.reports;
            var report = prompt('Saisir le nom du rapport à ajouter au projet:');
            if (report !== null) {
                reports.push(report);
                fetch('https://lab.padem.org/wp-json/mo/v1/updateProject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ project_id: projectId, reports: reports }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        getProjects();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }

        // Fonction pour archiver un projet
        function archiveProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);

            //#region Mettre à jour le projet
            fetch('https://lab.padem.org/wp-json/mo/v1/createProjectData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    project_id: projectId,
                    project_title: project.project_title,
                    project_type: project.project_type,
                    start_date: project.start_date,
                    end_date: project.end_date,
                    is_archive: true, // Archiver le projet
                    updated_date: new Date(),
                    project_location: project.project_location,
                    project_status: 'Archivé',
                    project_referent: project.project_referent,
                    project_referent_email: project.project_referent_email,
                    project_description: project.project_description,
                    background_image_link: project.background_image_link,
                    users: project.users,
                    reports: project.reports,
                    folders: project.folders,
                    divers: project.divers,
                }),
            })
                .then(response => response.json())
                .then(data => {
                    //#region Supprimer le projet de la liste des projets
                    fetch('https://lab.padem.org/wp-json/mo/v1/removeProjectData', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ column_param1: project.id }),
                    })
                        .then(response => response.json())
                        .then(data => {
                            getProjects();
                            document.getElementById('all_projects_table').style.display = 'block';
                            document.getElementById('project_details').style.display = 'none';
                            // Masquer l'anime de chargement
                            document.getElementById('loading').style.display = 'none';
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                    //#endregion
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            //#endregion

            //#region Envoyer un email à l'ensemble des membres du projet pour les informer de l'archivage du projet
            var projectMembers = project.users;
            var subject = 'Padem Lab Notifications: ' + 'Archivage du projet ' + project.project_title;
            var message = 'Bonjour, \n\nLe projet ' + project.project_title + ' a été archivé. \n\nCordialement, \n\nL\'équipe PADEM';

            // Envoyer un email à chaque membre du projet
            project.users.forEach(user => {
                var userEmail = users.find(u => u.ID === user).user_email;

                sendMailNotification(userEmail, subject, message);
            });
        }
        //#endregion
        //#endregion

        //#region Afficher le projet correspondant à l'ID
        function displayProject(projectId) {
            var project = projects.find(project => project.project_id === projectId);
            var displayProject = document.getElementById('project_details');
            // Vider le contenu
            displayProject.innerHTML = '';

            //#region Formater les dates
            var formated_updated_date = new Date(project.updated_date).toLocaleDateString('fr-FR'); // Formater la date
            var formated_start_date = new Date(project.start_date).toLocaleDateString('fr-FR');
            var formated_end_date = new Date(project.end_date).toLocaleDateString('fr-FR');

            var _updated_date = formated_updated_date.split('/'); // Récupérer la date
            var _start_date = formated_start_date.split('/');
            var _end_date = formated_end_date.split('/');

            var month_updated_date = getMonthName(parseInt(_updated_date[1])); // Récupérer le mois
            var month_start_date = getMonthName(parseInt(_start_date[1]));
            var month_end_date = getMonthName(parseInt(_end_date[1]));

            var day_updated_date = getDayName(new Date(project.updated_date).getDay()); // Récupérer le jour de la semaine
            var day_start_date = getDayName(new Date(project.start_date).getDay());
            var day_end_date = getDayName(new Date(project.end_date).getDay());

            var final_updated_date = day_updated_date + ' ' + _updated_date[0] + ' ' + month_updated_date + ' ' + _updated_date[2]; // Date finale
            var final_start_date = day_start_date + ' ' + _start_date[0] + ' ' + month_start_date + ' ' + _start_date[2];
            var final_end_date = day_end_date + ' ' + _end_date[0] + ' ' + month_end_date + ' ' + _end_date[2];
            //#endregion

            //#region Progression du projet (En cours, En attente, Terminé)
            var today = new Date();
            var start_date = new Date(project.start_date);
            var end_date = new Date(project.end_date);
            var progression = '';
            if (today < start_date) {
                progression = 'En attente';
            }
            else if (today >= start_date && today <= end_date) {
                progression = 'En cours';
            }
            else {
                progression = 'Terminé';
            }
            //#endregion

            displayProject.innerHTML = `
                <!-- Afficher le projet -->
                <div class="card-body" style="display: flex; justify-content: ${userRole.includes('administrator') ? 'space-between' : 'flex-end'}; width: 100%; height: fit-content; border-radius: 25px; background-color: transparent;" id="header_buttons_container_${project.project_id}">
                    <div style="display: flex; justify-content: flex-start; width: 100%; height: fit-content;">
                        <!-- Boutons d'actions -->
                        <button type="button" id="add_document_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone ajouter document --> <img src="https://img.icons8.com/?size=100&id=57052&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                        <div style="width: 5px;"></div>
                        <button type="button" id="add_report_to_project" style="background-color: white; border-radius: 25px;"> <!-- icone soumettre rapport --> <img src="https://img.icons8.com/?size=100&id=5271&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                        <div style="width: 5px;"></div>
                        <button type="button" id="display_this_project" style="background-color: white; border-radius: 25px; border: 1px solid #29A6A7;"> <!-- icone éditer --> <img src="https://img.icons8.com/?size=100&id=h88n73Ss5iTI&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt=""></button>
                    </div>
                    <!-- Boutons d'édition -->
                    ${userRole.includes('administrator') ? `<button type="button" id="archive_Project_" style="background-color: white; border-radius: 25px;"> <!-- icone archive --> <img src="https://img.icons8.com/?size=100&id=12634&format=png&color=FA5252" style="width: 20px; height: 20px;" alt=""></button>` : ''}
                </div>
                <article class="card" style="margin: 5px; padding: 5px; border-radius: 25px;">
                    <!-- Informations du projet -->
                    <div style="display: flex; justify-content: space-between; margin: 5px; padding: 5px;">
                        <h4 style="color: #29A6A7; margin-top: 5px;">${project.project_title ? project.project_title : '---'}</h4>
                        <button type="button" id="back_To_All_Projects" style="background-color: #29A6A7; border-radius: 50px; width: fit-content; color: white; font-size: 12px;" title="Retour"> <!-- icone retour --> <img src="https://img.icons8.com/?size=100&id=3483&format=png&color=FFFFFF" style="width: 20px; height: 20px;" alt=""> Retour</button>
                    </div>
                    <div style="display: none;">
                        <div style="display: flex; justify-content: flex-start; margin-bottom: -5px;">
                            <button type="button" id="hide_show_details" style="width: fit-content; color: lightgray; font-size: 12px;" title=""> <img src="https://img.icons8.com/?size=100&id=986&format=png&color=9F9F9F" id="hide_show_details_icon_"
                                style="width: 20px; height: 20px;" alt="details">Masquer les détails du projet</button>
                        </div>
                        <hr style="border: 1px solid lightgray;">
                    </div>
                    <div style="display: block; margin: 5px; padding: 5px; border-radius: 25px; border: 1px solid #E4E4E4;">
                        <!-- Bouton pour afficher/masquer les détails du projet -->
                        <button type="button" id="hide_show_details_container_${project.project_id}" style="width: fit-content; color: lightgray; font-size: 12px;" title=""> 
                            <img src="https://img.icons8.com/?size=100&id=121539&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="details">
                            Afficher les détails du projet...</button>
                        <!-- Détails du projet -->
                        <div id="project_details_container_" style="display: none;">
                            <div style="border-radius: 25px; background-color: white; display: flex; justify-content: space-between;" id="project_details_container">
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Bailleur de fonds --> <img src="https://img.icons8.com/?size=100&id=Iv2ecGx6KYqh&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Bailleur: </p>
                                        <p style="color: black; margin-left: 5px;">${project.funder ? project.funder : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Groupe --> <img src="https://img.icons8.com/?size=100&id=779&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Association: </p>
                                        <p style="color: black; margin-left: 5px;">${project.association ? project.association : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Thématique --> <img src="https://img.icons8.com/?size=100&id=22798&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Thématique: </p>
                                        <p style="color: black; margin-left: 5px;">${project.project_type ? project.project_type : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone pays --> <img src="https://img.icons8.com/?size=100&id=17548&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Pays: </p>
                                        <p style="color: black; margin-left: 5px;">${project.project_location ? project.project_location : '---'}</p>
                                    </div>
                                </div>
                                <div class="card-body" style="display: column; justify-content: flex-start;">
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone Responsable --> <img src="https://img.icons8.com/?size=100&id=21996&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Référent: </p>
                                        <p style="color: black; margin-left: 5px;">${project.project_referent ? project.project_referent : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de début --> <img src="https://img.icons8.com/?size=100&id=1072&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de début: </p>
                                        <p style="color: black; margin-left: 5px;">${final_start_date ? final_start_date : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- icone date de fin --> <img src="https://img.icons8.com/?size=100&id=1070&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Date de fin: </p>
                                        <p style="color: black; margin-left: 5px;">${final_end_date ? final_end_date : '---'}</p>
                                    </div>
                                    <div style="display: flex; justify-content: flex-start;">
                                        <p style="color: gray;"> <!-- progress bar --> <img src="https://img.icons8.com/?size=100&id=39273&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> Progression: </p>
                                        <p style="color: ${progression === 'En cours' ? 'green' : progression === 'Terminé' ? 'red' : 'gray'}; width: fit-content; margin-left: 5px;">${progression}</p>
                                    </div>
                                </div>
                                <!-- Bouton pour modifier les détails du projet -->
                                ${userRole.includes('administrator') ? `<button type="button" id="update_all_project_details" style="width: fit-content; margin-bottom: 150px;" title="Modifier les détails du projet"> <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=9F9F9F" id="update_all_project_details_icon"
                                    style="width: 55px; height: 30px;" alt="Modifier les détails du projet"></button>`: ''}
                            </div>
                            <!-- Description du projet -->
                            <div id="project_description_container_main" style="display: block;">
                                <div style="display: flex; justify-content: flex-start; margin-bottom: -3px;">
                                    <button type="button" id="_project_description_" style="width: fit-content; color: gray; font-size: 12px;" title="">Voir la description du projet....</button>
                                </div>
                                <div id="project_description_container_" style="display: none;">
                                    <div style="display: column; justify-content: flex-start; margin: 5px; padding: 5px;">
                                        <p style="color: black; margin-left: 5px;">${project.project_description ? project.project_description : 'Aucune description disponible pour ce projet.'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Formulaire pour modifier les détails du projet -->
                        <form class="card" id="update_all_project_details_container_" style="display: none;" method="POST">
                            <div class="card-body" style="margin: 5px; padding: 5px; border: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="update_funder_${project.project_id}" style="color: gray;"> <!-- icone Bailleur de fonds --> 
                                            <img src="https://img.icons8.com/?size=100&id=Iv2ecGx6KYqh&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> 
                                            Bailleur:  <span style="color: red;">*</span></label>
                                        <input type="text" id="update_funder_${project.project_id}" class="form-control" value="${project.funder ? project.funder : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div class="col-md-6">
                                        <label for="update_association_${project.project_id}" style="color: gray;"> <!-- icone Groupe --> 
                                            <img src="https://img.icons8.com/?size=100&id=779&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> 
                                            Association: <span style="color: red;">*</span></label>
                                        <input type="text" id="update_association_${project.project_id}" class="form-control" value="${project.association ? project.association : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                </div>
                                <div class="row">
                                    <div style="margin: 10px;"></div>
                                    <div class="col-md-6">
                                        <label for="update_project_type_${project.project_id}" style="color: gray;"> <!-- icone Thématique --> 
                                            <img src="https://img.icons8.com/?size=100&id=22798&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> 
                                            Thématique: <span style="color: red;">*</span></label>
                                        <input type="text" id="update_project_type_${project.project_id}" class="form-control" value="${project.project_type ? project.project_type : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div class="col-md-6">
                                        <label for="update_project_location_${project.project_id}" style="color: gray;"> <!-- icone pays --> 
                                            <img src="https://img.icons8.com/?size=100&id=17548&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> 
                                            Pays: <span style="color: red;">*</span></label>
                                        <input type="text" id="update_project_location_${project.project_id}" class="form-control" value="${project.project_location ? project.project_location : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="update_project_referent_${project.project_id}" style="color: gray;"> <!-- icone Responsable --> 
                                            <img src="https://img.icons8.com/?size=100&id=21996&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> 
                                            Référent: <span style="color: red;">*</span></label>
                                        <input type="text" id="update_project_referent_${project.project_id}" class="form-control" value="${project.project_referent ? project.project_referent : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <!-- Adresse email du référent -->
                                    <div class="col-md-6">
                                        <label for="update_project_referent_email_${project.project_id}" style="color: gray;"> <!-- icone Responsable --> 
                                            <img src="https://img.icons8.com/?size=100&id=21996&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> 
                                            Email du référent: <span style="color: red;">*</span></label>
                                        <input type="email" id="update_project_referent_email_${project.project_id}" class="form-control" value="${project.project_referent_email ? project.project_referent_email : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="update_start_date_${project.project_id}" style="color: gray;"> <!-- icone date de début --> 
                                            <img src="https://img.icons8.com/?size=100&id=1072&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> 
                                            Date de début: <span style="color: red;">*</span></label>
                                        <input type="date" id="update_start_date_${project.project_id}" class="form-control" value="${project.start_date ? project.start_date : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                    <div style="margin: 10px;"></div>
                                    <div class="col-md-6">
                                        <label for="update_end_date_${project.project_id}" style="color: gray;"> <!-- icone date de fin --> 
                                            <img src="https://img.icons8.com/?size=100&id=1070&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> 
                                            Date de fin: <span style="color: red;">*</span></label>
                                        <input type="date" id="update_end_date_${project.project_id}" class="form-control" value="${project.end_date ? project.end_date : '---'}" style="color: gray; margin-left: 5px; background-color: white; margin-top: -5px; border: 1px solid lightgray; border-radius: 25px;">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <label for="update_project_description_${project.project_id}" style="color: gray;"> <!-- icone Responsable --> 
                                            <img src="https://img.icons8.com/?size=100&id=77&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt=""> 
                                            Description: <span style="color: red;">*</span></label>
                                        <textarea id="update_project_description_${project.project_id}" class="form-control" style="color: gray; margin-left: 5px; width: fit-content; border: 1px solid lightgray; border-radius: 15px;" rows="5">${project.project_description ? project.project_description : '---'}</textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div style="display: flex; justify-content: flex-end; margin: 5px; padding: 5px;">
                                    <button type="button" id="update_all_project_details_button_${project.project_id}" style="width: fit-content; background-color: #29A6A7; border-radius: 25px; color: white; font-size: 12px;" title="valider"> <!-- icone valider --> <img src="https://img.icons8.com/?size=100&id=11658&format=png&color=FFFFFF" style="width: 20px; height: 20px;" alt=""> Valider</button>
                                    <div style="margin: 5px;"></div>
                                    <button type="button" id="cancel_update_all_project_details_${project.project_id}" style="width: fit-content; background-color: red; border-radius: 25px; color: white; font-size: 12px;" title="annuler"> <!-- icone annuler --> <img src="https://img.icons8.com/?size=100&id=3062&format=png&color=FFFFFF" style="width: 20px; height: 20px;" alt=""> Annuler</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="card-body" style="margin: 5px; padding: 5px; min-height: 300px; width: 100%;"">
                        <!-- Menu initial -->
                        <div id="first_menu_${project.project_id}" style="display: block;">
                            <div style="margin: 5px; display: flex; justify-content: flex-end;">
                                <button id="_project_trames_${project.project_id}" style="width: fit-content; color: #29A6A7; border-bottom-color: #29A6A7; align-self: center; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/ios/50/9F9F9F/report-card.png"
                                        style="width: 15px; height: 15px;" alt=""> Trames</button>
                                <button id="_project_documents_${project.project_id}" style="width: fit-content; color: gray; border-bottom-color: transparent; align-self: center; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/ios/50/9F9F9F/document.png"
                                        style="width: 15px; height: 15px;" alt=""> Documents</button>                          
                                <button id="_project_members_${project.project_id}" style="width: fit-content; color: gray; border-bottom-color: transparent; align-self: center; margin: 5px; padding: 5px; font-size: 13px;" class="box-clicable"> <img src="https://img.icons8.com/?size=100&id=21997&format=png&color=9F9F9F"
                                        style="width: 15px; height: 15px;" alt=""> Membres</button>
                            </div>
                            <!-- Ligne de séparation -->
                            <hr style="border: 1px solid lightgray;">
                            <div>
                                
                                <div class="container" id="projectTrame_display_${project.project_id}" style="display: block;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 400px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_tite_${project.project_id}">Nom <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="this__name_${project.project_id}">Auteur <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="this_creta_date_${project.project_id}">Date de création <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}">Type <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}">Taille <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_trames_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>

                                <div class="container" id="projectDocuments_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 400px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="doc_title_${project.project_id}">Nom <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="doc_name">Auteur <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="doc_association_name">Date de création <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;"
                                                        alt=""></th>
                                                <th scope="col" id="doc_theme_name">Type <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="doc_status_name">Taille <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="display_project_documents_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="container" id="projectMembers_${project.project_id}" style="display: none;">
                                    <table style="width: 100%; border-collapse: collapse; min-height: 400px;">
                                        <thead style="font-size: 12px; font-weight: lighter; color: gray;">
                                            <tr>
                                                <th scope="col" id="project_tite_${project.project_id}_members">Nom <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="country_name_${project.project_id}_members">Mail <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="association_name_${project.project_id}_members">Pays <img
                                                        src="https://img.icons8.com/ios/50/000000/sort.png" style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="theme_name_${project.project_id}_members">Association <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col" id="status_name_${project.project_id}_members">Rôle <img src="https://img.icons8.com/ios/50/000000/sort.png"
                                                        style="width: 15px; height: 15px;" alt=""></th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="this_display_project_members_${project.project_id}" class="main-group-scroll" style="min-height: 200px;">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Ajouter un document au projet (Formulaire & upload) -->
                        <div id="_menu_add_document_${project.project_id}" style="display: none;">
                            <!-- Formulaire de création de document -->
                            <form id="files_Form_${project.project_id}" class="card" style="border-radius: 25px; background-color: white; padding: 20px;" method="post" enctype="multipart/form-data">
                                <!--#region Upload de fichiers un ou plusieurs fichiers (pdf, word, excel, powerpoint) un à la fois avec un bouton d'ajout et un bouton de suppression -->
                                <div style="display: column; justify-content: space-between; padding: 10px;" id="onglet_files_container_${project.project_id}" class="card-body">
                                    <div style="height: 10px;"></div>
                                    <!-- Sélectionner le type de fichier (Trame ou autre) -->
                                    <label for="files_file_type_${project.project_id}" style="font-size: 14px; font-weight: lighter; color: gray;">
                                        <img src="https://img.icons8.com/ios/50/9F9F9F/folder-invoices.png" style="width: 20px; height: 20px;" alt="">
                                        Type de document à ajouter au projet <span style="color: red;">*</span>
                                    </label>
                                    <select class="form-control" id="files_file_type_${project.project_id}" name="files_file_type_" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px; font-size: 14px; color: gray;">
                                        <option value="0">Sélectionner</option>
                                        <option value="1">Trame</option>
                                        <option value="2">Autre</option>
                                    </select>
                                    <!-- Choisir un fichier -->
                                    <div style="height: 10px;"></div>
                                    <div class="col-md-12">
                                        <input type="file" id="files_file_1_${project.project_id}" name="files_file_1" class="form-control" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                        <div style="height: 10px;"></div>
                                    </div>
                                    <div style="height: 10px;"></div>
                                </div>
                                <!--#endregion Upload de fichiers -->
                                <div class="action-buttons col-md-12" style="display: flex; justify-content: flex-end;">
                                    <button type="button" class="btn btn-secondary" style="color: white; width: fit-content; border-radius: 20px;" id="onglet_files_cancel_${project.project_id}">
                                        Annuler <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="Annuler" style="width: 25px; height: 25px;">
                                    </button>
                                    <button type="button" class="btn btn-primary" style="width: fit-content; border-radius: 20px; color: white;" id="onglet_files_send_${project.project_id}">
                                        Enregistrer <img src="https://img.icons8.com/ios/50/FFFFFF/save.png" alt="Enregistrer" style="width: 25px; height: 25px;">
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Ajouter un nouveau rapport au projet -->
                        <div class="container" id="_menu_add_report_${project.project_id}" style="display: none;">
                            <form class="card" id="add_report_to_project_form_${project.project_id}" style="border-radius: 25px; background-color: white; padding: 20px;" method="post" enctype="multipart/form-data">
                                <div  class="card-body" style="border-radius: 15px; padding: 10px; background: none; margin: 10px;">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="report_title_${project.project_id}" style="color: gray;">
                                                <img src="https://img.icons8.com/ios/50/9F9F9F/title.png" style="width: 20px; height: 20px;" alt="">
                                                Titre du rapport</label>
                                            <input type="text" class="form-control" id="report_title_${project.project_id}" name="report_title" style="width: 100%; border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                        </div>
                                        <!-- type de rapport -->
                                        <div class="col-md-6">
                                            <label for="report_type_${project.project_id}" style="color: gray;">
                                                <img src="https://img.icons8.com/ios/50/9F9F9F/report-card.png" style="width: 20px; height: 20px;" alt="">
                                                Type de rapport <span style="color: red;">*</span>
                                            </label>
                                            <select class="form-control" id="report_type_${project.project_id}" name="report_type" style="border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                                <option value="">Sélectionner un type de rapport</option>
                                                <option value="Rapport d'activité">Rapport d'activité</option>
                                                <option value="Rapport financier">Rapport financier</option>
                                                <option value="Rapport de mission">Rapport de mission</option>
                                                <option value="Rapport de suivi">Rapport de suivi</option>
                                                <option value="Rapport de fin de projet">Rapport de fin de projet</option>
                                                <option value="Rapport d'évaluation">Rapport d'évaluation</option>
                                                <option value="Autre">Autre</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div style="height: 10px;"></div>
                                    <div class="row" style="display: none;" id="report_type_other_container_${project.project_id}">
                                        <!-- Type de rapport si autre -->
                                        <div class="col-md-6">
                                            <label for="report_type_other_${project.project_id}" style="color: gray;">
                                                <img src="https://img.icons8.com/ios/50/9F9F9F/report-card.png" style="width: 20px; height: 20px;" alt="">
                                                Autre type de rapport</label>
                                            <input type="text" class="form-control" id="report_type_other_${project.project_id}" name="report_type_other" style="border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                            <small id="file_Help_report_autre${project.project_id}" class="form-text text-muted">Veuillez préciser le type de rapport.</small>
                                        </div>
                                    </div>
                                    <div style="height: 10px;"></div>
                                    <div class="row">
                                        <!-- Date du rapport -->
                                        <div class="col-md-6">
                                            <label for="report_date_${project.project_id}" style="color: gray;">
                                                <img src="https://img.icons8.com/ios/50/9F9F9F/calendar.png" style="width: 20px; height: 20px;" alt="">
                                                Date <span style="color: red;">*</span></label>
                                            <input type="date" class="form-control" id="report_date_${project.project_id}" name="report_date_" style="border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="report_comments_${project.project_id}" style="color: gray;">
                                                <img src="https://img.icons8.com/?size=100&id=118377&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">
                                                Commentaires</label>
                                            <textarea class="form-control" id="report_comments_${project.project_id}" name="report_comments_" rows="5" style="border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                                </textarea>
                                        </div>
                                    </div>
                                    <div style="height: 10px;"></div>
                                    <div class="col-md-12">
                                        <label for="report_file_1_${project.project_id}" style="color: gray;">
                                            <img src="https://img.icons8.com/ios/50/9F9F9F/pdf.png" style="width: 20px; height: 20px;" alt="">
                                            Document 1:  <span style="color: red;">*</span></label>
                                        <input type="file" class="form-control" id="report_file_1_${project.project_id}" name="report_file_1_" style="border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                        <small id="file_Help_${project.project_id}" class="form-text text-muted">Veuillez sélectionner un fichier PDF.</small>
                                    </div>
                                    <div style="height: 10px;"></div>
                                    <div class="col-md-12">
                                        <label for="report_file_2_${project.project_id}" style="color: gray;">
                                            <img src="https://img.icons8.com/ios/50/9F9F9F/pdf.png" style="width: 20px; height: 20px;" alt="">
                                            Document 2: </label>
                                        <input type="file" class="form-control" id="report_file_2_${project.project_id}" name="report_file_2_" style="border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                        <small id="file_Help_2_${project.project_id}" class="form-text text-muted">Veuillez sélectionner un fichier PDF.</small>
                                    </div>
                                    <div style="height: 10px;"></div>
                                    <div class="col-md-12">
                                        <label for="report_file_3_${project.project_id}" style="color: gray;">
                                            <img src="https://img.icons8.com/ios/50/9F9F9F/pdf.png" style="width: 20px; height: 20px;" alt="">
                                            Document 3: </label>
                                        <input type="file" class="form-control" id="report_file_3_${project.project_id}" name="report_file_3_" style="border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                        <small id="file_Help_3_${project.project_id}" class="form-text text-muted">Veuillez sélectionner un fichier PDF.</small>
                                    </div>
                                    <div style="height: 10px;"></div>
                                    <div class="col-md-12">
                                        <label for="report_file_4_${project.project_id}" style="color: gray;">
                                            <img src="https://img.icons8.com/ios/50/9F9F9F/pdf.png" style="width: 20px; height: 20px;" alt="">
                                            Document 4: </label>
                                        <input type="file" class="form-control" id="report_file_4_${project.project_id}" name="report_file_4_" style="border-radius: 20px; border: 1px solid lightgray; padding: 5px;">
                                        <small id="file_Help_4_${project.project_id}" class="form-text text-muted">Veuillez sélectionner un fichier PDF.</small>
                                    </div>
                                </div>
                                <div style="height: 10px;"></div>
                                <div class="action-buttons col-md-12" style="display: flex; justify-content: flex-end;">
                                    <button type="button" class="btn btn-secondary" style="color: white; width: fit-content; border-radius: 20px;" id="this_project_cancel_add_report_${project.project_id}">
                                        Annuler <img src="https://lab.padem.org/wp-content/uploads/Annuler.png" alt="Annuler" style="width: 25px; height: 25px;">
                                    </button>
                                    <button type="button" class="btn btn-primary" style="width: fit-content; border-radius: 20px; color: white;" id="this_project_add_report_${project.project_id}">
                                        Enregistrer <img src="https://img.icons8.com/ios/50/FFFFFF/save.png" alt="Enregistrer" style="width: 25px; height: 25px;">
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </article>
            `;

            // Événement pour Afficher / masquer le container des détails du projet 
            document.getElementById('hide_show_details_container_' + project.project_id).addEventListener('click', function () {
                var project_details_container = document.getElementById('project_details_container_');
                if (project_details_container.style.display === 'none') {
                    project_details_container.style.animation = 'show 1s';
                    project_details_container.style.display = 'block';
                    document.getElementById('hide_show_details_container_' + project.project_id).innerHTML = '<img src="https://img.icons8.com/?size=100&id=986&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="details"> Masquer les détails du projet...';
                }
                else {
                    project_details_container.style.animation = 'hide 1s';
                    project_details_container.style.display = 'none';
                    document.getElementById('hide_show_details_container_' + project.project_id).innerHTML = '<img src="https://img.icons8.com/?size=100&id=121539&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="details"> Afficher les détails du projet...';
                }
            });

            if (userRole.includes('administrator')) {
                //#region Ajouter écouteur d'événement pour le bouton "Modifier les détails du projet"
                document.getElementById('update_all_project_details').addEventListener('click', function () {
                    document.getElementById('update_all_project_details_container_').style.display = 'block';
                    document.getElementById('project_details_container_').style.display = 'none';
                    // Masquer le bouton "Modifier les détails du projet"
                    document.getElementById('hide_show_details_container_' + project.project_id).style.display = 'none';
                });
                //#region Ajouter écouteur d'événement pour le bouton "Valider"
                document.getElementById('update_all_project_details_button_' + project.project_id).addEventListener('click', function () {

                    // Récupérer les infos du projet
                    fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    })
                        .then(response => response.json())
                        .then(this_data => {
                            var this_project = this_data.find(p => p.project_id === project.project_id);
                            if (this_project) {
                                // Afficher le bouton "Modifier les détails du projet"
                                document.getElementById('hide_show_details_container_' + project.project_id).style.display = 'block';

                                var funder = document.getElementById('update_funder_' + project.project_id).value;
                                var association = document.getElementById('update_association_' + project.project_id).value;
                                var project_type = document.getElementById('update_project_type_' + project.project_id).value;
                                var project_location = document.getElementById('update_project_location_' + project.project_id).value;
                                var project_referent = document.getElementById('update_project_referent_' + project.project_id).value;
                                var project_referent_email = document.getElementById('update_project_referent_email_' + project.project_id).value;
                                var start_date = document.getElementById('update_start_date_' + project.project_id).value;
                                var end_date = document.getElementById('update_end_date_' + project.project_id).value;
                                var project_description = document.getElementById('update_project_description_' + project.project_id).value;

                                // Vérifier si les champs sont vides
                                if (funder === '' || association === '' || project_type === '' || project_location === '' || project_referent === '' || start_date === '' || end_date === '') {
                                    alert('Veuillez completer tous les champs obligatoires.');
                                } else {
                                    // Mettre à jour les détails du projet (https://lab.padem.org/wp-json/mo/v1/createProjectData)
                                    fetch('https://lab.padem.org/wp-json/mo/v1/createProjectData', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            project_id: project.project_id,
                                            project_title: this_project.project_title,
                                            is_archive: this_project.is_archive,
                                            funder: funder,
                                            association: association,
                                            project_type: project_type,
                                            project_location: project_location,
                                            project_status: this_project.project_status,
                                            project_referent: project_referent,
                                            project_referent_email: this_project.project_referent_email,
                                            start_date: start_date,
                                            end_date: end_date,
                                            project_description: project_description,
                                            updated_date: new Date().toISOString().slice(0, 19).replace('T', ' '),
                                        }),
                                    })
                                        .then(response => response.json())
                                        .then(data => {
                                            if (data.success) {
                                                alert('Les détails du projet ont été mis à jour avec succès.');
                                                document.getElementById('update_all_project_details_container_').style.display = 'none';
                                                document.getElementById('project_details_container_').style.display = 'block';

                                                //#region Mettre à jour les détails du projet
                                                document.getElementById('funder_' + project.project_id).innerHTML = document.getElementById('update_funder_' + project.project_id).value;
                                                document.getElementById('association_' + project.project_id).innerHTML = document.getElementById('update_association_' + project.project_id).value;
                                                document.getElementById('project_type_' + project.project_id).innerHTML = document.getElementById('update_project_type_' + project.project_id).value;
                                                document.getElementById('project_location_' + project.project_id).innerHTML = document.getElementById('update_project_location_' + project.project_id).value;
                                                document.getElementById('project_referent_' + project.project_id).innerHTML = document.getElementById('update_project_referent_' + project.project_id).value;
                                                document.getElementById('start_date_' + project.project_id).innerHTML = document.getElementById('update_start_date_' + project.project_id).value;
                                                document.getElementById('end_date_' + project.project_id).innerHTML = document.getElementById('update_end_date_' + project.project_id).value;
                                                document.getElementById('project_description_' + project.project_id).innerHTML = document.getElementById('update_project_description_' + project.project_id).value;
                                                //#endregion

                                                // Supprimer l'ancien contenu
                                                fetch('https://lab.padem.org/wp-json/mo/v1/removeProjectData', {
                                                    method: 'DELETE',
                                                    headers: {
                                                        'Content-Type': 'application/json',
                                                    },
                                                    body: JSON.stringify({
                                                        column_param1: this_project.id, // Supprimer les anciennes données du projet
                                                    }),
                                                })
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        if (data.status === 'success') {
                                                            console.log('Les anciennes données du projet ont été supprimées avec succès.');
                                                        } else {
                                                            alert('Une erreur s\'est produite lors de la suppression des anciennes données du projet.');
                                                        }
                                                    })
                                                    .catch((error) => {
                                                        console.error('Error:', error);
                                                    });
                                            } else {
                                                alert('Une erreur s\'est produite lors de la mise à jour des détails du projet.');
                                            }
                                        })
                                        .catch((error) => {
                                            console.error('Error:', error);
                                        });
                                }
                            }
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                });
                //#endregion

                //#region Ajouter écouteur d'événement pour le bouton "Annuler"
                document.getElementById('cancel_update_all_project_details_' + project.project_id).addEventListener('click', function () {
                    document.getElementById('update_all_project_details_container_').style.display = 'none';
                    document.getElementById('project_details_container_').style.display = 'block';
                    // Afficher le bouton "Modifier les détails du projet"
                    document.getElementById('hide_show_details_container_' + project.project_id).style.display = 'block';
                });
                //#endregion
            }

            //#region Ajouter écouteur d'événement pour le bouton "Masquer la description du projet"
            document.getElementById('_project_description_').addEventListener('click', function () {
                var project_description_container = document.getElementById('project_description_container_');
                if (project_description_container.style.display === 'block') {
                    project_description_container.style.animation = 'hide 1s';
                    project_description_container.style.display = 'none';
                    document.getElementById('_project_description_').innerHTML = 'Voir la description du projet....';
                }
                else {
                    project_description_container.style.animation = 'show 1s';
                    project_description_container.style.display = 'block';
                    document.getElementById('_project_description_').innerHTML = 'Masquer la description du projet';
                }
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton "Masquer les détails du projet"
            document.getElementById('hide_show_details').addEventListener('click', function () {
                var project_details_container = document.getElementById('project_details_container_');
                if (project_details_container.style.display === 'block') {
                    project_details_container.style.animation = 'hide 1s';
                    project_details_container.style.display = 'none';
                    document.getElementById('hide_show_details').innerHTML = 'Afficher les détails du projet';
                    document.getElementById('hide_show_details_icon_').src = 'https://img.icons8.com/?size=100&id=121539&format=png&color=9F9F9F';
                }
                else {
                    project_details_container.style.animation = 'show 1s';
                    project_details_container.style.display = 'block';
                    document.getElementById('hide_show_details').innerHTML = 'Masquer les détails du projet';
                    document.getElementById('hide_show_details_icon_').src = 'https://img.icons8.com/?size=100&id=986&format=png&color=9F9F9F';
                }
            });
            //#endregion

            //#region Ajouter écouteur d'événement pour le bouton Retour aux projets
            document.getElementById('back_To_All_Projects').addEventListener('click', function (e) {
                e.preventDefault();

                // Masquer tout les autres éléments
                document.getElementById('project_details').style.display = 'none';
                // Afficher le tableau des projets
                document.getElementById('all_projects_table').style.display = 'block';
            });
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons (Rapports, Documents, Associations, Membres, Demandes de rapports)
            document.getElementById(`_project_trames_${project.project_id}`).addEventListener('click', function () {
                // Afficher les rapports du projet & masquer les autres éléments
                document.getElementById('projectTrame_display_' + project.project_id).style.display = 'block';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_project_trames_${project.project_id}`).style.borderBottomColor = '#29A6A7';
                document.getElementById(`_project_trames_${project.project_id}`).style.color = '#29A6A7';
                document.getElementById(`_project_documents_${project.project_id}`).style.borderBottomColor = 'transparent';
                document.getElementById(`_project_documents_${project.project_id}`).style.color = 'gray';
                document.getElementById(`_project_members_${project.project_id}`).style.borderBottomColor = 'transparent';
                document.getElementById(`_project_members_${project.project_id}`).style.color = 'gray';
            });
            document.getElementById(`_project_documents_${project.project_id}`).addEventListener('click', function () {
                // Afficher les documents du projet & masquer les autres éléments
                document.getElementById('projectTrame_display_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'none';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'block';

                // Changement de couleur des boutons
                document.getElementById(`_project_trames_${project.project_id}`).style.borderBottomColor = 'transparent';
                document.getElementById(`_project_trames_${project.project_id}`).style.color = 'gray';
                document.getElementById(`_project_documents_${project.project_id}`).style.borderBottomColor = '#29A6A7';
                document.getElementById(`_project_documents_${project.project_id}`).style.color = '#29A6A7';
                document.getElementById(`_project_members_${project.project_id}`).style.borderBottomColor = 'transparent';
                document.getElementById(`_project_members_${project.project_id}`).style.color = 'gray';
            });
            document.getElementById(`_project_members_${project.project_id}`).addEventListener('click', function () {
                // Afficher les membres du projet & masquer les autres éléments
                document.getElementById('projectTrame_display_' + project.project_id).style.display = 'none';
                document.getElementById('projectMembers_' + project.project_id).style.display = 'block';
                document.getElementById('projectDocuments_' + project.project_id).style.display = 'none';

                // Changement de couleur des boutons
                document.getElementById(`_project_trames_${project.project_id}`).style.borderBottomColor = 'transparent';
                document.getElementById(`_project_trames_${project.project_id}`).style.color = 'gray';
                document.getElementById(`_project_documents_${project.project_id}`).style.borderBottomColor = 'transparent';
                document.getElementById(`_project_documents_${project.project_id}`).style.color = 'gray';
                document.getElementById(`_project_members_${project.project_id}`).style.borderBottomColor = '#29A6A7';
                document.getElementById(`_project_members_${project.project_id}`).style.color = '#29A6A7';
            });
            //#endregion

            //#region Fonction pour afficher les documents du projet (https://lab.padem.org/wp-json/mo/v1/getProjectFile)
            displayProjectDocuments(); // Afficher les documents du projet
            function displayProjectDocuments() {
                // Animation de chargement
                document.getElementById('display_project_documents_' + project.project_id).innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: gray;"> <img src="https://img.icons8.com/?size=100&id=3574&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">
                            Chargement des fichiers...</td>
                    </tr>
                `;
                document.getElementById('display_project_trames_' + project.project_id).innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: gray;"> <img src="https://img.icons8.com/?size=100&id=3574&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">
                            Chargement des trames...</td>
                    </tr>
                `;
                // Récupérer les utilisateurs
                fetch('https://lab.padem.org/wp-json/mo/v1/getAllMembers')
                    .then(response => response.json())
                    .then(data => {
                        var all_users_names = [];
                        if (data.length > 0) {
                            data.forEach(user => {
                                all_users_names.push({
                                    user_email: user.user_email,
                                    user_name: user.display_name
                                });
                            });
                        } else {
                            console.log('Aucun utilisateur trouvé.');
                        }
                        // Récupérer les fichiers
                        fetch('https://lab.padem.org/wp-json/mo/v1/getProjectFile',
                            {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            }
                        )
                            .then(response => response.json())
                            .then(data => {
                                var tbody = document.getElementById('display_project_documents_' + project.project_id);
                                var tbody_trames = document.getElementById('display_project_trames_' + project.project_id);
                                tbody.innerHTML = '';
                                tbody_trames.innerHTML = '';
                                var is_image = new Array(data.length).fill(false); // Tableau pour vérifier si le fichier est une image
                                var file_type = new Array(data.length).fill(''); // Tableau pour enregistrer le type de fichier
                                var is_folder = new Array(data.length).fill(false); // Tableau pour vérifier si le fichier est un dossier
                                var is_trame = new Array(data.length).fill(false); // Tableau pour vérifier si le fichier est une trame
                                var is_other = new Array(data.length).fill(false); // Tableau pour vérifier si le fichier est un autre type de fichier

                                if (data.length > 0) {

                                    //#region trie des fichiers
                                    // Fonction pour trier les fichiers par ordre alphabétique
                                    function sortFilesAlphabetically() {
                                        data.sort(function (a, b) {
                                            var nameA = a.file_name.toUpperCase(); // ignore upper and lowercase
                                            var nameB = b.file_name.toUpperCase(); // ignore upper and lowercase
                                            if (nameA < nameB) {
                                                return -1;
                                            }
                                            if (nameA > nameB) {
                                                return 1;
                                            }
                                            // names must be equal
                                            return 0;
                                        });
                                    }

                                    // Fonction pour trier les fichiers par date de création
                                    function sortFilesByDate() {
                                        data.sort(function (a, b) {
                                            var dateA = new Date(a.created_at);
                                            var dateB = new Date(b.created_at);
                                            return dateB - dateA;
                                        });
                                    }

                                    // Fonction pour trier les fichiers par taille
                                    function sortFilesBySize() {
                                        data.sort(function (a, b) {
                                            var sizeA = parseInt(a.file_size);
                                            var sizeB = parseInt(b.file_size);
                                            return sizeB - sizeA;
                                        });
                                    }

                                    // Fonction pour trier les fichiers par type
                                    function sortFilesByType() {
                                        data.sort(function (a, b) {
                                            var typeA = a.file_type.toUpperCase(); // ignore upper and lowercase
                                            var typeB = b.file_type.toUpperCase(); // ignore upper and lowercase
                                            if (typeA < typeB) {
                                                return -1;
                                            }
                                            if (typeA > typeB) {
                                                return 1;
                                            }
                                            // names must be equal
                                            return 0;
                                        });
                                    }

                                    //#endregion

                                    // Afficher les fichiers
                                    data.forEach((file, index) => {
                                        if ((!file.is_trame || file.is_trame === '0') && file.project_id === project.project_id) { // Si le fichier n'est pas une trame et appartient au projet

                                            //#region Formater la taille du fichier
                                            var fileSize = '';
                                            if (file.file_size) { // Si la taille du fichier est définie

                                                var unformattedFileSize = parseInt(file.file_size); // Convertir la taille en entier

                                                if (unformattedFileSize < 1024) {
                                                    fileSize = unformattedFileSize + ' octets';
                                                }
                                                else if (unformattedFileSize < 1048576) {
                                                    fileSize = (unformattedFileSize / 1024).toFixed(2) + ' Ko';
                                                }
                                                else if (unformattedFileSize < 1073741824) {
                                                    fileSize = (unformattedFileSize / 1048576).toFixed(2) + ' Mo';
                                                }
                                                else {
                                                    fileSize = (unformattedFileSize / 1073741824).toFixed(2) + ' Go';
                                                }
                                            } else {
                                                fileSize = '---';
                                            }
                                            //#endregion

                                            //#region Afficher une icone à côté du nom du fichier selon son type
                                            var fileIcon = '';
                                            if (file.file_type) {
                                                if ((file.file_type).includes('pdf')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FF0000/pdf.png';
                                                    is_other[index] = true;
                                                    is_image[index] = false;
                                                    is_folder[index] = false;
                                                } else if ((file.file_type).includes('word')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/2E86C1/ms-word.png';
                                                    is_other[index] = true;
                                                    is_image[index] = false;
                                                    is_folder[index] = false;
                                                } else if ((file.file_type).includes('excel')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/1ABC9C/ms-excel.png';
                                                    is_other[index] = true;
                                                    is_image[index] = false;
                                                    is_folder[index] = false;
                                                } else if ((file.file_type).includes('powerpoint')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/ms-powerpoint.png';
                                                    is_other[index] = true;
                                                    is_image[index] = false;
                                                    is_folder[index] = false;
                                                } else if ((file.file_type).includes('image')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/image.png';
                                                    is_image[index] = true;
                                                    is_folder[index] = false;
                                                    is_other[index] = false;
                                                } else if ((file.file_type).includes('audio')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/audio.png';
                                                    is_other[index] = true;
                                                } else if ((file.file_type).includes('video')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/video.png';
                                                    is_other[index] = true;
                                                } else if ((file.file_type).includes('folder')) {
                                                    fileIcon = 'https://img.icons8.com/?size=100&id=EoxnfFDqfEyw&format=png&color=29A6A7';
                                                    is_folder[index] = true;
                                                    is_image[index] = false;
                                                    is_other[index] = false;
                                                } else {
                                                    fileIcon = 'https://img.icons8.com/ios/50/9F9F9F/file.png';
                                                }
                                            } else {
                                                fileIcon = 'https://img.icons8.com/ios/50/9F9F9F/file.png';
                                            }
                                            //#endregion

                                            //#region formatage de la date
                                            let date = new Date(file.created_at);
                                            let day = date.getDate();
                                            let month = date.getMonth() + 1;
                                            let year = date.getFullYear();
                                            let created_at = `${day} ${getMonthName(month)} ${year}`;
                                            //#endregion

                                            //#region Récupérer le nom de l'auteur
                                            var author_email = file.author_email;
                                            var author = all_users_names.find(user => user.user_email === author_email) || '';
                                            var author_name = author.user_name || '---';
                                            //#endregion

                                            //#region Créer une ligne pour chaque trame
                                            var tr = document.createElement('tr');
                                            tr.style.border = '1px solid lightgray';
                                            tr.style.borderRadius = '25px';
                                            tr.style.backgroundColor = 'white';
                                            tr.title = file.file_name ? file.file_name : '---';
                                            tr.style.margin = '5px';
                                            tr.style.padding = '8px';
                                            tr.style.paddingRight = '10px';
                                            tr.style.marginBottom = '0px';
                                            tr.id = file.id + '_file';
                                            //#endregion

                                            // Changement de couleur de la ligne au survol
                                            tr.addEventListener('mouseover', function (e) {
                                                if (is_folder[index]) { // Si le fichier est un dossier
                                                    tr.style.border = '1px solid #DBB065';
                                                } else {
                                                    tr.style.border = '1px solid #6CE8E8';
                                                }
                                            });
                                            tr.addEventListener('mouseout', function (e) {
                                                tr.style.border = '1px solid lightgray';
                                            });

                                            tr.innerHTML = `
                                                <th style="font-weight: lighter; color: black; display: ${is_folder[index] ? 'flex' : 'none'};  justify-content: space-between;">
                                                    <div style="width: 100%; height: 50px; background-color: white; display: flex; justify-content: flex-start; cursor: pointer;" id="this_trame_folder_${file.id}">
                                                        <img src="https://img.icons8.com/?size=100&id=21094&format=png&color=DBB065" style="width: 40px; height: 40px; background-color: white;" alt="">
                                                        <div style="width: 6px;"></div>
                                                        <p class="long-file-name" style="color: black; margin-top: 15px;" >${file.folder_name ? file.folder_name : '---'}</p>
                                                    </div>
                                                </th>
                                                <!-- Afficher un aperçu de l'image -->
                                                <th style="font-weight: lighter; color: black; display: ${(is_image[index]) ? 'flex' : 'none'};  justify-content: space-between;">
                                                    <div style="width: 100%; height: 50px; border-radius: 50%; background-color: white; display: flex; justify-content: flex-start; cursor: pointer;" id="this_trame_preview_image_${file.id}">
                                                        ${file.file_link ? `<img src="${file.file_link}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">` : `<img src="https://img.icons8.com/ios/50/FFA500/image.png" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">`}
                                                        <div style="width: 6px;"></div>
                                                        <p class="long-file-name" style="color: black; margin-top: 15px;">${file.file_name ? file.file_name : '---'}</p>
                                                    </div>
                                                </th>
                                                <th style="font-weight: lighter; color: black; display: ${is_other[index] ? 'flex' : 'none'};  justify-content: space-between;"> 
                                                    <div id="this_trame_name_displayed_${file.id}" style="display: flex; justify-content: space-between;"> 
                                                        ${file.file_link ? `<iframe src="${file.file_link}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" title="file"></iframe>` : `<img src="${fileIcon}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">`}
                                                        <div style="width: 6px;"></div>
                                                        <p class="long-file-name" style="color: black; margin-top: 15px;">${file.file_name ? file.file_name : '---'}</p>
                                                    </div>
                                                    <!-- Menu de l'action à effectuer sur le document (Renommer) -->
                                                </th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${author_name}</th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${created_at}</th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${file.file_type ? `<img src="${fileIcon}" style="width: 20px; height: 20px;" alt="">` : '---'}</th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${fileSize}</th>
                                                <!-- Bouton pour télécharger le document et bouton pour supprimer le document -->
                                                <th style="color: #29A6A7; width: 100%; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 3px;">
                                                    <!-- Afficher l'animation de chargement -->
                                                    <div id="this_loading_delete_${file.id}" style="display: none; background: none;">
                                                        <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Suppression...">
                                                    </div>
                                                    <div style="width: 10px;"></div>
                                                    <a href="${file.file_link}" id="this_download_trame_${file.id}" download="${file.file_name}" style="display: ${is_folder[index] ? 'none' : 'flex'}; justify-content: space-between; text-decoration: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; background-color: #D6D6D641; align-self: center;" title="Télécharger">
                                                        <img src="https://img.icons8.com/ios/50/29A6A7/download.png" style="margin-left: 15px; width: 20px; height: 20px; cursor: pointer; align-self: center;" alt="Télécharger">
                                                    </a>
                                                    <div style="width: 10px;"></div>
                                                    <div style="display: flex; justify-content: space-between; width: 50px; height: 50px; border-radius: 50%; background-color: #D6D6D641; align-self: center;" id="this_this_file_menu_icon_${file.id}" title="Détails">
                                                        <img src="https://img.icons8.com/ios/50/9F9F9F/menu.png" style="margin-left: 15px; width: 20px; height: 20px; cursor: pointer; align-self: center;" alt="Détails" id="this_display_menu_${file.id}">
                                                    </div>
                                                    <!-- Menu de l'action à effectuer sur le document -->
                                                    <div  class="dropdown-menu" id="this_file_menu_${file.id}" style="display: none ; position: absolute; background-color: white; border-radius: 20px; padding: 5px; margin-top: 10px; margin-right: 10px; width: fit-content; align-self: center;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="this_display_file_${file.id}" title="Afficher">
                                                            <img src="https://img.icons8.com/ios/50/9F9F9F/visible.png" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Afficher dans un nouvel onglet">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: ${is_folder[index] ? 'lightgray' : 'gray'}; font-size: 12px; margin-top: 10px; font-weight: lighter;">Afficher</p>
                                                        </div>
                                                        <!--<hr style="border: 1px solid lightgray; width: 100%; margin: 5px;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="this_edit_file_${file.id}" title="Editer">
                                                            <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=9F9F9F" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Editer">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;">Renommer</p>
                                                        </div>
                                                        <hr style="border: 1px solid lightgray; width: 100%; margin: 5px;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="this_move_element_${file.id}" title="Editer">
                                                            <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=9F9F9F" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Editer">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;">Déplacer</p>
                                                        </div>-->
                                                        <hr style="border: 1px solid lightgray; width: 100%; margin: 5px;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="this_delete_trame_${file.id}" title="Supprimer">
                                                            ${userRole.includes('administrator') ? `<img src="https://img.icons8.com/ios/50/9F9F9F/trash.png" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Supprimer" id="this_delete_trame_icon_${file.id}">` : `<img src="https://img.icons8.com/ios/50/FF0000/lock.png" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Vous n'avez pas les droits" id="this_delete_trame_icon_${file.id}">`}
                                                            <div style="width: 10px;"></div>
                                                            ${userRole.includes('administrator') ? `<p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;" id="this_delete_trame_text_${file.id}">Supprimer</p>` : `<p style="color: lightgray; font-size: 12px; margin-top: 10px; font-weight: lighter;" title="Vous n'avez pas les droits">Supprimer</p>`}
                                                        </div>
                                                    </div>
                                                    <!-- Menu de l'action à effectuer sur le document ou le dossier (Déplacer dans un dossier) -->
                                                </th>
                                            `;
                                            tbody.appendChild(tr);

                                            // Changer la couleur de fond du bouton télécharger au survole de la souris
                                            document.getElementById('this_download_trame_' + file.id).addEventListener('mouseenter', function (e) {
                                                document.getElementById('this_download_trame_' + file.id).style.backgroundColor = '#29A7A73E';
                                            });

                                            // Remettre la couleur de fond du bouton télécharger à sa couleur initiale
                                            document.getElementById('this_download_trame_' + file.id).addEventListener('mouseleave', function (e) {
                                                document.getElementById('this_download_trame_' + file.id).style.backgroundColor = '#D6D6D641';
                                            });

                                            // Afficher le menu de l'action à effectuer sur le document
                                            document.getElementById('this_display_menu_' + file.id).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                document.getElementById('this_file_menu_' + file.id).style.display = 'block';
                                            });

                                            // Cacher le menu de l'action à effectuer sur le document au clic en dehors du menu
                                            document.addEventListener('click', function (e) {
                                                if (e.target.id !== 'this_display_menu_' + file.id) {
                                                    document.getElementById('this_file_menu_' + file.id).style.display = 'none';
                                                }
                                            });

                                            // Évènement pour supprimer un document
                                            document.getElementById('this_delete_trame_' + file.id).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                if (userRole.includes('administrator')) { // Si l'utilisateur est un administrateur
                                                    deleteTrame(file.id, file.file_link);
                                                }
                                            });

                                            // Évènement pour afficher un document
                                            document.getElementById('this_display_file_' + file.id).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                if (!is_folder[index]) {
                                                    window.open(file.file_link, '_blank');
                                                }
                                            });

                                        } else if (file.is_trame === '1' && file.project_id === project.project_id) { // Si le fichier est une trame et appartient au projet

                                            //#region Formater la taille du fichier
                                            var fileSize = '';
                                            if (file.file_size) { // Si la taille du fichier est définie

                                                var unformattedFileSize = parseInt(file.file_size); // Convertir la taille en entier

                                                if (unformattedFileSize < 1024) {
                                                    fileSize = unformattedFileSize + ' octets';
                                                }
                                                else if (unformattedFileSize < 1048576) {
                                                    fileSize = (unformattedFileSize / 1024).toFixed(2) + ' Ko';
                                                }
                                                else if (unformattedFileSize < 1073741824) {
                                                    fileSize = (unformattedFileSize / 1048576).toFixed(2) + ' Mo';
                                                }
                                                else {
                                                    fileSize = (unformattedFileSize / 1073741824).toFixed(2) + ' Go';
                                                }
                                            } else {
                                                fileSize = '---';
                                            }
                                            //#endregion

                                            //#region Afficher une icone à côté du nom du fichier selon son type
                                            var fileIcon = '';
                                            if (file.file_type) {
                                                if ((file.file_type).includes('pdf')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FF0000/pdf.png';
                                                    is_other[index] = true;
                                                    is_image[index] = false;
                                                    is_folder[index] = false;
                                                } else if ((file.file_type).includes('word')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/2E86C1/ms-word.png';
                                                    is_other[index] = true;
                                                    is_image[index] = false;
                                                    is_folder[index] = false;
                                                } else if ((file.file_type).includes('excel')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/1ABC9C/ms-excel.png';
                                                    is_other[index] = true;
                                                    is_image[index] = false;
                                                    is_folder[index] = false;
                                                } else if ((file.file_type).includes('powerpoint')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/ms-powerpoint.png';
                                                    is_other[index] = true;
                                                    is_image[index] = false;
                                                    is_folder[index] = false;
                                                } else if ((file.file_type).includes('image')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/image.png';
                                                    is_image[index] = true;
                                                    is_folder[index] = false;
                                                    is_other[index] = false;
                                                } else if ((file.file_type).includes('audio')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/audio.png';
                                                    is_other[index] = true;
                                                } else if ((file.file_type).includes('video')) {
                                                    fileIcon = 'https://img.icons8.com/ios/50/FFA500/video.png';
                                                    is_other[index] = true;
                                                } else if ((file.file_type).includes('folder')) {
                                                    fileIcon = 'https://img.icons8.com/?size=100&id=EoxnfFDqfEyw&format=png&color=29A6A7';
                                                    is_folder[index] = true;
                                                    is_image[index] = false;
                                                    is_other[index] = false;
                                                } else {
                                                    fileIcon = 'https://img.icons8.com/ios/50/9F9F9F/file.png';
                                                }
                                            } else {
                                                fileIcon = 'https://img.icons8.com/ios/50/9F9F9F/file.png';
                                            }
                                            //#endregion

                                            //#region formatage de la date
                                            let date = new Date(file.created_at);
                                            let day = date.getDate();
                                            let month = date.getMonth() + 1;
                                            let year = date.getFullYear();
                                            let created_at = `${day} ${getMonthName(month)} ${year}`;
                                            //#endregion

                                            //#region Récupérer le nom de l'auteur
                                            var author_email = file.author_email;
                                            var author = all_users_names.find(user => user.user_email === author_email) || '';
                                            var author_name = author.user_name || '---';
                                            //#endregion

                                            //#region Créer une ligne pour chaque trame
                                            var tr = document.createElement('tr');
                                            tr.style.border = '1px solid lightgray';
                                            tr.style.borderRadius = '25px';
                                            tr.style.backgroundColor = 'white';
                                            tr.title = file.file_name ? file.file_name : '---';
                                            tr.style.margin = '5px';
                                            tr.style.padding = '8px';
                                            tr.style.paddingRight = '10px';
                                            tr.style.marginBottom = '0px';
                                            tr.id = file.id + '_trame';
                                            //#endregion

                                            // Changement de couleur de la ligne au survol
                                            tr.addEventListener('mouseover', function (e) {
                                                if (is_folder[index]) { // Si le fichier est un dossier
                                                    tr.style.border = '1px solid #DBB065';
                                                } else {
                                                    tr.style.border = '1px solid #6CE8E8';
                                                }
                                                //document.getElementById('move_file_icon_' + trame.id).style.display = 'flex'; // Afficher l'icone de déplacement de fichier
                                            });
                                            tr.addEventListener('mouseout', function (e) {
                                                tr.style.border = '1px solid lightgray';
                                                //document.getElementById('move_file_icon_' + trame.id).style.display = 'none';
                                            });

                                            tr.innerHTML = `
                                                <th style="font-weight: lighter; color: black; display: ${is_folder[index] ? 'flex' : 'none'};  justify-content: space-between;">
                                                    <div style="width: 100%; height: 50px; background-color: white; display: flex; justify-content: flex-start; cursor: pointer;" id="this_trame_folder_${file.id}">
                                                        <img src="https://img.icons8.com/?size=100&id=21094&format=png&color=DBB065" style="width: 40px; height: 40px; background-color: white;" alt="">
                                                        <div style="width: 6px;"></div>
                                                        <p class="long-file-name" style="color: black; margin-top: 15px;" >${file.folder_name ? file.folder_name : '---'}</p>
                                                    </div>
                                                </th>
                                                <!-- Afficher un aperçu de l'image -->
                                                <th style="font-weight: lighter; color: black; display: ${(is_image[index]) ? 'flex' : 'none'};  justify-content: space-between;">
                                                    <div style="width: 100%; height: 50px; border-radius: 50%; background-color: white; display: flex; justify-content: flex-start; cursor: pointer;" id="this_trame_preview_image_${file.id}">
                                                        ${file.file_link ? `<img src="${file.file_link}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">` : `<img src="https://img.icons8.com/ios/50/FFA500/image.png" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">`}
                                                        <div style="width: 6px;"></div>
                                                        <p class="long-file-name" style="color: black; margin-top: 15px;">${file.file_name ? file.file_name : '---'}</p>
                                                    </div>
                                                </th>
                                                <th style="font-weight: lighter; color: black; display: ${is_other[index] ? 'flex' : 'none'};  justify-content: space-between;"> 
                                                    <div id="this_trame_name_displayed_${file.id}" style="display: flex; justify-content: space-between;"> 
                                                        ${file.file_link ? `<iframe src="${file.file_link}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" title="file"></iframe>` : `<img src="${fileIcon}" style="border: 1px solid lightgray; width: 50px; height: 50px; border-radius: 50%; background-color: white;" alt="">`}
                                                        <div style="width: 6px;"></div>
                                                        <p class="long-file-name" style="color: black; margin-top: 15px;">${file.file_name ? file.file_name : '---'}</p>
                                                    </div>
                                                    <!-- Menu de l'action à effectuer sur le document (Renommer) -->
                                                </th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${author_name}</th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${created_at}</th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${file.file_type ? `<img src="${fileIcon}" style="width: 20px; height: 20px;" alt="">` : '---'}</th>
                                                <th style="font-weight: lighter; color: black; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 15px; margin-top: 15px;"><div style="width: 20px;"></div>${fileSize}</th>
                                                <!-- Bouton pour télécharger le document et bouton pour supprimer le document -->
                                                <th style="color: #29A6A7; width: 100%; display: flex; justify-content: flex-end; margin-left: 15px; margin-right: 3px;">
                                                    <!-- Afficher l'animation de chargement -->
                                                    <div id="this_loading_delete_${file.id}" style="display: none; background: none;">
                                                        <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Suppression...">
                                                    </div>
                                                    <div style="width: 10px;"></div>
                                                    <a href="${file.file_link}" id="this_download_trame_${file.id}" download="${file.file_name}" style="display: ${is_folder[index] ? 'none' : 'flex'}; justify-content: space-between; text-decoration: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; background-color: #D6D6D641; align-self: center;" title="Télécharger">
                                                        <img src="https://img.icons8.com/ios/50/29A6A7/download.png" style="margin-left: 15px; width: 20px; height: 20px; cursor: pointer; align-self: center;" alt="Télécharger">
                                                    </a>
                                                    <div style="width: 10px;"></div>
                                                    <div style="display: flex; justify-content: space-between; width: 50px; height: 50px; border-radius: 50%; background-color: #D6D6D641; align-self: center;" id="this_this_file_menu_icon_${file.id}" title="Détails">
                                                        <img src="https://img.icons8.com/ios/50/9F9F9F/menu.png" style="margin-left: 15px; width: 20px; height: 20px; cursor: pointer; align-self: center;" alt="Détails" id="this_display_menu_${file.id}">
                                                    </div>
                                                    <!-- Menu de l'action à effectuer sur le document -->
                                                    <div  class="dropdown-menu" id="this_file_menu_${file.id}" style="display: none ; position: absolute; background-color: white; border-radius: 20px; padding: 5px; margin-top: 10px; margin-right: 10px; width: fit-content; align-self: center;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="this_display_file_${file.id}" title="Afficher">
                                                            <img src="https://img.icons8.com/ios/50/9F9F9F/visible.png" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Afficher dans un nouvel onglet">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: ${is_folder[index] ? 'lightgray' : 'gray'}; font-size: 12px; margin-top: 10px; font-weight: lighter;">Afficher</p>
                                                        </div>
                                                        <!--<hr style="border: 1px solid lightgray; width: 100%; margin: 5px;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="this_edit_file_${file.id}" title="Editer">
                                                            <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=9F9F9F" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Editer">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;">Renommer</p>
                                                        </div>
                                                        <hr style="border: 1px solid lightgray; width: 100%; margin: 5px;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="this_move_element_${file.id}" title="Editer">
                                                            <img src="https://img.icons8.com/?size=100&id=6697&format=png&color=9F9F9F" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Editer">
                                                            <div style="width: 10px;"></div>
                                                            <p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;">Déplacer</p>
                                                        </div>-->
                                                        <hr style="border: 1px solid lightgray; width: 100%; margin: 5px;">
                                                        <div style="display: flex; justify-content: space-between; width: fit-content; border-radius: 15px; cursor: pointer; align-self: center; margin-left: 20px; margin: 5px; padding: 5px;" id="this_delete_trame_${file.id}" title="Supprimer">
                                                            ${userRole.includes('administrator') ? `<img src="https://img.icons8.com/ios/50/9F9F9F/trash.png" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Supprimer" id="this_delete_trame_icon_${file.id}">` : `<img src="https://img.icons8.com/ios/50/FF0000/lock.png" style="width: 20px; height: 20px; cursor: pointer; margin-top: 10px;" alt="Vous n'avez pas les droits" id="this_delete_trame_icon_${file.id}">`}
                                                            <div style="width: 10px;"></div>
                                                            ${userRole.includes('administrator') ? `<p style="color: gray; font-size: 12px; margin-top: 10px; font-weight: lighter;" id="this_delete_trame_text_${file.id}">Supprimer</p>` : `<p style="color: lightgray; font-size: 12px; margin-top: 10px; font-weight: lighter;" title="Vous n'avez pas les droits">Supprimer</p>`}
                                                        </div>
                                                    </div>
                                                    <!-- Menu de l'action à effectuer sur le document ou le dossier (Déplacer dans un dossier) -->
                                                </th>
                                            `;
                                            tbody_trames.appendChild(tr); // Ajouter la ligne à la table

                                            // Changer la couleur de fond du bouton télécharger au survole de la souris
                                            document.getElementById('this_download_trame_' + file.id).addEventListener('mouseenter', function (e) {
                                                document.getElementById('this_download_trame_' + file.id).style.backgroundColor = '#29A7A73E';
                                            });

                                            // Remettre la couleur de fond du bouton télécharger à sa couleur initiale
                                            document.getElementById('this_download_trame_' + file.id).addEventListener('mouseleave', function (e) {
                                                document.getElementById('this_download_trame_' + file.id).style.backgroundColor = '#D6D6D641';
                                            });

                                            // Afficher le menu de l'action à effectuer sur le document
                                            document.getElementById('this_display_menu_' + file.id).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                document.getElementById('this_file_menu_' + file.id).style.display = 'block';
                                            });

                                            // Cacher le menu de l'action à effectuer sur le document au clic en dehors du menu
                                            document.addEventListener('click', function (e) {
                                                if (e.target.id !== 'this_display_menu_' + file.id) {
                                                    document.getElementById('this_file_menu_' + file.id).style.display = 'none';
                                                }
                                            });

                                            // Évènement pour supprimer un document
                                            document.getElementById('this_delete_trame_' + file.id).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                if (userRole.includes('administrator')) {
                                                    deleteTrame(file.id, file.file_link);
                                                }
                                            });

                                            // Évènement pour afficher le document dans un nouvel onglet
                                            document.getElementById('this_display_file_' + file.id).addEventListener('click', function (e) {
                                                e.preventDefault();
                                                if (!is_folder[index]) {
                                                    window.open(file.file_link, '_blank');
                                                }
                                            });
                                        }

                                        // fonction pour supprimer un document
                                        function deleteTrame(file_id, file_link) {


                                            document.getElementById('this_loading_delete_' + file_id).style.display = 'block'; // Afficher l'animation de chargement

                                            // Supprimer le document du serveur
                                            fetch(ajaxurl, {
                                                method: 'POST',
                                                body: new URLSearchParams({
                                                    action: 'delete_file_callback',
                                                    file_url: file_link, // Lien du fichier à supprimer
                                                }),
                                            })
                                                .then(response => response.json())
                                                .then(data => {
                                                    if (data.success) {
                                                        console.log('Success:', data);
                                                    } else {
                                                        console.log('Error:', data.data);
                                                    }
                                                })
                                                .catch(error => console.error('Error:', error));

                                            fetch('https://lab.padem.org/wp-json/mo/v1/removeProjectFile', {
                                                method: 'DELETE',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({
                                                    column_param1: file_id
                                                })
                                            })
                                                .then(response => response.json())
                                                .then(data => {
                                                    if (data) {
                                                        // Supprimer le document de la table
                                                        document.getElementById(file_id).remove(); // Supprimer la ligne de la table
                                                        document.getElementById('this_loading_delete_' + file_id).style.display = 'none'; // Cacher l'animation de chargement
                                                    }
                                                })
                                                .catch(error => {
                                                    console.error(error);
                                                    document.getElementById('this_loading_delete_' + file_id).style.display = 'none'; // Cacher l'animation de chargement
                                                });
                                        }

                                    });
                                    if (tbody.innerHTML === '') { // Si aucun document trouvé
                                        let tr = document.createElement('tr');
                                        tr.innerHTML = `
                                            <td colspan="6" style="text-align: center; color: gray;"> <img src="https://img.icons8.com/?size=100&id=3574&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">
                                                Aucun document trouvé.</td>
                                        `;
                                        tbody.appendChild(tr);
                                    }
                                    if (tbody_trames.innerHTML === '') { // Si aucun document trame n'est trouvé
                                        let tr = document.createElement('tr');
                                        tr.innerHTML = `
                                            <td colspan="6" style="text-align: center; color: gray;"> <img src="https://img.icons8.com/?size=100&id=3574&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">
                                                Aucun document trame trouvé.</td>
                                        `;
                                        tbody_trames.appendChild(tr);
                                    }
                                } else {
                                    let tr = document.createElement('tr');
                                    tr.innerHTML = `
                                        <td colspan="6" style="text-align: center; color: gray;"> <img src="https://img.icons8.com/?size=100&id=3574&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">
                                            Aucun document trouvé.</td>
                                    `;
                                    tbody.appendChild(tr);
                                }
                            })
                            .catch(error => {
                                console.error(error);
                                let tr = document.createElement('tr');
                                tr.innerHTML = `
                                    <td colspan="6" style="text-align: center; color: gray;"> <img src="https://img.icons8.com/?size=100&id=3574&format=png&color=9F9F9F" style="width: 20px; height: 20px;" alt="">
                                        Aucun document trouvé.</td>
                                `;
                                tbody.appendChild(tr);
                                tbody_trames.appendChild(tr);
                            });
                    })
                    .catch(error => console.error(error));
            }
            //#endregion

            //#region Fonction pour afficher les membres du projet (https://lab.padem.org/wp-json/mo/v1/getAllMembers & https://lab.padem.org/wp-json/mo/v1/getLocalUser)
            displayProjectMembers(); // Afficher les membres du projet
            function displayProjectMembers() {
                var user_role_and_location = [];
                fetch('https://lab.padem.org/wp-json/mo/v1/getLocalUser')
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            var _IDs = new Array(data.length);
                            var _IDs_location = new Array(data.length);
                            var _roles = new Array(data.length);
                            var _locations = new Array(data.length);
                            data.forEach(user => {
                                if (user.meta_key === 'wp_capabilities') {
                                    if (user.meta_value.includes('administrator')) {
                                        _IDs.push(user.ID);
                                        _roles.push('Administrateur');
                                    } else if (user.meta_value.includes('partenaire')) {
                                        _IDs.push(user.ID);
                                        _roles.push('Partenaire');
                                    } else if (user.meta_value.includes('subscriber')) {
                                        _IDs.push(user.ID);
                                        _roles.push('Partenaire');
                                    }
                                } else if (user.meta_key === 'locale') {
                                    _IDs_location.push(user.ID);
                                    _locations.push(user.meta_value);
                                }
                            });
                            if (_IDs.length > 0) {
                                for (let i = 0; i < _IDs.length; i++) {
                                    user_role_and_location.push({
                                        ID: _IDs[i],
                                        role: _roles[i],
                                        location: _locations[i]
                                    });
                                }
                            }
                        }
                        // Get members of the project from WordPress REST API(https://lab.padem.org/wp-json/mo/v1/getWorkingTable)
                        fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable',
                            {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json',
                                }
                            })
                            .then(response => response.json())
                            .then(project_members => {
                                var project_members_list = [];
                                var working_table_id = '';
                                project_members.forEach(member => {
                                    // Récupérer les membres du projet
                                    if (member.project_id === project.project_id) {
                                        working_table_id = member.Working_Table_Id;
                                        project_members_list.push(JSON.parse(member.users_emails_list)); // Récupérer les membres du projet
                                    }
                                });

                                // Get members of the project from WordPress REST API(https://lab.padem.org/wp-json/mo/v1/getAllMembers)
                                //#region Récupérer les membres du projet
                                var project_id = project.project_id;
                                var url = 'https://lab.padem.org/wp-json/mo/v1/getAllMembers';
                                var options = {
                                    method: 'GET',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    }
                                };
                                fetch(url, options)
                                    .then(response => response.json())
                                    .then(data => {
                                        var display_project_members = document.getElementById('this_display_project_members_' + project.project_id); // Afficher les membres du projet
                                        display_project_members.innerHTML = '';
                                        members.forEach(member => {
                                            var tr = document.createElement('tr');
                                            var member_id = member.ID;
                                            var member_name = member.display_name ? member.display_name : '----';
                                            var member_mail = member.user_email ? member.user_email : '----';
                                            var member_country = user_role_and_location.find(user => user.ID === member_id).location ?? '----';  // Récupérer le pays de l'utilisateur
                                            var member_association = member.member_association ? member.member_association : '----';
                                            var member_role = user_role_and_location.find(user => user.ID === member_id).role ?? '----'; // Récupérer le rôle de l'utilisateur 
                                            tr.id = 'member_' + member_id;
                                            tr.style.fontSize = '12px';
                                            tr.style.fontWeight = 'lighter';
                                            tr.style.color = 'gray';
                                            tr.style.borderBottom = '1px solid #f2f2f2';
                                            tr.addEventListener('mouseover', function () {
                                                tr.style.backgroundColor = '#f2f2f2';
                                            });
                                            tr.addEventListener('mouseout', function () {
                                                tr.style.backgroundColor = 'white';
                                            });
                                            display_project_members.appendChild(tr);
                                            tr.innerHTML = `
                                            <tr>
                                                <td>${member_name}</td>
                                                <td>${member_mail}</td>
                                                <td>${member_country}</td>
                                                <td>${member_association}</td>
                                                <td>${member_role}</td>
                                                <td>
                                                    <!-- Animation de chargement -->
                                                    <div id="loading_${member_id}_" style="display: none;">
                                                        <img src="https://img.icons8.com/?size=100&id=104&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">
                                                    </div>
                                                    <!-- Indiquer si le membre est déjà ajouté au projet -->
                                                    ${project_members_list.includes(member_mail) ? '<span style="color: green;">Ajouté</span>' : '<span style="color: red;">Non ajouté</span>'}
                                                    <!-- Ajouter le membre au projet si ce dernier n'est pas encore ajouté -->
                                                    ${project_members_list.includes(member_mail) ? '' : '<button id="add_member_to_this_project_' + member_id + '" class="btn btn-primary" style="font-size: 12px; padding: 2px 5px;">Ajouter</button>'}
                                                    <!-- Supprimer le membre du projet si ce dernier est déjà ajouté -->
                                                    ${project_members_list.includes(member_mail) ? '<button id="remove_member_from_this_project_' + member_id + '" class="btn btn-danger" style="font-size: 12px; padding: 2px 5px;">Supprimer</button>' : ''}
                                                </td>
                                            </tr>
                                        `;

                                            // Ajouter un membre au projet
                                            document.getElementById('add_member_to_this_project_' + member_id).addEventListener('click', function () {

                                                // Animation de chargement
                                                document.getElementById('loading_' + member_id + '_').style.display = 'block';

                                                // Ajouter le membre au projet
                                                fetch('https://lab.padem.org/wp-json/mo/v1/createWorkingTable',
                                                    {
                                                        method: 'POST',
                                                        headers: {
                                                            'Content-Type': 'application/json',
                                                        },
                                                        body: JSON.stringify({
                                                            project_id: project.project_id,
                                                            users_emails_list: JSON.stringify(project_members_list.push(member_mail))
                                                        })
                                                    })
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        console.log('Success:', data);
                                                        // Supprimer l'ancienne version de la liste des membres du projet
                                                        fetch('https://lab.padem.org/wp-json/mo/v1/removeWorkingTable',
                                                            {
                                                                method: 'DELETE',
                                                                headers: {
                                                                    'Content-Type': 'application/json',
                                                                },
                                                                body: JSON.stringify({
                                                                    column_param1: parseInt(working_table_id) // Supprimer l'ancienne version de la liste des membres du projet
                                                                })
                                                            })
                                                            .then(response => response.json())
                                                            .then(data => {
                                                                if (data.success) {
                                                                    // Masquer l'animation de chargement
                                                                    document.getElementById('loading_' + member_id + '_').style.display = 'none';
                                                                }
                                                            })
                                                            .catch(error => {
                                                                console.error('Erreur:', error);
                                                                // Masquer l'animation de chargement
                                                                document.getElementById('loading_' + member_id + '_').style.display = 'none';
                                                            });
                                                    });
                                            });

                                            // Supprimer un membre du projet
                                            document.getElementById('remove_member_from_this_project_' + member_id).addEventListener('click', function () {

                                                // Animation de chargement
                                                document.getElementById('loading_' + member_id + '_').style.display = 'block';
                                                var new_members_list = [];
                                                project_members_list.forEach(member => {
                                                    if (member !== member_mail) {
                                                        new_members_list.push(member);
                                                    }
                                                });

                                                // Supprimer le membre du projet
                                                fetch('https://lab.padem.org/wp-json/mo/v1/createWorkingTable',
                                                    {
                                                        method: 'POST',
                                                        headers: {
                                                            'Content-Type': 'application/json',
                                                        },
                                                        body: JSON.stringify({
                                                            project_id: project.project_id,
                                                            users_emails_list: JSON.stringify(new_members_list)
                                                        })
                                                    })
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        console.log('Success:', data);
                                                        // Supprimer l'ancienne version de la liste des membres du projet
                                                        fetch('https://lab.padem.org/wp-json/mo/v1/removeWorkingTable',
                                                            {
                                                                method: 'DELETE',
                                                                headers: {
                                                                    'Content-Type': 'application/json',
                                                                },
                                                                body: JSON.stringify({
                                                                    column_param1: parseInt(working_table_id) // Supprimer l'ancienne version de la liste des membres du projet
                                                                })
                                                            })
                                                            .then(response => response.json())
                                                            .then(data => {
                                                                if (data.success) {
                                                                    // Masquer l'animation de chargement
                                                                    document.getElementById('loading_' + member_id + '_').style.display = 'none';
                                                                }
                                                            })
                                                            .catch(error => {
                                                                console.error('Erreur:', error);
                                                                // Masquer l'animation de chargement
                                                                document.getElementById('loading_' + member_id + '_').style.display = 'none';
                                                            });
                                                    });
                                            });
                                        });
                                    })
                                    .catch(error => {
                                        console.error('Erreur:', error);
                                        // Masquer l'animation de chargement
                                        document.getElementById('loading_' + member_id + '_').style.display = 'none';
                                    });
                                //#endregion

                            })
                            .catch(error => {
                                console.error('Erreur:', error);
                            });
                    })
                    .catch(error => {
                        console.error('Erreur:', error);
                    });
            }
            //#endregion

            //#region Ajouter des écouteurs d'événements pour les boutons (entré/sortie de la souris) pour afficher le nom du bouton
            document.getElementById('add_document_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_document_to_project').innerHTML = 'Ajouter un Document';
                document.getElementById('add_document_to_project').style.color = 'white';
                document.getElementById('add_document_to_project').style.fontSize = '12px';
                document.getElementById('add_document_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_document_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_document_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=57052&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_document_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('add_report_to_project').addEventListener('mouseover', function () {
                document.getElementById('add_report_to_project').innerHTML = 'Ajouter un Rapport';
                document.getElementById('add_report_to_project').style.color = 'white';
                document.getElementById('add_report_to_project').style.fontSize = '12px';
                document.getElementById('add_report_to_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('add_report_to_project').addEventListener('mouseout', function () {
                document.getElementById('add_report_to_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=5271&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('add_report_to_project').style.backgroundColor = 'white';
            });

            document.getElementById('display_this_project').addEventListener('mouseover', function () {
                document.getElementById('display_this_project').innerHTML = 'Afficher le Projet';
                document.getElementById('display_this_project').style.color = 'white';
                document.getElementById('display_this_project').style.fontSize = '12px';
                document.getElementById('display_this_project').style.backgroundColor = '#29A6A7';
            });
            document.getElementById('display_this_project').addEventListener('mouseout', function () {
                document.getElementById('display_this_project').innerHTML = '<img src="https://img.icons8.com/?size=100&id=h88n73Ss5iTI&format=png&color=29A6A7" style="width: 20px; height: 20px;" alt="">';
                document.getElementById('display_this_project').style.backgroundColor = 'white';
            });

            if (userRole.includes('administrator')) {
                document.getElementById('archive_Project_').addEventListener('mouseover', function () {
                    document.getElementById('archive_Project_').innerHTML = 'Archiver le Projet';
                    document.getElementById('archive_Project_').style.color = 'white';
                    document.getElementById('archive_Project_').style.fontSize = '12px';
                    document.getElementById('archive_Project_').style.backgroundColor = 'red';
                });
                document.getElementById('archive_Project_').addEventListener('mouseout', function () {
                    document.getElementById('archive_Project_').innerHTML = '<img src="https://img.icons8.com/?size=100&id=12634&format=png&color=FA5252" style="width: 20px; height: 20px;" alt="">';
                    document.getElementById('archive_Project_').style.backgroundColor = 'white';
                });
            }
            //#endregion

            //#region Ajouter des écouteurs d'événements "click" pour les boutons (ajouter un document, un rapport et archiver le projet)
            document.getElementById('add_document_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                // Mettre en surbrillance le bouton cliqué
                document.getElementById('add_document_to_project').style.border = '1px solid #29A6A7';
                document.getElementById('add_report_to_project').style.border = 'none';
                document.getElementById('display_this_project').style.border = 'none';
                // Afficher le formulaire pour ajouter un document
                document.getElementById('_menu_add_document_' + project.project_id).style.display = 'block';
                // Masquer tous les autres formulaires
                document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
                document.getElementById('first_menu_' + project.project_id).style.display = 'none';
            });
            document.getElementById('add_report_to_project').addEventListener('click', function (e) {
                e.preventDefault();
                // Mettre en surbrillance le bouton cliqué
                document.getElementById('add_report_to_project').style.border = '1px solid #29A6A7';
                document.getElementById('add_document_to_project').style.border = 'none';
                document.getElementById('display_this_project').style.border = 'none';
                // Afficher le formulaire pour ajouter un rapport
                document.getElementById('_menu_add_report_' + project.project_id).style.display = 'block';
                // Masquer tous les autres formulaires
                document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                document.getElementById('first_menu_' + project.project_id).style.display = 'none';
            });
            document.getElementById('display_this_project').addEventListener('click', function (e) {
                e.preventDefault();
                // Mettre en surbrillance le bouton cliqué
                document.getElementById('display_this_project').style.border = '1px solid #29A6A7';
                document.getElementById('add_document_to_project').style.border = 'none';
                document.getElementById('add_report_to_project').style.border = 'none';
                // Afficher le projet
                document.getElementById('first_menu_' + project.project_id).style.display = 'block';
                // Masquer tous les autres formulaires
                document.getElementById('_menu_add_document_' + project.project_id).style.display = 'none';
                document.getElementById('_menu_add_report_' + project.project_id).style.display = 'none';
            });

            if (userRole.includes('administrator')) {
                document.getElementById('archive_Project_').addEventListener('click', function (e) {
                    e.preventDefault();
                    // Afficher l'anime de chargement
                    document.getElementById('loading').style.display = 'block';
                    // Archiver le projet
                    // Get Projet ID
                    fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData',
                        {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            var projectId = data.find(_project => _project.project_id === project.project_id).id;
                            // Mettre à jour le projet
                            fetch('https://lab.padem.org/wp-json/mo/v1/createProjectData',
                                {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        project_id: projectId,
                                        project_title: project.project_title,
                                        project_type: project.project_type,
                                        start_date: project.start_date,
                                        end_date: project.end_date,
                                        is_archive: 1, // Archiver le projet
                                        updated_date: new Date(),
                                        project_location: project.project_location,
                                        project_status: 'Archivé',
                                        project_referent: project.project_referent,
                                        project_referent_email: project.project_referent_email,
                                        project_description: project.project_description,
                                        background_image_link: project.background_image_link,
                                        users: project.users,
                                        reports: project.reports,
                                        folders: project.folders,
                                        divers: project.divers,
                                    })
                                })
                                .then(response => response.json())
                                .then(data => {
                                    // Supprimer le projet de la liste des projets
                                    fetch('https://lab.padem.org/wp-json/mo/v1/removeProjectData',
                                        {
                                            method: 'DELETE',
                                            headers: {
                                                'Content-Type': 'application/json',
                                            },
                                            body: JSON.stringify({ column_param1: project.id })
                                        })
                                        .then(response => response.json())
                                        .then(data => {
                                            getProjects();
                                            displayAllArchivesProjects();
                                            displayArchivesReports();
                                            document.getElementById('all_projects_table').style.display = 'block';
                                            document.getElementById('project_details').style.display = 'none';
                                            // Masquer l'anime de chargement
                                            document.getElementById('loading').style.display = 'none';
                                        })
                                        .catch((error) => {
                                            console.error('Error:', error);
                                            // Masquer l'anime de chargement
                                            document.getElementById('loading').style.display = 'none';
                                        });
                                })
                                .catch((error) => {
                                    console.error('Error:', error);
                                    // Masquer l'anime de chargement
                                    document.getElementById('loading').style.display = 'none';
                                });
                        });
                });
            }
            //#endregion

            //#region Évènement pour afficher/masquer (report_type_other_) si le type de rapport est "Autre"
            document.getElementById('report_type_' + project.project_id).addEventListener('change', function () {
                if (document.getElementById('report_type_' + project.project_id).value === 'Autre') {
                    document.getElementById('report_type_other_container_' + project.project_id).style.display = 'block';
                } else {
                    document.getElementById('report_type_other_container_' + project.project_id).style.display = 'none';
                }
            });
            //#endregion

            //#region Pour ajouter un document au projet
            document.getElementById('onglet_files_send_' + project.project_id).addEventListener('click', function (e) {
                e.preventDefault();

                // Récupérer le type de fichier (trame ou non)
                let files_type_trame = document.getElementById('files_file_type_' + project.project_id).value;

                // Récupérer le fichier
                let fichier_file = document.getElementById('files_file_1_' + project.project_id).files[0];
                let fichier_file_name = fichier_file.name;
                let fichier_file_type = fichier_file.type;
                let fichier_file_size = fichier_file.size;

                // Récupérer l'adresse email de l'utilisateur connecté
                let userEmail = current_user_data.email;

                // Vérifier si les champs sont vides
                if (fichier_file.length === 0) {
                    alert('Veuillez ajouter un fichier.');
                    return;
                }

                // Afficher l'avancement du chargement
                document.getElementById('loading').style.display = 'block';

                // Créer un objet FormData
                let formData = new FormData();
                formData.append('file', fichier_file);
                formData.append('action', 'handle_file_upload');

                // Envoyer le fichier au serveur
                fetch(ajaxurl, {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            //#region Envoi des données du fichier à la base de données
                            fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFile', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    project_id: project.project_id,
                                    file_name: ((data.data.url).split('/')).pop(), // Nom du fichier
                                    file_type: fichier_file_type,
                                    file_link: data.data.url, // Lien du fichier
                                    file_size: fichier_file_size,
                                    author_email: userEmail,
                                    folder_name: '', // Dossier de destination
                                    is_folder: false,
                                    is_in_folder: false,
                                    folder_link: '',
                                    is_trame: files_type_trame === '1' ? true : false,
                                    created_at: new Date(Date.now()) // Date de création
                                }),
                            })
                                .then((response) => response.json())
                                .then((data) => {
                                    // Masquer l'avancement du chargement
                                    document.getElementById('loading').style.display = 'none';
                                    // Recharger les fichiers
                                    displayFiles();
                                    displayProjectDocuments();

                                    // Vider les champs du formulaire
                                    document.getElementById('files_file_1_' + project.project_id).value = '';
                                    document.getElementById('files_file_type_' + project.project_id).value = '0';
                                })
                                .catch((error) => {
                                    console.error('Error:', error);
                                    // Masquer l'avancement du chargement
                                    document.getElementById('loading').style.display = 'none';
                                });
                            //#endregion
                        } else {
                            console.log('Error:', data.data);
                            // Masquer l'avancement du chargement
                            document.getElementById('loading').style.display = 'none';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // Masquer l'avancement du chargement
                        document.getElementById('loading').style.display = 'none';
                    });
            });
            //#endregion

            //#region pour annuler l'ajout d'un document
            document.getElementById('onglet_files_cancel_' + project.project_id).addEventListener('click', function (e) {
                e.preventDefault();
                // Vider les champs du formulaire
                document.getElementById('files_file_1_' + project.project_id).value = '';
                document.getElementById('files_file_type_' + project.project_id).value = '0';
            });
            //#endregion

            //#region pour Ajouter un rapport au projet
            document.getElementById('this_project_add_report_' + project.project_id).addEventListener('click', function (e) {
                e.preventDefault();

                // Afficher l'avancement du chargement
                document.getElementById('loading').style.display = 'block';

                // Récupérer les données du formulaire
                let report_title = document.getElementById('report_title_' + project.project_id).value;
                let report_date = document.getElementById('report_date_' + project.project_id).value;
                let report_type = document.getElementById('report_type_' + project.project_id).value;
                let report_type_other = document.getElementById('report_type_other_' + project.project_id).value;
                let report_description = document.getElementById('report_comments_' + project.project_id).value;

                // Récupérer les fichiers du rapport si nécessaire
                let document_1 = document.getElementById('report_file_1_' + project.project_id).files[0];
                let document_2 = document.getElementById('report_file_2_' + project.project_id).files[0] ?? '';
                let document_3 = document.getElementById('report_file_3_' + project.project_id).files[0] ?? '';
                let document_4 = document.getElementById('report_file_4_' + project.project_id).files[0] ?? '';

                // Vérifier si les champs sont vides
                if (report_title === '' || report_date === '' || report_type === '0' || document_1 === undefined) {
                    alert('Veuillez remplir tous les champs obligatoires.');
                    return;
                }

                let document_1_name = document_1.name;
                let document_1_type = document_1.type;
                let document_1_size = document_1.size;

                // Récupérer l'adresse email de l'utilisateur connecté
                let userEmail = current_user_data.email;

                // Envoyer les fichiers au serveur
                let formData = new FormData();
                formData.append('file_1', document_1);
                if (document_2 !== '') {
                    let _formData_2 = new FormData();
                    _formData_2.append('file_2', document_2);
                    _formData_2.append('action', 'handle_file_upload');

                    // Envoyer le fichier 2 au serveur
                    fetch(ajaxurl, {
                        method: 'POST',
                        body: _formData_2,
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                console.log('URL:', data.data);
                                // Envoi des données des fichier à la base de données(Document 2)
                                fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFile', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        project_id: project.project_id,
                                        file_name: ((data.data.url).split('/')).pop(), // Nom du fichier
                                        file_type: document_2.type,
                                        file_link: data.data.url, // Lien du fichier
                                        file_size: document_2.size,
                                        author_email: userEmail,
                                        folder_name: '', // Dossier de destination
                                        is_folder: false,
                                        is_in_folder: false,
                                        folder_link: '',
                                        is_trame: false,
                                        created_at: new Date(Date.now()) // Date de création
                                    }),
                                })
                                    .then((response) => response.json())
                                    .then((data) => {
                                        console.log('Success:', data);
                                    })
                                    .catch((error) => {
                                        console.error('Error:', error);
                                    });
                            } else {
                                console.log('Error:', data.data);
                            }
                        })
                        .catch(error => console.error('Error:', error));
                }
                if (document_3 !== '') {
                    let _formData_3 = new FormData();
                    _formData_3.append('file_3', document_3);
                    _formData_3.append('action', 'handle_file_upload');

                    // Envoyer le fichier 3 au serveur
                    fetch(ajaxurl, {
                        method: 'POST',
                        body: _formData_3,
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                console.log('URL:', data.data);
                                // Envoi des données des fichier à la base de données(Document 3)
                                fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFile', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        project_id: project.project_id,
                                        file_name: ((data.data.url).split('/')).pop(), // Nom du fichier
                                        file_type: document_3.type,
                                        file_link: data.data.url, // Lien du fichier
                                        file_size: document_3.size,
                                        author_email: userEmail,
                                        folder_name: '', // Dossier de destination
                                        is_folder: false,
                                        is_in_folder: false,
                                        folder_link: '',
                                        is_trame: false,
                                        created_at: new Date(Date.now()) // Date de création
                                    }),
                                })
                                    .then((response) => response.json())
                                    .then((data) => {
                                        console.log('Success:', data);
                                    })
                                    .catch((error) => {
                                        console.error('Error:', error);
                                    });
                            } else {
                                console.log('Error:', data.data);
                            }
                        })
                        .catch(error => console.error('Error:', error));
                }
                if (document_4 !== '') {
                    let _formData_4 = new FormData();
                    _formData_4.append('file_4', document_4);
                    _formData_4.append('action', 'handle_file_upload');

                    // Envoyer le fichier 4 au serveur
                    fetch(ajaxurl, {
                        method: 'POST',
                        body: _formData_4,
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                console.log('URL:', data.data);
                                // Envoi des données des fichier à la base de données(Document 4)
                                fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFile', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        project_id: project.project_id,
                                        file_name: ((data.data.url).split('/')).pop(), // Nom du fichier
                                        file_type: document_4.type,
                                        file_link: data.data.url, // Lien du fichier
                                        file_size: document_4.size,
                                        author_email: userEmail,
                                        folder_name: '', // Dossier de destination
                                        is_folder: false,
                                        is_in_folder: false,
                                        folder_link: '',
                                        is_trame: false,
                                        created_at: new Date(Date.now()) // Date de création
                                    }),
                                })
                                    .then((response) => response.json())
                                    .then((data) => {
                                        console.log('Success:', data);
                                    })
                                    .catch((error) => {
                                        console.error('Error:', error);
                                    });
                            } else {
                                console.log('Error:', data.data);
                            }
                        })
                        .catch(error => console.error('Error:', error));
                }

                // Masquer l'avancement du chargement
                // Envoi des données du rapport à la base de données
                fetch('https://lab.padem.org/wp-json/mo/v1/createReport', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        project_id: project.project_id,
                        report_title: report_title,
                        report_date: report_date,
                        report_type: report_type === 'Autre' ? report_type_other : report_type,
                        report_status: 'En cours',
                        file_id_list: [], // Liste des fichiers du rapport
                    }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        // Masquer l'avancement du chargement
                        document.getElementById('loading').style.display = 'none';
                        // Recharger les rapports
                        displayReports();

                        //#region Vider les champs du formulaire
                        document.getElementById('report_title_' + project.project_id).value = '';
                        document.getElementById('report_date_' + project.project_id).value = '';
                        document.getElementById('report_type_' + project.project_id).value = '0';
                        document.getElementById('report_type_other_' + project.project_id).value = '';
                        document.getElementById('report_comments_' + project.project_id).value = '';
                        document.getElementById('report_file_1_' + project.project_id).value = '';
                        document.getElementById('report_file_2_' + project.project_id).value = '';
                        document.getElementById('report_file_3_' + project.project_id).value = '';
                        document.getElementById('report_file_4_' + project.project_id).value = '';
                        //#endregion
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                        // Masquer l'avancement du chargement
                        document.getElementById('loading').style.display = 'none';
                    });
            });
            //#endregion

            //#region Annuler l'ajout d'un rapport
            document.getElementById('this_project_cancel_add_report_' + project.project_id).addEventListener('click', function (e) {
                e.preventDefault();
                // Vider les champs du formulaire
                document.getElementById('report_title_' + project.project_id).value = '';
                document.getElementById('report_date_' + project.project_id).value = '';
                document.getElementById('report_type_' + project.project_id).value = '0';
                document.getElementById('report_type_other_' + project.project_id).value = '';
                document.getElementById('report_comments_' + project.project_id).value = '';
                document.getElementById('report_file_1_' + project.project_id).value = '';
                document.getElementById('report_file_2_' + project.project_id).value = '';
                document.getElementById('report_file_3_' + project.project_id).value = '';
                document.getElementById('report_file_4_' + project.project_id).value = '';
            });
            //#endregion
        }
        //#endregion

        //#region Afficher le rapport correspondant à l'ID
        function displayReport(reportId) {
            let report = reports.find(report => report.report_id === reportId);
            let displayReport = document.getElementById('all_projects_table');
            displayReport.innerHTML = '';
            displayReport.innerHTML = `
                <article class="report">
                    <div style="display: flex; justify-content: space-between;">
                        <button type="button" class="btn btn-primary" id="backToProjects" onclick="getProjects()">Tous les Projets</button>
                        <div style="display: flex; justify-content: flex-end;">
                            <button type="button" class="btn btn-primary" id="previousReport" onclick="displayReport(${report.report_id - 1})"> <img src="https://img.icons8.com/ios/50/000000/previous.png" style="width: 20px; height: 20px;" alt=""> Précédent</button>
                            <button type="button" class="btn btn-primary" id="nextReport" onclick="displayReport(${report.report_id + 1})"> <img src="https://img.icons8.com/ios/50/000000/next.png" style="width: 20px; height: 20px;" alt=""> Suivant</button>
                        </div>
                    </div>
                    <br>
                    
                    <h1>${report.report_title}</h1>
                    <p>${report.report_date}</p>
                    <p>${report.report_type}</p>
                    <p>${report.report_status}</p>
                    <p>${report.report_description}</p>
                    <p>${report.report_referent}</p>
                    <p>${report.report_referent_email}</p>
                    <p>${report.report_manager}</p>
                    <p>${report.report_manager_email}</p>
                    <p>${report.report_project}</p>
                    <p>${report.report_association}</p>
                    <p>${report.report_location}</p>
                    <p>${report.report_status}</p>
                    <p>${report.report_type}</p>
                    <p>${report.report_start_date}</p>
                    <p>${report.report_end_date}</p>
                    <p>${report.report_updated_date}</p>

                    <!-- Afficher la liste des documents du rapport -->
                    <ul id="reportDocuments_${reportId}" style="display: block;">
                    </ul>

                    <!-- Ajouter les autres informations du rapport -->
                    <button type="button" class="btn btn-primary" id="add_document_to_report" onclick="addDocumentToReport(${report.report_id})">Ajouter un Document</button>

                    <!-- Ajouter les actions possibles sur le rapport (membres privilégiés et administrateurs) -->
                    <button type="button" class="btn btn-primary" id="add_assocition_to_report" onclick="addAssociationToReport(${report.report_id})">Ajouter une Association</button>
                    <button type="button" class="btn btn-primary" id="add_member_to_report" onclick="addMemberToReport(${report.report_id})">Ajouter un Membre</button>
                    <button type="button" class="btn btn-primary" id="editReport" onclick="editReport(${report.report_id})">Modifier</button>
                    <button type="button" class="btn btn-danger" id="archiveReport" onclick="archiveReport(${report.report_id})">Archiver</button>
                </article>
            `;

            //#region Ajouter des écouteurs d'événements pour les boutons
            document.getElementById('add_document_to_report').addEventListener('click', function (e) {
                e.preventDefault();
                addDocumentToReport(report.report_id);
            });
            document.getElementById('add_assocition_to_report').addEventListener('click', function (e) {
                e.preventDefault();
                addAssociationToReport(report.report_id);
            });
            document.getElementById('add_member_to_report').addEventListener('click', function (e) {
                e.preventDefault();
                addMemberToReport(report.report_id);
            });
            document.getElementById('editReport').addEventListener('click', function (e) {
                e.preventDefault();
                editReport(report.report_id);
            });
            document.getElementById('archiveReport').addEventListener('click', function (e) {
                e.preventDefault();
                archiveReport(report.report_id);
            });
            //#endregion

            //#region Afficher les documents du rapport
            let reportDocuments = document.getElementById(`reportDocuments_${reportId}`);
            reportDocuments.innerHTML = '';
            fetch(`https://lab.padem.org/wp-json/mo/v1/getReportDocuments`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(document => {
                        if (document.report_id === reportId) {
                            let li_document = document.createElement('li');
                            li_document.style.border = '1px solid lightgray';
                            li_document.style.borderRadius = '25px';
                            li_document.style.margin = '5px';
                            li_document.style.padding = '5px';
                            li_document.className = 'box-clicable';
                            li_document.id = document.document_id;
                            li_document.addEventListener('click', function () {
                                displayDocument(document.document_id);
                            });
                            reportDocuments.appendChild(li_document);
                            li_document.innerHTML = `
                                <p>${document.document_title}</p>
                                <p>${document.document_date}</p>
                                <p>${document.document_type}</p>
                                
                                <button type="button" class="btn btn-primary" id="downloadDocument" onclick="downloadDocument(${document.document_id})"> <img src="https://img.icons8.com/ios/50/000000/download.png" style="width: 20px; height: 20px;" alt=""> Télécharger</button>
                                <button type="button" class="btn btn-primary" id="editDocument" onclick="editDocument(${document.document_id})">Modifier</button>
                                <button type="button" class="btn btn-danger" id="deleteDocument" onclick="deleteDocument(${document.document_id})">Supprimer</button>
                            `;

                            //#region Ajouter des écouteurs d'événements pour les boutons
                            document.getElementById('downloadDocument').addEventListener('click', function (e) {
                                e.preventDefault();
                                downloadDocument(document.document_id);
                            });
                            document.getElementById('editDocument').addEventListener('click', function (e) {
                                e.preventDefault();
                                editDocument(document.document_id);
                            });
                            document.getElementById('deleteDocument').addEventListener('click', function (e) {
                                e.preventDefault();
                                deleteDocument(document.document_id);
                            });
                            //#endregion
                        }
                    });
                })
                .catch(error => console.error('Erreur récupération des documents:', error));
            //#endregion
        }
        //#endregion

        //#region Fonction pour envoyer des mails de notification via le serveur SMTP de Padem
        function sendMailNotification(member, subject, message) {
            const nodemailer = require('nodemailer');

            // Créer un transporteur SMTP réutilisable à l'aide de l'objet transporteur par défaut
            let transporter = nodemailer.createTransport({
                host: 'ssl0.ovh.net',
                port: 465,
                secure: true,
                auth: {
                    user: 'nathan.imogo@padem.org',
                    pass: 'NathIm82!',
                },
                tls: {
                    rejectUnauthorized: false
                },
            });

            // Options de l'e-mail
            let mailOptions = {
                from: '<nathan.imogo@padem.org>',
                to: member,
                subject: subject,
                text: message,
            };

            // Envoyer l'e-mail
            transporter.sendMail(mailOptions, (error, info) => {
                if (error) {
                    console.log('Erreur envoi de l\'e-mail:', error);
                } else {
                    console.log('E-mail envoyé:', info.response);
                }
            });
        }
        //#endregion

        //#region Fonction envoyer des notifications de diverses actions (ajout, modification, suppression, archivage)
        function sendNotification(action, member, project, report, document) {
            let subject = '';
            let message = '';

            switch (action) {
                case 'add':
                    subject = 'Ajout d\'un élément';
                    message = `Bonjour, un élément a été ajouté au projet ${project}.\n\nCordialement,`;
                    break;
                case 'edit':
                    subject = 'Modification d\'un élément';
                    message = `Bonjour, un élément a été modifié dans le projet ${project}.\n\nCordialement,`;
                    break;
                case 'delete':
                    subject = 'Suppression d\'un élément';
                    message = `Bonjour, un élément a été supprimé du projet ${project}.\n\nCordialement,`;
                    break;
                case 'archive':
                    subject = 'Archivage d\'un élément';
                    message = `Bonjour, un élément a été archivé dans le projet ${project}.\n\nCordialement,`;
                    break;
                default:
                    break;
            }

            sendMailNotification(member, subject, message);
        }
        //#endregion

        //#region Filtrer les projets par statut (En cours, Terminé, Archivé)
        // Fonction pour trier les projets par ordre alphabétique du nom du projet
        function sortByTitle(projects) {
            return projects.sort((a, b) => a.project_title.localeCompare(b.project_title));
        }
        document.getElementById('project_tite').addEventListener('click', function () {
            getProjects('title');
        });

        // Fonction pour trier les projets par ordre alphabétique du pays de réalisation
        function sortByCountry(projects) {
            return projects.sort((a, b) => a.project_location.localeCompare(b.project_location));
        }
        document.getElementById('country_name').addEventListener('click', function () {
            getProjects('country');
        });

        // Fonction pour trier les projets par ordre alphabétique du nom de l'association
        function sortByAssociation(projects) {
            return projects.sort((a, b) => a.association.localeCompare(b.association));
        }
        document.getElementById('association_name').addEventListener('click', function () {
            getProjects('association');
        });

        // Fonction pour trier les projets par ordre alphabétique de la thématique
        function sortByThematic(projects) {
            return projects.sort((a, b) => a.project_type.localeCompare(b.project_type));
        }
        document.getElementById('theme_name').addEventListener('click', function () {
            getProjects('thematic');
        });

        // Fonction pour trier les projets par ordre alphabétique du statut
        function sortByStatus(projects) {
            return projects.sort((a, b) => a.project_state.localeCompare(b.project_state));
        }
        document.getElementById('status_name').addEventListener('click', function () {
            getProjects('status');
        });
        //#endregion

    </script>
</body>