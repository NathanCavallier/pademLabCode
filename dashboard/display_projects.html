<body>
    <!-- Afficher la liste des projets en cours -->
    <table>
        <tbody id="projectsList_dashboard"></tbody>
    </table>


</body>


<script>
    // Projet: Récurérer les données depuis la base de données et les afficher dans des cellules individuels cliquables pour les modifier
    document.addEventListener('DOMContentLoaded', () => {
        // Déclarer les variables
        var userId;
        var userEmail = '';
        var userRole = '';
        var buttonText = '';


        // Récupérer la liste des projets depuis la base de données (à partir de l'API (https://lab.padem.org/wp-json/mo/v1/getProjects))
        // les projets sont affichés dans des lignes individuelles avec un bouton cliquables pour les modifier
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjects', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                var stepper = 0;
                var colorStatusText = {
                    'En cours': 'green',
                    'Terminé': 'lightred',
                    'En pause': 'lightblue',
                    'Annulé': 'gray',
                    'Non commencé': 'orange',
                }
                var tr = document.createElement('tr');
                tr.className = 'card';
                // Parcourir la liste des projets
                data.forEach(project => {
                    // Ajouter le titre du projet, la date de début, la date de fin, le pays, le référent et le statut dans des lignes individuelles

                    // Ajouter les données dans la carte
                    var td = document.createElement('td');
                    
                    td.style.borderRadius = '15px';
                    td.style.backgroundColor = 'white';
                    tr.style.height = 'auto';
                    td.style.width = '33%';
                    td.style.margin = '10px';
                    td.style.padding = '10px';
                    tr.style.width = '100%';
                    tr.style.margin = '10px';
                    tr.style.padding = '10px';

                    td.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h4 style="text-transform: capitalize; font-weight: bold; color: #29A6A7;">${project.project_title}</h4>
                                <p style="text-transform: capitalize; font-weight: bold; color: ${colorStatusText[project.project_status]}; background: white" id="status_${project.project_id}">${project.project_status}</p>
                            </div>
                            <div class="card-body">
                                <p>Date de début : ${project.start_date}</p>
                                <p>Date de fin : ${project.end_date}</p>
                                <p>Lieu du projet : ${project.project_location}</p>
                                <p>Email du référent : ${project.project_referent_email}</p>
                            </div>
                            <div class="card-footer">
                                <button class="buttonModifier">Voir le projet</button>
                            </div>
                        </div>
                    `;

                    // Ajouter la cellule dans la ligne
                    tr.appendChild(td);

                    // Ajouter un événement de clic sur le bouton "Modifier"    
                    td.querySelector('button').addEventListener('click', () => {
                        // Rediriger l'utilisateur vers la page de modification du projet
                        window.location.href = 'https://lab.padem.org/projet/edit_project.html?project_id=' + project.project_id;
                    });

                    stepper++;
                    if (stepper === 3) {
                        // Ajouter la ligne à la liste des projets
                        document.getElementById('projectsList_dashboard').appendChild(tr);
                        tr = document.createElement('tr');
                        td = document.createElement('td');
                        tr.className = 'card';
                        stepper = 0;
                    }
                });
                if (stepper > 0) {
                    document.getElementById('projectsList_dashboard').appendChild(tr);
                }
            })
    });
</script>