<body>
    <!-- Afficher la liste des projets en cours -->
    <div id="projectContainer">
    </div>
</body>


<script>
    // Projet: Récurérer les données depuis la base de données et les afficher dans des cellules individuels cliquables pour les modifier
    document.addEventListener('DOMContentLoaded', () => {
        // Déclarer les variables
        var userId;
        var userEmail = '';
        var userRole = '';
        var buttonText = '';


        // Récupérer la liste des projets depuis la base de données (à partir de l'API (https://lab.padem.org/wp-json/mo/v1/getProjects))
        // les projets sont affichés dans des lignes individuelles avec un bouton cliquables pour les modifier
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjects', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                var stepper = 0;
                var colorStatusText = {
                    'En cours': 'lightgreen',
                    'Terminé': 'lightred',
                    'En pause': 'lightblue',
                    'Annulé': 'lightgray',
                    'Non commencé': 'lightorange',
                };
                var textColor = {
                    'En cours': 'green',
                    'Terminé': 'red',
                    'En pause': 'blue',
                    'Annulé': 'gray',
                    'Non commencé': 'orange',
                };
                var projectContainer = document.getElementById('projectContainer');
                // Parcourir la liste des projets
                data.forEach(project => {

                    var card = document.createElement('div');
                    card.className = 'card';
                    card.style.borderRadius = '15px';
                    card.style.backgroundColor = 'white';
                    card.style.height = 'auto';
                    card.style.width = 'auto';
                    card.style.margin = '10px';
                    card.style.border = '1px ${colorStatusText[project.project_status]}';

                    var dateDebut = new Date(project.start_date);
                    var dateFin = new Date(project.end_date);
                    var dateDuJour = new Date();

                    var dureeTotale = dateFin.getTime() - dateDebut.getTime();
                    var dureeEcoulee = dateDuJour.getTime() - dateDebut.getTime();

                    var progression = (dureeEcoulee / dureeTotale) * 100;

                    var barreProgression = document.createElement('progress');
                    barreProgression.id = 'progress_' + project.project_id;
                    barreProgression.value = progression;
                    barreProgression.max = 100;
                    barreProgression.style.width = '100%';
                    barreProgression.style.height = '10px';
                    barreProgression.style.backgroundColor = 'none';
                    barreProgression.style.borderRadius = '10px';

                    card.style.fontSize = '14px'; // Change la taille de la police
                    card.style.fontFamily = 'Arial'; // Change la police
                    card.style.color = 'gray'; // Change la couleur de la police

                    card.innerHTML = `
                        <div class="card">
                            <div id="card-body" class="card-body" style="backgroundColor: none;">
                                <div style="margin-top: 150px; margin-bottom: 10px"></div>
                                <h4 style="text-fon; font-weight: bold; color: #29A6A7;">${project.project_title}</h4>
                                <p style="font-weight: bold;">${project.project_location}</p>
                                ${barreProgression.outerHTML}
                            </div>
                            <div class="card-footer">
                                <p style="font-weight: lighter; color: ${textColor[project.project_status]}; background: ${colorStatusText[project.project_status]}; margin: 5px; border-radius: 5px; fontSize: 9px;" id="status_${project.project_id}">${project.project_status}</p>
                                <button class="buttonModifier">Voir le projet</button>
                            </div>
                        </div>
                    `;

                    // Ajouter la cellule dans la ligne
                    projectContainer.appendChild(card);

                    // Ajouter un événement de clic sur le bouton "Modifier"    
                    card.querySelector('button').addEventListener('click', () => {
                        // Rediriger l'utilisateur vers la page de modification du projet
                        window.location.href = 'https://lab.padem.org/projet/edit_project.html?project_id=' + project.project_id;
                    });

                    // Ajouter l'image en arrière-plan du card-body
                    card.querySelector('#card-body').style.backgroundImage = `url(${project.background_image_link})`;
                    card.querySelector('#card-body').style.backgroundSize = 'cover';
                    card.querySelector('#card-body').style.backgroundPosition = 'center';
                    card.querySelector('#card-body').style.backgroundRepeat = 'no-repeat';

                    // incrémenter le stepper
                    stepper++;
                    if (stepper === 3) {
                        card = document.createElement('div');
                        stepper = 0;
                    }
                });
            })
    });
</script>