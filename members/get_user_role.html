<!-- Récupérer et afficher le rôle de l'utilisateur connecté -->
<div id="userRoleToDispaly" style="font-size: 12px;"></div>

<script>
    // Récupérer les données de l'utilisateur connecté
    var userEmail = user_data.email;
    var userRole = 'Utilisateur';
    var users_list = {
        'bacground_colors': {
            'Administrateur': '#FF0000',
            'Coordinateur': '#FFA500',
            'chef_de_projet': '#FFA500',
            'partenaire': '#008000',
            'comptable': '#0000FF',
            'consultant': '#800080',
            'bailleur': '#FF00FF',
            'Utilisateur': '#808080'
        },
        'emails_names': {
            'Coordinateur': 'coordinator_email',
            'chef_de_projet': 'chief_email',
            'partenaire': 'partner_email',
            'comptable': 'accountant_email',
            'consultant': 'consultant_email',
            'bailleur': 'funder_email'
        },
        'users': {
            'Coordinateur': [],
            'chef_de_projet': [],
            'partenaire': [],
            'comptable': [],
            'consultant': [],
            'bailleur': []
        },
        'urls': {
            'Administrateur': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
            'Coordinateur': 'https://lab.padem.org/wp-json/mo/v1/getCoordinator',
            'chef_de_projet': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
            'partenaire': 'https://lab.padem.org/wp-json/mo/v1/getPartner',
            'comptable': 'https://lab.padem.org/wp-json/mo/v1/getAccountant',
            'consultant': 'https://lab.padem.org/wp-json/mo/v1/getConsultant',
            'bailleur': 'https://lab.padem.org/wp-json/mo/v1/getFunder'
        }
    };
    // Récupérer le rôle de l'utilisateur connecté au chargement de la page
    document.addEventListener('DOMContentLoaded', function () {
        //#region Sty du rôle de l'utilisateur connecté
        document.getElementById('loading').style.display = 'block';
        document.getElementById('userRoleToDispaly').innerText = userRole;
        document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors.Utilisateur;
        document.getElementById('userRoleToDispaly').style.color = 'white';
        document.getElementById('userRoleToDispaly').style.fontWeight = 'normal';
        document.getElementById('userRoleToDispaly').style.fontSize = '12px';
        document.getElementById('userRoleToDispaly').style.padding = '5px';
        document.getElementById('userRoleToDispaly').style.borderRadius = '10px';
        document.getElementById('userRoleToDispaly').style.margin = '5px';
        document.getElementById('userRoleToDispaly').style.textAlign = 'center';
        checkIfUserIsAdmin();
        localStorage.setItem('userRole', userRole);
        //#endregion
    });
    // Vérifier si l'utilisateur connecté est un administrateur
    function checkIfUserIsAdmin() {
        // Vérifier si l'utilisateur connecté est un administrateur
        fetch(users_list.urls.Administrateur,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    // Récupérer les emails des administrateurs
                    var data_emails = [];
                    data.forEach(item => {
                        data_emails.push(item[users_list.emails_names.chef_de_projet]);
                    });
                    // Vérifier si l'utilisateur connecté est un administrateur
                    if (data_emails.includes(userEmail)) {
                        userRole = 'Administrateur';
                        document.getElementById('userRoleToDispaly').innerHTML = userRole;
                        document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors.Administrateur;
                        document.getElementById('userRoleToDispaly').style.display = 'block';
                        // Masquer le spinner de chargement
                        document.getElementById('loading').style.display = 'none';
                    } else {
                        // Vérifier si l'utilisateur connecté est un coordinateur
                        checkIfUserIsCoordinator();
                    }
                } else {
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                    checkIfUserIsCoordinator();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un coordinateur 
    function checkIfUserIsCoordinator() {
        // Vérifier si l'utilisateur connecté est un coordinateur
        fetch(users_list.urls.Coordinateur,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    // Récupérer les emails des coordinateurs
                    var data_emails = [];
                    data.forEach(item => {
                        data_emails.push(item[users_list.emails_names.Coordinateur]);
                    });
                    // Vérifier si l'utilisateur connecté est un coordinateur
                    if (data_emails.includes(userEmail)) {
                        userRole = 'Coordinateur';
                        document.getElementById('userRoleToDispaly').innerText = userRole;
                        document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors.Coordinateur;
                        document.getElementById('userRoleToDispaly').style.display = 'block';
                        // Masquer le spinner de chargement
                        document.getElementById('loading').style.display = 'none';
                    } else {
                        // Vérifier si l'utilisateur connecté est un chef de projet
                        checkIfUserIsProjectChief();
                    }
                } else {
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                    checkIfUserIsProjectChief();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un chef de projet
    function checkIfUserIsProjectChief() {
        // Vérifier si l'utilisateur connecté est un chef de projet
        fetch(users_list.urls.chef_de_projet,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    // Récupérer les emails des chefs de projet
                    var data_emails = [];
                    data.forEach(item => {
                        data_emails.push(item[users_list.emails_names.chef_de_projet]);
                    });
                    // Vérifier si l'utilisateur connecté est un chef de projet
                    if (data_emails.includes(userEmail)) {
                        userRole = 'Chef de projet';
                        document.getElementById('userRoleToDispaly').innerText = userRole;
                        document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors.chef_de_projet;
                        document.getElementById('userRoleToDispaly').style.display = 'block';
                        // Masquer le spinner de chargement
                        document.getElementById('loading').style.display = 'none';
                    } else {
                        // Vérifier si l'utilisateur connecté est un partenaire
                        checkIfUserIsPartner();
                    }
                } else {
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                    checkIfUserIsPartner();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un partenaire
    function checkIfUserIsPartner() {
        // Vérifier si l'utilisateur connecté est un partenaire
        fetch(users_list.urls.partenaire,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    // Récupérer les emails des partenaires
                    var data_emails = [];
                    data.forEach(item => {
                        data_emails.push(item[users_list.emails_names.partenaire]);
                    });
                    // Vérifier si l'utilisateur connecté est un partenaire
                    if (data_emails.includes(userEmail)) {
                        userRole = 'Partenaire';
                        document.getElementById('userRoleToDispaly').innerText = userRole;
                        document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors.partenaire;
                        document.getElementById('userRoleToDispaly').style.display = 'block';
                        // Masquer le spinner de chargement
                        document.getElementById('loading').style.display = 'none';
                    } else {
                        // Vérifier si l'utilisateur connecté est un comptable
                        checkIfUserIsAccountant();
                    }
                } else {
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                    checkIfUserIsAccountant();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un comptable
    function checkIfUserIsAccountant() {
        // Vérifier si l'utilisateur connecté est un comptable
        fetch(users_list.urls.comptable,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    // Récupérer les emails des comptables
                    var data_emails = [];
                    data.forEach(item => {
                        data_emails.push(item[users_list.emails_names.comptable]);
                    });
                    // Vérifier si l'utilisateur connecté est un comptable
                    if (data_emails.includes(userEmail)) {
                        userRole = 'Comptable';
                        document.getElementById('userRoleToDispaly').innerText = userRole;
                        document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors.comptable;
                        document.getElementById('userRoleToDispaly').style.display = 'block';
                        // Masquer le spinner de chargement
                        document.getElementById('loading').style.display = 'none';
                    } else {
                        // Vérifier si l'utilisateur connecté est un consultant
                        checkIfUserIsConsultant();
                    }
                } else {
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                    checkIfUserIsConsultant();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un consultant
    function checkIfUserIsConsultant() {
        // Vérifier si l'utilisateur connecté est un consultant
        fetch(users_list.urls.consultant,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                    // Récupérer les emails des consultants
                    var data_emails = [];
                    data.forEach(item => {
                        data_emails.push(item[users_list.emails_names.consultant]);
                    });
                    // Vérifier si l'utilisateur connecté est un consultant
                    if (data_emails.includes(userEmail)) {
                        userRole = 'Consultant';
                        document.getElementById('userRoleToDispaly').innerText = userRole;
                        document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors.consultant;
                        document.getElementById('userRoleToDispaly').style.display = 'block';
                    } else {
                        userRole = 'Utilisateur';
                        document.getElementById('userRoleToDispaly').innerText = userRole;
                        document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors.Utilisateur;
                        document.getElementById('userRoleToDispaly').style.display = 'block';
                    }
                } else {
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

</script>