<!-- Récupérer et afficher le rôle de l'utilisateur connecté -->
<p id="userRoleToDispaly" class="badge badge-secondary rounded-pill"></p>

<script>
    var userRole = '';
    var users_list = {
        'bacground_colors': {
            'Administrateur': '#FF0000',
            'Coordinateur': '#FFA500',
            'Chef de projet': '#FFA500',
            'partenaire': '#008000',
            'comptable': '#0000FF',
            'consultant': '#800080',
            'bailleur': '#FF00FF'
        },
        'emails_names': {
            'Coordinateur': 'coordinator_email',
            'Chef de projet': 'chief_email',
            'partenaire': 'partner_email',
            'comptable': 'accountant_email',
            'consultant': 'consultant_email',
            'bailleur': 'funder_email'
        },
        'users': {
            'Coordinateur': [],
            'Chef de projet': [],
            'partenaire': [],
            'comptable': [],
            'consultant': [],
            'bailleur': []
        },
        'urls': {
            'Administrateur': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
            'Coordinateur': 'https://lab.padem.org/wp-json/mo/v1/getCoordinator',
            'Chef de projet': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
            'partenaire': 'https://lab.padem.org/wp-json/mo/v1/getPartner',
            'comptable': 'https://lab.padem.org/wp-json/mo/v1/getAccountant',
            'consultant': 'https://lab.padem.org/wp-json/mo/v1/getConsultant',
            'bailleur': 'https://lab.padem.org/wp-json/mo/v1/getFunder'
        }
    };
    // Récupérer le rôle de l'utilisateur connecté au chargement de la page
    document.addEventListener('DOMContentLoaded', function () {
        // Afficher le spinner de chargement
        document.getElementById('loading').style.display = 'block';
        // Récupérer les données de l'utilisateur connecté
        var userEmail = user_data.email;
        var fetchPromises = []; // Déclaration de fetchPromises
        //#region Vérifier si l'utilisateur connecté est un administrateur, un coordinateur, un chef de projet, un partenaire, un comptable ou un consultant 

        for (const key in users_list.urls) {
            if (users_list.urls.hasOwnProperty(key)) {
                const url = users_list.urls[key];
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        users_list.users[key] = data;
                        data.forEach(element => {
                            if (element[users_list.emails_names[key]] === userEmail) {
                                userRole = key;
                                document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors[key];
                                document.getElementById('userRoleToDispaly').style.color = 'white';
                                document.getElementById('userRoleToDispaly').style.fontWeight = 'normal';
                                document.getElementById('userRoleToDispaly').style.fontSize = '12px';
                                document.getElementById('userRoleToDispaly').style.padding = '5px';
                                document.getElementById('userRoleToDispaly').style.borderRadius = '10px';
                                document.getElementById('userRoleToDispaly').style.margin = '5px';
                                // Afficher le rôle de l'utilisateur connecté
                                document.getElementById('userRoleToDispaly').textContent = userRole;
                                document.getElementById('loading').style.display = 'none';
                                console.log(key);
                                return;
                            } else if (key === 'bailleur') {
                                document.getElementById('loading').style.display = 'none';
                                userRole = 'Utilisateur';
                                document.getElementById('userRoleToDispaly').style.backgroundColor = '#7D7D7D';
                                document.getElementById('userRoleToDispaly').style.color = 'white';
                                document.getElementById('userRoleToDispaly').style.fontWeight = 'normal';
                                document.getElementById('userRoleToDispaly').style.fontSize = '12px';
                                document.getElementById('userRoleToDispaly').style.padding = '5px';
                                document.getElementById('userRoleToDispaly').style.borderRadius = '10px';
                                document.getElementById('userRoleToDispaly').style.margin = '5px';
                                // Afficher le rôle de l'utilisateur connecté
                                document.getElementById('userRoleToDispaly').textContent = userRole;
                                document.getElementById('loading').style.display = 'none';
                                return;
                            }
                        });
                    })
                    .catch(error => console.error(error))
            }
        }
        //#endregion
    });


</script>