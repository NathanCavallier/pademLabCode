<!-- Récupérer et afficher le rôle de l'utilisateur connecté -->
<div id="userRoleToDispaly" class="badge badge-secondary rounded-pill"></div>

<script>
    // Récupérer les données de l'utilisateur connecté
    var userEmail = user_data.email;
    var userRole = '';
    var users_list = {
        'bacground_colors': {
            'Administrateur': '#FF0000',
            'Coordinateur': '#FFA500',
            'chef_de_projet': '#FFA500',
            'partenaire': '#008000',
            'comptable': '#0000FF',
            'consultant': '#800080',
            'bailleur': '#FF00FF',
            'Utilisateur': '#808080'
        },
        'emails_names': {
            'Coordinateur': 'coordinator_email',
            'chef_de_projet': 'chief_email',
            'partenaire': 'partner_email',
            'comptable': 'accountant_email',
            'consultant': 'consultant_email',
            'bailleur': 'funder_email'
        },
        'users': {
            'Coordinateur': [],
            'chef_de_projet': [],
            'partenaire': [],
            'comptable': [],
            'consultant': [],
            'bailleur': []
        },
        'urls': {
            'Administrateur': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
            'Coordinateur': 'https://lab.padem.org/wp-json/mo/v1/getCoordinator',
            'chef_de_projet': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
            'partenaire': 'https://lab.padem.org/wp-json/mo/v1/getPartner',
            'comptable': 'https://lab.padem.org/wp-json/mo/v1/getAccountant',
            'consultant': 'https://lab.padem.org/wp-json/mo/v1/getConsultant',
            'bailleur': 'https://lab.padem.org/wp-json/mo/v1/getFunder'
        }
    };
    // Récupérer le rôle de l'utilisateur connecté au chargement de la page
    document.addEventListener('DOMContentLoaded', function () {
        // Afficher le spinner de chargement
        document.getElementById('loading').style.display = 'block';
        var fetchPromises = []; // Déclaration de fetchPromises
        //#region Vérifier si l'utilisateur connecté est un administrateur, un coordinateur, un chef de projet, un partenaire, un comptable ou un consultant 
        document.getElementById('userRoleToDispaly').style.color = 'white';
        document.getElementById('userRoleToDispaly').style.fontWeight = 'normal';
        document.getElementById('userRoleToDispaly').style.fontSize = '12px';
        document.getElementById('userRoleToDispaly').style.padding = '5px';
        document.getElementById('userRoleToDispaly').style.borderRadius = '10px';
        document.getElementById('userRoleToDispaly').style.margin = '5px';
        document.getElementById('userRoleToDispaly').style.display = 'none';
        // Vérifier si l'utilisateur connecté est un administrateur, un coordinateur, un chef de projet, un partenaire, un comptable ou un consultant
        checkIfUserIsAdmin();
        //#endregion
    });
    // Vérifier si l'utilisateur connecté est un administrateur
    async function checkIfUserIsAdmin() {
        // Vérifier si l'utilisateur connecté est un administrateur
        fetch(users_list.urls.Administrateur,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                // Récupérer les emails des administrateurs
                var data_emails = data.map(function (item) {
                    return item[users_list.emails_names.admin];
                });
                // Vérifier si l'utilisateur connecté est un administrateur
                if (data_emails.includes(userEmail)) {
                    userRole = 'Administrateur';
                    document.getElementById('userRoleToDispaly').innerHTML = userRole;
                    document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors[userRole];
                    document.getElementById('userRoleToDispaly').style.display = 'block';
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                } else {
                    // Vérifier si l'utilisateur connecté est un coordinateur
                    checkIfUserIsCoordinator();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un coordinateur
    async function checkIfUserIsCoordinator() {
        // Vérifier si l'utilisateur connecté est un coordinateur
        fetch(users_list.urls.Coordinateur,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                // Récupérer les emails des coordinateurs
                var data_emails = data.map(function (item) {
                    return item[users_list.emails_names.coordinator];
                });
                // Vérifier si l'utilisateur connecté est un coordinateur
                if (data_emails.includes(userEmail)) {
                    userRole = 'Coordinateur';
                    document.getElementById('userRoleToDispaly').innerHTML = userRole;
                    document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors[userRole];
                    document.getElementById('userRoleToDispaly').style.display = 'block';
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                } else {
                    // Vérifier si l'utilisateur connecté est un chef de projet
                    checkIfUserIsProjectChief();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un chef de projet
    async function checkIfUserIsProjectChief() {
        // Vérifier si l'utilisateur connecté est un chef de projet
        fetch(users_list.urls.chef_de_projet,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                // Récupérer les emails des chefs de projet
                var data_emails = data.map(function (item) {
                    return item[users_list.emails_names.chef_de_projet];
                });
                // Vérifier si l'utilisateur connecté est un chef de projet
                if (data_emails.includes(userEmail)) {
                    userRole = 'Chef de projet';
                    document.getElementById('userRoleToDispaly').innerHTML = userRole;
                    document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors.chef_de_projet;
                    document.getElementById('userRoleToDispaly').style.display = 'block';
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                } else {
                    // Vérifier si l'utilisateur connecté est un partenaire
                    checkIfUserIsPartner();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un partenaire
    async function checkIfUserIsPartner() {
        // Vérifier si l'utilisateur connecté est un partenaire
        fetch(users_list.urls.partenaire,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                // Récupérer les emails des partenaires
                var data_emails = data.map(function (item) {
                    return item[users_list.emails_names.partenaire];
                });
                // Vérifier si l'utilisateur connecté est un partenaire
                if (data_emails.includes(userEmail)) {
                    userRole = 'partenaire';
                    document.getElementById('userRoleToDispaly').innerHTML = userRole;
                    document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors[userRole];
                    document.getElementById('userRoleToDispaly').style.display = 'block';
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                } else {
                    // Vérifier si l'utilisateur connecté est un comptable
                    checkIfUserIsAccountant();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un comptable
    async function checkIfUserIsAccountant() {
        // Vérifier si l'utilisateur connecté est un comptable
        fetch(users_list.urls.comptable,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                // Récupérer les emails des comptables
                var data_emails = data.map(function (item) {
                    return item[users_list.emails_names.comptable];
                });
                // Vérifier si l'utilisateur connecté est un comptable
                if (data_emails.includes(userEmail)) {
                    userRole = 'comptable';
                    document.getElementById('userRoleToDispaly').innerHTML = userRole;
                    document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors[userRole];
                    document.getElementById('userRoleToDispaly').style.display = 'block';
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                } else {
                    // Vérifier si l'utilisateur connecté est un consultant
                    checkIfUserIsConsultant();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Vérifier si l'utilisateur connecté est un consultant
    async function checkIfUserIsConsultant() {
        // Vérifier si l'utilisateur connecté est un consultant
        fetch(users_list.urls.consultant,
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                // Récupérer les emails des consultants
                var data_emails = data.map(function (item) {
                    return item[users_list.emails_names.consultant];
                });
                // Vérifier si l'utilisateur connecté est un consultant
                if (data_emails.includes(userEmail)) {
                    userRole = 'consultant';
                    document.getElementById('userRoleToDispaly').innerHTML = userRole;
                    document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors[userRole];
                    document.getElementById('userRoleToDispaly').style.display = 'block';
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                } else {
                    // Masquer le spinner de chargement
                    document.getElementById('loading').style.display = 'none';
                    userRole = 'Utilisateur';
                    document.getElementById('userRoleToDispaly').innerHTML = userRole;
                    document.getElementById('userRoleToDispaly').style.backgroundColor = users_list.bacground_colors[userRole];
                    document.getElementById('userRoleToDispaly').style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }


</script>