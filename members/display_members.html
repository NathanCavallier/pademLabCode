<!-- #region -->
<script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Ajoutez ceci pour utiliser Font Awesome -->
<!-- Afficher la liste de tout les membres du site -->
<ul id="all_members" style="list-style: none; display: none;"></ul>

<script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Ajoutez ceci pour utiliser Font Awesome -->
<!-- Afficher la liste de tout les coordinateurs du site -->
<ul id="coordinateur" style="display: none; list-style: none;"></ul>

<script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Ajoutez ceci pour utiliser Font Awesome -->
<!-- Afficher la liste de tout les chefs de projet du site -->
<ul id="chef_de_projet" style="list-style: none; display: none;"></ul>

<script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Ajoutez ceci pour utiliser Font Awesome -->
<!-- Afficher la liste de tout les comptables du site -->
<ul id="accountant" style="list-style: none; display: none;"></ul>

<script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Ajoutez ceci pour utiliser Font Awesome -->
<!-- Afficher la liste de tout les consultants du site -->
<ul id="consultant" style="list-style: none; display: none;"></ul>

<script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Ajoutez ceci pour utiliser Font Awesome -->
<!-- Afficher la liste de tout les partenaires du site -->
<ul id="partner" style="list-style: none; display: none;"></ul>
<!-- #endregion -->


<!--#region Liste des boutons -->
<button type="button" class="box-clicable" id="my_project_profile"
    style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
    Mon profile projet </button>
<button type="button" class="box-clicable" id="add_member"
    style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
    <img src="https://lab.padem.org/wp-content/uploads/plus.png" width="30px" height="30px" id="add_member_button"
        alt="Ajouter un membre projet">
</button>
<button type="button" class="box-clicable" id="tous"
    style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px;font-size: 13px;">
    Tous les memebres</button>
<button type="button" class="box-clicable" id="with_project"
    style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
    Avec projet </button>
<button type="button" class="box-clicable" id="with_role_without_project"
    style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
    Avec rôle et sans projet </button>
<button type="button" class="box-clicable" id="without_role_without_project"
    style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
    Sans rôle et sans projet </button>
<!--#endregion-->

<div class="row" style="height: fit-content;">
    <div class="col">
        <ul id="my-project-profile" style="list-style: none; display: none;"></ul>
    </div>
    <div class="col">
        <ul id="connected_user_projects" style="list-style: none; display: none;"></ul>
    </div>
</div>
<ul id="add-member" style="list-style: none; display: none;"></ul>
<ul id="tous-" style="list-style: none; display: none;"></ul>
<ul id="with-project" style="list-style: none; display: none;"></ul>
<ul id="with-role-without-project" style="list-style: none; display: none;"></ul>
<ul id="without-role-without-project" style="list-style: none; display: none;"></ul>


<!--#region Script des boutons -->
<script>
    var menuActiveButtons = {
        'selected_background': '#29A6A7',
        'selected_color': 'white',
        'unselected_background': 'white',
        'unselected_color': 'gray',
    };
    // Récupérer les données de l'utilisateur connecté
    var userEmail = current_user_data.email;
    var userRoles = current_user_data.roles;
    var userId = current_user_data.ID;
    var userRole = '';
    //#region Vérifier le rôle de l'utilisateur connecté
    if (userRoles.includes('administrator')) {
        userRole = 'Administrateur';
    } else if (userRoles.includes('coordinator')) {
        userRole = 'Coordinateur';
    } else if (userRoles.includes('chef-de-projet')) {
        userRole = 'Chef de projet';
    } else if (userRoles.includes('partner')) {
        userRole = 'Partenaire';
    } else if (userRoles.includes('accountant')) {
        userRole = 'Comptable';
    } else if (userRoles.includes('consultant')) {
        userRole = 'Consultant';
    } else {
        userRole = 'Abonné';
    }
    localStorage.setItem('userRole', userRole);
    //#endregion
    var users_list = {
        'bacground_colors': {
            'Administrateur': '#FF0000',
            'Coordinateur': '#FFA500',
            'chef_de_projet': '#FFA500',
            'partenaire': '#008000',
            'comptable': '#0000FF',
            'consultant': '#800080',
            'Utilisateur': '#808080'
        },
        'emails_names': {
            'Coordinateur': 'coordinator_email',
            'chef_de_projet': 'chief_email',
            'partenaire': 'partner_email',
            'comptable': 'accountant_email',
            'consultant': 'consultant_email',
        },
        'users': {
            'Coordinateur': [],
            'chef_de_projet': [],
            'partenaire': [],
            'comptable': [],
            'consultant': []
        },
        'urls': {
            'Administrateur': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
            'Coordinateur': 'https://lab.padem.org/wp-json/mo/v1/getCoordinator',
            'chef_de_projet': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
            'partenaire': 'https://lab.padem.org/wp-json/mo/v1/getPartner',
            'comptable': 'https://lab.padem.org/wp-json/mo/v1/getAccountant',
            'consultant': 'https://lab.padem.org/wp-json/mo/v1/getConsultant'
        }
    };
    document.addEventListener('DOMContentLoaded', function () {
        // Afficher le spinner
        document.getElementById('loading').style.display = 'block';
        var menuActiveButtons = {
            'selected_background': '#29A6A7',
            'selected_color': 'white',
            'unselected_background': 'white',
            'unselected_color': 'gray',
        };
        // Récupérer la liste de tout les membres de la plate-forme
        getAllWordPressMembers();
        // Récupérer les données de l'utilisateur connecté
        displayUserProfile();
        // Afficher/Masquer le bouton de d'ajout d'un membre en fonction du rôle de l'utilisateur
        if (userRole === 'Coordinateur' || userRole === 'Chef de projet' || userRole === 'Administrateur' || userRole === 'partenaire' || userRole === 'comptable' || userRole === 'consultant') {
            document.getElementById('add_member').style.display = 'block';
        } else {
            document.getElementById('add_member').style.display = 'none';
        }
        try {
            // Afficher le loader
            //#region Couleurs initiales des boutons
            try {
                document.getElementById('my_project_profile').style.backgroundColor = menuActiveButtons.unselected_background;
                document.getElementById('my_project_profile').style.color = menuActiveButtons.unselected_color;
                document.getElementById('add_member').style.backgroundColor = menuActiveButtons.unselected_background;
                document.getElementById('add_member').style.color = menuActiveButtons.unselected_color;
                document.getElementById('tous').style.backgroundColor = menuActiveButtons.selected_background;
                document.getElementById('tous').style.color = menuActiveButtons.selected_color;
                document.getElementById('with_project').style.backgroundColor = menuActiveButtons.unselected_background;
                document.getElementById('with_project').style.color = menuActiveButtons.unselected_color;
                document.getElementById('with_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                document.getElementById('with_role_without_project').style.color = menuActiveButtons.unselected_color;
                document.getElementById('without_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                document.getElementById('without_role_without_project').style.color = menuActiveButtons.unselected_color;
            } catch (error) {
                console.log('Erreur lors de l\'exécution du script(couleurs initiales des bouttons) :', error);
            }
            //#endregion

            //#region État initial des listes
            try {
                document.getElementById('coordinateur').style.display = 'block';
                document.getElementById('chef_de_projet').style.display = 'block';
                document.getElementById('accountant').style.display = 'block';
                document.getElementById('consultant').style.display = 'block';
                document.getElementById('partner').style.display = 'block';
            } catch (error) {
                console.log('Erreur lors de l\'exécution du script(état initial des listes) :', error);
            }
            //#endregion

            //#region des zones d'affichages
            try {
                document.getElementById('my-project-profile').style.display = 'none';
                document.getElementById('add-member').style.display = 'none';
                document.getElementById('tous-').style.display = 'block';
                document.getElementById('with-project').style.display = 'none';
                document.getElementById('with-role-without-project').style.display = 'none';
                document.getElementById('without-role-without-project').style.display = 'none';
            } catch (error) {
                console.log('Erreur lors de l\'exécution du script(des zones d\'affichages) :', error);
            }
            //#endregion

            document.getElementById('my_project_profile').addEventListener('click', function () {
                try {
                    //#region des zones d'affichages
                    document.getElementById('my-project-profile').style.display = 'block';
                    document.getElementById('add-member').style.display = 'none';
                    document.getElementById('tous-').style.display = 'none';
                    document.getElementById('with-project').style.display = 'none';
                    document.getElementById('with-role-without-project').style.display = 'none';
                    document.getElementById('without-role-without-project').style.display = 'none';

                    document.getElementById('my_project_profile').style.backgroundColor = menuActiveButtons.selected_background;
                    document.getElementById('my_project_profile').style.color = menuActiveButtons.selected_color;
                    document.getElementById('add_member').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('add_member').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('add_member_button').src = 'https://lab.padem.org/wp-content/uploads/plus.png';
                    document.getElementById('tous').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('tous').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_role_without_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('without_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('without_role_without_project').style.color = menuActiveButtons.unselected_color;
                    //#endregion
                } catch (error) {
                    console.log('Erreur lors de l\'exécution du script (boutton "my_project_profile") :', error);
                }
            });

            // Afficher le formulaire d'ajout d'un membre
            try {
                var add_member_form = document.createElement('form');
                add_member_form.id = 'add_member_form';
                add_member_form.style.display = 'block';
                add_member_form.style.padding = '10px';
                add_member_form.style.border = '1px solid #29A6A7';
                add_member_form.style.borderRadius = '15px';
                add_member_form.style.margin = '5px';
                add_member_form.style.backgroundColor = 'white';
                add_member_form.style.color = 'gray';
                add_member_form.style.fontSize = '13px';
                add_member_form.style.width = '100%';
                add_member_form.style.height = 'fit-content';
                add_member_form.style.display = 'flex';
                add_member_form.style.flexDirection = 'column';
                add_member_form.style.alignItems = 'left';
                add_member_form.style.justifyContent = 'center';
                add_member_form.innerHTML = `
                    <label for="new_member_role">Choisir le role du nouveau :</label>
                    <select id="new_member_role" name="new_member_role" required>
                        <option value="Coordinateur">Aucun role</option>
                        <option value="Coordinateur">Coordinateur</option>
                        <option value="chef_de_projet">Chef de projet</option>
                        <option value="comptable">Comptable</option>
                        <option value="consultant">Consultant</option>
                        <option value="partenaire">Partenaire</option>
                    </select>
                    <select for="new_member_projects">Choisir un ou plusieurs projets :</select>
                    <select id="new_member_projects" name="new_member_projects" required>
                        <option value="0">Aucun projet</option>
                    </select>
                    <label for="new_member_name">Nom et prénom :</label>
                    <input type="text" id="new_member_name" name="new_member_name" placeholder="Nom et prénom du nouveau membre" required>
                    <label for="new_member_email">Adresse email du nouveau membre :</label>
                    <input type="email" id="new_member_email" name="new_member_email" placeholder="Adresse email du nouveau membre" required>
                    <button type="submit" id="add_member_button" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
                        Ajouter le membre 
                    </button>
                    <button type="button" id="add_member_button" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
                        <img src="https://lab.padem.org/wp-content/uploads/plus.png" width="25px" height="25px" id="add_member_button" alt="Ajouter un membre projet">
                    </button>
                `;
                document.getElementById('add-member').appendChild(add_member_form);

                //#region Récupérer la liste des projets(les noms et les IDs)
                fetch('https://lab.padem.org/wp-json/mo/v1/getAllProjects', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(project => {
                            var option = document.createElement('option');
                            option.value = project.project_id;
                            option.innerHTML = project.project_title;
                            document.getElementById('new_member_projects').appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Erreur lors de la récupération des données des projets :', error);
                    });
                //#endregion

                document.getElementById('add_member_button').addEventListener('click', function () {
                    //addMemberToProject();
                });
            } catch (error) {
                console.log('Erreur lors de l\'exécution du script (formulaire d\'ajout d\'un membre) :', error);
            }

            // Ajouter un événement pour afficher le formulaire d'ajout d'un membre
            document.getElementById('add_member').addEventListener('click', function () {
                try {
                    //#region des zones d'affichages
                    document.getElementById('my-project-profile').style.display = 'none';
                    document.getElementById('add-member').style.display = 'block';
                    document.getElementById('tous-').style.display = 'none';
                    document.getElementById('with-project').style.display = 'none';
                    document.getElementById('with-role-without-project').style.display = 'none';
                    document.getElementById('without-role-without-project').style.display = 'none';
                    //#endregion
                    //#region Couleurs des boutons
                    document.getElementById('my_project_profile').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('my_project_profile').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('add_member').style.backgroundColor = menuActiveButtons.selected_background;
                    document.getElementById('add_member').style.color = menuActiveButtons.selected_color;
                    document.getElementById('add_member_button').src = 'https://lab.padem.org/wp-content/uploads/plus_white.png';
                    document.getElementById('tous').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('tous').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_role_without_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('without_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('without_role_without_project').style.color = menuActiveButtons.unselected_color;


                } catch (error) {
                    console.log('Erreur lors de l\'exécution du script (boutton "add_member") :', error);
                }
            });

            // Ajouter un événement pour afficher la liste de tout les membres
            document.getElementById('tous').addEventListener('click', function () {
                try {
                    //#region des zones d'affichages
                    document.getElementById('my-project-profile').style.display = 'none';
                    document.getElementById('add-member').style.display = 'none';
                    document.getElementById('tous-').style.display = 'block';
                    document.getElementById('with-project').style.display = 'none';
                    document.getElementById('with-role-without-project').style.display = 'none';
                    document.getElementById('without-role-without-project').style.display = 'none';
                    //#endregion
                    //#region Couleurs des boutons
                    document.getElementById('my_project_profile').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('my_project_profile').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('add_member').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('add_member').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('add_member_button').src = 'https://lab.padem.org/wp-content/uploads/plus.png';
                    document.getElementById('tous').style.backgroundColor = menuActiveButtons.selected_background;
                    document.getElementById('tous').style.color = menuActiveButtons.selected_color;
                    document.getElementById('with_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_role_without_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('without_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('without_role_without_project').style.color = menuActiveButtons.unselected_color;
                    //#endregion

                    // Afficher la liste de tout les membres
                    document.getElementById('coordinateur').style.display = 'block';
                    document.getElementById('chef_de_projet').style.display = 'block';
                    document.getElementById('accountant').style.display = 'block';
                    document.getElementById('consultant').style.display = 'block';
                    document.getElementById('partner').style.display = 'block';

                } catch (error) {
                    console.log('Erreur lors de l\'exécution du script (boutton "tous") :', error);
                }
            });

            // Ajouter un événement pour afficher la liste de tout les membres avec un projet
            document.getElementById('with_project').addEventListener('click', function () {
                try {
                    //#region des zones d'affichages
                    document.getElementById('my-project-profile').style.display = 'none';
                    document.getElementById('add-member').style.display = 'none';
                    document.getElementById('tous-').style.display = 'none';
                    document.getElementById('with-project').style.display = 'block';
                    document.getElementById('with-role-without-project').style.display = 'none';
                    document.getElementById('without-role-without-project').style.display = 'none';
                    //#endregion
                    document.getElementById('my_project_profile').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('my_project_profile').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('add_member').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('add_member').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('add_member_button').src = 'https://lab.padem.org/wp-content/uploads/plus.png';
                    document.getElementById('tous').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('tous').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_project').style.backgroundColor = menuActiveButtons.selected_background;
                    document.getElementById('with_project').style.color = menuActiveButtons.selected_color;
                    document.getElementById('with_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_role_without_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('without_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('without_role_without_project').style.color = menuActiveButtons.unselected_color;
                } catch (error) {
                    console.log('Erreur lors de l\'exécution du script (boutton "with_project") :', error);
                }
            });

            // Ajouter un événement pour afficher la liste de tout les membres avec un rôle et sans projet
            document.getElementById('with_role_without_project').addEventListener('click', function () {

                try {
                    document.getElementById('my-project-profile').style.display = 'none';
                    document.getElementById('add-member').style.display = 'none';
                    document.getElementById('tous-').style.display = 'none';
                    document.getElementById('with-project').style.display = 'none';
                    document.getElementById('with-role-without-project').style.display = 'block';
                    document.getElementById('without-role-without-project').style.display = 'none';

                    document.getElementById('my_project_profile').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('my_project_profile').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('add_member').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('add_member').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('add_member_button').src = 'https://lab.padem.org/wp-content/uploads/plus.png';
                    document.getElementById('tous').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('tous').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_role_without_project').style.backgroundColor = menuActiveButtons.selected_background;
                    document.getElementById('with_role_without_project').style.color = menuActiveButtons.selected_color;
                    document.getElementById('without_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('without_role_without_project').style.color = menuActiveButtons.unselected_color;
                } catch (error) {
                    console.log('Erreur lors de l\'exécution du script (boutton "with_role_without_project") :', error);
                }
            });

            // Ajouter un événement pour afficher la liste de tout les membres sans rôle et sans projet
            document.getElementById('without_role_without_project').addEventListener('click', function () {

                try {
                    document.getElementById('my-project-profile').style.display = 'none';
                    document.getElementById('add-member').style.display = 'none';
                    document.getElementById('tous-').style.display = 'none';
                    document.getElementById('with-project').style.display = 'none';
                    document.getElementById('with-role-without-project').style.display = 'none';
                    document.getElementById('without-role-without-project').style.display = 'block';

                    document.getElementById('my_project_profile').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('my_project_profile').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('add_member').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('add_member').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('tous').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('tous').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('with_role_without_project').style.backgroundColor = menuActiveButtons.unselected_background;
                    document.getElementById('with_role_without_project').style.color = menuActiveButtons.unselected_color;
                    document.getElementById('without_role_without_project').style.backgroundColor = menuActiveButtons.selected_background;
                    document.getElementById('without_role_without_project').style.color = menuActiveButtons.selected_color;

                } catch (error) {
                    console.log('Erreur lors de l\'exécution du script (boutton "without_role_without_project") :', error);
                }
            });
        } catch (error) {
            console.log('Erreur lors de l\'exécution du script :', error);
        }
    });


    // Récupérer la liste de tout les membres de la plate-forme
    var all_members = [];
    function getAllWordPressMembers() {
        fetch('https://lab.padem.org/wp-json/mo/v1/getAllMembers', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                data.forEach(user => {
                    all_members.push({
                        '_id': user.ID,
                        'role': '',
                        'display_name': user.display_name,
                        'email': user.user_email,
                        'user_registered_date': user.user_registered
                    });
                });
                // Afficher la liste de tout les membres
                all_members.forEach(member => {
                    var li = document.createElement('li');
                    li.innerHTML = `
                        <i class="fas fa-user"></i> ${member.display_name} (${member.email}) - Utilisateur
                    `;
                    document.getElementById('tous-').appendChild(li);
                });
                // Masquer le spinner
                document.getElementById('loading').style.display = 'none';
                /*
                //#region Vérifier le rôle de l'utilisateur
                all_members.forEach(member => {
                    for (var role in users_list.urls) {
                        fetch(users_list.urls[role], {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                            .then(response => response.json())
                            .then(data => {
                                data.forEach(user => {
                                    users_list.users[role].push(user[users_list.emails_names[role]]);
                                });
                                // Ajouter les membres à la liste des membres
                                users_list.users[role].forEach(user => {
                                    if (user === member.email) {
                                        member.role = role;
                                        var li = document.createElement('li');
                                        li.innerHTML = `
                                            <i class="fas fa-user"></i> ${member.display_name} (${member.email}) - ${member.role}
                                        `;
                                        document.getElementById('tous-').appendChild(li);
                                        if (member.role === 'Coordinateur') {
                                            var li_coordinateur = document.createElement('li');
                                            li_coordinateur.innerHTML = `
                                                <i class="fas fa-user"></i> ${member.display_name} (${member.email}) - ${member.role}
                                            `;
                                            document.getElementById('coordinateur').appendChild(li_coordinateur);
                                        } else if (member.role === 'chef_de_projet') {
                                            var li_chef_de_projet = document.createElement('li');
                                            li_chef_de_projet.innerHTML = `
                                                <i class="fas fa-user"></i> ${member.display_name} (${member.email}) - ${member.role}
                                            `;
                                            document.getElementById('chef_de_projet').appendChild(li_chef_de_projet);
                                        } else if (member.role === 'comptable') {
                                            var li_comptable = document.createElement('li');
                                            li_comptable.innerHTML = `
                                                <i class="fas fa-user"></i> ${member.display_name} (${member.email}) - ${member.role}
                                            `;
                                            document.getElementById('accountant').appendChild(li_comptable);
                                        } else if (member.role === 'consultant') {
                                            var li_consultant = document.createElement('li');
                                            li_consultant.innerHTML = `
                                                <i class="fas fa-user"></i> ${member.display_name} (${member.email}) - ${member.role}
                                            `;
                                            document.getElementById('consultant').appendChild(li_consultant);
                                        } else if (member.role === 'partenaire') {
                                            var li_partenaire = document.createElement('li');
                                            li_partenaire.innerHTML = `
                                                <i class="fas fa-user"></i> ${member.display_name} (${member.email}) - ${member.role}
                                            `;
                                            document.getElementById('partner').appendChild(li_partenaire);
                                        }
                                    } else {
                                        var li = document.createElement('li');
                                        li.innerHTML = `
                                            <i class="fas fa-user"></i> ${member.display_name} (${member.email}) - Utilisateur
                                        `;
                                        document.getElementById('tous-').appendChild(li);
                                    }
                                });
                            })
                            .catch(error => {
                                console.error('Erreur lors de la récupération des données de l\'utilisateur :', error);
                            });
                    }
                });
                //#endregion
                */
            })
            .catch(error => {
                console.error('Erreur lors de la récupération des données de l\'utilisateur :', error);
            });
    }

    // Récupérer le profile projet de l'utilisateur
    // Fonction pour afficher les diverses informations de l'utilisateur connecté (la liste des projets et rapports dont il est membre, son rôle, son adresse email, son nom, son prénom, son pays, sa ville, sa date de création de compte, sa date de dernière connexion, sa date de dernière activité, sa date de dernière modification, etc..) sous forme d'un formulaire modifiable
    function displayUserProfile() {
        // Récupérer les informations de l'utilisateur connecté
        var user_email = current_user_data.email;
        var userRole = localStorage.getItem('userRole');

        // Vérifier le rôle de l'utilisateur avant d'afficher les informations de son profile projet
        if (userRole === 'Coordinateur' || userRole === 'chef_de_projet' || userRole === 'Administrateur') {

            var allUserProjectsIDs = [];
            // Récupérer tout les IDs des projets de l'utilisateur connecté
            fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    data.forEach(project => {
                        if (project.user_email === user_email) {
                            allUserProjectsIDs.push(project.project_id);
                        }
                    });
                    // Vérifier si l'utilisateur connecté a des projets
                    if (allUserProjectsIDs.length > 0) {
                        // Récupérer tout les projets de l'utilisateur connecté
                        allUserProjectsIDs.forEach(project_id => {
                            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData', {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                            })
                                .then(response => response.json())
                                .then(data => {
                                    data.forEach(project => {
                                        if (project.project_id === project_id) {
                                            var li = document.createElement('li');
                                            li.innerHTML = `
                                                <i class="fas fa-project-diagram"></i> ${project.project_title} (${project.created_date}) - ${project.project_status} <button type="button" id="see_project_${project.project_id}" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
                                                    Aller au projet <i class="fas fa-arrow-right"></i>
                                                </button> <button type="button" id="quit_project_${project.project_id}" style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
                                                    Quitter le projet <i class="fas fa-sign-out-alt"></i>
                                            `;
                                            document.getElementById('connected_user_projects').appendChild(li);
                                            // Ajouter un événement pour voir le projet
                                            document.getElementById(`see_project_${project.project_id}`).addEventListener('click', function () {
                                                localStorage.setItem('project_id', project.project_id);
                                                window.open('https://lab.padem.org/projet', '_blank');
                                            });
                                            //#region Ajouter un événement pour quitter le projet
                                            document.getElementById(`quit_project_${project.project_id}`).addEventListener('click', function () {
                                                Swal.fire({
                                                    title: 'Êtes-vous sûr de vouloir quitter ce projet ?',
                                                    showDenyButton: true,
                                                    confirmButtonText: `Oui`,
                                                    denyButtonText: `Non`,
                                                }).then((result) => {
                                                    if (result.isConfirmed) {
                                                        // Rechercher le projet
                                                        fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable', {
                                                            method: 'GET',
                                                            headers: {
                                                                'Content-Type': 'application/json',
                                                            },
                                                        })
                                                            .then(response => response.json())
                                                            .then(data => {
                                                                data.forEach(project => {
                                                                    if (project.project_id === project_id) {
                                                                        // Supprimer le projet de la liste des projets de l'utilisateur connecté
                                                                        workingTableID = project.Working_Table_Id;
                                                                        // Récupérer la liste des adresses mails des utilisateurs de ce projet
                                                                        var listOfusers = JSON.parse(project.users_emails_list);
                                                                        // Supprimer l'adresse mail de l'utilisateur connecté de la liste des utilisateurs de ce projet
                                                                        var index = listOfusers.indexOf(user_email);
                                                                        if (index > -1) {
                                                                            listOfusers.splice(index, 1);
                                                                        }
                                                                        // Mettre à jour la liste des utilisateurs de ce projet
                                                                        fetch('https://lab.padem.org/wp-json/mo/v1/createWorkingTable', {
                                                                            method: 'POST',
                                                                            headers: {
                                                                                'Content-Type': 'application/json',
                                                                            },
                                                                            body: JSON.stringify({
                                                                                'project_id': project.project_id,
                                                                                'users_emails_list': JSON.stringify(listOfusers)
                                                                            }),
                                                                        })
                                                                            .then(response => response.json())
                                                                            .then(data => {
                                                                                console.log('Liste des utilisateurs mise à jour avec succès :', data);
                                                                                // Supprimer le projet de la liste des projets de l'utilisateur connecté
                                                                                fetch('https://lab.padem.org/wp-json/mo/v1/removeWorkingTable', {
                                                                                    method: 'DELETE',
                                                                                    headers: {
                                                                                        'Content-Type': 'application/json',
                                                                                    },
                                                                                    body: JSON.stringify({
                                                                                        'Working_Table_Id': workingTableID
                                                                                    }),
                                                                                })
                                                                                    .then(response => response.json())
                                                                                    .then(data => {
                                                                                        alert('Projet supprimé avec succès !');
                                                                                        console.log('Projet supprimé avec succès :', data);
                                                                                        // Actualiser la page
                                                                                        window.location.href = 'https://lab.padem.org/membres';
                                                                                    })
                                                                                    .catch(error => {
                                                                                        console.error('Erreur lors de la suppression du projet :', error);
                                                                                    });

                                                                            })
                                                                            .catch(error => {
                                                                                console.error('Erreur lors de la mise à jour de la liste des utilisateurs :', error);
                                                                            });
                                                                    }
                                                                });
                                                            })
                                                            .catch(error => {
                                                                console.error('Erreur lors de la récupération des projets :', error);
                                                            });
                                                    }
                                                });
                                            });
                                            //#endregion
                                        }
                                    });
                                })
                                .catch(error => {
                                    console.error('Erreur lors de la récupération des projets :', error);
                                });
                        });

                    } else {
                        // Afficher un message d'erreur si l'utilisateur n'a pas de projets
                        var p = document.createElement('p');
                        p.innerHTML = 'Vous n\'avez pas de projets pour le moment.';
                        document.getElementById('connected_user_projects').appendChild(p);
                    }
                })
                .catch(error => {
                    console.error('Erreur lors de la récupération des projets de l\'utilisateur :', error);
                });

            all_members.forEach(member => {
                if (member.email === user_email) {
                    var form = document.createElement('form');
                    form.id = 'user_profile_form';
                    form.style.display = 'block';
                    form.style.padding = '10px';
                    form.style.border = '1px solid #29A6A7';
                    form.style.borderRadius = '15px';
                    form.style.margin = '5px';
                    form.style.backgroundColor = 'white';
                    form.style.color = 'gray';
                    form.style.fontSize = '13px';
                    form.style.width = '100%';
                    form.innerHTML = `
                    <label for="email">Adresse email :</label>
                    <input type="email" id="email" name="email" value="${member.email}" readonly>
                    <label for="role">Rôle :</label>
                    <input type="text" id="role" name="role" value="${member.role}" readonly>
                    <label for="display_name">Nom d'affichage :</label>
                    <input type="text" id="display_name" name="display_name" value="${member.display_name}" readonly>
                    <label for="user_registered_date">Date de création de compte :</label>
                    <input type="text" id="user_registered_date" name="user_registered_date" value="${member.user_registered_date}" readonly>
                `;
                    document.getElementById('my-project-profile').appendChild(form);
                }
            });

        } else {
            // Afficher un message d'erreur si l'utilisateur n'a pas le rôle de chef de projet, consultant, comptable ou partenaire.
            var p = document.createElement('p');
            p.innerHTML = 'Vous devez être chef de projet, consultant, comptable ou partenaire pour voir les informations de votre profile projet.';
            document.getElementById('connected_user_projects').appendChild(p);
        }
    }

    // Ajouter un membre à un projet
    function addMemberToProject() {
        var user_email = current_user_data.email;
        var userRole = localStorage.getItem('userRole');

        // Attribuer un rôle et ajouter un utilisateur déjà inscrit sur le site mais n'ayant pas accès à un projet (grâce à son adresse email)

        // Ajouter un utilisateur non inscrit sur le site (grâce à son adresse email) et lui attribuer un rôle
        /*
                fetch('https://lab.padem.org/wp-json/mo/v1/createWorkingTable', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(member),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Membre ajouté avec succès :', data);
                    })
                    .catch(error => {
                        console.error('Erreur lors de l\'ajout du membre :', error);
                    });
                    */
    }


</script>
<!--#endregion-->