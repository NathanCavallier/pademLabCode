<!-- Description: Afficher la liste des projets en cours -->

<body>
    <!-- Afficher la liste des projets en cours -->
    <ul id="projectsList" style="text-decoration: none;"></ul>
</body>


<script>
    // Projet: Récurérer les données depuis la base de données et les afficher dans des cellules individuels cliquables pour les modifier
    document.addEventListener('DOMContentLoaded', () => {
        // Déclarer les variables
        var userId;
        var userEmail = '';
        var userRole = '';
        var buttonText = 'Compléter le projet';
        var numberOfMembers = 0;
        var localStatus = '';
        var projectStatus = '';

        // Récupérer la liste des projets depuis la base de données (à partir de l'API (https://lab.padem.org/wp-json/mo/v1/getProjects))
        // les projets sont affichés dans des lignes individuelles avec un bouton cliquables pour les modifier
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjects', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                var colorStatusText = {
                    'En cours': 'green',
                    'Terminé': 'lightred',
                    'En pause': 'lightblue',
                    'Annulé': 'gray',
                    'Non commencé': 'lightgray',
                };
                var colorStatusBackground = {
                    'Complet': 'green',
                    'Incomplet': 'red',
                };
                var stepper = 0;
                // Parcourir la liste des projets
                data.forEach(project => {
                    // Créer un élément de liste pour chaque projet
                    var li = document.createElement('li');
                    var divNewElement = document.createElement('div');

                    // Ajouter le titre du projet, la date de début, la date de fin, le pays, le référent et le statut dans des éléments individuels
                    li.style.color = 'black';
                    li.style.textAlign = 'left';
                    li.style.border = 'none';
                    li.style.borderRadius = '15px';
                    li.style.backgroundColor = 'white';
                    li.style.height = 'auto';
                    li.style.width = '100%';
                    li.style.display = 'flex';
                    li.style.justifyContent = 'space-between';
                    li.style.padding = '10px';
                    li.style.margin = '10px';
                    li.style.border = '1px #5AC4C4D0';
                    li.style.textDecoration = 'none';

                    projectStatus = project.project_status;
                    numberOfMembers = project.users_list.length;
                    if (numberOfMembers === 0 || project.users_list === null || project.users_list === undefined) {
                        localStatus = 'Incomplet';
                        buttonText = 'Compléter le projet';
                        projectStatus = 'Non commencé';
                    } else if (numberOfMembers > 0) {
                        localStatus = 'Complet';
                        buttonText = 'Modifier le projet';
                    }

                    // Ajouter les données dans l'élément de liste
                    li.innerHTML = `
                        <ul style="list-style-type: none; padding: 0; margin: 0;">
                            <li style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                                <span style="font-weight: bold; color: #29A6A7;">${project.project_title}</span>
                                <span>${project.project_location}</span>
                                <span>Membres: ${numberOfMembers}</span>
                                <span style="text-transform: capitalize; font-weight: bold; color: ${colorStatusText[projectStatus]}; background: white; margin: 5px; padding: 5px; boder-radius: 20px;" id="status_${project.project_id}">${projectStatus}</span>
                                <span style="font-weight: bold; font-size: 11px; color: ${colorStatusBackground[localStatus]};">${localStatus}</span>
                                <span style="display: 'flex'; justify-content: 'flex-end';">
                                    <div style="margin-right: 10px;"></div>
                                    <button class="buttonModifier" id="buttonModifier_${project.project_id}" style="margin: 5px; padding: 5px; boder-radius: 20px; font-size: 11px;">${buttonText}</button>
                                </span>
                            </li>
                            <div style="margin: 5px; padding: 5px;"></div>
                            <li id="modifyProject_${project.project_id}" style="display: none; width: 100%; height: auto; background: white; margin: 10px; padding: 10px; border-radius: 10px; border: 1px #5AC4C4D0;">
                                <hr style="border: 1px solid #29A6A7;">
                                <div class="row">
                                    <div class="col-md-12">
                                    <div class="row">
                                    <div style="margin-top: 5px; padding: 5px;"></div>
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button type="button" class="btn btn-primary"
                                                    style="width: fit-content; color: #29A6A7; border-radius: 20px;" onclick="showModifyProject()">
                                                    Compléter le projet
                                                </button>
                                            </div>
                                        </div>
                                        <!-- Afficher une liste de boutons à l'horizontale permettant de faire apparaître le type d'éléments à ajouter au projet -->
                                        <div class="col-md-12" id="modifyProject" style="display: none; width: 100%; background: white;">
                                            <div class="row">
                                                <div class="btn-group" role="group" aria-label="Basic example">
                                                    <button type="button" id="buttonNewMember" class="btn btn-secondary" onclick="showNewMember()"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Nouveau membre</button>
                                                    <button type="button" id="buttonExistingMember" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Membre existant</button>
                                                    <button type="button" id="buttonReportRequest" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Demande de Rapport</button>
                                                    <button type="button" id="buttonDocumentModel" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Document model</button>
                                                    <button type="button" id="buttonAddLink" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Ajouter un Lien</button>
                                                    <button type="button" id="buttonAddDivers" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Divers</button>
                                                </div>
                                            </div>
                                            <div id="newMember" style="display: none;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="newMemberEmail">Adresse email du nouveau membre</label>
                                                            <input type="email" class="form-control" id="newMemberEmail" aria-describedby="emailHelp">
                                                            <label for="last_name">Nom</label>
                                                            <input type="text" class="form-control" id="last_name" aria-describedby="emailHelp">
                                                            <label for="first_name">Prénom</label>
                                                            <input type="text" class="form-control" id="first_name" aria-describedby="emailHelp">
                                                            <small id="emailHelp-2" class="form-text text-muted">Nous ne partagerons jamais votre adresse
                                                                email avec qui que ce soit.</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="newMemberRole">Rôle du nouveau membre</label>
                                                            <select class="form-control" id="newMemberRole">
                                                                <option value="Coordinateur">Coordinateur</option>
                                                                <option value="chef-de-projet">Chef de projet</option>
                                                                <option value="comptable">Comptable</option>
                                                                <option value="consultant">Consultant</option>
                                                                <option value="partenaire">Partenaire</option>
                                                                <option value="bailleur">Bailleur</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                    <button type="submit" class="btn btn-primary" id="buttonAddMember">Ajouter le nouveau membre</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="existingMember" style="display: none;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="existingMemberEmail">Adresse email du membre existant</label>
                                                            <select class="form-control" id="existingMemberEmail">
                                                            </select>
                                                            <small id="emailHelp" class="form-text text-muted">Nous ne partagerons jamais votre adresse
                                                                email avec qui que ce soit.</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="existingMemberRole">Rôle du membre existant</label>
                                                            <select class="form-control" id="existingMemberRole">
                                                                <option>Administrateur</option>
                                                                <option>Chef de projet</option>
                                                                <option>Comptable</option>
                                                                <option>Consultant</option>
                                                                <option>Partenaire</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="addExistingMember">Ajouter le membre existant</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newReport" style="display: none;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="reportTitle">Titre du rapport</label>
                                                            <input type="text" class="form-control" id="reportTitle" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="reportDescription">Description du rapport</label>
                                                            <textarea class="form-control" id="reportDescription" rows="3"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="submitReport">Ajouter le rapport</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newDocument" style="display: none;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="documentTitle">Titre du document</label>
                                                            <input type="text" class="form-control" id="documentTitle" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="documentDescription">Description du document</label>
                                                            <textarea class="form-control" id="documentDescription" rows="5"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="documentFile">Charger le document </label>
                                                            <input type="file" class="form-control-file" id="documentFile">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="newDocument">Ajouter le document</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newLink" style="display: none;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="linkTitle">Titre du lien</label>
                                                            <input type="text" class="form-control" id="linkTitle" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="linkDescription">Description du lien</label>
                                                            <textarea class="form-control" id="linkDescription" rows="5"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="linkUrl">URL du lien</label>
                                                            <input type="text" class="form-control" id="linkUrl" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="linkSubmit">Ajouter le lien</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newMisc" style="display: none;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="miscTitle">Titre de l'élément</label>
                                                            <input type="text" class="form-control" id="miscTitle" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="miscDescription">Description de l'élément</label>
                                                            <textarea class="form-control" id="miscDescription" rows="5"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="miscFile">Charger un document </label>
                                                            <input type="file" class="form-control-file" id="miscFile">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="buttonAddMisc">Ajouter l'élément</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                            </li>
                        </ul>
                    `;
                    // Ajouter l'élément de liste dans la liste des projets
                    document.getElementById('projectsList').appendChild(li);

                    // Ajouter un gestionnaire d'événement pour chaque bouton "Compléter le projet ou Modifier le projet"
                    document.getElementById(`buttonModifier_${project.project_id}`).addEventListener('click', () => {
                        if (document.getElementById(`modifyProject_${project.project_id}`).style.display === 'none') {
                            document.getElementById(`modifyProject_${project.project_id}`).style.display = 'block';
                        } else {
                            document.getElementById(`modifyProject_${project.project_id}`).style.display = 'none';
                        }
                    });


                    // Ajouter un gestionnaire d'événement pour chaque élément de liste
                    document.getElementById(`buttonExistingMember_${project.project_id}`).addEventListener('click', () => {
                        document.getElementById(`existingMember_${project.project_id}`).style.display = 'block';
                        document.getElementById('newMember').style.display = 'none';
                        document.getElementById('newReport').style.display = 'none';
                        document.getElementById('newDocument').style.display = 'none';
                        document.getElementById('newLink').style.display = 'none';
                        document.getElementById('newMisc').style.display = 'none';
                    });

                    document.getElementById('buttonReportRequest').addEventListener('click', () => {
                        document.getElementById('newReport').style.display = 'block';
                        document.getElementById('newMember').style.display = 'none';
                        document.getElementById('existingMember').style.display = 'none';
                        document.getElementById('newDocument').style.display = 'none';
                        document.getElementById('newLink').style.display = 'none';
                        document.getElementById('newMisc').style.display = 'none';
                    });

                    document.getElementById('buttonDocumentModel').addEventListener('click', () => {
                        document.getElementById('newDocument').style.display = 'block';
                        document.getElementById('newMember').style.display = 'none';
                        document.getElementById('existingMember').style.display = 'none';
                        document.getElementById('newReport').style.display = 'none';
                        document.getElementById('newLink').style.display = 'none';
                        document.getElementById('newMisc').style.display = 'none';
                    });

                    document.getElementById('buttonNewMember').addEventListener('click', () => {
                        document.getElementById('newMember').style.display = 'block';
                        document.getElementById('existingMember').style.display = 'none';
                        document.getElementById('newReport').style.display = 'none';
                        document.getElementById('newDocument').style.display = 'none';
                        document.getElementById('newLink').style.display = 'none';
                        document.getElementById('newMisc').style.display = 'none';
                    });

                    document.getElementById('buttonAddLink').addEventListener('click', () => {
                        document.getElementById('newLink').style.display = 'block';
                        document.getElementById('newMember').style.display = 'none';
                        document.getElementById('existingMember').style.display = 'none';
                        document.getElementById('newReport').style.display = 'none';
                        document.getElementById('newDocument').style.display = 'none';
                        document.getElementById('newMisc').style.display = 'none';
                    });

                    document.getElementById('buttonAddDivers').addEventListener('click', () => {
                        document.getElementById('newMisc').style.display = 'block';
                        document.getElementById('newLink').style.display = 'none';
                        document.getElementById('newMember').style.display = 'none';
                        document.getElementById('existingMember').style.display = 'none';
                        document.getElementById('newReport').style.display = 'none';
                        document.getElementById('newDocument').style.display = 'none';
                    });

                    stepper++;
                    if (stepper === 2) {
                        li.style.backgroundColor = '#F2F1F1';
                        li.style.borderColor = 'lightgray';
                        stepper = 0;
                    } else {
                        li.style.backgroundColor = 'white';
                    }
                });
            })
            .catch(error => {
                console.error(error);
            });

        // Fonction pour modifier un projet
        function modifierProjet(projectId) {
            var divNewElement = document.getElementById(projectId);



            if (divNewElement.style.display === 'none') {
                divNewElement.style.display = 'block';
            } else {
                divNewElement.style.display = 'none';
            }
        }


    });
</script>