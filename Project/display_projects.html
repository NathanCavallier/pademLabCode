<!-- Description: Afficher la liste des projets en cours -->

<body>
    <!-- Afficher la liste des projets en cours -->
    <ul id="projectsList"></ul>
</body>


<script>
    // Projet: Récurérer les données depuis la base de données et les afficher dans des cellules individuels cliquables pour les modifier
    document.addEventListener('DOMContentLoaded', (event) => {
        // Déclarer les variables
        var userId;
        var userEmail = '';
        var userRole = '';
        var buttonText = 'Compléter le projet';
        var numberOfMembers = 0;
        var localStatus = '';
        var projectStatus = '';

        var listOfAllMembersEmailOnPademLab = [];

        //#region Récupérer l'ID de l'utilisateur connecté
        fetch('https://lab.padem.org/wp-json/mo/v1/getUserId', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                data.forEach(user => {
                    if (user['meta_key'] === 'wp_capabilities') {
                        userId = user.user_id;
                    }
                });
            })
            .catch(error => {
                console.error('Error:', error);
            });
        //#endregion

        //#region Récupérer les emails des utilisateurs qui ont l'ID du projet
        function getProjectUsersEmails(projectId) {

            //#region Récupérer les emails des chefs de projet
            fetch('https://lab.padem.org/wp-json/mo/v1/getProjectChief', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    data.forEach(user => {
                        if (user.project_id === projectId) {
                            var option = document.createElement('option');
                            option.value = user.chief_email;
                            option.text = user.chief_first_name - user.chief_last_name + ' - ' + 'Chef de projet';
                            document.getElementById('consigneDescription_' + projectId).appendChild(option);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            //#endregion

            //#region Récupérer les emails des Coordinateurs
            fetch('https://lab.padem.org/wp-json/mo/v1/getCoordinator', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    data.forEach(user => {
                        if (user.project_id === projectId) {
                            var option = document.createElement('option');
                            option.value = user.coordinator_email;
                            option.text = user.coordinator_first_name + ' ' + user.coordinator_last_name + ' - ' + 'Coordinateur';
                            document.getElementById('listOfdestinataires_' + projectId).appendChild(option);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            //#endregion

            //#region Récupérer les emails des comptables
            fetch('https://lab.padem.org/wp-json/mo/v1/getAccountant', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    data.forEach(user => {
                        if (user.project_id === projectId) {
                            var option = document.createElement('option');
                            option.value = user.accountant_email;
                            option.text = user.accountant_first_name + ' ' + user.accountant_last_name + ' - ' + 'Comptable';
                            document.getElementById('listOfdestinataires_' + projectId).appendChild(option);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            //#endregion

            //#region Récupérer les emails des consultants
            fetch('https://lab.padem.org/wp-json/mo/v1/getConsultant', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    data.forEach(user => {
                        if (user.project_id === projectId) {
                            var option = document.createElement('option');
                            option.value = user.consultant_email;
                            option.text = user.consultant_first_name + ' ' + user.consultant_last_name + ' - ' + 'Consultant';
                            document.getElementById('listOfdestinataires_' + projectId).appendChild(option);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            //#endregion

            //#region Récupérer les emails des partenaires
            fetch('https://lab.padem.org/wp-json/mo/v1/getPartner', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    data.forEach(user => {
                        if (user.project_id === projectId) {
                            var option = document.createElement('option');
                            option.value = user.partner_email;
                            option.text = user.partner_first_name + ' ' + user.partner_last_name + ' - ' + 'Partenaire';
                            document.getElementById('listOfdestinataires_' + projectId).appendChild(option);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            //#endregion

            //#region Récupérer l'email du referent du projet
            fetch('https://lab.padem.org/wp-json/mo/v1/getReferent', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.project_id === projectId) {
                        var option = document.createElement('option');
                        option.value = data.referent_email;
                        option.text = data.referent_first_name + ' ' + data.referent_last_name + ' - ' + 'Référent du projet';
                        document.getElementById('listOfdestinataires_' + projectId).appendChild(option);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            //#endregion
        }
        //#endregion

        //#region Récupérer les emails et les rôles des utilisateurs depuis la base de données (à partir de l'API (https://lab.padem.org/wp-json/mo/v1/getUserEmailAndState))
        function getAllUsersEmails(projectId) {
            fetch('https://lab.padem.org/wp-json/mo/v1/getUserEmailAndState', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    data.forEach(user => {
                        var option = document.createElement('option');
                        option.value = user.user_email;
                        option.text = user.user_email + ' - ' + user.user_login;
                        document.getElementById('existingMemberEmail_' + projectId).appendChild(option);
                        listOfAllMembersEmailOnPademLab.push(user.user_email);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        //#endregion

        // Récupérer la liste des projets depuis la base de données (à partir de l'API (https://lab.padem.org/wp-json/mo/v1/getProjects))
        // les projets sont affichés dans des lignes individuelles avec un bouton cliquables pour les modifier
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjects', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                var colorStatusText = {
                    'Publié': 'green',
                    'Non publié': 'gray',
                };
                var colorStatusBackground = {
                    'Complet': 'green',
                    'Incomplet': 'red',
                };
                var stepper = 0;
                // Parcourir la liste des projets
                data.forEach(project => {
                    // Créer un élément de liste pour chaque projet
                    var li = document.createElement('li');
                    var project_id = project.project_id;

                    //#region Style de l'élément de liste
                    li.style.color = 'black';
                    li.style.textAlign = 'left';
                    li.style.border = '1px #29A6A7';
                    li.style.borderRadius = '15px';
                    li.style.backgroundColor = 'white';
                    stepper++;
                    if (stepper === 2) {
                        li.style.border = 'none';
                        stepper = 0;
                    }
                    li.style.height = 'auto';
                    li.style.width = '95%';
                    li.style.display = 'flex';
                    li.style.justifyContent = 'space-between';
                    li.style.padding = '10px';
                    li.style.margin = '10px';
                    li.style.textDecoration = 'none';

                    projectStatus = project.project_status;
                    numberOfMembers = project.users_list.length;
                    if (numberOfMembers === 0 || project.users_list === null || project.users_list === undefined) {
                        localStatus = 'Incomplet';
                        buttonText = 'Compléter le projet';
                        projectStatus = 'Non publié';

                    } else if (numberOfMembers > 0) {
                        localStatus = 'Complet';
                        buttonText = 'Modifier le projet';
                        projectStatus = 'Publié';
                    }
                    //#endregion

                    // Récupérer les emails des utilisateurs qui ont l'ID du projet
                    getProjectUsersEmails(project_id);

                    // Récuperer les emails des utilisateurs inscrits sur Padem Lab
                    getAllUsersEmails(project_id);

                    //#region Ajouter les données dans l'élément de liste
                    li.innerHTML = `
                        <div style="list-style-type: none; padding: 5px; margin: 5px; border-radius: 10px;">
                            <ul class="project-row" style="width: fit-content;">
                                <li class="project-element" style="font-weight: bold; color: #29A6A7;">${project.project_title}</li>
                                <li class="project-element">${project.project_location}</li>
                                <li class="project-element">Membres: ${numberOfMembers}</li>
                                <li class="project-element" style="text-transform: capitalize; font-weight: bold; color: ${colorStatusText[projectStatus]}; background: none; margin: 5px; padding: 5px; boder-radius: 20px;" id="status_${project.project_id}">${projectStatus}</li>
                                <li class="project-element" style="font-weight: bold; font-size: 11px; color: ${colorStatusBackground[localStatus]};">${localStatus}</li>
                                <li class="project-element" style="display: 'flex'; justify-content: 'flex-end';">
                                    <div style="margin-right: 10px;"></div>
                                    <button class="buttonModifier" id="buttonModifier_${project_id}" style="margin: 5px; padding: 5px; boder-radius: 20px; font-size: 11px;">${buttonText}</button>
                                </li>
                            </ul>
                            <div id="modifyProject_${project_id}" style="display: none; width: 100%; height: auto; background: white; margin: 10px; padding: 10px; border-radius: 10px; border: 1px #5AC4C4D0;">
                                <hr style="border: 1px solid #29A6A7;">
                                <div style="margin: 5px; padding: 5px;"></div>
                                <div class="row">
                                    <div class="col-md-12">
                                    <div class="row">
                                    <div style="margin-top: 5px; padding: 5px;"></div>
                                    <div class="container">
                                        <!-- Afficher une liste de boutons à l'horizontale permettant de faire apparaître le type d'éléments à ajouter au projet -->
                                        <div class="col-md-12" style="width: 100%; background: white;">
                                            <div class="row" style="width: 100%;">
                                                <div class="btn-group" role="group" aria-label="menu" style="width: 100%;">
                                                    <button type="button" id="buttonReportRequest_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Envoyer un message</button>
                                                    <div style="margin: 5px; padding: 5px;"></div>
                                                    <div style="margin: 5px; padding: 5px;"></div>
                                                    <button type="button" id="buttonNewMember_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Nouveau membre</button>
                                                    <button type="button" id="buttonExistingMember_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Membre existant</button>
                                                    <button type="button" id="buttonDocumentModel_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Document model</button>
                                                    <button type="button" id="buttonAddLink_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Ajouter un Lien</button>
                                                    <button type="button" id="buttonAddDivers_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: #29A6A7; color: white; font-size: 10px; border-radius: 20px;">
                                                        Divers</button>
                                                </div>
                                            </div>
                                            <div style="margin: 5px; padding: 5px;"></div>
                                            <div id="newMember_${project_id}" style="display: none; width: 100%">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="newMemberEmail_${project_id}" required>Adresse email du nouveau membre: </label>
                                                            <input type="email" class="form-control" id="newMemberEmail_${project_id}" aria-describedby="emailHelp">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="last_name_${project_id}">Nom: </label>
                                                            <input type="text" class="form-control" id="last_name_${project_id}" aria-describedby="emailHelp">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="first_name_${project_id}">Prénom: </label>
                                                            <input type="text" class="form-control" id="first_name_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="newMemberRole_${project_id}">Rôle du nouveau membre: </label>
                                                            <select class="form-control" id="newMemberRole_${project_id}" required>
                                                                <option value="Coordinateur">Coordinateur</option>
                                                                <option value="chef-de-projet">Chef de projet</option>
                                                                <option value="comptable">Comptable</option>
                                                                <option value="consultant">Consultant</option>
                                                                <option value="partenaire">Partenaire</option>
                                                                <option value="bailleur">Bailleur</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="newMemberCityAndCountry_${project_id}">Ville et pays du nouveau membre: </label>
                                                            <input type="text" class="form-control" id="newMemberCityAndCountry_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="buttonAddMember_${project_id}" style="width: fit-content;">Ajouter le nouveau membre au projet</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="existingMember_${project_id}" style="display: none; width: 100%;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="existingMemberEmail_${project_id}">Adresse email du membre existant: </label>
                                                            <select class="form-control" id="existingMemberEmail_${project_id}" required>
                                                            </select>
                                                        </div>
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="existingMember_last_name_${project_id}">Nom du membre existant: </label>
                                                            <input type="text" class="form-control" id="existingMember_last_name_${project_id}" aria-describedby="emailHelp">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="existingMember_first_name_${project_id}">Prénom du membre existant: </label>
                                                            <input type="text" class="form-control" id="existingMember_first_name_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="existingMemberRole_${project_id}">Rôle du membre existant: </label>
                                                            <select class="form-control" id="existingMemberRole_${project_id}" required>
                                                                <option value="Coordinateur">Coordinateur</option>
                                                                <option value="chef-de-projet">Chef de projet</option>
                                                                <option value="comptable">Comptable</option>
                                                                <option value="consultant">Consultant</option>
                                                                <option value="partenaire">Partenaire</option>
                                                                <option value="bailleur">Bailleur</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="existingMemberCityAndCountry_${project_id}">Ville et pays du membre existant: </label>
                                                            <input type="text" class="form-control" id="existingMemberCityAndCountry_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="addExistingMember_${project_id}" style="width: fit-content;">Ajouter le membre existant au projet</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newReport_${project_id}" style="display: none; width: 100%;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="listOfdestinataires_${project_id}">Sélectionnez un ou plusieurs destinataires : </label>
                                                            <select class="form-control" id="listOfdestinataires_${project_id}" multiple required>
                                                            </select>
                                                        </div>
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="messageObject_${project_id}">Objet du message ou de la demande: </label>
                                                            <input type="text" class="form-control" id="messageObject_${project_id}" aria-describedby="emailHelp" required></input>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="messageDescription_${project_id}">Saisissez votre message : </label>
                                                            <textarea class="form-control" id="messageDescription_${project_id}" rows="8" required></textarea>
                                                        </div>
                                                    </div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label for="joinedFiles_${project_id}">Ajouter des fichiers joints: </label>
                                                            <input type="file" class="form-control" id="joinedFiles_${project_id}" multiple>
                                                        </div>
                                                    </div>
                                                    <div style="margin: 5px; padding: 5px;"></div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="submitReport_${project_id}" style="width: fit-content;">Envoyer le message</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newDocument_${project_id}" style="display: none; width: 100%;">
                                                <div class="row">
                                                    <div class="column">
                                                        <div>
                                                            <div class="col-md-12">
                                                                <div class="form-group">
                                                                    <div style="margin: 5px; padding: 5px;"></div>
                                                                    <label for="documentTitle_${project_id}">Titre du document: </label>
                                                                    <input type="text" class="form-control" id="documentTitle_${project_id}" aria-describedby="emailHelp">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-12">
                                                                <div class="form-group">
                                                                    <div style="margin: 5px; padding: 5px;"></div>
                                                                    <label for="documentDescription_${project_id}">Description du document: </label>
                                                                    <textarea class="form-control" id="documentDescription_${project_id}" rows="5"></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-12">
                                                                <div class="form-group">
                                                                    <div style="margin: 5px; padding: 5px;"></div>
                                                                    <label for="documentFile_${project_id}">Charger le document: </label>
                                                                    <input type="file" class="form-control-file" id="documentFile_${project_id}">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>

                                                        </div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="submitDocument_${project_id}" style="width: fit-content;">Ajouter le document au projet</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newLink_${project_id}" style="display: none; width: 100%;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="linkTitle_${project_id}">Titre du lien</label>
                                                            <input type="text" class="form-control" id="linkTitle_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="linkDescription_${project_id}">Description du lien: </label>
                                                            <textarea class="form-control" id="linkDescription_${project_id}" rows="5"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="linkUrl_${project_id}">Saisir le lien: </label>
                                                            <input type="text" class="form-control" id="linkUrl_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="linkSubmit_${project_id}" style="width: fit-content;">Ajouter le lien au projet</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newMisc_${project_id}" style="display: none; width: 100%;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="miscTitle_${project_id}">Titre de l'élément: </label>
                                                            <input type="text" class="form-control" id="miscTitle_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="miscDescription_${project_id}">Description de l'élément: </label>
                                                            <textarea class="form-control" id="miscDescription_${project_id}" rows="5"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="miscFile_${project_id}">Charger un document: </label>
                                                            <input type="file" class="form-control-file" id="miscFile_${project_id}">
                                                        </div>
                                                    </div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary" id="buttonAddMisc_${project_id}" style="width: fit-content;">Ajouter l'élément au projet</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    `;
                    //#endregion
                    // Ajouter l'élément de liste dans la liste des projets
                    document.getElementById('projectsList').appendChild(li);

                    // Ajouter un gestionnaire d'événement pour chaque bouton "Compléter le projet ou Modifier le projet"
                    document.getElementById(`buttonModifier_${project_id}`).addEventListener('click', () => {

                        if (document.getElementById(`modifyProject_${project_id}`).style.display === 'none') {
                            li.style.backgroundColor = '#f2f2f2';
                            document.getElementById(`modifyProject_${project_id}`).style.display = 'block';
                            document.getElementById(`buttonModifier_${project_id}`).style.backgroundColor = 'red';
                            document.getElementById(`buttonModifier_${project_id}`).innerText = 'Annuler';
                        } else {
                            li.style.backgroundColor = '#ffffff';
                            document.getElementById(`modifyProject_${project_id}`).style.display = 'none';
                            document.getElementById(`buttonModifier_${project_id}`).innerText = 'Compléter le projet';
                            document.getElementById(`buttonModifier_${project_id}`).style.backgroundColor = 'green';

                            //#region masquer les formulaires
                            document.getElementById('newMember_' + project_id).style.display = 'none';
                            document.getElementById('existingMember_' + project_id).style.display = 'none';
                            document.getElementById('newReport_' + project_id).style.display = 'none';
                            document.getElementById('newDocument_' + project_id).style.display = 'none';
                            document.getElementById('newLink_' + project_id).style.display = 'none';
                            document.getElementById('newMisc_' + project_id).style.display = 'none';
                            //#endregion

                            //#region  Supprimer toutes les informations des formulaires
                            document.getElementById(`newMemberEmail_${project_id}`).value = '';
                            document.getElementById(`newMemberRole_${project_id}`).value = '';
                            document.getElementById(`last_name_${project_id}`).value = '';
                            document.getElementById(`first_name_${project_id}`).value = '';
                            document.getElementById(`existingMemberEmail_${project_id}`).value = '';
                            document.getElementById(`existingMemberRole_${project_id}`).value = '';
                            document.getElementById(`reportTitle_${project_id}`).value = '';
                            document.getElementById(`reportDescription_${project_id}`).value = '';
                            document.getElementById(`documentTitle_${project_id}`).value = '';
                            document.getElementById(`documentDescription_${project_id}`).value = '';
                            document.getElementById(`documentFile_${project_id}`).value = '';
                            document.getElementById(`linkTitle_${project_id}`).value = '';
                            document.getElementById(`linkDescription_${project_id}`).value = '';
                            document.getElementById(`linkUrl_${project_id}`).value = '';
                            document.getElementById(`miscTitle_${project_id}`).value = '';
                            document.getElementById(`miscDescription_${project_id}`).value = '';
                            document.getElementById(`miscFile_${project_id}`).value = '';
                            document.getElementById(`messageObject_${project_id}`).value = '';
                            document.getElementById(`messageDescription_${project_id}`).value = '';
                            document.getElementById(`joinedFiles_${project_id}`).value = '';
                            //#endregion

                            if (numberOfMembers === 0) {
                                document.getElementById(`buttonModifier_${project_id}`).innerText = 'Compléter le projet';
                                buttonText = 'Compléter le projet';
                                projectStatus = 'Non publié';
                                document.getElementById(`status_${project_id}`).innerText = projectStatus;
                            }
                            else {
                                buttonText = 'Modifier le projet';
                                document.getElementById(`buttonModifier_${project_id}`).innerText = 'Modifier le projet';
                                projectStatus = 'Publié';
                                document.getElementById(`status_${project_id}`).innerText = 'Publié';
                            }
                        }

                        //#region Réinitialiser les couleurs des boutons
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                        //#endregion
                    });

                    // Ajouter un gestionnaire d'événement pour chaque bouton "Nouveau membre", "Membre existant", "Demande de rapport", "Document model", "Ajouter un lien", "Ajouter divers"
                    document.getElementById(`buttonExistingMember_${project_id}`).addEventListener('click', () => {
                        // Afficher le formulaire pour ajouter un membre existant
                        document.getElementById(`existingMember_${project_id}`).style.display = 'block';
                        document.getElementById('newMember_' + project_id).style.display = 'none';
                        document.getElementById('newReport_' + project_id).style.display = 'none';
                        document.getElementById('newDocument_' + project_id).style.display = 'none';
                        document.getElementById('newLink_' + project_id).style.display = 'none';
                        document.getElementById('newMisc_' + project_id).style.display = 'none';

                        // Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                    });

                    document.getElementById('buttonReportRequest_' + project_id).addEventListener('click', () => {
                        document.getElementById('newReport_' + project_id).style.display = 'block';
                        document.getElementById('newMember_' + project_id).style.display = 'none';
                        document.getElementById('existingMember_' + project_id).style.display = 'none';
                        document.getElementById('newDocument_' + project_id).style.display = 'none';
                        document.getElementById('newLink_' + project_id).style.display = 'none';
                        document.getElementById('newMisc_' + project_id).style.display = 'none';

                        // Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.color = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                    });

                    document.getElementById('buttonDocumentModel_' + project_id).addEventListener('click', () => {
                        document.getElementById('newDocument_' + project_id).style.display = 'block';
                        document.getElementById('newMember_' + project_id).style.display = 'none';
                        document.getElementById('existingMember_' + project_id).style.display = 'none';
                        document.getElementById('newReport_' + project_id).style.display = 'none';
                        document.getElementById('newLink_' + project_id).style.display = 'none';
                        document.getElementById('newMisc_' + project_id).style.display = 'none';

                        // Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                    });

                    document.getElementById('buttonNewMember_' + project_id).addEventListener('click', () => {
                        document.getElementById('newMember_' + project_id).style.display = 'block';
                        document.getElementById('existingMember_' + project_id).style.display = 'none';
                        document.getElementById('newReport_' + project_id).style.display = 'none';
                        document.getElementById('newDocument_' + project_id).style.display = 'none';
                        document.getElementById('newLink_' + project_id).style.display = 'none';
                        document.getElementById('newMisc_' + project_id).style.display = 'none';

                        // Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = 'white';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                    });

                    document.getElementById('buttonAddLink_' + project_id).addEventListener('click', () => {
                        document.getElementById('newLink_' + project_id).style.display = 'block';
                        document.getElementById('newMember_' + project_id).style.display = 'none';
                        document.getElementById('existingMember_' + project_id).style.display = 'none';
                        document.getElementById('newReport_' + project_id).style.display = 'none';
                        document.getElementById('newDocument_' + project_id).style.display = 'none';
                        document.getElementById('newMisc_' + project_id).style.display = 'none';

                        // Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                    });

                    document.getElementById('buttonAddDivers_' + project_id).addEventListener('click', () => {
                        document.getElementById('newMisc_' + project_id).style.display = 'block';
                        document.getElementById('newLink_' + project_id).style.display = 'none';
                        document.getElementById('newMember_' + project_id).style.display = 'none';
                        document.getElementById('existingMember_' + project_id).style.display = 'none';
                        document.getElementById('newReport_' + project_id).style.display = 'none';
                        document.getElementById('newDocument_' + project_id).style.display = 'none';

                        //#region Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonReportRequest_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = 'white';
                        //#endregion
                    });

                    // Ajouter un gestionnaire d'événement pour chaque bouton "Ajouter le nouveau membre", "Ajouter le nouveau rapport", "Ajouter le nouveau document", "Ajouter le nouveau lien", "Ajouter divers"
                    document.getElementById('buttonAddMember_' + project_id).addEventListener('click', () => {
                        var newMemberEmail = document.getElementById('newMemberEmail_' + project_id).value || '';
                        var newMemberRole = document.getElementById('newMemberRole_' + project_id).value || '';
                        var lastName = document.getElementById('last_name_' + project_id).value || '';
                        var firstName = document.getElementById('first_name_' + project_id).value || '';
                        var cityAndCountry = document.getElementById('newMemberCityAndCountry_' + project_id).value || '';

                        if (newMemberEmail === '' || newMemberRole === '' || firstName === '') {
                            alert('Veuillez remplir tous les champs. (Email, Rôle et Prénom (le Nom est optionnel))');
                            return;
                        }

                        var users_list = {
                            'emails_names': {
                                'Coordinateur': 'coordinator_email',
                                'chef-de-projet': 'chief_email',
                                'partenaire': 'partner_email',
                                'comptable': 'accountant_email',
                                'consultant': 'consultant_email',
                                'bailleur': 'funder_email'
                            },
                            'users': {
                                'Coordinateur': [],
                                'chef-de-projet': [],
                                'partenaire': [],
                                'comptable': [],
                                'consultant': [],
                                'bailleur': []
                            },
                            'urls': {
                                'Coordinateur': 'https://lab.padem.org/wp-json/mo/v1/getCoordinator',
                                'chef-de-projet': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
                                'partenaire': 'https://lab.padem.org/wp-json/mo/v1/getPartner',
                                'comptable': 'https://lab.padem.org/wp-json/mo/v1/getAccountant',
                                'consultant': 'https://lab.padem.org/wp-json/mo/v1/getConsultant',
                                'bailleur': 'https://lab.padem.org/wp-json/mo/v1/getFunder'
                            }
                        };

                        var urls_and_data = {
                            'Coordinateur': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createCoordinator',
                                'data': {
                                    'project_id': project_id,
                                    'coordinator_email': newMemberEmail,
                                    'coordinator_first_name': firstName,
                                    'coordinator_last_name': lastName,
                                    'coordinator_countryAndCity': cityAndCountry,
                                    'coordinator_activity_history': JSON.stringify([
                                        {
                                            'hour': new Date().getHours(),
                                            'minute': new Date().getMinutes(),
                                            'day': new Date().getDate(),
                                            'month': new Date().getMonth() + 1,
                                            'year': new Date().getFullYear(),
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                }
                            },
                            'chef-de-projet': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createProjectChief',
                                'data': {
                                    'project_id': project_id,
                                    'chief_email': newMemberEmail,
                                    'chief_first_name': firstName,
                                    'chief_last_name': lastName,
                                    'chief_countryAndCity': cityAndCountry,
                                    'chief_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            }
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                }
                            },
                            'comptable': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createAccountant',
                                'data': {
                                    'project_id': project_id,
                                    'accountant_email': newMemberEmail,
                                    'accountant_first_name': firstName,
                                    'accountant_last_name': lastName,
                                    'accountant_countryAndCity': cityAndCountry,
                                    'accountant_activity_history': JSON.stringify([
                                        {
                                            'hour': new Date().getHours(),
                                            'minute': new Date().getMinutes(),
                                            'day': new Date().getDate(),
                                            'month': new Date().getMonth() + 1,
                                            'year': new Date().getFullYear(),
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                }
                            },
                            'consultant': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createConsultant',
                                'data': {
                                    'project_id': project_id,
                                    'consultant_email': newMemberEmail,
                                    'consultant_first_name': firstName,
                                    'consultant_last_name': lastName,
                                    'consultant_countryAndCity': cityAndCountry,
                                    'consultant_activity_history': JSON.stringify([
                                        {
                                            'hour': new Date().getHours(),
                                            'minute': new Date().getMinutes(),
                                            'day': new Date().getDate(),
                                            'month': new Date().getMonth() + 1,
                                            'year': new Date().getFullYear(),
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                },
                            },
                            'partenaire': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createPartner',
                                'data': {
                                    'project_id': project_id,
                                    'partner_email': newMemberEmail,
                                    'partner_first_name': firstName,
                                    'partner_last_name': lastName,
                                    'partner_countryAndCity': cityAndCountry,
                                    'partner_activity_history': JSON.stringify([
                                        {
                                            'hour': new Date().getHours(),
                                            'minute': new Date().getMinutes(),
                                            'day': new Date().getDate(),
                                            'month': new Date().getMonth() + 1,
                                            'year': new Date().getFullYear(),
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                },
                            },
                            'bailleur': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createBailleur',
                                'data': {
                                    'project_id': project_id,
                                    'bailleur_email': newMemberEmail,
                                    'bailleur_first_name': firstName,
                                    'bailleur_last_name': lastName,
                                    'bailleur_countryAndCity': cityAndCountry,
                                    'bailleur_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            }
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                },
                            }
                        };
                        // Vérifier si l'utilisateur existe déjà en fonction de son email (méthode GET)
                        fetch(users_list.urls[newMemberRole], {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                            .then(response => response.json())
                            .then(data => {
                                //#region Vérifier si l'utilisateur existe déjà en fonction de son email
                                data.forEach(user => {
                                    users_list.users[newMemberRole].push(user[users_list.emails_names[newMemberRole]]);
                                });
                                if (users_list.users[newMemberRole].includes(newMemberEmail)) {
                                    alert('Cet utilisateur existe déjà.');
                                    return;
                                }
                                // Envoyer les données à l'API
                                //#region
                                fetch(urls_and_data[newMemberRole].url, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify(urls_and_data[newMemberRole].data),
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Récupérer l'ID du nouveau membre
                                        var newMemberEmail;
                                        if (data.accountant_email !== null) {
                                            newMemberEmail = data.accountant_email;
                                        }
                                        else if (data.funder_email !== null) {
                                            newMemberEmail = data.funder_email;
                                        }
                                        else if (data.partner_email !== null) {
                                            newMemberEmail = data.partner_email;
                                        }
                                        else if (data.coordinator_email !== null) {
                                            newMemberEmail = data.coordinator_email;
                                        }
                                        else if (data.chief_email !== null) {
                                            newMemberEmail = data.chief_email;
                                        }
                                        else if (data.consultant_email !== null) {
                                            newMemberEmail = data.consultant_email;
                                        }
                                        else {
                                            console.log('Erreur lors de la création du nouveau membre');
                                            return;
                                        }

                                        // Ajouter l'ID du nouveau membre à la liste des membres du projet sur la base de données
                                        fetch('https://lab.padem.org/wp-json/mo/v1/updateOneProject',
                                            {
                                                method: 'PUT',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({
                                                    'project_id': project_id,
                                                    'user_list': JSON.stringify({
                                                        'id': project_id + '-' + new Date().getTime() + '-' + Math.random().toString(36).substring(2),
                                                        'user_id': newMemberEmail,
                                                    }),
                                                }),
                                            })
                                            .then(response => response.json())
                                            .then(data => {
                                                console.log(data);
                                                // Recharger la page
                                                window.location.href = 'https://lab.padem.org/project/';
                                            })
                                            .catch(error => {
                                                console.error(error);
                                            });
                                    })
                                    .catch(error => {
                                        console.error(error);
                                    });
                                //#endregion
                            })
                            .catch(error => {
                                console.error('Erreur lors de la récupération des données de l\'utilisateur :', error);
                            });
                    });



                    // Ajouter un membre existant au projet sur la base de données
                    document.getElementById('addExistingMember_' + project_id).addEventListener('click', () => {
                        var existingMemberEmail = document.getElementById('existingMemberEmail_' + project_id).value || '';
                        var existingMemberRole = document.getElementById('existingMemberRole_' + project_id).value || '';
                        var existingMember_first_name = document.getElementById('existingMember_first_name_' + project_id).value || '';
                        var existingMember_last_name = document.getElementById('existingMember_last_name_' + project_id).value || '';
                        var existingMember_countryAndCity = document.getElementById('existingMemberCityAndCountry_' + project_id).value || '';

                        if (!existingMemberEmail || !existingMemberRole || !existingMember_first_name) {
                            alert('Veuillez remplir tous les champs. (Email, Rôle et Prénom (le Nom est optionnel))');
                            return;
                        }

                        var users_list = {
                            'emails_names': {
                                'Coordinateur': 'coordinator_email',
                                'chef-de-projet': 'chief_email',
                                'partenaire': 'partner_email',
                                'comptable': 'accountant_email',
                                'consultant': 'consultant_email',
                                'bailleur': 'funder_email'
                            },
                            'users': {
                                'Coordinateur': [],
                                'chef-de-projet': [],
                                'partenaire': [],
                                'comptable': [],
                                'consultant': [],
                                'bailleur': []
                            },
                            'urls': {
                                'Coordinateur': 'https://lab.padem.org/wp-json/mo/v1/getCoordinator',
                                'chef-de-projet': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
                                'partenaire': 'https://lab.padem.org/wp-json/mo/v1/getPartner',
                                'comptable': 'https://lab.padem.org/wp-json/mo/v1/getAccountant',
                                'consultant': 'https://lab.padem.org/wp-json/mo/v1/getConsultant',
                                'bailleur': 'https://lab.padem.org/wp-json/mo/v1/getFunder'
                            }
                        }

                        var urls_and_data = {
                            'Coordinateur': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createCoordinator',
                                'data': {
                                    'project_id': project_id,
                                    'coordinator_email': existingMemberEmail,
                                    'coordinator_first_name': existingMember_first_name,
                                    'coordinator_last_name': existingMember_last_name,
                                    'coordinator_countryAndCity': existingMember_countryAndCity,
                                    'coordinator_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            }
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                }
                            },
                            'chef-de-projet': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createProjectChief',
                                'data': {
                                    'project_id': project_id,
                                    'chief_email': existingMemberEmail,
                                    'chief_first_name': existingMember_first_name,
                                    'chief_last_name': existingMember_last_name,
                                    'chief_countryAndCity': existingMember_countryAndCity,
                                    'chief_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            }
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                }
                            },
                            'comptable': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createAccountant',
                                'data': {
                                    'project_id': project_id,
                                    'accountant_email': existingMemberEmail,
                                    'accountant_first_name': existingMember_first_name,
                                    'accountant_last_name': existingMember_last_name,
                                    'accountant_countryAndCity': existingMember_countryAndCity,
                                    'accountant_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            }
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        },
                                    ]),
                                },
                            },
                            'consultant': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createConsultant',
                                'data': {
                                    'project_id': project_id,
                                    'consultant_email': existingMemberEmail,
                                    'consultant_first_name': existingMember_first_name,
                                    'consultant_last_name': existingMember_last_name,
                                    'consultant_countryAndCity': existingMember_countryAndCity,
                                    'consultant_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            },
                                        },
                                        {
                                            'activite': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                },
                            },
                            'partenaire': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createPartner',
                                'data': {
                                    'project_id': project_id,
                                    'partner_email': existingMemberEmail,
                                    'partner_first_name': existingMember_first_name,
                                    'partner_last_name': existingMember_last_name,
                                    'partner_countryAndCity': existingMember_countryAndCity,
                                    'partner_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            },
                                        },
                                        {
                                            'activite': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                },
                            },
                            'bailleur': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createFunder',
                                'data': {
                                    'project_id': project_id,
                                    'funder_email': existingMemberEmail,
                                    'funder_first_name': existingMember_first_name,
                                    'funder_last_name': existingMember_last_name,
                                    'funder_countryAndCity': existingMember_countryAndCity,
                                    'funder_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            },
                                        },
                                        {
                                            'activite': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                },
                            },
                        };

                        // Véifier si le membre existe déjà (méthode GET)
                        fetch(users_list.urls[existingMemberRole], {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                            .then(response => response.json())
                            .then(data => {
                                data.forEach(user => {
                                    users_list.users[existingMemberRole].push(user[users_list.emails_names[existingMemberRole]]);
                                });
                                // Vérifier si le membre existe déjà
                                if (users_list.users[existingMemberRole].includes(existingMemberEmail)) {
                                    alert('Ce membre existe déjà dans la base de données. Veuillez entrer une autre adresse email !');
                                    return;
                                }
                                //#region Ajouter le nouveau membre
                                // Envoyer la requête POST à l'URL spécifiée
                                fetch(urls_and_data[existingMemberRole].url, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify(urls_and_data[existingMemberRole].data),
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Récupérer l'ID du nouveau membre
                                        var existingMemberEmail;
                                        if (data.coordinator_email !== null) {
                                            existingMemberEmail = data.coordinator_email;
                                        }
                                        else if (data.funder_email !== null) {
                                            existingMemberEmail = data.funder_email;
                                        }
                                        else if (data.partner_email !== null) {
                                            existingMemberEmail = data.partner_email;
                                        }
                                        else if (data.chief_email !== null) {
                                            existingMemberEmail = data.chief_email;
                                        }
                                        else if (data.accountant_email !== null) {
                                            existingMemberEmail = data.accountant_email;
                                        }
                                        else if (data.consultant_email !== null) {
                                            existingMemberEmail = data.consultant_email;
                                        }
                                        else {
                                            console.log('Erreur lors de la création du nouveau membre');
                                            return;
                                        }

                                        // Ajouter l'ID du nouveau membre à la liste des membres du projet sur la base de données
                                        fetch('https://lab.padem.org/wp-json/mo/v1/updateOneProject',
                                            {
                                                method: 'PUT',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({
                                                    'project_id': project_id,
                                                    'user_list': JSON.stringify({
                                                        'email_id': project_id + '-' + new Date().getTime() + '-' + Math.random().toString(36).substr(2, 9),
                                                        'user_id': existingMemberEmail,
                                                    }),
                                                }),
                                            })
                                            .then(response => response.json())
                                            .then(data => {
                                                // Afficher un message de succès
                                                alert('Membre ajouté avec succès !');
                                                // Recharger la page
                                                window.location.href = 'https://lab.padem.org/projets/';
                                            })
                                            .catch(error => {
                                                console.error(error);
                                            });
                                    })
                                    .catch(error => {
                                        console.error(error);
                                    });
                                //#endregion
                            })
                            .catch(error => {
                                console.error('Erreur lors de la récupération des membres:', error);
                            });
                    });

                    // Ajouter un rapport au projet sur la base de données
                    document.getElementById('submitReport_' + project_id).addEventListener('click', () => {
                        var listOfdestinataires_emails = document.getElementById('reportdestinataires_' + project_id).value || '';
                        var messageObject = document.getElementById('messageObject_' + project_id).value || '';
                        var messageContent = document.getElementById('messageDescription_' + project_id).value || '';
                        var joinedFiles = document.getElementById('reportFiles_' + project_id).files || [];

                        var file_id = [];
                        if (joinedFiles.length > 0) {
                            for (var i = 0; i < joinedFiles.length; i++) {
                                file_id.push(joinedFiles[i].name);
                            }

                            // Enregistrer le ou les fichiers sélectionnés et les envoyer à l'API(https://lab.padem.org/wp-json/mo/v1/createMedia)
                            var formData = new FormData();
                            for (var i = 0; i < joinedFiles.length; i++) {
                                formData.append('files[]', joinedFiles[i]);
                            }
                            fetch('https://lab.padem.org/wp-json/mo/v1/createMedia', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    'project_id': project_id,
                                    'file_content': formData,
                                }),
                            })
                                .then(response => response.json())
                                .then(data => {
                                    console.log(data);
                                    // Récupérer l'ID du ou des fichiers enregistrés
                                    file_id = data.id;
                                    // Ajouter l'id du ou des fichiers à la liste des fichiers du projet sur la base de données
                                    fetch('https://lab.padem.org/wp-json/mo/v1/updateOneProject',
                                        {
                                            method: 'PUT',
                                            headers: {
                                                'Content-Type': 'application/json',
                                            },
                                            body: JSON.stringify({
                                                'project_id': project_id,
                                                'file_id': JSON.stringify({
                                                    'id': project_id + '-' + new Date().getTime() + '-' + Math.random().toString(36).substring(2),
                                                    'file_id': file_id,
                                                }),
                                            }),
                                        })
                                        .then(response => response.json())
                                        .then(data => {
                                            console.log(data);
                                        })
                                        .catch(error => {
                                            console.error(error);
                                        });
                                })
                                .catch(error => {
                                    console.error(error);
                                });
                        }

                        // Enregistrer le message dans la base de données via l'API(https://lab.padem.org/wp-json/mo/v1/createReport)
                        fetch('https://lab.padem.org/wp-json/mo/v1/createReport', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                'file_id': JSON.stringify(file_id),
                                'project_id': project_id,
                                'message_destinataires': listOfdestinataires_emails,
                                'message_object': messageObject,
                                'message_content': messageContent,
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log(data);
                                // Récupérer l'ID du rapport enregistré
                                var report_id = data.report_id;
                                // Ajouter l'id du rapport à la liste des rapports du projet sur la base de données
                                fetch('https://lab.padem.org/wp-json/mo/v1/updateOneProject',
                                    {
                                        method: 'PUT',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            'project_id': project_id,
                                            'report_id': JSON.stringify({
                                                'id': project_id + '-' + new Date().getTime() + '-' + Math.random().toString(36).substring(2),
                                                'report_id': report_id,
                                            }),
                                        }),
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        console.log(data);
                                    })
                                    .catch(error => {
                                        console.error(error);
                                    });
                                // Afficher un message de succès
                                alert('Message envoyé avec succès !');
                                // Recharger la page
                                window.location.href = 'https://lab.padem.org/projets/';
                            })
                            .catch(error => {
                                console.error(error);
                            });
                    });

                    // Ajouter un document modèle au projet sur la base de données
                    document.getElementById('submitDocument_' + project_id).addEventListener('click', () => {
                        var documentTitle = document.getElementById('documentTitle_' + project_id).value || '';
                        var documentDescription = document.getElementById('documentDescription_' + project_id).value || '';
                        var documentFile = document.getElementById('documentFile_' + project_id).files[0] || '';

                        // Enregistrer le document dans la base de données
                        var formData = new FormData();
                        formData.append('file', documentFile);
                        fetch('https://lab.padem.org/wp-json/mo/v1/createMedia', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                'project_id': project_id,
                                'file_name': documentTitle,
                                'file_content': formData,
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log(data);
                                // Récupérer l'ID du document enregistré
                                var document_id = data.id;
                                // Ajouter l'id du document à la liste des documents du projet sur la base de données
                                fetch('https://lab.padem.org/wp-json/mo/v1/updateOneProject',
                                    {
                                        method: 'PUT',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            'project_id': project_id,
                                            'folder_id': JSON.stringify({
                                                'id': project_id + '-' + new Date().getTime() + '-' + Math.random().toString(36).substring(2),
                                                'document_id': document_id,
                                            }),
                                        }),
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        console.log(data);
                                    })
                                    .catch(error => {
                                        console.error(error);
                                    });
                                // Afficher un message de succès
                                alert('Document ajouté avec succès !');
                                // Recharger la page
                                window.location.href = 'https://lab.padem.org/projets/';
                            })
                            .catch(error => {
                                console.error(error);
                            });
                    });

                    // Ajouter un lien au projet sur la base de données
                    document.getElementById('linkSubmit_' + project_id).addEventListener('click', () => {
                        var linkTitle = document.getElementById('linkTitle_' + project_id).value || '';
                        var linkDescription = document.getElementById('linkDescription_' + project_id).value || '';
                        var linkURL = document.getElementById('linkURL_' + project_id).value || '';

                        // Enregistrer le lien dans la base de données
                        fetch('https://lab.padem.org/wp-json/mo/v1/createLink', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                'project_id': project_id,
                                'link_title': linkTitle,
                                'link_description': linkDescription,
                                'link_url': linkURL,
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log(data);
                                // Afficher un message de succès
                                alert('Lien ajouté avec succès !');
                                // Recharger la page
                                window.location.href = 'https://lab.padem.org/projets/';
                            })
                            .catch(error => {
                                console.error(error);
                            });
                    });
                });
            })
            .catch(error => {
                console.error(error);
            });


    });
</script>