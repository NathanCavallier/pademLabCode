<!-- Description: Afficher la liste des projets en cours -->

<body>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Ajoutez ceci pour utiliser Font Awesome -->
    <!-- Afficher la liste des projets en cours -->
    <ul id="projectsList"></ul>
</body>



<script>
    // Projet: Récurérer les données depuis la base de données et les afficher dans des cellules individuels cliquables pour les modifier
    document.addEventListener('DOMContentLoaded', (event) => {
        // Déclarer les variables
        var userId;
        var userEmail = '';
        var userRole = '';
        var buttonText = 'Compléter le projet';
        var localStatus = '';
        var projectStatus = '';
        var allUsers = [];
        var tabNumber = new Array().fill({
            'tab': []
        });
        var counter = 0;

        var listOfAllMembersEmailOnPademLab = [];

        //#region Récupérer les informations de l'utilisateur connecté
        fetch('https://lab.padem.org/unserialize_usermeta.php', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
                userId = data.user_infos._id;
                userEmail = data.user_infos.email;
            })
            .catch(error => {
                console.error('Error:', error);
            });
        //#endregion

        // Envoyer des emails de notifications aux membres du projet
        /*
        function sendEmailNotification(projectId, userEmail, userRole, projectTitle) {
            fetch('https://lab.padem.org/wp-json/mo/v1/sendNotification', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    'project_id': projectId,
                    'user_email': userEmail,
                    'user_role': userRole,
                    'project_title': projectTitle,
                    'subject': 'Notification de projet ' + projectTitle,
                    'message': 'Bonjour, \n\nVous avez été ajouté en tant que ' + userRole + ' au projet ' + projectTitle + '.\n\nCordialement,\nPADEM Lab' + '\n' + 'https://lab.padem.org',
                }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Email envoyé:', data);
                })
                .catch(error => {
                    console.error('Erreur:', error);
                });
        }
        const nodemailer = require('nodemailer');
        async function sendEmailNotificationToAllMembers(projectId, projectTitle, memberEmail, projectManagerEmail) {
            document.getElementById('loading_' + projectId).style.display = 'block';
            let transporter = nodemailer.createTransport({
                service: 'gmail', // Utilisez le service de messagerie de votre choix
                auth: {
                    user: 'imogonathan@gmail.com', // Votre adresse e-mail
                    pass: 'IUTs2018' // Votre mot de passe
                }
            });

            let mailOptions = {
                from: 'imogonathan@gmail.com',
                to: `${memberEmail}, ${projectManagerEmail}`,
                subject: 'Notification de nouveau membre - ' + projectTitle,
                text: 'Un nouveau membre a été ajouté au projet.' + '\n\n' + `Email: ${memberEmail}` +  + '\n\n' + 'Cordialement,\nPADEM Lab' + '\n' + 'https://lab.padem.org'
            };

            try {
                let info = await transporter.sendMail(mailOptions);
                alert('Email envoyé: %s', info.messageId);
                console.log('Message sent: %s', info.messageId);
                document.getElementById('loading_' + projectId).style.display = 'none';
            } catch (error) {
                alert('Une erreur s\'est produite: %s', error);
                console.error('An error occurred: %s', error);
                document.getElementById('loading_' + projectId).style.display = 'none';
            }
        }
        */
        // Récupérer la liste des projets depuis la base de données (à partir de l'API (https://lab.padem.org/wp-json/mo/v1/getProjects))
        // les projets sont affichés dans des lignes individuelles avec un bouton cliquables pour les modifier
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjects', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                // Déclarer les variables
                document.getElementById('totalProjects').innerText = data.length;
                var colorStatusText = {
                    'Publié': 'green',
                    'Non publié': 'gray',
                };
                var colorStatusBackground = {
                    'Complet': 'green',
                    'Incomplet': 'red',
                };
                var stepper = 0;
                var projectStepper = 0;
                var tabStepper = 0;
                var numberOfMembers = 0;
                var membersTable = new Array(data.length).fill(0);
                var filesIDs = new Array().fill(0);
                var globalStepper = 0;
                var members = new Array(data.length).fill({
                    'project_id': 0,
                    'coordinateur': [],
                    'chef_de_projet': [],
                    'accountant': [],
                    'consultant': [],
                    'partner': [],
                    'funder': [],
                    'referent': []
                });
                // Parcourir la liste des projets
                data.forEach(project => {
                    var project_id = project.project_id;
                    var list_OfUsers = {
                        'project_id': 0,
                        'coordinateur': [],
                        'chef_de_projet': [],
                        'accountant': [],
                        'consultant': [],
                        'partner': [],
                        'funder': [],
                        'referent': []
                    };
                    var currentStepper = 0;
                    // Fonction pour supprimer un membre du projet
                    function removeSelectedMembers(email, project_id) {
                        fetch('https://lab.padem.org/wp-json/mo/v1/removeMember', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                'project_id': project_id,
                                'email': email,
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Membre supprimé:', data);
                            })
                            .catch(error => {
                                console.error('Erreur:', error);
                            });
                    }

                    //#region Style de l'élément de liste
                    // Créer un élément de liste pour chaque projet
                    var li = document.createElement('li');
                    li.style.color = 'black';
                    li.style.textAlign = 'left';
                    li.style.border = '1px #29A6A7';
                    li.style.borderRadius = '15px';
                    li.style.backgroundColor = 'white';
                    stepper++;
                    if (stepper === 2) {
                        li.style.border = 'none';
                        stepper = 0;
                    }
                    li.style.height = 'auto';
                    li.style.width = '95%';
                    li.style.display = 'flex';
                    li.style.justifyContent = 'space-between';
                    li.style.padding = '10px';
                    li.style.margin = '10px';
                    li.style.textDecoration = 'none';
                    //#endregion

                    //#region Ajouter les données dans l'élément de liste
                    li.innerHTML = `
                        <div style="list-style-type: none; padding: 5px; margin: 5px; border-radius: 10px;">
                            <ul class="project-row" style="width: fit-content;">
                                <li class="project-element" style="font-weight: bold; color: gray;">${projectStepper + 1}</li>
                                <li class="project-element" style="font-weight: bold; color: #29A6A7;">${project.project_title}</li>
                                <li class="project-element">Pays: ${project.project_location}</li>
                                <li class="project-element" style="display: flex;"><p id="numberOfmember_${project_id}"></p></li>
                                <li class="project-element" style="text-transform: capitalize; font-weight: bold; color: ${colorStatusText[projectStatus]}; background: none; margin: 5px; padding: 5px; boder-radius: 20px;" id="status_${project_id}"></li>
                                <li class="project-element" style="font-weight: bold; font-size: 11px;" id="localStatus_${project_id}"><div style="margin-right: 40px;"></div></li>
                                <li class="project-element" style="display: flex; justify-content: flex-end;">
                                    <button class="buttonModifier" id="buttonModifier_${project_id}" style="margin: 5px; margin-right: -15px; padding: 5px; boder-radius: 20px; font-size: 11px;">${buttonText}</button>
                                </li>
                            </ul>
                            <div id="modifyProject_${project_id}" style="display: none; width: 100%; height: auto; background: white; margin: 10px; padding: 10px; border-radius: 10px;">
                                <hr style="border: 1px solid #29A6A7;">
                                <div style="margin: 5px; padding: 5px;"></div>
                                <div class="row">
                                    <div class="col-md-12">
                                    <div class="row">
                                    <div style="margin-top: 5px; padding: 5px;"></div>
                                    <div class="container">
                                        <!-- Afficher une liste de boutons à l'horizontale permettant de faire apparaître le type d'éléments à ajouter au projet -->
                                        <div class="col-md-12" style="width: 100%; background: white;">
                                            <div class="row" style="display: flex-end; width: 100%;">
                                                <div class="btn-group" role="group" aria-label="menu" style="width: 100%;">
                                                    <button type="button" id="buttonExistingMember_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                        Membres du projet</button>
                                                    <div style="margin-left: 50px; margin-right: 50px;"></div>
                                                    <button type="button" id="buttonNewMember_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                        Ajouter un membre</button>
                                                    <button type="button" id="buttonDocumentModel_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                        Ajouter des fichiers</button>
                                                    <button type="button" id="buttonAddLink_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                        Ajouter un Lien</button>
                                                    <button type="button" id="buttonAddDivers_${project_id}" class="btn btn-secondary"
                                                        style="width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                        Documents Models</button>
                                                </div>
                                            </div>
                                            <div style="margin: 5px; padding: 5px;"></div>
                                            <div id="newMember_${project_id}" style="display: none; width: 100%" class="settings-scroll">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="newMemberEmail_${project_id}" required>Adresse email du nouveau membre: </label>
                                                            <input type="email" class="form-control" id="newMemberEmail_${project_id}" aria-describedby="emailHelp">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="last_name_${project_id}">Nom: </label>
                                                            <input type="text" class="form-control" id="last_name_${project_id}" aria-describedby="emailHelp">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="first_name_${project_id}">Prénom: </label>
                                                            <input type="text" class="form-control" id="first_name_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="newMemberRole_${project_id}">Rôle du nouveau membre: </label>
                                                            <select class="form-control" id="newMemberRole_${project_id}" required>
                                                                <option value="Coordinateur">Coordinateur</option>
                                                                <option value="chef-de-projet">Chef de projet</option>
                                                                <option value="comptable">Comptable</option>
                                                                <option value="consultant">Consultant</option>
                                                                <option value="partenaire">Partenaire</option>
                                                                <option value="bailleur">Bailleur</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="newMemberCityAndCountry_${project_id}">Ville et pays du nouveau membre: </label>
                                                            <input type="text" class="form-control" id="newMemberCityAndCountry_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12">
                                                        <div class="colomn" style="display: flex; width: 100%;">
                                                            <button type="submit" class="btn btn-primary" id="buttonAddMember_${project_id}" style="width: fit-content;">Ajouter le nouveau membre au projet</button>
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <div id="loading_${project_id}" style="display: none;">
                                                                <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="existingMember_${project_id}" style="display: none; width: 100%;">
                                                <div class="row">
                                                    <h6 style="color: gray;">Membres du projet</h6>
                                                    <hr style="border: 1px gray;">
                                                    <div style="display: flex;" class="settings-scroll">
                                                        <div style="flex: 1; margin-right: 10px;">
                                                            <ul id="projectMembers_${project_id}" style="list-style: none;">
                                                                <!-- Les membres du projet vont ici -->
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newDocument_${project_id}" style="display: none; width: 100%;">
                                                <div class="row">                                        
                                                    <div class="row" style="display: flex;">
                                                        <div style="display: flex; justify-content: space-between;">
                                                            <p style="color: gray;">Sélectionnez des fichiers à intégrer au projet  -  Disponible(s): <p id="filesNumber_${project_id}"></p></p>
                                                        </div>
                                                        <hr style="border: 1px gray;">
                                                        <div style="width: 100%; background: white;" class="settings-scroll">
                                                            <div style="margin-top: 10px; padding: 10px;"></div>
                                                            <ul id="projectFiles_${project_id}" style="list-style: none; background: white;">
                                                                <!-- Les éléments de la liste seront ajoutés ici dynamiquement -->
                                                            </ul>
                                                            <div style="margin-top: 10px; padding: 10px;"></div>
                                                        </div>
                                                        <!-- Colonne de droite pour les détails de l'image -->
                                                        <div style="width: 100%; class="settings-scroll">
                                                            <div style="margin-top: 10px; padding: 10px;"></div>
                                                            <div id="projectFileDetails_${project_id}_${filesIDs[globalStepper]}" style="display: none;">
                                                                <!-- Les détails du fichier seront ajoutés ici dynamiquement -->
                                                            </div>
                                                            <div style="margin-top: 10px; padding: 10px;"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newLink_${project_id}" style="display: none; width: 100%;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="linkTitle_${project_id}">Titre du lien</label>
                                                            <input type="text" class="form-control" id="linkTitle_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="linkDescription_${project_id}">Description du lien: </label>
                                                            <textarea class="form-control" id="linkDescription_${project_id}" rows="5"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="linkUrl_${project_id}">Saisir le lien: </label>
                                                            <input type="text" class="form-control" id="linkUrl_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12" style="display: flex; width: 100%;">
                                                        <button type="submit" class="btn btn-primary" id="linkSubmit_${project_id}" style="width: fit-content;">Ajouter le lien au projet</button>
                                                        <div style="margin: 5px; padding: 5px;"></div>
                                                        <div id="loading_${project_id}" style="display: none;">
                                                            <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="newMisc_${project_id}" style="display: none; width: 100%;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="miscTitle_${project_id}">Titre de l'élément: </label>
                                                            <input type="text" class="form-control" id="miscTitle_${project_id}" aria-describedby="emailHelp">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="miscDescription_${project_id}">Description de l'élément: </label>
                                                            <textarea class="form-control" id="miscDescription_${project_id}" rows="5"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <label for="miscFile_${project_id}">Charger un document: </label>
                                                            <input type="file" class="form-control-file" id="miscFile_${project_id}">
                                                        </div>
                                                    </div>
                                                    <div style="margin-top: 10px; padding: 10px;"></div>
                                                    <div class="col-md-12" style="display: flex; width: 100%;">
                                                        <button type="submit" class="btn btn-primary" id="buttonAddMisc_${project_id}" style="width: fit-content;">Ajouter l'élément au projet</button><div style="margin: 5px; padding: 5px;"></div>
                                                        <div id="loading_${project_id}" style="display: none;">
                                                            <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    `;
                    //#endregion

                    // Ajouter l'élément de liste dans la liste des projets
                    document.getElementById('projectsList').appendChild(li);

                    // Ajouter un gestionnaire d'événement pour chaque bouton "Compléter le projet ou Modifier le projet"
                    document.getElementById(`buttonModifier_${project_id}`).addEventListener('click', () => {

                        if (document.getElementById(`modifyProject_${project_id}`).style.display === 'none') {
                            li.style.backgroundColor = '#f2f2f2';
                            document.getElementById(`modifyProject_${project_id}`).style.display = 'block';
                            document.getElementById(`buttonModifier_${project_id}`).style.backgroundColor = 'red';
                            document.getElementById(`buttonModifier_${project_id}`).innerText = 'Annuler';
                        } else {
                            li.style.backgroundColor = '#ffffff';
                            document.getElementById(`modifyProject_${project_id}`).style.display = 'none';
                            document.getElementById(`buttonModifier_${project_id}`).innerText = 'Compléter le projet';
                            document.getElementById(`buttonModifier_${project_id}`).style.backgroundColor = 'green';

                            //#region masquer les formulaires
                            document.getElementById('newMember_' + project_id).style.display = 'none';
                            document.getElementById('existingMember_' + project_id).style.display = 'none';
                            document.getElementById('newDocument_' + project_id).style.display = 'none';
                            document.getElementById('newLink_' + project_id).style.display = 'none';
                            document.getElementById('newMisc_' + project_id).style.display = 'none';
                            //#endregion

                            //#region  Supprimer toutes les informations des formulaires
                            document.getElementById(`newMemberEmail_${project_id}`).value = '';
                            document.getElementById(`newMemberRole_${project_id}`).value = '';
                            document.getElementById(`last_name_${project_id}`).value = '';
                            document.getElementById(`first_name_${project_id}`).value = '';
                            document.getElementById(`linkTitle_${project_id}`).value = '';
                            document.getElementById(`linkDescription_${project_id}`).value = '';
                            document.getElementById(`linkUrl_${project_id}`).value = '';
                            document.getElementById(`miscTitle_${project_id}`).value = '';
                            document.getElementById(`miscDescription_${project_id}`).value = '';
                            document.getElementById(`miscFile_${project_id}`).value = '';
                            //#endregion
                        }

                        //#region Réinitialiser les couleurs des boutons
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                        //#endregion
                    });

                    // Ajouter un gestionnaire d'événement pour chaque bouton "Nouveau membre", "Membre existant", "Demande de rapport", "Document model", "Ajouter un lien", "Ajouter divers"
                    document.getElementById(`buttonExistingMember_${project_id}`).addEventListener('click', () => {
                        // Afficher le formulaire pour ajouter un membre existant
                        document.getElementById(`existingMember_${project_id}`).style.display = 'block';
                        document.getElementById('newMember_' + project_id).style.display = 'none';
                        document.getElementById('newDocument_' + project_id).style.display = 'none';
                        document.getElementById('newLink_' + project_id).style.display = 'none';
                        document.getElementById('newMisc_' + project_id).style.display = 'none';

                        // Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                    });

                    document.getElementById('buttonDocumentModel_' + project_id).addEventListener('click', () => {
                        document.getElementById('newDocument_' + project_id).style.display = 'block';
                        document.getElementById('newMember_' + project_id).style.display = 'none';
                        document.getElementById('existingMember_' + project_id).style.display = 'none';
                        document.getElementById('newLink_' + project_id).style.display = 'none';
                        document.getElementById('newMisc_' + project_id).style.display = 'none';

                        // Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                    });

                    document.getElementById('buttonNewMember_' + project_id).addEventListener('click', () => {
                        document.getElementById('newMember_' + project_id).style.display = 'block';
                        document.getElementById('existingMember_' + project_id).style.display = 'none';
                        document.getElementById('newDocument_' + project_id).style.display = 'none';
                        document.getElementById('newLink_' + project_id).style.display = 'none';
                        document.getElementById('newMisc_' + project_id).style.display = 'none';

                        // Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                    });

                    document.getElementById('buttonAddLink_' + project_id).addEventListener('click', () => {
                        document.getElementById('newLink_' + project_id).style.display = 'block';
                        document.getElementById('newMember_' + project_id).style.display = 'none';
                        document.getElementById('existingMember_' + project_id).style.display = 'none';
                        document.getElementById('newDocument_' + project_id).style.display = 'none';
                        document.getElementById('newMisc_' + project_id).style.display = 'none';

                        // Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                    });

                    document.getElementById('buttonAddDivers_' + project_id).addEventListener('click', () => {
                        document.getElementById('newMisc_' + project_id).style.display = 'block';
                        document.getElementById('newLink_' + project_id).style.display = 'none';
                        document.getElementById('newMember_' + project_id).style.display = 'none';
                        document.getElementById('existingMember_' + project_id).style.display = 'none';
                        document.getElementById('newDocument_' + project_id).style.display = 'none';

                        //#region Changer le background du bouton cliqué
                        document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                        document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = '#29A6A7';
                        document.getElementById(`buttonAddDivers_${project_id}`).style.color = 'white';
                        //#endregion
                    });


                    // Ajouter un gestionnaire d'événement pour chaque bouton "Ajouter le nouveau membre", "Ajouter le nouveau rapport", "Ajouter le nouveau document", "Ajouter le nouveau lien", "Ajouter divers"
                    var buttonAddMember_ = document.getElementById('buttonAddMemmber_' + project_id);
                    if(buttonAddMember_ !== null) {
                        document.getElementById('loading_' + project_id).style.display = 'block';
                        var newMemberEmail = document.getElementById('newMemberEmail_' + project_id).value || '';
                        var newMemberRole = document.getElementById('newMemberRole_' + project_id).value || '';
                        var lastName = document.getElementById('last_name_' + project_id).value || '';
                        var firstName = document.getElementById('first_name_' + project_id).value || '';
                        var cityAndCountry = document.getElementById('newMemberCityAndCountry_' + project_id).value || '';

                        if (newMemberEmail === '' || newMemberRole === '' || firstName === '') {
                            alert('Veuillez remplir tous les champs. (Email, Rôle et Prénom (le Nom est optionnel))');
                            document.getElementById('loading_' + project_id).style.display = 'none';
                            return;
                        }

                        var users_list = {
                            'emails_names': {
                                'Coordinateur': 'coordinator_email',
                                'chef-de-projet': 'chief_email',
                                'partenaire': 'partner_email',
                                'comptable': 'accountant_email',
                                'consultant': 'consultant_email',
                                'bailleur': 'funder_email'
                            },
                            'users': {
                                'Coordinateur': [],
                                'chef-de-projet': [],
                                'partenaire': [],
                                'comptable': [],
                                'consultant': [],
                                'bailleur': []
                            },
                            'urls': {
                                'Coordinateur': 'https://lab.padem.org/wp-json/mo/v1/getCoordinator',
                                'chef-de-projet': 'https://lab.padem.org/wp-json/mo/v1/getProjectChief',
                                'partenaire': 'https://lab.padem.org/wp-json/mo/v1/getPartner',
                                'comptable': 'https://lab.padem.org/wp-json/mo/v1/getAccountant',
                                'consultant': 'https://lab.padem.org/wp-json/mo/v1/getConsultant',
                                'bailleur': 'https://lab.padem.org/wp-json/mo/v1/getFunder'
                            }
                        };

                        var urls_and_data = {
                            'Coordinateur': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createCoordinator',
                                'data': {
                                    'project_id': project_id,
                                    'coordinator_email': newMemberEmail,
                                    'coordinator_first_name': firstName,
                                    'coordinator_last_name': lastName,
                                    'coordinator_countryAndCity': cityAndCountry,
                                    'coordinator_activity_history': JSON.stringify([
                                        {
                                            'hour': new Date().getHours(),
                                            'minute': new Date().getMinutes(),
                                            'day': new Date().getDate(),
                                            'month': new Date().getMonth() + 1,
                                            'year': new Date().getFullYear(),
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                }
                            },
                            'chef-de-projet': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createProjectChief',
                                'data': {
                                    'project_id': project_id,
                                    'chief_email': newMemberEmail,
                                    'chief_first_name': firstName,
                                    'chief_last_name': lastName,
                                    'chief_countryAndCity': cityAndCountry,
                                    'chief_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            }
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                }
                            },
                            'comptable': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createAccountant',
                                'data': {
                                    'project_id': project_id,
                                    'accountant_email': newMemberEmail,
                                    'accountant_first_name': firstName,
                                    'accountant_last_name': lastName,
                                    'accountant_countryAndCity': cityAndCountry,
                                    'accountant_activity_history': JSON.stringify([
                                        {
                                            'hour': new Date().getHours(),
                                            'minute': new Date().getMinutes(),
                                            'day': new Date().getDate(),
                                            'month': new Date().getMonth() + 1,
                                            'year': new Date().getFullYear(),
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                }
                            },
                            'consultant': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createConsultant',
                                'data': {
                                    'project_id': project_id,
                                    'consultant_email': newMemberEmail,
                                    'consultant_first_name': firstName,
                                    'consultant_last_name': lastName,
                                    'consultant_countryAndCity': cityAndCountry,
                                    'consultant_activity_history': JSON.stringify([
                                        {
                                            'hour': new Date().getHours(),
                                            'minute': new Date().getMinutes(),
                                            'day': new Date().getDate(),
                                            'month': new Date().getMonth() + 1,
                                            'year': new Date().getFullYear(),
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                },
                            },
                            'partenaire': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createPartner',
                                'data': {
                                    'project_id': project_id,
                                    'partner_email': newMemberEmail,
                                    'partner_first_name': firstName,
                                    'partner_last_name': lastName,
                                    'partner_countryAndCity': cityAndCountry,
                                    'partner_activity_history': JSON.stringify([
                                        {
                                            'hour': new Date().getHours(),
                                            'minute': new Date().getMinutes(),
                                            'day': new Date().getDate(),
                                            'month': new Date().getMonth() + 1,
                                            'year': new Date().getFullYear(),
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                },
                            },
                            'bailleur': {
                                'url': 'https://lab.padem.org/wp-json/mo/v1/createBailleur',
                                'data': {
                                    'project_id': project_id,
                                    'bailleur_email': newMemberEmail,
                                    'bailleur_first_name': firstName,
                                    'bailleur_last_name': lastName,
                                    'bailleur_countryAndCity': cityAndCountry,
                                    'bailleur_activity_history': JSON.stringify([
                                        {
                                            'Date': {
                                                'hour': new Date().getHours(),
                                                'minute': new Date().getMinutes(),
                                                'day': new Date().getDate(),
                                                'month': new Date().getMonth() + 1,
                                                'year': new Date().getFullYear(),
                                            }
                                        },
                                        {
                                            'Activité': `Création du projet ${project.project_title} et ajout des membres`,
                                        },
                                        {
                                            'Commentaire': 'Le projet est en cours de création',
                                        },
                                        {
                                            'Divers': '',
                                        }
                                    ]),
                                },
                            }
                        };
                        // Vérifier si l'utilisateur existe déjà en fonction de son email (méthode GET)
                        fetch(users_list.urls[newMemberRole], {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                            .then(response => response.json())
                            .then(data => {
                                //#region Vérifier si l'utilisateur existe déjà en fonction de son email
                                data.forEach(user => {
                                    users_list.users[newMemberRole].push(user[users_list.emails_names[newMemberRole]]);
                                });
                                if (users_list.users[newMemberRole].includes(newMemberEmail)) {
                                    alert('Cet utilisateur existe déjà.');
                                    return;
                                }
                                // Envoyer les données à l'API
                                //#region
                                fetch(urls_and_data[newMemberRole].url, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify(urls_and_data[newMemberRole].data),
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Récupérer l'ID du nouveau membre
                                        var newMemberEmail;
                                        if (data.accountant_email !== null) {
                                            newMemberEmail = data.accountant_email;
                                        }
                                        else if (data.funder_email !== null) {
                                            newMemberEmail = data.funder_email;
                                        }
                                        else if (data.partner_email !== null) {
                                            newMemberEmail = data.partner_email;
                                        }
                                        else if (data.coordinator_email !== null) {
                                            newMemberEmail = data.coordinator_email;
                                        }
                                        else if (data.chief_email !== null) {
                                            newMemberEmail = data.chief_email;
                                        }
                                        else if (data.consultant_email !== null) {
                                            newMemberEmail = data.consultant_email;
                                        }
                                        else {
                                            console.log('Erreur lors de la création du nouveau membre');
                                            return;
                                        }

                                        // Ajouter l'ID du nouveau membre à la liste des membres du projet sur la base de données
                                        fetch('https://lab.padem.org/wp-json/mo/v1/updateOneProject',
                                            {
                                                method: 'PUT',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({
                                                    'project_id': project_id,
                                                    'users': JSON.stringify({
                                                        'id': project_id + '-' + new Date().getTime() + '-' + Math.random().toString(36).substring(2),
                                                        'user_email': newMemberEmail,
                                                    }),
                                                }),
                                            })
                                            .then(response => response.json())
                                            .then(data => {
                                                // Masquer le spinner
                                                document.getElementById('loading_' + project_id).style.display = 'none';
                                                // Afficher un message de succès
                                                alert('Membre ajouté avec succès !');
                                                // Recharger la page
                                                window.location.href = 'https://lab.padem.org/projets/';
                                            })
                                            .catch(error => {
                                                console.error(error);
                                                // Masquer le spinner
                                                document.getElementById('loading_' + project_id).style.display = 'none';
                                                // Afficher un message d'erreur
                                                alert('Une erreur est survenue : ' + error.message);
                                            });
                                    })
                                    .catch(error => {
                                        console.error(error);
                                        // Masquer le spinner
                                        document.getElementById('loading_' + project_id).style.display = 'none';
                                        // Afficher un message d'erreur
                                        alert('Une erreur est survenue : ' + error.message);
                                    });
                                //#endregion
                            })
                            .catch(error => {
                                console.error('Erreur lors de la récupération des données de l\'utilisateur :', error);
                                // Masquer le spinner
                                document.getElementById('loading_' + project_id).style.display = 'none';
                            });
                    }
                    
                    // Ajouter un lien au projet sur la base de données
                    document.getElementById('linkSubmit_' + project_id).addEventListener('click', () => {
                        document.getElementById('loading_' + project_id).style.display = 'block';
                        var linkTitle = document.getElementById('linkTitle_' + project_id).value || '';
                        var linkDescription = document.getElementById('linkDescription_' + project_id).value || '';
                        var linkURL = document.getElementById('linkURL_' + project_id).value || '';

                        if (!linkTitle || !linkURL) {
                            alert('Veuillez remplir tous les champs. (Titre et URL)');
                            document.getElementById('loading_' + project_id).style.display = 'none';
                            return;
                        }

                        // Enregistrer le lien dans la base de données
                        fetch('https://lab.padem.org/wp-json/mo/v1/createLink', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                'project_id': project_id,
                                'link_title': linkTitle,
                                'link_description': linkDescription,
                                'link_url': linkURL,
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log(data);
                                // Récupérer l'ID du lien enregistré
                                var link_id = data.link_id;
                                // Ajouter l'id du lien à la liste des liens du projet sur la base de données
                                fetch('https://lab.padem.org/wp-json/mo/v1/updateOneProject',
                                    {
                                        method: 'PUT',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            'project_id': project_id,
                                            'links': JSON.stringify({
                                                'id': project_id + '-' + new Date().getTime() + '-' + Math.random().toString(36).substring(2),
                                                'link_id': link_id,
                                            }),
                                        }),
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        console.log(data);
                                        document.getElementById('loading_' + project_id).style.display = 'none';
                                        // Afficher un message de succès
                                        alert('Lien ajouté avec succès !');
                                        // Recharger la page
                                        window.location.href = 'https://lab.padem.org/projets/';
                                    })
                                    .catch(error => {
                                        console.error(error);
                                        document.getElementById('loading_' + project_id).style.display = 'none';
                                        alert('Une erreur est survenue : ' + error.message);
                                    });
                            })
                            .catch(error => {
                                console.error(error);
                                document.getElementById('loading_' + project_id).style.display = 'none';
                                alert('Une erreur est survenue : ' + error.message);
                            });
                    });

                    // Ajouter un élément divers au projet sur la base de données
                    document.getElementById('buttonAddMisc_' + project_id).addEventListener('click', () => {
                        document.getElementById('loading_' + project_id).style.display = 'block';
                        var miscTitle = document.getElementById('miscTitle_' + project_id).value || '';
                        var miscDescription = document.getElementById('miscDescription_' + project_id).value || '';
                        var miscFile = document.getElementById('miscFile_' + project_id).files[0] || '';

                        if (!miscTitle || !miscFile) {
                            alert('Veuillez remplir tous les champs. (Titre et Fichier)');
                            document.getElementById('loading_' + project_id).style.display = 'none';
                            return;
                        }

                        var formData = new FormData();
                        formData.append('file', miscFile, miscFile.name, miscFile.type, miscFile.lastModified, miscFile.lastModifiedDate, miscFile.webkitRelativePath);

                        // Enregistrer l'élément divers dans la base de données
                        fetch('https://lab.padem.org/wp-json/mo/v1/createDivers', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                'project_id': project_id,
                                'divers_title': miscTitle,
                                'divers_description': miscDescription,
                                'divers_content': formData,
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log(data);
                                // Récupérer l'ID de l'élément divers enregistré
                                var divers_id = data.divers_id;
                                // Ajouter l'id de l'élément divers à la liste des éléments divers du projet sur la base de données
                                fetch('https://lab.padem.org/wp-json/mo/v1/updateOneProject',
                                    {
                                        method: 'PUT',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            'project_id': project_id,
                                            'divers': JSON.stringify({
                                                'id': project_id + '-' + new Date().getTime() + '-' + Math.random().toString(36).substring(2),
                                                'misc_id': divers_id,
                                            }),
                                        }),
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        console.log(data);
                                        document.getElementById('loading_' + project_id).style.display = 'none';
                                        // Afficher un message de succès
                                        alert('Élément divers ajouté avec succès !');
                                        window.location.href = 'https://lab.padem.org/projets/';
                                    })
                                    .catch(error => {
                                        console.error(error);
                                        // Masquer le spinner
                                        document.getElementById('loading_' + project_id).style.display = 'none';
                                        // Afficher un message d'erreur
                                        alert('Une erreur est survenue : ', error.message);
                                    });
                            })
                            .catch(error => {
                                console.error(error);
                                // Masquer le spinner
                                document.getElementById('loading_' + project_id).style.display = 'none';
                                // Afficher un message d'erreur
                                alert('Une erreur est survenue : ', error.message);
                            });
                    });
                
                    
                    //#region Récupérer les membres du projet
                    fetch('https://lab.padem.org/wp-json/mo/v1/getProjectChief', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data !== null && data !== undefined && Array.isArray(data)) {
                                var stepper = 0;
                                data.forEach(user => {
                                    if (user.project_id === project_id) {
                                        //tabNumber[tabStepper].tab[currentStepper] = currentStepper + 1;
                                        var number = document.getElementById(`numberOfmember_${project_id}`).value;
                                        if (number === null || number === undefined || number === '') {
                                            document.getElementById(`numberOfmember_${project_id}`).value = 1;
                                        } else {
                                            document.getElementById(`numberOfmember_${project_id}`).value = parseInt(document.getElementById(`numberOfmember_${project_id}`).value) + 1;
                                        }
                                        document.getElementById(`numberOfmember_${project_id}`).innerText =  ' ' + document.getElementById(`numberOfmember_${project_id}`).value + ' membres';
                                        var li = document.createElement('li');
                                        var spacer = document.createElement('br');
                                        li.style.color = 'black';
                                        li.style.textAlign = 'left';
                                        // Alternance de la couleur de fond
                                        if (stepper % 2 == 0) {
                                            li.style.backgroundColor = 'white'; // Couleur pour les indices pairs
                                        } else {
                                            li.style.backgroundColor = '#EEEEEE'; // Couleur pour les indices impairs
                                        }
                                        li.style.borderRadius = '15px';
                                        li.style.backgroundColor = 'white';
                                        li.style.display = 'flex';
                                        li.style.justifyContent = 'space-between';
                                        li.style.padding = '10px';
                                        li.style.margin = '10px';
                                        li.style.textDecoration = 'none';
                                        li.style.width = '100%';

                                        li.innerHTML = `  -  ${user.chief_first_name} ${user.chief_last_name}  -  ${user.chief_email}  -  Chef de projet <button class="btn btn-tertiary" onclick="removeSelectedMembers('${user.chief_email}', '${project_id}')">Supprimer</button>"`;
                                        document.getElementById('projectMembers_' + project_id).appendChild(li);
                                        stepper++;
                                        currentStepper++;
                                    }
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Erreur récupérer les chefs de projet:', error);
                        });

                    fetch('https://lab.padem.org/wp-json/mo/v1/getAccountant', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data !== null && data !== undefined && Array.isArray(data)) {
                                var stepper = 0;
                                data.forEach(user => {
                                    if (user.project_id === project_id) {
                                        //tabNumber[tabStepper].tab[currentStepper] = currentStepper + 1;
                                        var number = document.getElementById(`numberOfmember_${project_id}`).value;
                                        if (number === null || number === undefined || number === '') {
                                            document.getElementById(`numberOfmember_${project_id}`).value = 2;
                                        } else {
                                            document.getElementById(`numberOfmember_${project_id}`).value = parseInt(document.getElementById(`numberOfmember_${project_id}`).value) + 1;
                                        }
                                        document.getElementById(`numberOfmember_${project_id}`).innerText =  ' ' + document.getElementById(`numberOfmember_${project_id}`).value + ' membres';
                                        var li = document.createElement('li');
                                        var spacer = document.createElement('br');
                                        li.style.color = 'black';
                                        li.style.textAlign = 'left';
                                        // Alternance de la couleur de fond
                                        if (stepper % 2 == 0) {
                                            li.style.backgroundColor = 'white'; // Couleur pour les indices pairs
                                        } else {
                                            li.style.backgroundColor = '#EEEEEE'; // Couleur pour les indices impairs
                                        }
                                        li.style.borderRadius = '15px';
                                        li.style.backgroundColor = 'white';
                                        li.style.display = 'flex';
                                        li.style.justifyContent = 'space-between';
                                        li.style.padding = '10px';
                                        li.style.margin = '10px';
                                        li.style.textDecoration = 'none';

                                        li.innerHTML = `  -  ${user.accountant_first_name} ${user.accountant_last_name}  -  ${user.accountant_email}  -  Comptable <button class="btn btn-tertiary" onclick="removeSelectedMembers('${user.accountant_email}', '${project_id}')">Supprimer</button>`;
                                        document.getElementById('projectMembers_' + project_id).appendChild(li);
                                        stepper++;
                                        currentStepper++;
                                    }
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Erreur récupérer les comptables', error);
                        });

                    fetch('https://lab.padem.org/wp-json/mo/v1/getConsultant', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data !== null && data !== undefined && Array.isArray(data)) {
                                var stepper = 0;
                                data.forEach(user => {
                                    if (user.project_id === project_id) {
                                        //tabNumber[tabStepper].tab[currentStepper] = currentStepper + 1;
                                        var number = document.getElementById(`numberOfmember_${project_id}`).value;
                                        if (number === null || number === undefined || number === '') {
                                            document.getElementById(`numberOfmember_${project_id}`).value = 1;
                                        } else {
                                            document.getElementById(`numberOfmember_${project_id}`).value = parseInt(document.getElementById(`numberOfmember_${project_id}`).value) + 1;
                                        }
                                        document.getElementById(`numberOfmember_${project_id}`).innerText =  ' ' + document.getElementById(`numberOfmember_${project_id}`).value + ' membres';
                                        var li = document.createElement('li');
                                        var spacer = document.createElement('br');
                                        li.style.color = 'black';
                                        li.style.textAlign = 'left';
                                        // Alternance de la couleur de fond
                                        if (stepper % 2 == 0) {
                                            li.style.backgroundColor = 'white'; // Couleur pour les indices pairs
                                        } else {
                                            li.style.backgroundColor = '#EEEEEE'; // Couleur pour les indices impairs
                                        }
                                        li.style.borderRadius = '15px';
                                        li.style.backgroundColor = 'white';
                                        li.style.display = 'flex';
                                        li.style.justifyContent = 'space-between';
                                        li.style.padding = '10px';
                                        li.style.margin = '10px';
                                        li.style.textDecoration = 'none';

                                        li.innerHTML = ` -  ${user.consultant_first_name} ${user.consultant_last_name}  -  ${user.consultant_email} - Consultant <button class="btn btn-tertiary" onclick="removeSelectedMembers('${user.consultant_email}', '${project_id}')">Supprimer</button>`;
                                        document.getElementById('projectMembers_' + project_id).appendChild(li);
                                        stepper++;
                                        currentStepper++;
                                    }
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Récupérer les consoltants:', error.message);
                        });

                    fetch('https://lab.padem.org/wp-json/mo/v1/getPartner', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                        .then(response => response.json())
                        .then(data => {
                            if (data !== null && data !== undefined && Array.isArray(data)) {
                                var stepper = 0;
                                data.forEach(user => {
                                    if (user.project_id === project_id) {
                                        //tabNumber[tabStepper].tab[currentStepper] = currentStepper + 1;
                                        var number = document.getElementById(`numberOfmember_${project_id}`).value;
                                        if (number === null || number === undefined || number === '') {
                                            document.getElementById(`numberOfmember_${project_id}`).value = 1;
                                        } else {
                                            document.getElementById(`numberOfmember_${project_id}`).value = parseInt(document.getElementById(`numberOfmember_${project_id}`).value) + 1;
                                        }
                                        document.getElementById(`numberOfmember_${project_id}`).innerText =  ' ' + document.getElementById(`numberOfmember_${project_id}`).value + ' membres';
                                        var li = document.createElement('li');
                                        var spacer = document.createElement('br');
                                        li.style.color = 'black';
                                        li.style.textAlign = 'left';
                                        // Alternance de la couleur de fond
                                        if (stepper % 2 == 0) {
                                            li.style.backgroundColor = 'white'; // Couleur pour les indices pairs
                                        } else {
                                            li.style.backgroundColor = '#EEEEEE'; // Couleur pour les indices impairs
                                        }
                                        li.style.borderRadius = '15px';
                                        li.style.backgroundColor = 'white';
                                        li.style.display = 'flex';
                                        li.style.justifyContent = 'space-between';
                                        li.style.padding = '10px';
                                        li.style.margin = '10px';
                                        li.style.textDecoration = 'none';

                                        li.innerHTML = `  -  ${user.partner_first_name ? user.partner_first_name : ''} ${user.partner_last_name}  -  ${user.partner_email} - Partenaire <button class="btn btn-tertiary" onclick="removeSelectedMembers('${user.partner_email}', '${project_id}')">Supprimer</button>`;
                                        document.getElementById('projectMembers_' + project_id).appendChild(li);
                                        stepper++;
                                        currentStepper++;
                                    }
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Récupérer les partenaires:', error);
                        });

                    fetch('https://lab.padem.org/wp-json/mo/v1/getReferent', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data !== null && data !== undefined && Array.isArray(data)) {
                                var stepper = 0;
                                data.forEach(user => {
                                    if (user.project_id === project_id) {
                                        //tabNumber[tabStepper].tab[currentStepper] = currentStepper + 1;
                                        var number = document.getElementById(`numberOfmember_${project_id}`).value;
                                        if (number === null || number === undefined || number === '') {
                                            document.getElementById(`numberOfmember_${project_id}`).value = 1;
                                        } else {
                                            document.getElementById(`numberOfmember_${project_id}`).value = parseInt(document.getElementById(`numberOfmember_${project_id}`).value) + 1;
                                        }
                                        document.getElementById(`numberOfmember_${project_id}`).innerText =  ' ' + document.getElementById(`numberOfmember_${project_id}`).value + ' membres';
                                        var li = document.createElement('li');
                                        var spacer = document.createElement('br');
                                        li.style.color = 'black';
                                        li.style.textAlign = 'left';
                                        // Alternance de la couleur de fond
                                        if (stepper % 2 == 0) {
                                            li.style.backgroundColor = 'white'; // Couleur pour les indices pairs
                                        } else {
                                            li.style.backgroundColor = '#EEEEEE'; // Couleur pour les indices impairs
                                        }
                                        li.style.borderRadius = '15px';
                                        li.style.backgroundColor = 'white';
                                        li.style.display = 'flex';
                                        li.style.justifyContent = 'space-between';
                                        li.style.padding = '10px';
                                        li.style.margin = '10px';
                                        li.style.textDecoration = 'none';

                                        li.innerHTML = `  -  ${user.referent_first_name} ${user.referent_last_name}  -  ${user.referent_email} - Référent `;
                                        document.getElementById('projectMembers_' + project_id).appendChild(li);
                                        stepper++;
                                        currentStepper++;
                                    }
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Récupérer les partenaires:', error);
                        });

                    fetch('https://lab.padem.org/wp-json/mo/v1/getCoordinator', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data !== null && data !== undefined && Array.isArray(data)) {
                                var stepper = 0;
                                data.forEach(user => {
                                    if (user.project_id === project_id) {
                                        //tabNumber[tabStepper].tab[currentStepper] = currentStepper + 1;
                                        var number = document.getElementById(`numberOfmember_${project_id}`).value;
                                        if (number === null || number === undefined || number === '') {
                                            document.getElementById(`numberOfmember_${project_id}`).value = 1;
                                        } else {
                                            document.getElementById(`numberOfmember_${project_id}`).value = parseInt(document.getElementById(`numberOfmember_${project_id}`).value) + 1;
                                        }
                                        document.getElementById(`numberOfmember_${project_id}`).innerText =  ' ' + document.getElementById(`numberOfmember_${project_id}`).value + ' membres';
                                        var li = document.createElement('li');
                                        var spacer = document.createElement('br');
                                        li.style.color = 'black';
                                        li.style.textAlign = 'left';
                                        // Alternance de la couleur de fond
                                        if (stepper % 2 == 0) {
                                            li.style.backgroundColor = 'white'; // Couleur pour les indices pairs
                                        } else {
                                            li.style.backgroundColor = '#EEEEEE'; // Couleur pour les indices impairs
                                        }
                                        li.style.borderRadius = '15px';
                                        li.style.backgroundColor = 'white';
                                        li.style.display = 'flex';
                                        li.style.justifyContent = 'space-between';
                                        li.style.padding = '10px';
                                        li.style.margin = '10px';
                                        li.style.textDecoration = 'none';

                                        li.innerHTML = `   -  ${user.consultant_first_name} ${user.coordinator_last_name}  -  ${user.coordinator_email} - Coordinateur <button class="btn btn-tertiary" onclick="removeSelectedMembers('${user.coordinator_email}', '${project_id}')">Supprimer</button>`;
                                        document.getElementById('projectMembers_' + project_id).appendChild(li);
                                        stepper++;
                                        currentStepper++;
                                    }
                                });
                            }
                        })
                        .catch(error => {
                            console.error('récupérer les coordinateurs:', error);
                        });

                    fetch('https://lab.padem.org/wp-json/mo/v1/getFunder', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data !== null && data !== undefined && Array.isArray(data)) {
                                var stepper = 0;
                                data.forEach(user => {
                                    if (user.project_id === project_id) {
                                        //tabNumber[tabStepper]['tab'] = currentStepper + 1;
                                        var number = document.getElementById(`numberOfmember_${project_id}`).value;
                                        if (number === null || number === undefined || number === '') {
                                            document.getElementById(`numberOfmember_${project_id}`).value = 1;
                                        } else {
                                            document.getElementById(`numberOfmember_${project_id}`).value = parseInt(document.getElementById(`numberOfmember_${project_id}`).value) + 1;
                                        }
                                        document.getElementById(`numberOfmember_${project_id}`).innerText =  ' ' + document.getElementById(`numberOfmember_${project_id}`).value + ' membres';
                                        var li = document.createElement('li');
                                        var spacer = document.createElement('br');
                                        li.style.color = 'black';
                                        li.style.textAlign = 'left';
                                        // Alternance de la couleur de fond
                                        if (stepper % 2 == 0) {
                                            li.style.backgroundColor = 'white'; // Couleur pour les indices pairs
                                        } else {
                                            li.style.backgroundColor = '#EEEEEE'; // Couleur pour les indices impairs
                                        }
                                        li.style.borderRadius = '15px';
                                        li.style.backgroundColor = 'white';
                                        li.style.display = 'flex';
                                        li.style.justifyContent = 'space-between';
                                        li.style.padding = '10px';
                                        li.style.margin = '10px';
                                        li.style.textDecoration = 'none';

                                        li.innerHTML = `   -  ${user.funder_first_name} ${user.funder_last_name}  -  ${user.funder_email} - Bailleur <button class="btn btn-tertiary" onclick="removeSelectedMembers('${user.funder_email}', '${project_id}')">Supprimer</button>`;
                                        document.getElementById('projectMembers_' + project_id).appendChild(li);
                                        stepper++;
                                        currentStepper++;
                                    }
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Récupérer les bailleurs:', error);
                        });
                    //#endregion

                    //#region Récupérer et afficher la liste de tout les fichiers du site afin de permettre à l'utilisateur de choisir un ou plusieurs fichier à ajouter au projet
                    fetch('https://lab.padem.org/wp-json/mo/v1/getSharedFiles', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data !== null && data !== undefined && Array.isArray(data)) {
                                var counter = 0;
                                var fileIds_tab = [];
                                var filesIDs = [];
                                var tab_liElements = {
                                    'li': [],
                                    'projectFileDetails': [],
                                    'file_id': 0,
                                };
                                var stateTab = new Array(data.length).fill(false);
                                document.getElementById(`projectFiles_${project_id}`).innerHTML = '';
                                document.getElementById(`projectFiles_${project_id}`).value = '';

                                //#region Récupérer le nombre de fichiers partagés
                                data.forEach(file => {
                                    if (file.file_id !== null && file.file_id !== undefined && !fileIds_tab.includes(file.file_id)) {
                                        fileIds_tab.push(file.file_id);
                                    }
                                })
                                document.getElementById(`filesNumber_${project_id}`).innerText = ' ' + fileIds_tab.length + ' fichiers';
                                //#endregion

                                data.forEach(file => {
                                    var file_name = file.file_name.split('/').pop();
                                    var file_id = file.file_id;

                                    if(!filesIDs.includes(file_id)){
                                        filesIDs.push(file_id);

                                        var file_size = file.file_size;
                                        filesIDs[globalStepper] = file_id;
                                        var isFileInProject = false;
                                        stateTab[counter] = isFileInProject;
                                        var isAlraedyAdded_text = document.createElement('p');
                                        isAlraedyAdded_text.style.color = 'green';
                                        isAlraedyAdded_text.innerText = 'Déjà ajouté';

                                        //#region Vérifier si le fichier est déjà dans le projet
                                        fetch('https://lab.padem.org/wp-json/mo/v1/getProjectFiles', {
                                                method: 'GET',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                            })
                                            .then(response => response.json())
                                            .then(projectFiles => {
                                                if (projectFiles !== null && projectFiles !== undefined && Array.isArray(projectFiles)) {
                                                    projectFiles.forEach(projectFile => {
                                                        if (projectFile.file_id === file_id && projectFile.project_id === project_id) {
                                                            isFileInProject = true;
                                                            stateTab[counter] = isFileInProject;
                                                        }
                                                    });
                                                }
                                            })
                                            .catch(error => {
                                                console.error('Erreur récupérer les fichiers du projet:', error);
                                            });
                                        //#endregion
                                        
                                        //#region Déterminer l'icône à afficher en fonction du type de fichier
                                        var icon_link;
                                        if (file_name.includes('.pdf')) {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/pdf.png';
                                        } else if (file_name.includes('.doc') || file_name.includes('.docx')) {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/word.png';
                                        } else if (file_name.includes('.xls') || file_name.includes('.xlsx')) {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/xls.png';
                                        } else if (file_name.includes('.ppt') || file_name.includes('.pptx')) {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/ppt.png';
                                        } else if (file_name.includes('.jpg') || file_name.includes('.jpeg') || file_name.includes('.png') || file_name.includes('.gif')) {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/jpg.png';
                                        } else if (file_name.includes('.zip') || file_name.includes('.rar') || file_name.includes('.7z')) {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/archive.png';
                                        } else if (file_name.includes('.txt') || file_name.includes('.log')) {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/txt.png';
                                        } else if (file_name.includes('.mp3') || file_name.includes('.wav') || file_name.includes('.flac') || file_name.includes('.ogg')) {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/audio.png';
                                        } else if (file_name.includes('.mp4') || file_name.includes('.avi') || file_name.includes('.mkv') || file_name.includes('.mov')) {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/85.png';
                                        } else {
                                            icon_link = 'https://lab.padem.org/wp-content/uploads/any_file.png';
                                        }
                                        //#endregion

                                        //#region Créer un élément de liste pour chaque fichier
                                        var li = document.createElement('li');
                                        li.style.color = 'black';
                                        li.style.fontSize = '13px';
                                        // Alternance de la couleur de fond
                                        li.style.textAlign = 'left';
                                        li.style.borderBottom = '1px #858787';
                                        li.style.borderRadius = '25px';
                                        li.style.backgroundColor = 'white';
                                        li.style.display = 'flex';
                                        li.style.justifyContent = 'space-left';
                                        li.style.justifyItems = 'left';
                                        li.style.padding = '10px';
                                        li.style.margin = '10px';
                                        li.style.textDecoration = 'none';
                                        li.style.width = '100%';
                                        li.style.cursor = 'pointer';
                                        li.style.id = 'file_';
                                        var line = document.createElement('hr');
                                        line.style.border = '1px solid #858787';
                                        line.style.width = '100%';
                                        line.style.margin = '10px';
                                        //#endregion

                                        //#region Afficher les détails du fichier
                                        var projectFileDetails = document.createElement('div');
                                        projectFileDetails.style.display = 'none';
                                        projectFileDetails.style.color = 'black';
                                        projectFileDetails.style.textAlign = 'left';
                                        projectFileDetails.style.fontSize = '10px';
                                        projectFileDetails.style.border = '1px #29A6A7';
                                        projectFileDetails.style.borderRadius = '15px';
                                        projectFileDetails.style.backgroundColor = 'grey';
                                        projectFileDetails.style.display = 'flex';
                                        projectFileDetails.style.justifyContent = 'space-between';
                                        projectFileDetails.style.padding = '10px';
                                        projectFileDetails.style.margin = '10px';
                                        projectFileDetails.style.textDecoration = 'none';
                                        projectFileDetails.style.width = '100%';
                                        projectFileDetails.style.id = 'fileDetails_' + project_id + '_' + file_id;
                                        //#endregion

                                        //#region Afficher l'aperçu du fichier et ses caractéristiques
                                        if (file_name.includes('.jpg') || file_name.includes('.jpeg') || file_name.includes('.png') || file_name.includes('.gif')) {
                                            projectFileDetails.innerHTML = projectFileDetails.innerHTML = `<div class="row"><img src="https://lab.padem.org/shared-files/${file_id}/?${file_name}" alt="${file_name}" id="img_${project_id}_${file_id}" ></img> <div style="display: flex; justify-content: space-between;"> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}">${file_name}</a> <div style="margin-left: 50px;"></div> Date: ${file.created_at}  <div style="margin-left: 50px;"></div> Auteur: ${file.user_name}  <div style="margin-left: 50px;"></div> <button id="addSelectedFiles_${project_id}_${file_id}" ${stateTab[counter] ? 'disabled' : ''}>${isFileInProject ? isAlraedyAdded_text.innerText : 'Ajouter'}</button>  <div style="margin-left: 50px;"></div>  <button class="btn btn-danger" id="removeSelectedFiles_${project_id}_${file_id}" ${isFileInProject ? '' : 'style="display: none;"'}>Supprimer</button> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}" class="btn btn-secondary" download>
                                                Télécharger</a>  <div style="margin-left: auto;"></div> <div id="loading_${project_id}_${file_id}" style="display: none;">
                                                    <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                    </div> </div></div>`;
                                        } else if(file_name.includes('.mp4') || file_name.includes('.avi') || file_name.includes('.mkv') || file_name.includes('.mov')) {
                                            projectFileDetails.innerHTML = projectFileDetails.innerHTML = `<div class="row"><video width="320" height="240" id="img_${project_id}_${file_id}" controls>
                                                <source src="https://lab.padem.org/shared-files/${file_id}/?${file_name}" type="video/mp4">
                                                <source src="https://lab.padem.org/shared-files/${file_id}/?${file_name}" type="video/ogg">
                                                Your browser does not support the video tag.
                                                </video><div class="row"> <div style="display: flex; justify-content: space-between;"> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}">${file_name}</a> <div style="margin-left: 50px;"></div> Date: ${file.created_at}  <div style="margin-left: 50px;"></div> Auteur: ${file.user_name}  <div style="margin-left: 50px;"></div> <button id="addSelectedFiles_${project_id}_${file_id}" ${stateTab[counter] ? 'disabled' : ''}>${isFileInProject ? isAlraedyAdded_text.innerText : 'Ajouter'}</button>  <div style="margin-left: 50px;"></div> <div style="display: flex; justify-content: space-between;"> <button class="btn btn-danger" id="removeSelectedFiles_${project_id}_${file_id}" ${isFileInProject ? '' : 'style="display: none;"'}>Supprimer</button> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}" class="btn btn-secondary" download>
                                                Télécharger</a>  <div style="margin-left: auto;"></div> <div id="loading_${project_id}_${file_id}" style="display: none;">
                                                        <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                        </div> </div></div>`;
                                        }
                                        else if(file_name.includes('.mp3') || file_name.includes('.wav') || file_name.includes('.flac') || file_name.includes('.ogg')) {
                                            projectFileDetails.innerHTML = projectFileDetails.innerHTML = `<div class="row"><audio id="img_${project_id}_${file_id}" controls>
                                                <source src="https://lab.padem.org/shared-files/${file_id}/?${file_name}" type="audio/mpeg">
                                                Your browser does not support the audio element.
                                                </audio> <div style="display: flex; justify-content: space-between;"> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}">${file_name}</a> <div style="margin-left: 50px;"></div> Date: ${file.created_at}  <div style="margin-left: 50px;"></div> Auteur: ${file.user_name}  <div style="margin-left: 50px;"></div> <button id="addSelectedFiles_${project_id}_${file_id}" ${stateTab[counter] ? 'disabled' : ''}>${isFileInProject ? isAlraedyAdded_text.innerText : 'Ajouter'}</button>  <div style="margin-left: 50px;"></div>  <button class="btn btn-danger" id="removeSelectedFiles_${project_id}_${file_id}" ${isFileInProject ? '' : 'style="display: none;"'}>Supprimer</button> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}" class="btn btn-secondary" download>
                                                    Télécharger</a>  <div style="margin-left: auto;"></div> <div id="loading_${project_id}_${file_id}" style="display: none;">
                                                    <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                    </div> </div></div>`;
                                        } 
                                        else if(file_name.includes('.pdf')) {
                                            projectFileDetails.innerHTML = projectFileDetails.innerHTML = `<div class="row"> <embed img_${project_id}_${file_id}" src="https://lab.padem.org/shared-files/${file_id}/?${file_name}" width="50%" height="fit-content" /> <div style="display: flex; justify-content: space-between;"> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}">${file_name}</a> <div style="margin-left: 50px;"></div> Date: ${file.created_at}  <div style="margin-left: 50px;"></div> Auteur: ${file.user_name}  <div style="margin-left: 50px;"></div> <button id="addSelectedFiles_${project_id}_${file_id}" ${stateTab[counter] ? 'disabled' : ''}>${isFileInProject ? isAlraedyAdded_text.innerText : 'Ajouter'}</button>  <div style="margin-left: 50px;"></div>  <button class="btn btn-danger" id="removeSelectedFiles_${project_id}_${file_id}" ${isFileInProject ? '' : 'style="display: none;"'}>Supprimer</button> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}" class="btn btn-secondary" download>
                                                Télécharger</a>  <div style="margin-left: auto;"></div> <div id="loading_${project_id}_${file_id}" style="display: none;">
                                                    <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                    </div></div></div>`;
                                        }
                                        else if(file_name.includes('.doc') || file_name.includes('.docx')) {
                                            projectFileDetails.innerHTML = projectFileDetails.innerHTML = `<div class="row"><iframe id="img_${project_id}_${file_id}" src="https://view.officeapps.live.com/op/embed.aspx?src=https://lab.padem.org/shared-files/${file_id}/?${file_name}" width="50%" height="fit-content" ></iframe> <div style="display: flex; justify-content: space-between;"> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}">${file_name}</a> <div style="margin-left: 50px;"></div> Date: ${file.created_at}  <div style="margin-left: 50px;"></div> Auteur: ${file.user_name}  <div style="margin-left: 50px;"></div> <button id="addSelectedFiles_${project_id}_${file_id}" ${stateTab[counter] ? 'disabled' : ''}>${isFileInProject ? isAlraedyAdded_text.innerText : 'Ajouter'}</button>  <div style="margin-left: 50px;"></div>  <button class="btn btn-danger" id="removeSelectedFiles_${project_id}_${file_id}" ${isFileInProject ? '' : 'style="display: none;"'}>Supprimer</button> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}" class="btn btn-secondary" download>
                                                Télécharger</a>  <div style="margin-left: auto;"></div> <div id="loading_${project_id}_${file_id}" style="display: none;">
                                                    <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                    </div></div></div>`;
                                        }
                                        else {
                                            projectFileDetails.innerHTML = projectFileDetails.innerHTML = `<div class="row"><img src="${icon_link}" alt="${file_name}" id="img_${project_id}_${file_id}" ></img> <div style="display: flex; justify-content: space-between;"> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}">${file_name}</a> <div style="margin-left: 50px;"></div> Date: ${file.created_at}  <div style="margin-left: 50px;"></div> Auteur: ${file.user_name}  <div style="margin-left: 50px;"></div> <button id="addSelectedFiles_${project_id}_${file_id}" ${stateTab[counter] ? 'disabled' : ''}>${isFileInProject ? isAlraedyAdded_text.innerText : 'Ajouter'}</button>  <div style="margin-left: 50px;"></div>  <button class="btn btn-danger" id="removeSelectedFiles_${project_id}_${file_id}" ${isFileInProject ? '' : 'style="display: none;"'}>Supprimer</button> <a href="https://lab.padem.org/shared-files/${file_id}/?${file_name}" class="btn btn-secondary" download>
                                                Télécharger</a>  <div style="margin-left: auto;"></div> <div id="loading_${project_id}_${file_id}" style="display: none;">
                                                    <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                    </div> </div></div>`;
                                        }
                                        //#endregion

                                        function formatFileSize(file_size) {
                                            var units = ['bits', 'Kb', 'Mb', 'Gb', 'Tb', 'Pb', 'Eb', 'Zb', 'Yb'];
                                            var i = 0;
                                            while (file_size >= 1024) {
                                                file_size /= 1024;
                                                ++i;
                                            }
                                            return file_size.toFixed(1) + ' ' + units[i];
                                        }

                                        li.innerHTML = `<div class="row"><div style="display: flex">${counter + 1}  -  <img src="${icon_link}" alt="${file_name}" id="img_${project_id}_${file_id}" ></img>  ${file_name}  ${formatFileSize(file_size)}</div><div style="margin-top: 10px; padding: 10px;"></div>
                                        </div>`;
                                        document.getElementById('projectFiles_' + project_id).appendChild(li);
                                        document.getElementById('projectFiles_' + project_id).appendChild(line);
                                        
                                        tab_liElements['li'].push(li);
                                        tab_liElements['projectFileDetails'].push(projectFileDetails);
                                        tab_liElements['file_id'] = file_id;
                                        
                                        //#region Ajouter un gestionnaire d'événement pour chaque bouton "Ajouter"
                                        var addSelectedFiles_ = document.getElementById(`addSelectedFiles_${project_id}_${file_id}`) || '';
                                        if (addSelectedFiles_ !== '' && addSelectedFiles_ !== undefined) {
                                            addSelectedFiles_.addEventListener('click', () => {
                                                fetch('https://lab.padem.org/wp-json/mo/v1/createProjectFiles', {
                                                        method: 'POST',
                                                        headers: {
                                                            'Content-Type': 'application/json',
                                                        },
                                                        body: JSON.stringify({
                                                            project_id: project_id,
                                                            file_id: file.file_id,
                                                            file_name: file_id,
                                                            user_email: userEmail,
                                                        }),
                                                    })
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        if (data !== null && data !== undefined) {
                                                        }
                                                    })
                                                    .catch(error => {
                                                        console.error('Erreur ajouter le fichier au projet:', error);
                                                    });
                                            });
                                        }
                                        //#endregion

                                        //#region Ajouter un gestionnaire d'événement pour chaque bouton "Supprimer"
                                        var removeSelectedFiles_ = document.getElementById(`removeSelectedFiles_${project_id}_${file_id}`) || '';
                                        if (removeSelectedFiles_ !== '' && removeSelectedFiles_ !== undefined) {
                                            removeSelectedFiles_.addEventListener('click', () => {
                                                fetch('https://lab.padem.org/wp-json/mo/v1/deleteProjectFiles', {
                                                        method: 'DELETE',
                                                        headers: {
                                                            'Content-Type': 'application/json',
                                                        },
                                                        body: JSON.stringify({
                                                            file_id: file.file_id,
                                                        }),
                                                    })
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        if (data !== null && data !== undefined) {
                                                        }
                                                    })
                                                    .catch(error => {
                                                        console.error('Erreur supprimer le fichier du projet:', error);
                                                    });
                                            });
                                        }
                                        //#endregion
                                        
                                        counter++;
                                    }
                                    currentStepper++;
                                    globalStepper++;
                                });
                                tab_liElements['li'].forEach(li => {
                                    var file_id = tab_liElements['file_id'];
                                    li.addEventListener('click', () => {
                                        var projectFileDetails = tab_liElements['projectFileDetails'][tab_liElements['li'].indexOf(li)];
                                        var div = document.createElement('div');
                                        div.innerHTML = projectFileDetails.innerHTML;
                                        if (projectFileDetails.style.display === 'none') {
                                            li.parentNode.insertBefore(div, li.nextSibling);
                                            projectFileDetails.style.display = 'block';
                                        } else {
                                            li.parentNode.removeChild(li.nextSibling);
                                            projectFileDetails.style.display = 'none';
                                        }
                                    });
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Erreur récupération les fichiers:', error);
                            var li = document.createElement('li');
                            li.style.color = 'black';
                            li.style.textAlign = 'left';
                            li.innerText = 'Aucun fichier trouvé';
                            document.getElementById('projectFiles_' + project_id).appendChild(li);
                        });
                    //#endregion
                    
                    // Afficher le statut du projet en fonction du nombre de membres
                    var numberOfMembers = document.querySelector(`#numberOfmember_${project_id}`);
                    if (numberOfMembers !== null && numberOfMembers !== undefined) {
                        var statusElement = document.getElementById(`status_${project_id}`);
                        if (statusElement !== null && statusElement !== undefined) {
                            if(document.getElementById(`numberOfmember_${project_id}`).value === 0) {
                                statusElement.innerText = 'En attente';
                                statusElement.style.color = 'red';
                            } else {
                                statusElement.innerText = 'Publié';
                                statusElement.style.color = 'green';
                            }
                        }
                    }
                    tabStepper++;
                    projectStepper++;
                });
            })
            .catch(error => {
                console.error(error);
                // Afficher un message d'erreur
                alert('Une erreur est survenue : ', error);
            });
    });
</script>