<!-- Description: Afficher la liste des projets en cours -->

<body>
    <!-- Afficher la liste des projets en cours -->
    <ul id="projectsList" style="text-decoration: none;"></ul>
</body>


<script>
    // Projet: Récurérer les données depuis la base de données et les afficher dans des cellules individuels cliquables pour les modifier
    document.addEventListener('DOMContentLoaded', () => {
        // Déclarer les variables
        var userId;
        var userEmail = '';
        var userRole = '';
        var buttonText = 'Compléter le projet';
        var numberOfMembers = 0;
        var localStatus = '';
        var projectStatus = '';

        // Récupérer la liste des projets depuis la base de données (à partir de l'API (https://lab.padem.org/wp-json/mo/v1/getProjects))
        // les projets sont affichés dans des lignes individuelles avec un bouton cliquables pour les modifier
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjects', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                var colorStatusText = {
                    'En cours': 'green',
                    'Terminé': 'lightred',
                    'En pause': 'lightblue',
                    'Annulé': 'gray',
                    'Non commencé': 'lightgray',
                };
                var colorStatusBackground = {
                    'Complet': 'green',
                    'Incomplet': 'red',
                };
                var stepper = 0;
                // Parcourir la liste des projets
                data.forEach(project => {
                    // Créer un élément de liste pour chaque projet
                    var li = document.createElement('li');
                    var liSpacer = document.createElement('li');
                    // Ajouter le titre du projet, la date de début, la date de fin, le pays, le référent et le statut dans des éléments individuels
                    li.style.color = 'black';
                    li.style.textAlign = 'left';
                    li.style.border = 'none';
                    li.style.borderRadius = '15px';
                    li.style.backgroundColor = 'white';
                    li.style.height = 'auto';
                    li.style.width = '100%';
                    li.style.display = 'flex';
                    li.style.justifyContent = 'space-between';
                    li.style.padding = '10px';
                    li.style.margin = '10px';
                    li.style.border = '1px #5AC4C4D0';
                    li.style.textDecoration = 'none';

                    liSpacer.style.height = 'auto';
                    liSpacer.style.width = '100%';
                    liSpacer.style.backgroundColor = 'none';
                    liSpacer.innerHTML = `
                        <div style="margin-top: 3px; margin-bottom: 3px; background: none;"></div>
                    `;
                    projectStatus = project.project_status;
                    numberOfMembers = project.users_list.length;
                    if (numberOfMembers === 0 || project.users_list === null || project.users_list === undefined) {
                        localStatus = 'Incomplet';
                        buttonText = 'Compléter le projet';
                        projectStatus = 'Non commencé';
                    } else if (numberOfMembers > 0) {
                        localStatus = 'Complet';
                        buttonText = 'Modifier le projet';
                    }

                    // Ajouter les données dans l'élément de liste
                    li.innerHTML = `
                        <span style="font-weight: bold; color: '#29A6A7';">${project.project_title}</span>
                        <span>${project.project_location}</span>
                        <span>Membres: ${numberOfMembers}</span>
                        <span style="text-transform: capitalize; font-weight: bold; color: ${colorStatusText[projectStatus]}; background: white; margin: 5px; padding: 5px; boder-radius: 20px;" id="status_${project.project_id}">${projectStatus}</span>
                        <span style="font-weight: bold; font-size: 11px; color: ${colorStatusBackground[localStatus]};">${localStatus}</span>
                        <span style="display: 'flex'; justify-content: 'flex-end';">
                            <div style="margin-right: 10px;"></div>
                            <button class="buttonModifier">${buttonText}</button>
                        </span>
                    `;
                    // Ajouter un événement de clic sur le bouton "Modifier"    
                    li.querySelector('button').addEventListener('click', () => {
                        // Rediriger l'utilisateur vers la page de modification du projet
                        window.location.href = 'https://lab.padem.org/projet/edit_project.html?project_id=' + project.project_id;
                    });
                    // Ajouter l'élément de liste dans la liste des projets
                    document.getElementById('projectsList').appendChild(li);

                    stepper++;
                    if (stepper === 2) {
                        li.style.backgroundColor = '#F2F1F1';
                        if (liSpacer !== null) {
                            document.getElementById('projectsList').appendChild(liSpacer);
                        }
                        stepper = 0;
                    } else {
                        li.style.backgroundColor = 'white';
                    }
                });
            })
    });
</script>