<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }

    table,
    th,
    td {
        border: 1px solid black;
    }

    th,
    td {
        padding: 5px;
        text-align: left;
    }

    th {
        background-color: #f2f2f2;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    tr:nth-child(odd) {
        background-color: #ffffff;
    }

    tr:hover {
        background-color: #e6e6e6;
    }

    button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
    }

    button:hover {
        background-color: #45a049;
    }

    button:active {
        background-color: #3e8e41;
    }

    button:focus {
        outline: none;
    }

    button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }
</style>

<body>
    <!-- Afficher la liste des projets en cours -->
    <table>
        <tbody id="projectsList"></tbody>
    </table>


</body>


<script>
    // Projet: Récurérer les données depuis la base de données et les afficher dans des cellules individuels cliquables pour les modifier
    document.addEventListener('DOMContentLoaded', () => {
        // Déclarer les variables
        var userId;
        var userEmail = '';
        var userRole = '';
        var buttonText = '';


        // Récupérer la liste des projets depuis la base de données (à partir de l'API (https://lab.padem.org/wp-json/mo/v1/getProjects))
        // les projets sont affichés dans des lignes individuelles avec un bouton cliquables pour les modifier
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjects', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                var colorStatusText = {
                    'En cours': 'green',
                    'Terminé': 'lightred',
                    'En pause': 'lightblue',
                    'Annulé': 'gray',
                    'Non commencé': 'orange',
                }
                // Parcourir la liste des projets
                data.forEach(project => {
                    // Créer une ligne pour chaque projet
                    var tr = document.createElement('tr');
                    var trSpacer = document.createElement('tr');
                    // Ajouter le titre du projet, la date de début, la date de fin, le pays, le référent et le statut dans des lignes individuelles
                    tr.style.color = 'black';
                    tr.style.textAlign = 'left';
                    tr.style.border = 'none';
                    tr.style.borderRadius = '15px';
                    tr.style.backgroundColor = 'white';
                    tr.style.height = 'auto';
                    tr.style.width = '50%';

                    trSpacer.innerHTML = `
                        <div style="margin-top: 10px; margin-bottom: 10px"></div>
                    `;

                    // Ajouter les données dans la ligne
                    tr.innerHTML = `
                        <td>${project.project_title}</td>
                        <td>${project.start_date}</td>
                        <td>${project.end_date}</td>
                        <td>${project.project_location}</td>
                        <td>${project.project_referent_email}</td>
                        <td style="text-transform: capitalize; font-weight: bold; color: ${colorStatusText[project.project_status]}; background: white" id="status_${project.project_id}">${project.project_status}</td>
                        <td>
                            <button class="buttonModifier">Modifier</button>
                        </td>
                    `;
                    // Ajouter un événement de clic sur le bouton "Modifier"    
                    tr.querySelector('button').addEventListener('click', () => {
                        // Rediriger l'utilisateur vers la page de modification du projet
                        window.location.href = 'https://lab.padem.org/projet/edit_project.html?project_id=' + project.project_id;
                    });
                    // Ajouter la ligne dans la liste des projets
                    document.getElementById('projectsList').appendChild(tr);
                    document.getElementById('projectsList').appendChild(trSpacer);
                });
            })
    });
</script>