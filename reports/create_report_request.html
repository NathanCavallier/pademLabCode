<div class="container">
    <form id="reportSubmissionForm">
        <div class="form-group">
            <label for="memberName">Votre adresse mail:</label>
            <input type="text" class="form-control" id="memberName" required>
        </div>
        <div class="form-group">
            <label for="projectName">Projet concerné:</label>
            <select class="form-control" id="projectName" required></select>
        </div>
        <div class="form-group">
            <label for="reportType">Type de rapport à fournir:</label>
            <select class="form-control" id="reportType" required>
                <option value="progress">Rapport d'avancement</option>
                <option value="final">Rapport final</option>
            </select>
        </div>
        <div class="form-group">
            <label for="reportContent">Nom des documents models:</label>
            <textarea class="form-control" id="reportContent" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary" style="width: fit-content;">Soumettre la demande de
            rapport</button>
    </form>
</div>


<!-- Afficher la liste de demande de rapport -->
<div class="container">
    <h2>Demandes de rapport</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Projet</th>
                <th>Type de rapport</th>
                <th>Documents models</th>
                <th>Statut</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Projet 1</td>
                <td>Rapport d'avancement</td>
                <td>Document 1, Document 2</td>
                <td>En attente</td>
            </tr>
            <tr>
                <td>Projet 2</td>
                <td>Rapport final</td>
                <td>Document 1, Document 2, Document 3</td>
                <td>En attente</td>
            </tr>
        </tbody>
    </table>
</div>


<script>

    document.addEventListener("DOMContentLoaded", function () {
        // Récupérer les noms des projets et leurs id
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjects',
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erreur réseau lors de la demande à l\'API');
                }
                return response.json();
            })
            .then(projects => {
                var projectNameInput = document.getElementById("projectName");
                projects.forEach(function (project) {
                    var option = document.createElement("option");
                    option.value = project.project_id;
                    option.text = project.project_title;
                    projectNameInput.appendChild(option);
                });
            })
            .catch(error => console.error('Erreur:', error));
    });

    document.getElementById("reportSubmissionForm").addEventListener("submit", function (event) {
        event.preventDefault();
        submitReportRequest();
    });

    function submitReportRequest() {
        var memberName = document.getElementById("memberName").value;
        var project_id = document.getElementById("projectName").value;
        var reportType = document.getElementById("reportType").value;
        var reportContent = document.getElementById("reportContent").value;

        if (memberName == "" || projectName == "" || reportType == "" || reportContent == "") {
            alert("Veuillez remplir tous les champs.");
            return;
        }

        var data = {
            'project_id': project_id,
            'link_title': memberName,
            'link_url': reportType,
            'link_description': reportContent
        };

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "https://lab.padem.org/wp-json/mo/v1/createLink", true);
        xhr.onload = function () {
            if (xhr.status == 200) {
                alert("Demande de rapport soumie avec succès!");
            } else {
                alert("Erreur lors de la soumission du rapport.");
            }
        };
        xhr.send(JSON.stringify(data));
    }
</script>