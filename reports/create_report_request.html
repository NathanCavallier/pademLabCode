<div class="container">
    <form id="reportSubmissionForm">
        <div class="form-group">
            <label for="memberName">Votre adresse mail:</label>
            <input type="text" class="form-control" id="memberName">
        </div>
        <div class="form-group">
            <label for="projectName">Projet concerné:</label>
            <select class="form-control" id="projectName" required></select>
        </div>
        <div class="form-group">
            <label for="reportType">Type de rapport à fournir:</label>
            <select class="form-control" id="reportType" required>
                <option value="progress">Rapport d'avancement</option>
                <option value="final">Rapport final</option>
            </select>
        </div>
        <div class="form-group">
            <label for="reportContent">Nom des documents models:</label>
            <textarea class="form-control" id="reportContent" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary" style="width: fit-content;">Soumettre la demande de
            rapport</button>
    </form>
</div>


<!-- Afficher la liste de demande de rapport -->


<script>

    document.addEventListener("DOMContentLoaded", function () {
        // Récupérer les noms des projets et leurs id
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjects',
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (!response.ok) {
                    console.log('Erreur réseau lors de la demande à l\'API');
                }
                return response.json();
            })
            .then(projects => {
                var projectNameInput = document.getElementById("projectName");
                projects.forEach(function (project) {
                    var option = document.createElement("option");
                    option.value = project.project_id;
                    option.text = project.project_title;
                    projectNameInput.appendChild(option);
                });
            })
            .catch(error => console.error('Erreur:', error));
    });

    document.getElementById("reportSubmissionForm").addEventListener("submit", function (event) {
        event.preventDefault();
        submitReportRequest();
    });

    function submitReportRequest() {
        var memberName = document.getElementById("memberName").value;
        var project_id = document.getElementById("projectName").value;
        var reportType = document.getElementById("reportType").value;
        var reportContent = document.getElementById("reportContent").value;

        if (memberName === "" || project_id === "" || reportType === "" || reportContent === "") {
            alert("Veuillez remplir tous les champs.");
            return;
        }

        var data = {
            'project_id': project_id,
            'link_title': memberName,
            'link_url': reportType,
            'link_description': reportContent
        };

        fetch("https://lab.padem.org/wp-json/mo/v1/createLink", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (response.ok) {
                alert("Demande de rapport soumise avec succès!");
            } else {
                console.log("Erreur lors de la soumission du rapport.");
            }
        })
        .catch(error => console.error('Erreur:', error));
    }
</script>