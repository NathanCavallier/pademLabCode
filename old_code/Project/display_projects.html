<!-- Description: Afficher la liste des projets en cours -->

<body>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Ajoutez ceci pour utiliser Font Awesome -->
    <!-- Afficher la liste des projets en cours -->
    <ul id="projectsList"></ul>
</body>



<script>
    // Projet: Récurérer les données depuis la base de données et les afficher dans des cellules individuels cliquables pour les modifier
    document.addEventListener('DOMContentLoaded', (event) => {
        // Afficher le spinner de chargement
        document.getElementById('loading').style.display = 'block';
        // Déclarer les variables
        var all_users_roles = JSON.parse(users_IDs_roles);
        var user_projects_ids = [];
        var userId = current_user_data.ID;
        var userEmail = current_user_data.email;
        var userRole = current_user_data.roles;
        var buttonText = 'Compléter le projet';
        var localStatus = '';
        var projectStatus = '';
        var allUsers = [];
        var tabNumber = new Array().fill({
            'tab': []
        });
        var counter = 0;
        var listOfAllMembersEmailOnPademLab = [];

        //#region Récupérer les informations de l'utilisateur connecté
        fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    data.forEach(user => {
                        var users = JSON.parse(user.users_emails_list);
                        console.log('Users:', users);
                    });
                } else {
                    console.log('Aucun utilisateur trouvé.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        //#endregion


        // Récupérer la liste des projets depuis la base de données (à partir de l'API (https://lab.padem.org/wp-json/mo/v1/getProjects))
        // les projets sont affichés dans des lignes individuelles avec un bouton cliquables pour les modifier
        fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                // Déclarer les variables
                document.getElementById('totalProjects').innerText = data.length;
                var colorStatusText = {
                    'Publié': 'green',
                    'Non publié': 'gray',
                };
                var colorStatusBackground = {
                    'Complet': 'green',
                    'Incomplet': 'red',
                };
                var stepper = 0;
                var projectStepper = 0;
                var tabStepper = 0;
                var numberOfMembers = 0;
                var membersTable = new Array(data.length).fill(0);
                var filesIDs = new Array().fill(0);
                var globalStepper = 0;
                var members = new Array(data.length).fill({
                    'project_id': 0,
                    'coordinateur': [],
                    'chef_de_projet': [],
                    'accountant': [],
                    'consultant': [],
                    'partner': [],
                    'funder': [],
                    'referent': []
                });
                // Parcourir la liste des projets
                data.forEach(project => {
                    var project_id = project.project_id;
                    var list_OfUsers = {
                        'project_id': 0,
                        'coordinateur': [],
                        'chef_de_projet': [],
                        'accountant': [],
                        'consultant': [],
                        'partner': [],
                        'funder': [],
                        'referent': []
                    };
                    var currentStepper = 0;
                    // Fonction pour supprimer un membre du projet
                    function removeSelectedMembers(email, project_id) {
                        fetch('https://lab.padem.org/wp-json/mo/v1/removeMember', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                'project_id': project_id,
                                'email': email,
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Membre supprimé:', data);
                            })
                            .catch(error => {
                                console.error('Erreur:', error);
                            });
                    }

                    // Créer un élément de liste pour chaque projet
                    var li = document.createElement('li');
                    //#region Style de l'élément de liste
                    try {
                        li.style.color = 'black';
                        li.style.textAlign = 'left';
                        li.style.border = '1px #29A6A7';
                        li.style.borderRadius = '15px';
                        li.style.backgroundColor = 'white';
                        stepper++;
                        if (stepper === 2) {
                            li.style.border = 'none';
                            stepper = 0;
                        }
                        li.style.height = 'auto';
                        li.style.width = '95%';
                        li.style.display = 'flex';
                        li.style.justifyContent = 'space-between';
                        li.style.padding = '10px';
                        li.style.margin = '10px';
                        li.style.textDecoration = 'none';
                    } catch (error) {
                        console.error('Erreur: (Style de l\'élément de liste)', error);
                    }
                    //#endregion

                    try {
                        //#region Ajouter les données dans l'élément de liste
                        li.innerHTML = `
                            <div style="list-style-type: none; padding: 5px; margin: 5px; border-radius: 10px;">
                                <ul class="project-row">
                                    <li class="project-element" style="font-weight: bold; color: gray;">${projectStepper + 1}</li>
                                    <li class="project-element" style="font-weight: bold; color: #29A6A7;">${project.project_title}</li>
                                    <li class="project-element">Pays: ${project.project_location}</li>
                                    <li class="project-element" style="display: flex;"><p id="numberOfmember_${project_id}"></p></li>
                                    <li class="project-element" style="text-transform: capitalize; font-weight: bold; color: ${colorStatusText[projectStatus]}; background: none; margin: 5px; padding: 5px; boder-radius: 20px;" id="status_${project_id}"></li>
                                    <li class="project-element" style="font-weight: bold; font-size: 11px;" id="localStatus_${project_id}"></li>
                                    <li class="project-element" style="display: flex; justify-content: flex-end;">
                                        <button class="buttonModifier" id="buttonModifier_${project_id}" style="display: none; margin: 5px; margin-right: -15px; padding: 5px; boder-radius: 20px; font-size: 11px;">${buttonText}</button>
                                    </li>
                                    <li class="project-element" style="display: flex; justify-content: flex-end;">
                                        <button class="buttonModifier" id="goTo_Project_${project_id}" style="margin: 5px; margin-right: -15px; padding: 5px; boder-radius: 20px; font-size: 11px;">Aller au projet</button>
                                    </li>
                                    <li class="project-element" style="display: flex; justify-content: flex-end;">
                                        <button class="buttonModifier" id="close_Project_${project_id}" style="display: none; margin: 5px; margin-right: -15px; padding: 5px; boder-radius: 20px; font-size: 11px; background: red; color: white;"> Fermer le projet <i class="fas fa-trash-alt"></i></button>
                                    </li>
                                </ul>
                                <div id="modifyProject_${project_id}" style="display: none; width: 100%; height: auto; background: white; margin: 10px; padding: 10px; border-radius: 10px;">
                                    <hr style="border: 1px solid #29A6A7;">
                                    <div style="margin: 5px; padding: 5px;"></div>
                                    <div class="row">
                                        <div class="col-md-12">
                                        <div class="row">
                                        <div style="margin-top: 5px; padding: 5px;"></div>
                                        <div class="container">
                                            <!-- Afficher une liste de boutons à l'horizontale permettant de faire apparaître le type d'éléments à ajouter au projet -->
                                            <div class="col-md-12" style="width: 100%; background: white;">
                                                <div class="row" style="display: flex-start; width: 100%;">
                                                    <div class="btn-group" role="group" aria-label="menu" style="width: 100%;">
                                                        <div style="margin-top: 5px; padding: 5px;"></div>
                                                        <div style="margin-top: 5px; padding: 5px;"></div>
                                                        <div style="margin-top: 5px; padding: 5px;"></div>
                                                        <button type="button" id="buttonExistingMember_${project_id}" class="btn btn-secondary"
                                                            style="width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                            Membres du projet</button>
                                                        <div style="margin-left: 50px; margin-right: 50px;"></div>
                                                        <button type="button" id="buttonNewMember_${project_id}" class="btn btn-secondary"
                                                            style="width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                            Ajouter un membre</button>
                                                        <button type="button" id="buttonDocumentModel_${project_id}" class="btn btn-secondary"
                                                            style="display: block; width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                            Ajouter des fichiers</button>
                                                        <button type="button" id="buttonAddLink_${project_id}" class="btn btn-secondary"
                                                            style="display: block; width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                            Ajouter un Lien</button>
                                                        <button type="button" id="buttonAddDivers_${project_id}" class="btn btn-secondary"
                                                            style="display: none; width: fit-content; margin: 5px; padding: 5px; background: white; color: #29A6A7; font-size: 10px; border-radius: 20px;">
                                                            Documents Models</button>
                                                    </div>
                                                </div>
                                                <div style="margin: 5px; padding: 5px;"></div>
                                                <div id="newMember_${project_id}" style="display: none; width: 100%" class="settings-scroll">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <!--#region Liste des boutons -->
                                                                <div style="display: flex; justify-content: flex-end;">
                                                                    <button type="button" class="box-clicable" id="tous_${project_id}"
                                                                        style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px; border: none; margin: 5px; padding: 5px;font-size: 13px;">
                                                                        Tous les membres </button>
                                                                    <button type="button" class="box-clicable" id="with_project_${project_id}"
                                                                        style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
                                                                        Avec projet </button>
                                                                    <button type="button" class="box-clicable" id="with_role_without_project_${project_id}"
                                                                        style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
                                                                        Avec rôle et sans projet </button>
                                                                    <button type="button" class="box-clicable" id="without_role_without_project_${project_id}"
                                                                        style="width: fit-content; color: gray; background-color: white; align-self: center; border-radius: 15px;border: none; margin: 5px; padding: 5px;font-size: 13px;">
                                                                        Sans rôle et sans projet </button>
                                                                </div>
                                                                <!--#endregion-->

                                                                <hr style="border: 1px solid gray; margin: 10px; padding: 10px;">

                                                                <!--#region Liste des membres -->
                                                                <ul id="tous-${project_id}" style="list-style: none; display: none;"></ul>
                                                                <ul id="with-project-${project_id}" style="list-style: none; display: none;"></ul>
                                                                <ul id="with-role-without-project-${project_id}" style="list-style: none; display: none;"></ul>
                                                                <ul id="without-role-without-project-${project_id}" style="list-style: none; display: none;"></ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="existingMember_${project_id}" style="display: none; width: 100%;">
                                                    <div class="row">
                                                        <h6 style="color: gray;">Membres du projet</h6>
                                                        <hr style="border: 1px gray;">
                                                        <div style="display: flex;" class="settings-scroll">
                                                            <div style="flex: 1; margin-right: 10px;">
                                                                <ul id="projectMembers_${project_id}" style="list-style: none;">
                                                                    <!-- Les membres du projet vont ici -->
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="newDocument_${project_id}" style="display: none; width: 100%;">
                                                    <div class="row">                                        
                                                        <div class="row" style="display: flex;">
                                                            <div style="display: flex; justify-content: space-between;">
                                                                <p style="color: gray;">Sélectionnez des fichiers à intégrer au projet  -  Disponible(s): <p id="filesNumber_${project_id}"></p></p>
                                                            </div>
                                                            <hr style="border: 1px gray;">
                                                            <div style="width: 100%; background: white;" class="settings-scroll">
                                                                <div style="margin-top: 10px; padding: 10px;"></div>
                                                                <ul id="projectFiles_${project_id}" style="list-style: none; background: white;">
                                                                    <!-- Les éléments de la liste seront ajoutés ici dynamiquement -->
                                                                </ul>
                                                                <div style="margin-top: 10px; padding: 10px;"></div>
                                                            </div>
                                                            <!-- Colonne de droite pour les détails de l'image -->
                                                            <div style="width: 100%; class="settings-scroll">
                                                                <div style="margin-top: 10px; padding: 10px;"></div>
                                                                <div id="projectFileDetails_${project_id}_${filesIDs[globalStepper]}" style="display: none;">
                                                                    <!-- Les détails du fichier seront ajoutés ici dynamiquement -->
                                                                </div>
                                                                <div style="margin-top: 10px; padding: 10px;"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="newLink_${project_id}" style="display: none; width: 100%;">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <div style="margin: 5px; padding: 5px;"></div>
                                                                <label for="linkTitle_${project_id}">Titre du lien</label>
                                                                <input type="text" class="form-control" id="linkTitle_${project_id}" aria-describedby="emailHelp">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <div style="margin: 5px; padding: 5px;"></div>
                                                                <label for="linkDescription_${project_id}">Description du lien: </label>
                                                                <textarea class="form-control" id="linkDescription_${project_id}" rows="5"></textarea>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <div style="margin: 5px; padding: 5px;"></div>
                                                                <label for="linkUrl_${project_id}">Saisir le lien: </label>
                                                                <input type="text" class="form-control" id="linkUrl_${project_id}" aria-describedby="emailHelp">
                                                            </div>
                                                        </div>
                                                        <div style="margin-top: 10px; padding: 10px;"></div>
                                                        <div class="col-md-12" style="display: flex; width: 100%;">
                                                            <button type="submit" class="btn btn-primary" id="linkSubmit_${project_id}" style="width: fit-content;">Ajouter le lien au projet</button>
                                                            <div style="margin: 5px; padding: 5px;"></div>
                                                            <div id="loading_${project_id}" style="display: none;">
                                                                <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="newMisc_${project_id}" style="display: none; width: 100%;">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <div style="margin: 5px; padding: 5px;"></div>
                                                                <label for="miscTitle_${project_id}">Titre de l'élément: </label>
                                                                <input type="text" class="form-control" id="miscTitle_${project_id}" aria-describedby="emailHelp">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <div style="margin: 5px; padding: 5px;"></div>
                                                                <label for="miscDescription_${project_id}">Description de l'élément: </label>
                                                                <textarea class="form-control" id="miscDescription_${project_id}" rows="5"></textarea>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <div style="margin: 5px; padding: 5px;"></div>
                                                                <label for="miscFile_${project_id}">Charger un document: </label>
                                                                <input type="file" class="form-control-file" id="miscFile_${project_id}">
                                                            </div>
                                                        </div>
                                                        <div style="margin-top: 10px; padding: 10px;"></div>
                                                        <div class="col-md-12" style="display: flex; width: 100%;">
                                                            <button type="submit" class="btn btn-primary" id="buttonAddMisc_${project_id}" style="width: fit-content;">Ajouter l'élément au projet</button><div style="margin: 5px; padding: 5px;"></div>
                                                            <div id="loading_${project_id}" style="display: none;">
                                                                <img src="https://lab.padem.org/wp-content/uploads/Spin@1x-1.0s-200px-200px.gif" style="width: 30px; height: 30px" alt="Chargement...">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                </div>
                            </div>
                        `;
                        //#endregion
                    } catch (error) {
                        console.error('Erreur: (pastille d\'un projet)', error);
                    }

                    // Ajouter l'élément de liste dans la liste des projets
                    document.getElementById('projectsList').appendChild(li);

                    //#region Couleurs initiales des boutons
                    try {
                        var menuActiveButtons = {
                            'selected_background': '#29A6A7',
                            'selected_color': 'white',
                            'unselected_background': 'white',
                            'unselected_color': 'gray',
                        };
                        document.getElementById('tous_' + project_id).style.backgroundColor = menuActiveButtons.selected_background;
                        document.getElementById('tous_' + project_id).style.color = menuActiveButtons.selected_color;
                        document.getElementById('with_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                        document.getElementById('with_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                        document.getElementById('with_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                        document.getElementById('with_role_without_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                        document.getElementById('without_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                        document.getElementById('without_role_without_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                    } catch (error) {
                        console.log('Erreur lors de l\'exécution du script(couleurs initiales des bouttons) :', error);
                    }
                    //#endregion

                    //#region Ajouter un gestionnaire d'événement pour chaque bouton(tous les membres, avec projet, avec rôle et sans projet, sans rôle et sans projet)
                    try {
                        document.getElementById(`tous_${project_id}`).addEventListener('click', () => {
                            document.getElementById(`tous-${project_id}`).style.display = 'block';
                            document.getElementById(`with-project-${project_id}`).style.display = 'none';
                            document.getElementById(`with-role-without-project-${project_id}`).style.display = 'none';
                            document.getElementById(`without-role-without-project-${project_id}`).style.display = 'none';

                            // Couleurs des boutons
                            document.getElementById('tous_' + project_id).style.backgroundColor = menuActiveButtons.selected_background;
                            document.getElementById('tous_' + project_id).style.color = menuActiveButtons.selected_color;
                            document.getElementById('with_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('with_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                            document.getElementById('with_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('with_role_without_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                            document.getElementById('without_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('without_role_without_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                            
                            getProjects();
                            getAllWordPressMembers();
                        });
                    } catch (error) {
                        console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "tous les membres")', error);
                    }

                    try {
                        document.getElementById(`with_project_${project_id}`).addEventListener('click', () => {
                            document.getElementById(`tous-${project_id}`).style.display = 'none';
                            document.getElementById(`with-project-${project_id}`).style.display = 'block';
                            document.getElementById(`with-role-without-project-${project_id}`).style.display = 'none';
                            document.getElementById(`without-role-without-project-${project_id}`).style.display = 'none';

                            // Couleurs des boutons
                            document.getElementById('tous_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('tous_' + project_id).style.color = menuActiveButtons.unselected_color;
                            document.getElementById('with_project_' + project_id).style.backgroundColor = menuActiveButtons.selected_background;
                            document.getElementById('with_project_' + project_id).style.color = menuActiveButtons.selected_color;
                            document.getElementById('with_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('with_role_without_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                            document.getElementById('without_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('without_role_without_project_' + project_id).style.color = menuActiveButtons.unselected_color;

                        });
                    } catch (error) {
                        console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "avec projet")', error);
                    }

                    try {
                        document.getElementById(`with_role_without_project_${project_id}`).addEventListener('click', () => {
                            document.getElementById(`tous-${project_id}`).style.display = 'none';
                            document.getElementById(`with-project-${project_id}`).style.display = 'none';
                            document.getElementById(`with-role-without-project-${project_id}`).style.display = 'block';
                            document.getElementById(`without-role-without-project-${project_id}`).style.display = 'none';

                            // Couleurs des boutons
                            document.getElementById('tous_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('tous_' + project_id).style.color = menuActiveButtons.unselected_color;
                            document.getElementById('with_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('with_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                            document.getElementById('with_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.selected_background;
                            document.getElementById('with_role_without_project_' + project_id).style.color = menuActiveButtons.selected_color;
                            document.getElementById('without_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('without_role_without_project_' + project_id).style.color = menuActiveButtons.unselected_color;

                        });
                    } catch (error) {
                        console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "avec rôle et sans projet")', error);
                    }

                    //#endregion 
                    try {
                        document.getElementById(`without_role_without_project_${project_id}`).addEventListener('click', () => {
                            document.getElementById(`tous-${project_id}`).style.display = 'none';
                            document.getElementById(`with-project-${project_id}`).style.display = 'none';
                            document.getElementById(`with-role-without-project-${project_id}`).style.display = 'none';
                            document.getElementById(`without-role-without-project-${project_id}`).style.display = 'block';

                            // Couleurs des boutons
                            document.getElementById('tous_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('tous_' + project_id).style.color = menuActiveButtons.unselected_color;
                            document.getElementById('with_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('with_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                            document.getElementById('with_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.unselected_background;
                            document.getElementById('with_role_without_project_' + project_id).style.color = menuActiveButtons.unselected_color;
                            document.getElementById('without_role_without_project_' + project_id).style.backgroundColor = menuActiveButtons.selected_background;
                            document.getElementById('without_role_without_project_' + project_id).style.color = menuActiveButtons.selected_color;

                        });
                    } catch (error) {
                        console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "sans rôle et sans projet")', error);
                    }
                    //#endregion


                    try {
                        // Récupérer le role de l'utilisateur connecté
                        if (userRole.includes('administrator') || userRole.includes('um_coordinateur') || userRole.includes('chef-de-projet')) {
                            document.getElementById(`close_Project_${project_id}`).style.display = 'block';
                            document.getElementById('buttonModifier_' + project_id).style.display = 'block';
                        } else {
                            document.getElementById(`close_Project_${project_id}`).style.display = 'none';
                            document.getElementById('buttonModifier_' + project_id).style.display = 'none';
                        }
                    } catch (error) {
                        console.error('Erreur: (Récupérer le role de l\'utilisateur connecté)', error);
                    }

                    try {
                        // Ajouter un gestionnaire d'événement pour chaque bouton "Aller au projet"
                        document.getElementById(`goTo_Project_${project_id}`).addEventListener('click', () => {
                            window.open(`https://lab.padem.org/accueil/partenaires/?projectId=${project_id}`, '_blank');
                        });
                    } catch (error) {
                        console.error('Erreur: (Aller au projet)', error);
                    }

                    try {
                        // Ajouter un gestionnaire d'événement pour chaque bouton "Fermer le projet"
                        document.getElementById(`close_Project_${project_id}`).addEventListener('click', () => {
                            Swal.fire({
                                title: 'Êtes-vous sûr de vouloir fermer ce projet?',
                                text: "Vous ne pourrez pas revenir en arrière !",
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#29',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Oui, fermer le projet!'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    fetch('https://lab.padem.org/wp-json/mo/v1/closeProject', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            'project_id': project_id,
                                        }),
                                    })
                                        .then(response => response.json())
                                        .then(data => {
                                            console.log('Projet fermé:', data);
                                            Swal.fire(
                                                'Projet fermé!',
                                                'Le projet a été fermé avec succès.',
                                                'success'
                                            );
                                        })
                                        .catch(error => {
                                            console.error('Erreur:', error);
                                        });
                                }
                            });
                        });
                    } catch (error) {
                        console.error('Erreur: (Fermer le projet)', error);
                    }

                    try {
                        // Ajouter un gestionnaire d'événement pour chaque bouton "Compléter le projet ou Modifier le projet"
                        document.getElementById(`buttonModifier_${project_id}`).addEventListener('click', () => {

                            if (document.getElementById(`modifyProject_${project_id}`).style.display === 'none') {
                                li.style.backgroundColor = '#f2f2f2';
                                document.getElementById(`modifyProject_${project_id}`).style.display = 'block';
                                document.getElementById(`buttonModifier_${project_id}`).style.backgroundColor = 'red';
                                document.getElementById(`buttonModifier_${project_id}`).innerText = 'Annuler';
                                document.getElementById(`close_Project_${project_id}`).style.display = 'none';
                                getProjects();
                                getAllWordPressMembers();
                            } else {
                                li.style.backgroundColor = '#ffffff';
                                document.getElementById(`modifyProject_${project_id}`).style.display = 'none';
                                document.getElementById(`buttonModifier_${project_id}`).innerText = 'Compléter le projet';
                                document.getElementById(`buttonModifier_${project_id}`).style.backgroundColor = 'green';
                                document.getElementById(`close_Project_${project_id}`).style.display = 'block';
                                //#region masquer les formulaires
                                document.getElementById('newMember_' + project_id).style.display = 'none';
                                document.getElementById('existingMember_' + project_id).style.display = 'none';
                                document.getElementById('newDocument_' + project_id).style.display = 'none';
                                document.getElementById('newLink_' + project_id).style.display = 'none';
                                document.getElementById('newMisc_' + project_id).style.display = 'none';
                                //#endregion
                            }

                            //#region Réinitialiser les couleurs des boutons
                            document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                            document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                            document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                            document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                            document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                            document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                            document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                            document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                            document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                            document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                            //#endregion
                        });
                    } catch (error) {
                        console.error('Erreur: (Compléter le projet ou Modifier le projet)', error);
                    }
                    //#endregion Ajouter les données dans l'élément de liste

                    try {

                        // Ajouter un gestionnaire d'événement pour chaque bouton "Nouveau membre", "Membre existant", "Demande de rapport", "Document model", "Ajouter un lien", "Ajouter divers"
                        try {
                            document.getElementById(`buttonExistingMember_${project_id}`).addEventListener('click', () => {
                                // Afficher le formulaire pour ajouter un membre existant
                                document.getElementById(`existingMember_${project_id}`).style.display = 'block';
                                document.getElementById('newMember_' + project_id).style.display = 'none';
                                document.getElementById('newDocument_' + project_id).style.display = 'none';
                                document.getElementById('newLink_' + project_id).style.display = 'none';
                                document.getElementById('newMisc_' + project_id).style.display = 'none';

                                // Changer le background du bouton cliqué
                                document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = '#29A6A7';
                                document.getElementById(`buttonExistingMember_${project_id}`).style.color = 'white';
                                document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                            });
                        } catch (error) {
                            console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "Membre existant")', error);
                        }

                        try {
                            document.getElementById('buttonDocumentModel_' + project_id).addEventListener('click', () => {
                                document.getElementById('newDocument_' + project_id).style.display = 'block';
                                document.getElementById('newMember_' + project_id).style.display = 'none';
                                document.getElementById('existingMember_' + project_id).style.display = 'none';
                                document.getElementById('newLink_' + project_id).style.display = 'none';
                                document.getElementById('newMisc_' + project_id).style.display = 'none';

                                // Changer le background du bouton cliqué
                                document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = '#29A6A7';
                                document.getElementById(`buttonDocumentModel_${project_id}`).style.color = 'white';
                                document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                            });
                        } catch (error) {
                            console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "Document model")', error);
                        }

                        try {
                            document.getElementById('buttonNewMember_' + project_id).addEventListener('click', () => {
                                document.getElementById('newMember_' + project_id).style.display = 'block';
                                document.getElementById('existingMember_' + project_id).style.display = 'none';
                                document.getElementById('newDocument_' + project_id).style.display = 'none';
                                document.getElementById('newLink_' + project_id).style.display = 'none';
                                document.getElementById('newMisc_' + project_id).style.display = 'none';

                                // Changer le background du bouton cliqué
                                document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = '#29A6A7';
                                document.getElementById(`buttonNewMember_${project_id}`).style.color = 'white';
                                document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                            });
                        } catch (error) {
                            console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "Nouveau membre")', error);
                        }

                        try {
                            document.getElementById('buttonAddLink_' + project_id).addEventListener('click', () => {
                                document.getElementById('newLink_' + project_id).style.display = 'block';
                                document.getElementById('newMember_' + project_id).style.display = 'none';
                                document.getElementById('existingMember_' + project_id).style.display = 'none';
                                document.getElementById('newDocument_' + project_id).style.display = 'none';
                                document.getElementById('newMisc_' + project_id).style.display = 'none';

                                // Changer le background du bouton cliqué
                                document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                                document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = '#29A6A7';
                                document.getElementById(`buttonAddLink_${project_id}`).style.color = 'white';
                                document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = 'white';
                                document.getElementById(`buttonAddDivers_${project_id}`).style.color = '#29A6A7';
                            });
                        } catch (error) {
                            console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "Ajouter un lien")', error);
                        }
                    } catch (error) {
                        console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "Nouveau membre", "Membre existant", "Demande de rapport", "Document model", "Ajouter un lien", "Ajouter divers")', error);
                    }
                    //#endregion
                    try {
                        document.getElementById('buttonAddDivers_' + project_id).addEventListener('click', () => {
                            document.getElementById('newMisc_' + project_id).style.display = 'block';
                            document.getElementById('newLink_' + project_id).style.display = 'none';
                            document.getElementById('newMember_' + project_id).style.display = 'none';
                            document.getElementById('existingMember_' + project_id).style.display = 'none';
                            document.getElementById('newDocument_' + project_id).style.display = 'none';

                            //#region Changer le background du bouton cliqué
                            document.getElementById(`buttonExistingMember_${project_id}`).style.backgroundColor = 'white';
                            document.getElementById(`buttonExistingMember_${project_id}`).style.color = '#29A6A7';
                            document.getElementById(`buttonNewMember_${project_id}`).style.backgroundColor = 'white';
                            document.getElementById(`buttonNewMember_${project_id}`).style.color = '#29A6A7';
                            document.getElementById(`buttonDocumentModel_${project_id}`).style.backgroundColor = 'white';
                            document.getElementById(`buttonDocumentModel_${project_id}`).style.color = '#29A6A7';
                            document.getElementById(`buttonAddLink_${project_id}`).style.backgroundColor = 'white';
                            document.getElementById(`buttonAddLink_${project_id}`).style.color = '#29A6A7';
                            document.getElementById(`buttonAddDivers_${project_id}`).style.backgroundColor = '#29A6A7';
                            document.getElementById(`buttonAddDivers_${project_id}`).style.color = 'white';
                            //#endregion
                        });
                    } catch (error) {
                        console.error('Erreur: (Ajouter un gestionnaire d\'événement pour chaque bouton "Ajouter divers")', error);
                    }

                    try {
                        // Afficher le statut du projet en fonction du nombre de membres
                        var numberOfMembers = document.querySelector(`#numberOfmember_${project_id}`);
                        if (numberOfMembers !== null && numberOfMembers !== undefined) {
                            var statusElement = document.getElementById(`status_${project_id}`);
                            if (statusElement !== null && statusElement !== undefined) {
                                if (document.getElementById(`numberOfmember_${project_id}`).value === 0) {
                                    statusElement.innerText = 'En attente';
                                    statusElement.style.color = 'red';
                                } else {
                                    statusElement.innerText = 'Publié';
                                    statusElement.style.color = 'green';
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Erreur: (Afficher le statut du projet en fonction du nombre de membres)', error);
                    }

                    //#region Fonctions

                    // Récupérer les noms et IDs de tout les projets
                    var projects = [];
                    function getProjects() {
                        fetch('https://lab.padem.org/wp-json/mo/v1/getProjectData', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                            .then(response => response.json())
                            .then(data => {
                                data.forEach(project => {
                                    projects.push({
                                        'project_id': project.project_id,
                                        'project_title': project.project_title
                                    });
                                });
                            })
                            .catch(error => {
                                console.error('Erreur lors de la récupération des données des projets :', error);
                            });
                    }

                    // Récupérer la liste de tout les membres de la plate-forme
                    var all_members = [];
                    function getAllWordPressMembers() {
                        document.getElementById(`loading`).style.display = 'block';
                        var stepper = 0;
                        fetch('https://lab.padem.org/wp-json/mo/v1/getAllMembers', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                            .then(response => response.json())
                            .then(data => {
                                var number_of_all_members = data.length;   // Nombre de tout les membres
                                data.forEach(user => {
                                    var userRole = '';
                                    if (all_users_roles.hasOwnProperty(user.ID))
                                        userRole = all_users_roles[user.ID][0];
                                    else
                                        userRole = 'subscriber';
                                    all_members.push({
                                        '_id': user.ID,
                                        'role': userRole,
                                        'display_name': user.display_name,
                                        'email': user.user_email,
                                        'user_registered_date': user.user_registered
                                    });
                                });

                                var counter_coordinateur = 0;
                                var counter_chef_de_projet = 0;
                                var counter_comptable = 0;
                                var counter_consultant = 0;
                                var counter_partenaire = 0;
                                var counter_abonne = 0;
                                var counter_with_project = 0;
                                var counter_with_role_without_project = 0;
                                var counter_without_role_without_project = 0;

                                // Afficher la liste de tout les membres
                                try {
                                    // Afficher la liste de tout les membres
                                    all_members.forEach(member => {

                                        //#region Style du conteneur de l'utilisateur
                                        var li = document.createElement('li');
                                        li.style.backgroundColor = 'white';
                                        li.style.color = 'black';
                                        li.style.border = '1px solid #29A6A7';
                                        li.style.borderRadius = '15px';
                                        li.style.margin = '5px';
                                        li.style.padding = '5px';
                                        li.style.fontSize = '13px';
                                        li.style.width = '100%';
                                        li.style.height = 'fit-content';
                                        li.style.display = 'flex';
                                        li.style.alignItems = 'fit-content';
                                        li.style.justifyContent = 'space-between';
                                        //#endregion

                                        //#region Style de la pastille contenant le role de l'utilisateur
                                        var role_span = document.createElement('span');
                                        role_span.style.backgroundColor = 'white';
                                        role_span.style.borderRadius = '15px';
                                        role_span.style.padding = '5px';
                                        role_span.style.margin = '5px';
                                        role_span.style.marginRight = '50px';
                                        role_span.style.fontSize = '13px';
                                        role_span.id = 'role_span' + member._id + project_id;

                                        if (member.role === 'administrator') {
                                            role_span.innerText = 'Administrateur';
                                            role_span.style.color = '#FF0000';
                                            role_span.style.border = '1px solid #FF0000';
                                        } else if (member.role === 'um_coordinateur') {
                                            role_span.innerText = 'Coordinateur';
                                            role_span.style.color = '#FFA500';
                                            role_span.style.border = '1px solid #FFA500';
                                        } else if (member.role === 'chef-de-projet') {
                                            role_span.innerText = 'Chef de projet';
                                            role_span.style.color = '#FFA500';
                                            role_span.style.border = '1px solid #FFA500';
                                        } else if (member.role === 'partenaire') {
                                            role_span.innerText = 'Partenaire';
                                            role_span.style.color = '#008000';
                                            role_span.style.border = '1px solid #008000';
                                        } else if (member.role === 'comptable') {
                                            role_span.innerText = 'Comptable';
                                            role_span.style.color = '#0000FF';
                                            role_span.style.border = '1px solid #0000FF';
                                        } else if (member.role === 'consultant') {
                                            role_span.innerText = 'Consultant';
                                            role_span.style.color = '#800080';
                                            role_span.style.border = '1px solid #800080';
                                        } else {
                                            role_span.innerText = 'Abonné';
                                            role_span.style.color = '#808080';
                                            role_span.style.border = '1px solid #808080';
                                        }
                                        //#endregion

                                        //#region Style du conteneur de l'adresse email de l'utilisateur
                                        var mail_container = document.createElement('span');
                                        mail_container.style.backgroundColor = 'white';
                                        mail_container.style.color = '#29A6A7';
                                        mail_container.style.borderRadius = '15px';
                                        mail_container.style.padding = '5px';
                                        mail_container.style.margin = '5px';
                                        mail_container.style.fontSize = '13px';
                                        mail_container.style.cursor = 'pointer';
                                        mail_container.id = 'mail_container' + member._id + project_id;
                                        mail_container.addEventListener('click', function () {
                                            window.location.href = 'mailto:' + member.email;
                                        });
                                        mail_container.innerHTML = member.email;
                                        //#endregion

                                        //#region Style pour afficher le sélecteur de projets
                                        getProjects();
                                        var select_projects = document.createElement('select');
                                        select_projects.style.backgroundColor = 'white';
                                        select_projects.style.borderRadius = '15px';
                                        select_projects.style.padding = '5px';
                                        select_projects.style.margin = '5px';
                                        select_projects.style.fontSize = '13px';
                                        select_projects.name = 'projects';
                                        select_projects.id = 'projects' + member._id + project_id;
                                        select_projects.innerHTML = `
                                            <option value="0">Choisir un projet</option>
                                        `;
                                        projects.forEach(project => {
                                            var option = document.createElement('option');
                                            option.value = project.project_id;
                                            option.innerText = project.project_title;
                                            select_projects.appendChild(option);
                                        });
                                        //#endregion

                                        //#region Style du bouton pour ajouter le membre à un ou plusieurs projets
                                        var add_member_to_project_button = document.createElement('button');
                                        add_member_to_project_button.style.backgroundColor = '#29A6A7';
                                        add_member_to_project_button.style.color = 'white';
                                        add_member_to_project_button.style.borderRadius = '15px';
                                        add_member_to_project_button.style.border = 'none';
                                        add_member_to_project_button.style.padding = '5px';
                                        add_member_to_project_button.style.margin = '5px';
                                        add_member_to_project_button.style.fontSize = '13px';
                                        add_member_to_project_button.innerText = 'Ajouter au projet';
                                        add_member_to_project_button.id = 'add_member_to_project_button' + member._id + project_id;
                                        add_member_to_project_button.addEventListener('click', function () {
                                            if (document.getElementById('projects' + member._id).value === '0') {
                                                alert('Veuillez choisir un projet');
                                            } else {
                                                addMemberToProject(document.getElementById('projects' + member._id).value, member.email);
                                                document.getElementById('remove_member_from_project_button' + member._id).style.display = 'block';
                                            }
                                        });
                                        //#endregion

                                        //#region Formater la date de création de compte de l'utilisateur (jour mois année heure minute)
                                        var formated_date = document.createElement('span');
                                        formated_date.style.backgroundColor = 'white';
                                        formated_date.style.borderRadius = '15px';
                                        formated_date.style.padding = '5px';
                                        formated_date.style.margin = '5px';
                                        formated_date.style.fontSize = '13px';
                                        formated_date.id = 'formated_date' + member._id + project_id;
                                        var date = new Date(member.user_registered_date);
                                        formated_date.innerText = date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear();
                                        //#endregion

                                        //#region Style du conteneur du nom du membre
                                        var name_container = document.createElement('span');
                                        name_container.style.backgroundColor = 'white';
                                        name_container.style.color = 'black';
                                        name_container.style.borderRadius = '15px';
                                        name_container.style.padding = '5px';
                                        name_container.style.margin = '5px';
                                        name_container.style.fontSize = '13px';
                                        name_container.id = 'name_container' + member._id + project_id;
                                        name_container.innerHTML = member.display_name;
                                        //#endregion

                                        //#region Style du conteneur du numéro de décompte des membres
                                        var numberOfMembers_container = document.createElement('span');
                                        numberOfMembers_container.style.backgroundColor = 'white';
                                        numberOfMembers_container.style.color = '#29A6A7';
                                        numberOfMembers_container.style.borderRadius = '15px';
                                        numberOfMembers_container.style.padding = '5px';
                                        numberOfMembers_container.style.margin = '5px';
                                        numberOfMembers_container.style.fontSize = '13px';
                                        numberOfMembers_container.id = 'numberOfMembers_container' + member._id + project_id;
                                        numberOfMembers_container.innerHTML = stepper + 1;
                                        //#endregion

                                        //#region Style du conteneur du bouton pour retirer un membre d'un projet
                                        var remove_member_from_project_button = document.createElement('button');
                                        remove_member_from_project_button.style.backgroundColor = '#D13010';
                                        remove_member_from_project_button.style.color = 'white';
                                        remove_member_from_project_button.style.borderRadius = '15px';
                                        remove_member_from_project_button.style.border = 'none';
                                        remove_member_from_project_button.style.padding = '5px';
                                        remove_member_from_project_button.style.margin = '5px';
                                        remove_member_from_project_button.style.fontSize = '13px';
                                        remove_member_from_project_button.innerText = 'Retirer du projet';
                                        remove_member_from_project_button.style.display = 'none';
                                        remove_member_from_project_button.id = 'remove_member_from_project_button' + member._id + project_id;
                                        remove_member_from_project_button.addEventListener('click', function () {
                                            if (document.getElementById('projects' + member._id).value === '0') {
                                                alert('Veuillez choisir un projet');
                                            } else {
                                                removeMemberFromProject(document.getElementById('projects' + member._id).value, member.email);
                                            }
                                        });
                                        //#endregion

                                        // Incrémenter le décompte des membres
                                        stepper++;

                                        li.innerHTML = `
                                            ${numberOfMembers_container.outerHTML}  <i class="fas fa-user"></i> ${name_container.outerHTML}   ${role_span.outerHTML}  ${select_projects.outerHTML}  ${add_member_to_project_button.outerHTML} ${remove_member_from_project_button.outerHTML}
                                        `;
                                        document.getElementById('tous-' + project_id).appendChild(li);
                                        try {

                                            //#region Afficher les membres avec un projet
                                            fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable', {
                                                method: 'GET',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                            })
                                                .then(response => response.json())
                                                .then(data => {
                                                    var numberOfProjects = 0;
                                                    var counte_just_one_time = 0;
                                                    data.forEach(project => {
                                                        if (project.user_email === member.email) {
                                                            numberOfProjects++;
                                                            counte_just_one_time++;
                                                            if (counte_just_one_time === 1) {
                                                                counter_with_project++;
                                                            }

                                                            var numberOfmember_container = document.createElement('span');
                                                            numberOfmember_container.style.backgroundColor = 'white';
                                                            numberOfmember_container.style.color = '#29A6A7';
                                                            numberOfmember_container.style.borderRadius = '15px';
                                                            numberOfmember_container.style.padding = '5px';
                                                            numberOfmember_container.style.margin = '5px';
                                                            numberOfmember_container.style.fontSize = '13px';
                                                            numberOfmember_container.id = 'numberOfmember_container' + member._id + project_id;
                                                            numberOfmember_container.innerText = numberOfProjects + ' projet(s)';

                                                            var li_with_project = document.createElement('li');
                                                            li_with_project.style.backgroundColor = 'white';
                                                            li_with_project.style.color = 'black';
                                                            li_with_project.style.border = '1px solid #29A6A7';
                                                            li_with_project.style.borderRadius = '15px';
                                                            li_with_project.style.margin = '5px';
                                                            li_with_project.style.padding = '5px';
                                                            li_with_project.style.fontSize = '13px';
                                                            li_with_project.style.width = '100%';
                                                            li_with_project.style.height = 'fit-content';
                                                            li_with_project.style.display = 'flex';
                                                            li_with_project.style.alignItems = 'fit-content';
                                                            li_with_project.style.justifyContent = 'space-between';
                                                            li_with_project.id = 'li_with_project' + member._id + project_id;

                                                            // Style du conteneur du numéro de décompte des membres avec un projet
                                                            var numberOfMembersWithProject_container = document.createElement('span');
                                                            numberOfMembersWithProject_container.style.backgroundColor = 'white';
                                                            numberOfMembersWithProject_container.style.color = '#29A6A7';
                                                            numberOfMembersWithProject_container.style.borderRadius = '15px';
                                                            numberOfMembersWithProject_container.style.padding = '5px';
                                                            numberOfMembersWithProject_container.style.margin = '5px';
                                                            numberOfMembersWithProject_container.style.fontSize = '13px';
                                                            numberOfMembersWithProject_container.id = 'numberOfMembersWithProject_container' + member._id + project_id;
                                                            numberOfMembersWithProject_container.innerHTML = counter_with_project;


                                                            li_with_project.innerHTML = `
                                                                ${numberOfMembersWithProject_container.outerHTML}  <i class="fas fa-user"></i>  ${name_container.outerHTML}  ${role_span.outerHTML}  ${select_projects.outerHTML}  ${add_member_to_project_button.outerHTML} ${numberOfmember_container.outerHTML} ${remove_member_from_project_button.outerHTML}
                                                            `;
                                                            document.getElementById('with-project-' + project_id).appendChild(li_with_project);
                                                        }
                                                    });
                                                    if (numberOfProjects === 0) {
                                                        document.getElementById('with-project-' + project_id).innerText = 'Aucun membre avec un projet n\'a été trouvé';
                                                    }
                                                })
                                                .catch(error => {
                                                    console.error('Erreur lors de la récupération des données de l\'utilisateur :', error);
                                                });
                                            //#endregion

                                        } catch (error) {
                                            console.log('Erreur lors de l\'exécution du script (afficher les membres avec un projet) :', error);
                                        }

                                        try {

                                            //#region Afficher les membres avec un rôle et sans projet
                                            fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable', {
                                                method: 'GET',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                            })
                                                .then(response => response.json())
                                                .then(data => {
                                                    var numberOfProjects = 0;
                                                    var counte_just_one_time = 0;
                                                    data.forEach(project => {
                                                        counte_just_one_time++;
                                                        if (project.user_email === member.email) {
                                                            numberOfProjects++;
                                                        }
                                                    });
                                                    if (numberOfProjects === 0 && member.role !== 'subscriber') {
                                                        counter_with_role_without_project++;
                                                        var li_with_role_without_project = document.createElement('li');
                                                        li_with_role_without_project.style.backgroundColor = 'white';
                                                        li_with_role_without_project.style.color = 'black';
                                                        li_with_role_without_project.style.border = '1px solid #29A6A7';
                                                        li_with_role_without_project.style.borderRadius = '15px';
                                                        li_with_role_without_project.style.margin = '5px';
                                                        li_with_role_without_project.style.padding = '5px';
                                                        li_with_role_without_project.style.fontSize = '13px';
                                                        li_with_role_without_project.style.width = '100%';
                                                        li_with_role_without_project.style.height = 'fit-content';
                                                        li_with_role_without_project.style.display = 'flex';
                                                        li_with_role_without_project.style.alignItems = 'left';
                                                        li_with_role_without_project.style.justifyContent = 'space-between';
                                                        li_with_role_without_project.id = 'li_with_role_without_project' + member._id;

                                                        // Style du conteneur du numéro de décompte des membres avec un rôle et sans projet
                                                        var numberOfMembersWithRoleWithoutProject_container = document.createElement('span');
                                                        numberOfMembersWithRoleWithoutProject_container.style.backgroundColor = 'white';
                                                        numberOfMembersWithRoleWithoutProject_container.style.color = '#29A6A7';
                                                        numberOfMembersWithRoleWithoutProject_container.style.borderRadius = '15px';
                                                        numberOfMembersWithRoleWithoutProject_container.style.padding = '5px';
                                                        numberOfMembersWithRoleWithoutProject_container.style.margin = '5px';
                                                        numberOfMembersWithRoleWithoutProject_container.style.fontSize = '13px';
                                                        numberOfMembersWithRoleWithoutProject_container.id = 'numberOfMembersWithRoleWithoutProject_container' + member._id + project_id;
                                                        numberOfMembersWithRoleWithoutProject_container.innerHTML = counter_with_role_without_project;

                                                        li_with_role_without_project.innerHTML = `
                                                            ${numberOfMembersWithRoleWithoutProject_container.outerHTML}  <i class="fas fa-user"></i> ${name_container.outerHTML}   ${role_span.outerHTML}  ${select_projects.outerHTML}  ${add_member_to_project_button.outerHTML} ${remove_member_from_project_button.outerHTML}
                                                            `;
                                                        document.getElementById('with-role-without-project-' + project_id).appendChild(li_with_role_without_project);
                                                    }
                                                })
                                                .catch(error => {
                                                    console.error('Erreur lors de la récupération des données de l\'utilisateur :', error);
                                                });
                                            //#endregion

                                        } catch (error) {
                                            console.log('Erreur lors de l\'exécution du script (afficher les membres avec un rôle et sans projet) :', error);
                                        }

                                        //#region Afficher les membres sans rôle et sans projet
                                        try {

                                            fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable', {
                                                method: 'GET',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                            })
                                                .then(response => response.json())
                                                .then(data => {
                                                    var numberOfProjects = 0;
                                                    var counte_just_one_time = 0;
                                                    data.forEach(project => {
                                                        if (project.user_email === member.email) {
                                                            numberOfProjects++;
                                                        }
                                                    });
                                                    if (numberOfProjects === 0 && member.role === 'subscriber') {
                                                        counter_without_role_without_project++;
                                                        var li_without_role_without_project = document.createElement('li');
                                                        li_without_role_without_project.style.backgroundColor = 'white';
                                                        li_without_role_without_project.style.color = 'black';
                                                        li_without_role_without_project.style.border = '1px solid #29A6A7';
                                                        li_without_role_without_project.style.borderRadius = '15px';
                                                        li_without_role_without_project.style.margin = '5px';
                                                        li_without_role_without_project.style.padding = '5px';
                                                        li_without_role_without_project.style.fontSize = '13px';
                                                        li_without_role_without_project.style.width = '100%';
                                                        li_without_role_without_project.style.height = 'fit-content';
                                                        li_without_role_without_project.style.display = 'flex';
                                                        li_without_role_without_project.style.alignItems = 'left';
                                                        li_without_role_without_project.style.justifyContent = 'space-between';
                                                        li_without_role_without_project.id = 'li_without_role_without_project' + member._id + project_id;

                                                        // Style du conteneur du numéro de décompte des membres sans rôle et sans projet
                                                        var numberOfMembersWithoutRoleWithoutProject_container = document.createElement('span');
                                                        numberOfMembersWithoutRoleWithoutProject_container.style.backgroundColor = 'white';
                                                        numberOfMembersWithoutRoleWithoutProject_container.style.color = '#29A6A7';
                                                        numberOfMembersWithoutRoleWithoutProject_container.style.borderRadius = '15px';
                                                        numberOfMembersWithoutRoleWithoutProject_container.style.padding = '5px';
                                                        numberOfMembersWithoutRoleWithoutProject_container.style.margin = '5px';
                                                        numberOfMembersWithoutRoleWithoutProject_container.style.fontSize = '13px';
                                                        numberOfMembersWithoutRoleWithoutProject_container.id = 'numberOfMembersWithoutRoleWithoutProject_container' + member._id + project_id;
                                                        numberOfMembersWithoutRoleWithoutProject_container.innerHTML = counter_without_role_without_project;

                                                        li_without_role_without_project.innerHTML = `
                                                            ${numberOfMembersWithoutRoleWithoutProject_container.outerHTML}  <i class="fas fa-user"></i> ${name_container.outerHTML}  ${role_span.outerHTML} ${select_projects.outerHTML}  ${add_member_to_project_button.outerHTML} ${remove_member_from_project_button.outerHTML}
                                                        `;
                                                        document.getElementById('without-role-without-project-' + project_id).appendChild(li_without_role_without_project);
                                                    }
                                                })
                                                .catch(error => {
                                                    console.error('Erreur lors de la récupération des données de l\'utilisateur :', error);
                                                });
                                            //#endregion

                                        } catch (error) {
                                            console.log('Erreur lors de l\'exécution du script (afficher les membres sans rôle et sans projet) :', error);
                                        }
                                    });

                                } catch (error) {
                                    console.log('Erreur lors de l\'exécution du script (afficher la liste des membres) :', error);
                                }
                                // Masquer le spinner
                                document.getElementById('loading').style.display = 'none';
                            })
                            .catch(error => {
                                console.error('Erreur lors de la récupération des données de l\'utilisateur :', error);
                            });
                    }

                    // Ajouter un membre à un projet
                    function addMemberToProject(projectId, member_email) {
                        var member = {
                            'project_id': projectId,
                            'user_email': member_email
                        };

                        //#region Vérifier si le membre est déjà dans le projet
                        fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                            .then(response => response.json())
                            .then(data => {
                                var isMemberAlreadyInProject = false;
                                data.forEach(project => {
                                    if (project.project_id === projectId && project.user_email === member_email) {
                                        isMemberAlreadyInProject = true;
                                    }
                                });
                                if (isMemberAlreadyInProject) {
                                    alert('Le membre est déjà dans le projet');
                                } else {
                                    // Ajouter le membre au projet
                                    fetch('https://lab.padem.org/wp-json/mo/v1/createWorkingTable', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify(member),
                                    })
                                        .then(response => response.json())
                                        .then(data => {
                                            alert('Membre ajouté avec succès !');
                                            console.log('Membre ajouté avec succès :', data);
                                        })
                                        .catch(error => {
                                            console.error('Erreur lors de l\'ajout du membre :', error);
                                        });
                                }
                            })
                            .catch(error => {
                                console.error('Erreur lors de la récupération des données des projets :', error);
                            });
                        //#endregion
                    }

                    // Retirer un membre d'un projet
                    function removeMemberFromProject(projectId, member_email) {
                        var member = {
                            'project_id': projectId,
                            'user_email': member_email
                        };

                        //#region Vérifier si le membre est déjà dans le projet
                        fetch('https://lab.padem.org/wp-json/mo/v1/getWorkingTable', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                            .then(response => response.json())
                            .then(data => {
                                var isMemberAlreadyInProject = false;
                                var all_emails = [];
                                var id = 0;
                                data.forEach(project => {
                                    all_emails.push(project.user_email);
                                    if (project.project_id === projectId && project.user_email === member_email) {
                                        isMemberAlreadyInProject = true;
                                        id = project.id;
                                    }
                                });
                                if (!isMemberAlreadyInProject) {
                                    alert('Le membre n\'est pas dans le projet');
                                } else {
                                    var new_emails = all_emails.filter(email => email !== member_email);
                                    // Retirer le membre du projet
                                    fetch('https://lab.padem.org/wp-json/mo/v1/removeWorkingTable', {
                                        method: 'DELETE',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            'id': id,
                                        }),
                                    })
                                        .then(response => response.json())
                                        .then(data => {
                                            // Mettre à jour la liste des membres
                                            fetch('https://lab.padem.org/wp-json/mo/v1/createWorkingTable', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                            })
                                                .then(response => response.json())
                                                .then(data => {
                                                    console.log('Liste des membres mise à jour avec succès :', data);
                                                })
                                                .catch(error => {
                                                    console.error('Erreur lors de la récupération des données des projets :', error);
                                                });
                                            alert('Membre retiré avec succès !');
                                            console.log('Membre retiré avec succès :', data);
                                        })
                                        .catch(error => {
                                            console.error('Erreur lors du retrait du membre :', error);
                                        });
                                }
                            })
                            .catch(error => {
                                console.error('Erreur lors de la récupération des données des projets :', error);
                            });
                        //#endregion
                    }

                    //#endregion

                    tabStepper++;
                    projectStepper++;
                });
                // Masquer le spinner
                document.getElementById('loading').style.display = 'none';
            })
            .catch(error => {
                console.error(error);
                // Afficher un message d'erreur
                alert('Une erreur est survenue : ', error);
            });
    });
</script>